import{ay as z,aB as i,bF as fe,aD as s,b7 as G,aE as W,aF as w,aG as n,aI as _,aH as t,aK as F,aJ as y,b8 as S,aL as ve,aC as r,cN as ke,b3 as H,aU as te,b6 as ne,aV as le,aW as J,aX as be,b2 as $,bJ as ee,bI as O,bK as U,b1 as q,aS as K,c0 as j,cf as se,cG as oe,cg as we,bG as ae}from"./admin-Ca7cl6NN.js";import{_ as ge}from"./MemberFormContent.vue_vue_type_script_setup_true_lang-BkezDNsU.js";import{l as I}from"./permission-api-BDoWsP34.js";import"./workspace-CiflQXiK.js";const he={style:{flex:"auto"}},$e=z({__name:"AddMemberDrawer",props:{currentWorkspace:{}},emits:["refresh"],setup(T,{expose:g,emit:C}){const v=T,k=C,m=i(!1),d=i(!1),f=i([]),R=i(!1),V=i([]),M=i([]),D=i([]);async function u(){var e;try{const l=await ve.getUserList(R);M.value=[{path:"user_ids",label:r("views.role.member.title"),rules:[{required:!0,message:`${r("common.selectPlaceholder")}${r("views.role.member.title")}`}],selectProps:{options:((e=l.data)==null?void 0:e.map(p=>({label:p.nick_name,value:p.id})))||[],placeholder:`${r("common.selectPlaceholder")}${r("views.role.member.title")}`}}]}catch(l){console.error(l)}}async function a(){var e;try{const l=await I("workspace").getWorkspaceRoleList(R);D.value=[{path:"role_ids",label:r("views.role.member.role"),rules:[{required:!0,message:`${r("common.selectPlaceholder")}${r("views.role.member.role")}`}],selectProps:{options:((e=l.data.filter(p=>p.type!==ke.ADMIN))==null?void 0:e.map(p=>({label:p.name,value:p.id})))||[],placeholder:`${r("common.selectPlaceholder")}${r("views.role.member.role")}`}}]}catch(l){console.error(l)}}function c(){V.value=[...M.value,...D.value],f.value=[{user_ids:[],role_ids:[]}]}fe(async()=>{await u(),await a(),c()});function h(){c(),d.value=!0}function b(){d.value=!1}const P=i();function o(){var e;(e=P.value)==null||e.validate().then(async l=>{var p;l&&(await I("workspace").CreateWorkspaceMember((p=v.currentWorkspace)==null?void 0:p.id,f.value,m),H(r("common.addSuccess")),b(),k("refresh"))})}return g({open:h}),(e,l)=>{const p=s("el-button"),L=s("el-drawer"),N=G("loading");return w(),W(L,{modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=A=>d.value=A),size:"600","destroy-on-close":!0,"before-close":b},{header:n(()=>[_("h4",null,y(e.$t("views.role.member.add")),1)]),default:n(()=>[S(t(ge,{ref_key:"memberFormContentRef",ref:P,models:V.value,form:f.value,"onUpdate:form":l[0]||(l[0]=A=>f.value=A),keepOneLine:""},null,8,["models","form"]),[[N,R.value]])]),footer:n(()=>[_("div",he,[t(p,{onClick:b},{default:n(()=>[F(y(e.$t("common.cancel")),1)]),_:1}),t(p,{type:"primary",onClick:l[1]||(l[1]=A=>o()),loading:m.value},{default:n(()=>[F(y(e.$t("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["modelValue"])}}}),Ce={class:"flex-between mb-16"},ye={class:"flex complex-search"},We=z({__name:"Member",props:{currentWorkspace:{}},setup(T){const g=T,C=i(!1),v=i("username"),k=i({username:"",nick_name:""}),m=te({current_page:1,page_size:20,total:0}),d=i([]);async function f(){var a,c;if((a=g.currentWorkspace)!=null&&a.id)try{const h={[v.value]:k.value[v.value]},b=await I("workspace").getWorkspaceMemberList((c=g.currentWorkspace)==null?void 0:c.id,m,h,C);d.value=b.data.records,m.total=b.data.total}catch(h){console.error(h)}}function R(){m.current_page=1,f()}ne(()=>{f()}),le(()=>{var a;return(a=g.currentWorkspace)==null?void 0:a.id},()=>{f()});const V=({row:a,column:c,rowIndex:h,columnIndex:b})=>{if(c.property==="nick_name"||c.property==="username"){const P=d.value.filter(o=>o.user_id===a.user_id);return h===d.value.findIndex(o=>o.user_id===a.user_id)?{rowspan:P.length,colspan:1}:{rowspan:0,colspan:0}}},M=i();function D(){var a;(a=M.value)==null||a.open()}function u(a){j(`${r("views.workspace.member.delete.confirmTitle")}${a.nick_name} ?`,"",{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{var c;C.value=!0,I("workspace").deleteWorkspaceMember((c=g.currentWorkspace)==null?void 0:c.id,a.user_relation_id,C).then(()=>{H(r("common.deleteSuccess")),f()})}).catch(()=>{})}return(a,c)=>{const h=s("el-button"),b=s("el-option"),P=s("el-select"),o=s("el-input"),e=s("el-table-column"),l=s("AppIcon"),p=s("el-tooltip"),L=s("app-table"),N=G("hasPermission"),A=G("loading");return w(),J(be,null,[_("div",Ce,[S((w(),W(h,{type:"primary",onClick:D},{default:n(()=>[F(y(a.$t("views.role.member.add")),1)]),_:1})),[[N,new($(ee))([$(O).ADMIN,$(O).WORKSPACE_MANAGE.getWorkspaceRole],[$(U).WORKSPACE_ADD_MEMBER,$(U).WORKSPACE_WORKSPACE_ADD_MEMBER.getWorkspacePermissionWorkspaceManageRole],[],"OR")]]),_("div",ye,[t(P,{class:"complex-search__left",modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=E=>v.value=E),style:{width:"120px"}},{default:n(()=>[t(b,{label:a.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),t(b,{label:a.$t("views.userManage.userForm.nick_name.label"),value:"nick_name"},null,8,["label"])]),_:1},8,["modelValue"]),v.value==="username"?(w(),W(o,{key:0,modelValue:k.value.username,"onUpdate:modelValue":c[1]||(c[1]=E=>k.value.username=E),onChange:f,placeholder:a.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):v.value==="nick_name"?(w(),W(o,{key:1,modelValue:k.value.nick_name,"onUpdate:modelValue":c[2]||(c[2]=E=>k.value.nick_name=E),onChange:f,placeholder:a.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):q("",!0)])]),S((w(),W(L,{data:d.value,"pagination-config":m,onSizeChange:R,onChangePage:f,class:"member-table","span-method":V,maxTableHeight:320},{default:n(()=>[t(e,{prop:"nick_name",label:a.$t("views.userManage.userForm.nick_name.label")},null,8,["label"]),t(e,{prop:"username",label:a.$t("views.login.loginForm.username.label")},null,8,["label"]),t(e,{prop:"role_name",label:a.$t("views.role.member.role")},null,8,["label"]),t(e,{label:a.$t("common.operation"),width:"100",fixed:"right"},{default:n(({row:E})=>[t(p,{effect:"dark",content:`${a.$t("views.role.member.delete.button")}`,placement:"top"},{default:n(()=>[S((w(),W(h,{type:"primary",text:"",onClick:K(X=>u(E),["stop"])},{default:n(()=>[t(l,{iconName:"app-delete-users"})]),_:1},8,["onClick"])),[[N,new($(ee))([$(O).ADMIN,$(O).WORKSPACE_MANAGE.getWorkspaceRole],[$(U).WORKSPACE_REMOVE_MEMBER,$(U).WORKSPACE_WORKSPACE_REMOVE_MEMBER.getWorkspacePermissionWorkspaceManageRole],[],"OR")]])]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[A,C.value]]),t($e,{ref_key:"addMemberDrawerRef",ref:M,currentWorkspace:g.currentWorkspace,onRefresh:f},null,8,["currentWorkspace"])],64)}}}),Re=se(We,[["__scopeId","data-v-b3a66da8"]]),Me={class:"dialog-footer"},Pe=z({__name:"CreateOrUpdateWorkspaceDialog",emits:["refresh"],setup(T,{expose:g,emit:C}){const v=C,k=i(!1),m={name:""},d=i({...m});function f(u){u?d.value={id:u.id,name:u.name}:d.value={...m},k.value=!0}const R=i(),V=te({name:[{required:!0,message:`${r("common.inputPlaceholder")}${r("views.workspace.name")}`,trigger:"blur"}]}),M=i(!1),D=async u=>{u&&await u.validate(a=>{a&&I("workspace").CreateOrUpdateWorkspace(d.value,M).then(c=>{H(d.value.id?r("common.renameSuccess"):r("common.createSuccess")),v("refresh",c.data),k.value=!1})})};return g({open:f}),(u,a)=>{const c=s("el-input"),h=s("el-form-item"),b=s("el-form"),P=s("el-button"),o=s("el-dialog");return w(),W(o,{title:`${d.value.id?u.$t("common.rename"):u.$t("common.create")}${u.$t("views.workspace.title")}`,modelValue:k.value,"onUpdate:modelValue":a[4]||(a[4]=e=>k.value=e),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:n(()=>[_("span",Me,[t(P,{onClick:a[2]||(a[2]=K(e=>k.value=!1,["prevent"]))},{default:n(()=>[F(y(u.$t("common.cancel")),1)]),_:1}),t(P,{type:"primary",onClick:a[3]||(a[3]=e=>D(R.value)),loading:M.value},{default:n(()=>[F(y(d.value.id?u.$t("common.save"):u.$t("common.create")),1)]),_:1},8,["loading"])])]),default:n(()=>[t(b,{"label-position":"top",ref_key:"formRef",ref:R,rules:V,model:d.value,"require-asterisk-position":"right",onSubmit:a[1]||(a[1]=K(()=>{},["prevent"]))},{default:n(()=>[t(h,{label:u.$t("views.workspace.name"),prop:"name"},{default:n(()=>[t(c,{modelValue:d.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value.name=e),maxlength:"64","show-word-limit":"",placeholder:`${u.$t("common.inputPlaceholder")}${u.$t("views.workspace.name")}`},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Ae={class:"workspace-manage p-16-24"},Ee={class:"mb-16"},Ve={class:"flex main-calc-height"},De={class:"workspace-left border-r"},Se={class:"p-24 pb-0"},Ie={class:"flex-between mb-12"},Oe={class:"medium"},Ue={class:"list-height-left"},Fe={class:"p-8-16"},Ne={class:"flex-between"},Be=["title"],Ke={class:"workspace-right p-24"},Te={class:"flex align-center mb-16"},Le={class:"medium"},xe={class:"color-input-placeholder ml-4"},Ge=z({__name:"index",setup(T){const g=i(""),C=i(!1),v=i([]),k=i([]),m=i();async function d(){try{const o=await I("workspace").getSystemWorkspaceList(C);v.value=o.data,k.value=M(v.value,g.value)}catch(o){console.error(o)}}ne(async()=>{await d(),m.value=v.value[0]});const f=()=>ae([O.ADMIN,U.WORKSPACE_EDIT],"OR"),R=()=>ae([O.ADMIN,U.WORKSPACE_DELETE],"OR");async function V(o){await d(),o?m.value=o:m.value=v.value.find(e=>{var l;return e.id===((l=m.value)==null?void 0:l.id)})}function M(o,e){return e.length?o.filter(l=>l.name.toLowerCase().includes(e.toLowerCase())):o}le(g,o=>{k.value=M(v.value,o)});function D(o){m.value=o}const u=i();function a(o){var e;(e=u.value)==null||e.open(o)}async function c(o){try{return await I("workspace").deleteWorkspaceCheck(o)}catch(e){console.log(e)}}async function h(o){const e=await c(o.id);(e?e.data.can_delete:!0)?j(`${r("views.workspace.delete.confirmTitle")}${o.name} ?`,r("views.workspace.delete.confirmContent"),{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{I("workspace").deleteWorkspace(o.id,C).then(async()=>{var p;H(r("common.deleteSuccess")),await d(),m.value=o.id===((p=m.value)==null?void 0:p.id)?v.value[0]:m.value})}):j(`${r("views.workspace.delete.confirmTitle")}${o.name} ?`,e?e.data.message:r("views.workspace.delete.confirmContent"),{showConfirmButton:!1,cancelButtonText:r("common.close")})}const b=i("");function P(o){b.value=o.id}return(o,e)=>{const l=s("AppIcon"),p=s("el-button"),L=s("el-tooltip"),N=s("el-input"),A=s("el-dropdown-item"),E=s("el-dropdown-menu"),X=s("el-dropdown"),re=s("common-list"),ce=s("el-scrollbar"),ie=s("el-divider"),me=s("UserFilled"),de=s("el-icon"),ue=s("el-card"),pe=G("hasPermission"),Q=G("loading");return w(),J("div",Ae,[_("h2",Ee,y(o.$t("views.workspace.title")),1),t(ue,{style:{"--el-card-padding":"0"}},{default:n(()=>{var Y,Z;return[_("div",Ve,[_("div",De,[_("div",Se,[_("div",Ie,[_("h4",Oe,y(o.$t("views.workspace.list")),1),t(L,{effect:"dark",content:`${o.$t("common.create")}${o.$t("views.workspace.title")}`,placement:"top"},{default:n(()=>[S((w(),W(p,{type:"primary",text:"",onClick:e[0]||(e[0]=x=>a())},{default:n(()=>[t(l,{iconName:"app-add-outlined"})]),_:1})),[[pe,[$(O).ADMIN,$(U).WORKSPACE_CREATE]]])]),_:1},8,["content"])]),t(N,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=x=>g.value=x),placeholder:o.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),_("div",Ue,[S((w(),W(ce,null,{default:n(()=>{var x;return[_("div",Fe,[t(re,{data:k.value,onClick:D,"default-active":(x=m.value)==null?void 0:x.id,onMouseenter:P,onMouseleave:e[3]||(e[3]=B=>b.value="")},{default:n(({row:B})=>[_("div",Ne,[_("span",{class:"ellipsis",title:B.name},y($(oe)(B.name)),9,Be),S(_("div",{onClick:e[2]||(e[2]=K(()=>{},["stop"]))},[f()||R()?(w(),W(X,{key:0,teleported:!1,trigger:"click"},{dropdown:n(()=>[t(E,{style:{"min-width":"80px"}},{default:n(()=>[f()?(w(),W(A,{key:0,onClick:K(_e=>a(B),["stop"]),class:"p-8"},{default:n(()=>[t(l,{iconName:"app-edit",class:"color-secondary"}),F(" "+y(o.$t("common.rename")),1)]),_:1},8,["onClick"])):q("",!0),R()?(w(),W(A,{key:1,onClick:K(_e=>h(B),["stop"]),class:"border-t p-8"},{default:n(()=>[t(l,{iconName:"app-delete",class:"color-secondary"}),F(" "+y(o.$t("common.delete")),1)]),_:1},8,["onClick"])):q("",!0)]),_:2},1024)]),default:n(()=>[t(p,{text:""},{default:n(()=>[t(l,{iconName:"app-more"})]),_:1})]),_:2},1024)):q("",!0)],512),[[we,b.value===B.id]])])]),empty:n(()=>[...e[4]||(e[4]=[_("span",null,null,-1)])]),_:1},8,["data","default-active"])])]}),_:1})),[[Q,C.value]])])]),S((w(),J("div",Ke,[_("div",Te,[_("h4",Le,y($(oe)((Y=m.value)==null?void 0:Y.name)),1),t(ie,{direction:"vertical",class:"mr-8 ml-8"}),t(de,{class:"color-input-placeholder"},{default:n(()=>[t(me)]),_:1}),_("span",xe,y((Z=m.value)==null?void 0:Z.user_count),1)]),t(Re,{currentWorkspace:m.value},null,8,["currentWorkspace"])])),[[Q,C.value]])])]}),_:1}),t(Pe,{ref_key:"createOrUpdateWorkspaceDialogRef",ref:u,onRefresh:V},null,512)])}}}),je=se(Ge,[["__scopeId","data-v-8d855397"]]);export{je as default};
