import{ay as Ve,az as Ae,aP as xe,aA as Se,aO as ze,aQ as Ne,aB as p,aC as _,aU as Ue,aV as Le,b6 as Pe,aL as Re,aD as n,aW as S,aF as s,aH as l,aG as t,aK as v,aJ as r,b2 as y,aI as i,aE as u,b1 as z,aX as M,aY as B,bX as Ee,bY as Te,aS as N,bZ as oe,bW as Ie,b_ as Fe,b$ as O,c0 as Me,b3 as Be,c1 as Oe}from"./admin-Ca7cl6NN.js";import{l as We}from"./permission-api-BDoWsP34.js";import"./workspace-CiflQXiK.js";const De={class:"p-16-24"},Je={class:"ml-4 color-text-primary"},He={class:"flex-between mb-16"},Ke={class:"complex-search"},Xe={class:"table-name flex align-center"},Ye=["src"],qe={class:"filter"},Ge={class:"form-item mb-16"},Qe={class:"text-right"},Ze={key:0,class:"flex align-center"},je={class:"color-text-primary"},ea={key:1,class:"flex align-center"},aa={class:"color-text-primary"},la={class:"filter"},ta={class:"form-item mb-16 ml-4"},oa={class:"text-right"},na={class:"mr-8"},sa={class:"mr-8"},pa=Ve({__name:"ApplicationResourceIndex",setup(ia){const ne=Ae();xe();const{user:H,application:se}=Se(),f=ze(()=>Ne.application.systemManage),ie=()=>f.value.overview_read()||f.value.access_read()||f.value.edit()||f.value.chat_log_read()||f.value.chat_user_read(),re=()=>f.value.export()||f.value.delete()||f.value.auth(),K=p();function ue(e){K.value.open(e.id)}const W=p([]);function ce(e){var m,V;(V=(m=e==null?void 0:e.work_flow)==null?void 0:m.nodes)==null||V.filter(c=>c.id==="base-node").map(c=>{W.value=c.properties.api_input_field_list?c.properties.api_input_field_list.map(d=>({name:d.variable,value:d.default_value})):c.properties.input_field_list?c.properties.input_field_list.filter(d=>d.assignment_method==="api_input").map(d=>({name:d.variable,value:d.default_value})):[]});const o=X(W.value)?"?"+X(W.value):"";O.getAccessToken(e.id,L).then(c=>{var d;window.open(se.location+((d=c==null?void 0:c.data)==null?void 0:d.access_token)+o)})}function X(e){const o=new URLSearchParams;return e.forEach(m=>{o.append(encodeURIComponent(m.name),encodeURIComponent(m.value))}),o.toString()}function pe(e){Me(`${_("views.application.delete.confirmTitle")}${e.name} ?`,_("views.application.delete.confirmMessage"),{confirmButtonText:_("common.confirm"),cancelButtonText:_("common.cancel"),confirmButtonClass:"danger"}).then(()=>{O.delApplication(e.id,L).then(()=>{const o=P.value.findIndex(m=>m.id===e.id);P.value.splice(o,1),Be(_("common.deleteSuccess"))})}).catch(()=>{})}const me=e=>{O.exportApplication(e.id,e.name,L).catch(o=>{o.response.status!==403&&o.response.data.text().then(m=>{Oe(`${_("views.application.tip.ExportError")}:${JSON.parse(m).message}`)})})},g=p("name"),b=p({name:"",create_user:"",type:""}),Y=p([]),de=p([{label:_("views.application.workflow"),value:"WORK_FLOW"},{label:_("views.application.simple"),value:"SIMPLE"}]),L=p(!1),P=p([]),D=Ue({current_page:1,page_size:20,total:0}),R=p([]),E=p(!1),$=p([]),T=p(!1),C=p([]),ve=p([{label:_("views.application.status.published"),value:!0},{label:_("views.application.status.unpublished"),value:!1}]),U=p(""),I=p([]);Le([()=>R.value,()=>U.value],()=>{U.value.length||(I.value=R.value),I.value=R.value.filter(e=>e.label.toLowerCase().includes(U.value.toLowerCase()))},{immediate:!0});function q(e){e==="clear"&&($.value=[]),U.value="",w(),E.value=!1}function G(e){e==="clear"&&(C.value=[]),w(),T.value=!1}async function _e(){if(H.isEE()){const e=await We("workspace").getSystemWorkspaceList(L);R.value=e.data.map(o=>({label:o.name,value:o.id}))}}const fe=()=>{b.value={name:"",create_user:"",type:""}};function w(){const e={};b.value[g.value]&&(e[g.value]=b.value[g.value]),$.value.length>0&&(e.workspace_ids=JSON.stringify($.value)),C.value.length>0&&(e.status=JSON.stringify(C.value)),O.getApplication(D,e,L).then(o=>{var m,V;D.total=(m=o.data)==null?void 0:m.total,P.value=(V=o.data)==null?void 0:V.records})}return Pe(()=>{_e(),w(),Re.getAllMemberList("").then(e=>{Y.value=e.data})}),(e,o)=>{const m=n("el-breadcrumb-item"),V=n("el-breadcrumb"),c=n("el-option"),d=n("el-select"),Q=n("el-input"),be=n("el-avatar"),F=n("el-icon"),k=n("el-table-column"),Z=n("el-tag"),j=n("Filter"),h=n("el-button"),ee=n("el-checkbox"),ae=n("el-checkbox-group"),le=n("el-popover"),he=n("SuccessFilled"),A=n("AppIcon"),ye=n("el-scrollbar"),ge=n("el-empty"),te=n("el-tooltip"),J=n("el-dropdown-item"),we=n("el-dropdown-menu"),ke=n("el-dropdown"),$e=n("app-table"),Ce=n("el-card");return s(),S("div",De,[l(V,{"separator-icon":"ArrowRight"},{default:t(()=>[l(m,null,{default:t(()=>[v(r(y(_)("views.system.resource_management.label")),1)]),_:1}),l(m,null,{default:t(()=>[i("h5",Je,r(y(_)("views.application.title")),1)]),_:1})]),_:1}),l(Ce,{class:"mt-16",style:{height:"calc(var(--app-main-height) + 20px)"}},{default:t(()=>[i("div",He,[i("div",Ke,[l(d,{class:"complex-search__left",modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=a=>g.value=a),style:{width:"120px"},onChange:fe},{default:t(()=>[l(c,{label:e.$t("common.creator"),value:"create_user"},null,8,["label"]),l(c,{label:e.$t("common.name"),value:"name"},null,8,["label"]),l(c,{label:e.$t("views.system.resource_management.type"),value:"type"},null,8,["label"])]),_:1},8,["modelValue"]),g.value==="name"?(s(),u(Q,{key:0,modelValue:b.value.name,"onUpdate:modelValue":o[1]||(o[1]=a=>b.value.name=a),onChange:w,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):g.value==="create_user"?(s(),u(d,{key:1,modelValue:b.value.create_user,"onUpdate:modelValue":o[2]||(o[2]=a=>b.value.create_user=a),onChange:w,clearable:"",filterable:"",style:{width:"220px"}},{default:t(()=>[(s(!0),S(M,null,B(Y.value,a=>(s(),u(c,{key:a.id,value:a.id,label:a.nick_name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):g.value==="type"?(s(),u(d,{key:2,modelValue:b.value.type,"onUpdate:modelValue":o[3]||(o[3]=a=>b.value.type=a),onChange:w,clearable:"",filterable:"",style:{width:"220px"}},{default:t(()=>[(s(!0),S(M,null,B(de.value,a=>(s(),u(c,{key:a.id,value:a.value,label:a.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):z("",!0)])]),l($e,{data:P.value,"pagination-config":D,onSizeChange:w,onChangePage:w,maxTableHeight:260},{default:t(()=>[l(k,{width:"220",label:e.$t("common.name"),"show-overflow-tooltip":""},{default:t(a=>[i("div",Xe,[l(F,{size:"24",class:"mr-8"},{default:t(()=>[l(be,{shape:"square",size:24,style:{background:"none"},class:"mr-8"},{default:t(()=>{var x;return[i("img",{src:y(Ee)((x=a.row)==null?void 0:x.icon),alt:""},null,8,Ye)]}),_:2},1024)]),_:2},1024),v(" "+r(a.row.name),1)])]),_:1},8,["label"]),l(k,{prop:"tool_type",label:e.$t("views.system.resource_management.type"),width:"160"},{default:t(a=>[y(Te)(a.row.type)?(s(),u(Z,{key:0,class:"warning-tag"},{default:t(()=>[v(r(e.$t("views.application.workflow")),1)]),_:1})):(s(),u(Z,{key:1,class:"blue-tag"},{default:t(()=>[v(r(e.$t("views.application.simple")),1)]),_:1}))]),_:1},8,["label"]),l(k,{width:"150",prop:"is_publish",label:e.$t("common.status.label"),"show-overflow-tooltip":""},{header:t(()=>[i("div",null,[i("span",null,r(e.$t("common.status.label")),1),l(le,{width:100,trigger:"click",visible:T.value},{reference:t(()=>[l(h,{style:{"margin-top":"-2px"},type:C.value&&C.value.length>0?"primary":"",link:"",onClick:o[4]||(o[4]=a=>T.value=!T.value)},{default:t(()=>[l(F,null,{default:t(()=>[l(j)]),_:1})]),_:1},8,["type"])]),default:t(()=>[i("div",qe,[i("div",Ge,[i("div",{onClick:o[6]||(o[6]=N(()=>{},["stop"]))},[l(ae,{modelValue:C.value,"onUpdate:modelValue":o[5]||(o[5]=a=>C.value=a),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(s(!0),S(M,null,B(ve.value,a=>(s(),u(ee,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),i("div",Qe,[l(h,{size:"small",onClick:o[7]||(o[7]=a=>G("clear"))},{default:t(()=>[v(r(e.$t("common.clear")),1)]),_:1}),l(h,{type:"primary",onClick:G,size:"small"},{default:t(()=>[v(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),default:t(a=>[a.row.is_publish?(s(),S("div",Ze,[l(F,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:t(()=>[l(he)]),_:1}),i("span",je,r(e.$t("views.application.status.published")),1)])):(s(),S("div",ea,[l(A,{iconName:"app-disabled",class:"color-secondary mr-8"}),i("span",aa,r(e.$t("views.application.status.unpublished")),1)]))]),_:1},8,["label"]),y(H).isEE()?(s(),u(k,{key:0,width:"150",prop:"workspace_name",label:e.$t("views.workspace.title"),"show-overflow-tooltip":""},{header:t(()=>[i("div",null,[i("span",null,r(e.$t("views.workspace.title")),1),l(le,{width:200,trigger:"click",visible:E.value},{reference:t(()=>[l(h,{style:{"margin-top":"-2px"},type:$.value&&$.value.length>0?"primary":"",link:"",onClick:o[8]||(o[8]=a=>E.value=!E.value)},{default:t(()=>[l(F,null,{default:t(()=>[l(j)]),_:1})]),_:1},8,["type"])]),default:t(()=>[i("div",la,[i("div",ta,[i("div",{onClick:o[11]||(o[11]=N(()=>{},["stop"]))},[l(Q,{modelValue:U.value,"onUpdate:modelValue":o[9]||(o[9]=a=>U.value=a),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),I.value.length?(s(),u(ye,{key:0,height:"300"},{default:t(()=>[l(ae,{modelValue:$.value,"onUpdate:modelValue":o[10]||(o[10]=a=>$.value=a),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(s(!0),S(M,null,B(I.value,a=>(s(),u(ee,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(s(),u(ge,{key:1,description:e.$t("common.noData")},null,8,["description"]))])])]),i("div",oa,[l(h,{size:"small",onClick:o[12]||(o[12]=a=>q("clear"))},{default:t(()=>[v(r(e.$t("common.clear")),1)]),_:1}),l(h,{type:"primary",onClick:q,size:"small"},{default:t(()=>[v(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):z("",!0),l(k,{prop:"nick_name",label:e.$t("common.creator"),"show-overflow-tooltip":""},null,8,["label"]),l(k,{label:e.$t("views.application.publishTime"),width:"180"},{default:t(({row:a})=>[v(r(y(oe)(a.update_time)),1)]),_:1},8,["label"]),l(k,{label:e.$t("common.createTime"),width:"180"},{default:t(({row:a})=>[v(r(y(oe)(a.create_time)),1)]),_:1},8,["label"]),l(k,{label:e.$t("common.operation"),align:"left",width:"120",fixed:"right"},{default:t(({row:a})=>[l(te,{effect:"dark",content:e.$t("views.application.operation.toChat"),placement:"top"},{default:t(()=>[i("span",na,[l(h,{type:"primary",text:"",title:e.$t("views.application.operation.toChat"),onClick:N(x=>ce(a),["stop"])},{default:t(()=>[l(A,{iconName:"app-create-chat"})]),_:1},8,["title","onClick"])])]),_:2},1032,["content"]),ie()?(s(),u(te,{key:0,effect:"dark",content:e.$t("views.system.resource_management.management"),placement:"top"},{default:t(()=>[i("span",sa,[l(h,{type:"primary",text:"",title:e.$t("views.system.resource_management.management"),onClick:x=>y(ne).push({path:`/application/resource-management/${a.id}/${a.type}/overview`})},{default:t(()=>[l(A,{iconName:"app-admin-operation"})]),_:1},8,["title","onClick"])])]),_:2},1032,["content"])):z("",!0),re()?(s(),u(ke,{key:1,trigger:"click"},{dropdown:t(()=>[l(we,null,{default:t(()=>[f.value.auth()?(s(),u(J,{key:0,onClick:N(x=>ue(a),["stop"])},{default:t(()=>[l(A,{iconName:"app-resource-authorization",class:"color-secondary"}),v(" "+r(e.$t("views.system.resourceAuthorization.title")),1)]),_:1},8,["onClick"])):z("",!0),f.value.export()?(s(),u(J,{key:1,onClick:N(x=>me(a),["stop"])},{default:t(()=>[l(A,{iconName:"app-export",class:"color-secondary"}),v(" "+r(e.$t("common.export")),1)]),_:1},8,["onClick"])):z("",!0),f.value.delete()?(s(),u(J,{key:2,onClick:N(x=>pe(a),["stop"])},{default:t(()=>[l(A,{iconName:"app-delete",class:"color-secondary"}),v(" "+r(e.$t("common.delete")),1)]),_:1},8,["onClick"])):z("",!0)]),_:2},1024)]),default:t(()=>[l(h,{text:"",onClick:o[13]||(o[13]=N(()=>{},["stop"])),type:"primary"},{default:t(()=>[l(A,{iconName:"app-more"})]),_:1})]),_:2},1024)):z("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])]),_:1}),l(Fe,{type:y(Ie).APPLICATION,ref_key:"ResourceAuthorizationDrawerRef",ref:K},null,8,["type"])])}}});export{pa as default};
