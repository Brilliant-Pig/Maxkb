import{ay as Ue,aA as ze,aB as c,aC as r,bd as Oe,b7 as Fe,b9 as je,be as Je,br as We,aL as He,aD as s,bf as k,aF as n,aH as l,aG as a,aK as b,aJ as m,bn as V,aI as p,aE as i,bm as _,bg as G,bh as K,c1 as qe,bb as v,c3 as ne,c0 as Ge,c4 as Ke,cp as y,c7 as Qe,c6 as se,bo as ie,bi as Xe}from"./chat-CUfIjAsy.js";import{_ as Ye,a as Ze,b as et,c as tt,M as ot}from"./McpToolConfigDialog-B1r57DBN.js";import{l as lt}from"./permission-api-DyNdOx42.js";import"./FieldFormDialog.vue_vue_type_script_setup_true_lang-BhzpDhcT.js";import"./workspace-Cv2gXV-V.js";var ce=(E=>(E.CUSTOM="common.custom",E.INTERNAL="views.tool.toolStore.internal",E))(ce||{});const at={class:"resource-manage_tool p-16-24"},nt={class:"ml-4 color-text-primary"},st={class:"flex-between mb-16"},it={class:"complex-search"},ct={class:"table-name flex align-center"},rt=["src"],ut={key:0},pt={key:1},mt={key:2},dt={key:0,class:"flex align-center"},_t={class:"color-text-primary"},ft={key:1,class:"flex align-center"},vt={class:"color-text-primary"},yt={class:"filter"},ht={class:"form-item mb-16 ml-4"},bt={class:"text-right"},gt={class:"mr-8"},kt={class:"mr-8"},Ct={class:"mr-8"},Tt={class:"mr-8"},St=Ue({__name:"ToolResourceIndex",setup(E){const{user:Q}=ze(),C=c("name"),g=c({name:"",create_user:"",tool_type:""}),X=c([]),re=c([{label:"MCP",value:"MCP"},{label:r("views.tool.toolStore.title"),value:"TOOL_STORE"},{label:r("views.tool.toolStore.internal"),value:"INTERNAL"},{label:r("common.custom"),value:"CUSTOM"}]),T=c(!1),N=c(!1),Y=c([]),D=Oe({current_page:1,page_size:20,total:0}),L=c([]),P=c(!1),R=c([]),d=Fe(()=>je.tool.systemManage),ue=e=>{var o;return d.value.export()||d.value.delete()||d.value.auth()||((o=e.init_field_list)==null?void 0:o.length)>0&&d.value.edit()},Z=c();function pe(e){Z.value.open(e.id)}function me(e){y.exportTool(e.id,e.name,T).catch(o=>{o.response.status!==403&&o.response.data.text().then(u=>{Qe(`${r("views.application.tip.ExportError")}:${JSON.parse(u).message}`)})})}const ee=c();function de(e){y.getToolById(e==null?void 0:e.id,T).then(o=>{ee.value.open(o.data)})}function _e(e){se(`${r("views.tool.delete.confirmTitle")}ï¼š${e.name} ?`,r("views.tool.delete.confirmMessage"),{confirmButtonText:r("common.confirm"),cancelButtonText:r("common.cancel"),confirmButtonClass:"danger"}).then(()=>{y.delTool(e.id,T).then(()=>{f(),ie(r("common.deleteSuccess"))})}).catch(()=>{})}function fe(e){y.getToolById(e==null?void 0:e.id,N).then(o=>{W.value.open(o.data)})}async function ve(e){J.value=r("views.tool.copyTool");const o=await y.getToolById(e.id,N),u=Xe.cloneDeep(o.data);delete u.id,u.name=u.name+`  ${r("common.copyTitle")}`,U.value.open(u)}const U=c(),j=c(),J=c(""),te=c("");function ye(e){e!=null&&e.template_id||(J.value=r("views.tool.editTool"),e?y.getToolById(e==null?void 0:e.id,T).then(o=>{U.value.open(o.data)}):U.value.open(e))}function he(e){e!=null&&e.template_id||(te.value=e?r("views.tool.editMcpTool"):r("views.tool.createMcpTool"),e?y.getToolById(e==null?void 0:e.id,T).then(o=>{j.value.open(o.data)}):j.value.open(e))}const oe=c();function be(e,o){var u;(u=oe.value)==null||u.open(e,o)}function ge(e,o){o&&y.putTool(e==null?void 0:e.id,{name:e.name},T).then(u=>{ie(r("common.saveSuccess")),A()})}const W=c();async function ke(e){if(e.is_active)se(`${r("views.tool.disabled.confirmTitle")}${e.name} ?`,r("views.tool.disabled.confirmMessage"),{confirmButtonText:r("common.status.disable"),confirmButtonClass:"danger"}).then(()=>{const o={is_active:!e.is_active};y.putTool(e.id,o,N).then(()=>(f(),!0)).catch(()=>!1)});else{const o=await y.getToolById(e.id,N);if((!o.data.init_params||Object.keys(o.data.init_params).length===0)&&o.data.init_field_list&&o.data.init_field_list.length>0&&o.data.init_field_list.filter(S=>S.default_value&&S.show_default_value).length!==o.data.init_field_list.length)return W.value.open(o.data,!e.is_active),!1;const u={is_active:!e.is_active};y.putTool(e.id,u,N).then(()=>(f(),!0)).catch(()=>!1)}}const I=c(""),z=c([]);Je([()=>L.value,()=>I.value],()=>{I.value.length||(z.value=L.value),z.value=L.value.filter(e=>e.label.toLowerCase().includes(I.value.toLowerCase()))},{immediate:!0});function le(e){e==="clear"&&(R.value=[]),f(),P.value=!1}async function Ce(){if(Q.isEE()){const e=await lt("workspace").getSystemWorkspaceList(T);L.value=e.data.map(o=>({label:o.name,value:o.id}))}}const Te=()=>{g.value={name:"",create_user:""}};function f(){const e={};g.value[C.value]&&(e[C.value]=g.value[C.value]),R.value.length>0&&(e.workspace_ids=JSON.stringify(R.value)),y.getToolListPage(D,e,T).then(o=>{var u,S;D.total=(u=o.data)==null?void 0:u.total,Y.value=(S=o.data)==null?void 0:S.records})}function A(e){e||(D.total=0,D.current_page=1),f()}return We(()=>{Ce(),f(),He.getAllMemberList("").then(e=>{X.value=e.data})}),(e,o)=>{const u=s("el-breadcrumb-item"),S=s("el-breadcrumb"),B=s("el-option"),H=s("el-select"),ae=s("el-input"),$e=s("el-avatar"),we=s("ToolIcon"),q=s("el-icon"),$=s("el-table-column"),Me=s("SuccessFilled"),h=s("AppIcon"),Ve=s("Filter"),w=s("el-button"),Re=s("el-checkbox"),Se=s("el-checkbox-group"),Ne=s("el-scrollbar"),De=s("el-empty"),Ie=s("el-popover"),Ae=s("el-switch"),Be=s("el-divider"),O=s("el-tooltip"),x=s("el-dropdown-item"),xe=s("el-dropdown-menu"),Ee=s("el-dropdown"),Le=s("app-table"),Pe=s("el-card");return n(),k("div",at,[l(S,{"separator-icon":"ArrowRight"},{default:a(()=>[l(u,null,{default:a(()=>[b(m(V(r)("views.system.resource_management.label")),1)]),_:1}),l(u,null,{default:a(()=>[p("h5",nt,m(V(r)("views.tool.title")),1)]),_:1})]),_:1}),l(Pe,{class:"mt-16",style:{height:"calc(var(--app-main-height) + 20px)"}},{default:a(()=>[p("div",st,[p("div",it,[l(H,{class:"complex-search__left",modelValue:C.value,"onUpdate:modelValue":o[0]||(o[0]=t=>C.value=t),style:{width:"120px"},onChange:Te},{default:a(()=>[l(B,{label:e.$t("common.creator"),value:"create_user"},null,8,["label"]),l(B,{label:e.$t("views.tool.form.toolName.label"),value:"name"},null,8,["label"]),l(B,{label:e.$t("views.system.resource_management.type"),value:"tool_type"},null,8,["label"])]),_:1},8,["modelValue"]),C.value==="name"?(n(),i(ae,{key:0,modelValue:g.value.name,"onUpdate:modelValue":o[1]||(o[1]=t=>g.value.name=t),onChange:f,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):C.value==="create_user"?(n(),i(H,{key:1,modelValue:g.value.create_user,"onUpdate:modelValue":o[2]||(o[2]=t=>g.value.create_user=t),onChange:f,filterable:"",clearable:"",style:{width:"220px"}},{default:a(()=>[(n(!0),k(G,null,K(X.value,t=>(n(),i(B,{key:t.id,value:t.id,label:t.nick_name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):C.value==="tool_type"?(n(),i(H,{key:2,modelValue:g.value.tool_type,"onUpdate:modelValue":o[3]||(o[3]=t=>g.value.tool_type=t),onChange:f,clearable:"",filterable:"",style:{width:"220px"}},{default:a(()=>[(n(!0),k(G,null,K(re.value,t=>(n(),i(B,{key:t.id,value:t.value,label:t.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):_("",!0)])]),l(Le,{data:Y.value,"pagination-config":D,onSizeChange:f,onChangePage:f,maxTableHeight:260},{default:a(()=>[l($,{width:"220",label:e.$t("common.name"),"show-overflow-tooltip":""},{default:a(({row:t})=>[p("div",ct,[l(q,{size:"24",class:"mr-8"},{default:a(()=>[t!=null&&t.icon?(n(),i($e,{key:0,shape:"square",size:24,style:{background:"none"},class:"mr-8"},{default:a(()=>[p("img",{src:V(qe)(t==null?void 0:t.icon),alt:""},null,8,rt)]),_:2},1024)):(n(),i(we,{key:1,size:24,type:t==null?void 0:t.tool_type},null,8,["type"]))]),_:2},1024),b(" "+m(t.name),1)])]),_:1},8,["label"]),l($,{prop:"tool_type",label:e.$t("views.system.resource_management.type")},{default:a(t=>[t.row.tool_type==="MCP"?(n(),k("span",ut," MCP ")):t.row.version?(n(),k("span",pt,m(e.$t("views.tool.toolStore.title")),1)):(n(),k("span",mt,m(e.$t(V(ce)[t.row.template_id?"INTERNAL":"CUSTOM"])),1))]),_:1},8,["label"]),l($,{label:e.$t("common.status.label"),width:"120"},{default:a(({row:t})=>[t.is_active?(n(),k("div",dt,[l(q,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:a(()=>[l(Me)]),_:1}),p("span",_t,m(e.$t("common.status.enabled")),1)])):(n(),k("div",ft,[l(h,{iconName:"app-disabled",class:"color-secondary mr-8"}),p("span",vt,m(e.$t("common.status.disabled")),1)]))]),_:1},8,["label"]),V(Q).isEE()?(n(),i($,{key:0,width:"150",prop:"workspace_name",label:e.$t("views.workspace.title"),"show-overflow-tooltip":""},{header:a(()=>[p("div",null,[p("span",null,m(e.$t("views.workspace.title")),1),l(Ie,{width:200,trigger:"click",visible:P.value},{reference:a(()=>[l(w,{style:{"margin-top":"-2px"},type:R.value&&R.value.length>0?"primary":"",link:"",onClick:o[4]||(o[4]=t=>P.value=!P.value)},{default:a(()=>[l(q,null,{default:a(()=>[l(Ve)]),_:1})]),_:1},8,["type"])]),default:a(()=>[p("div",yt,[p("div",ht,[p("div",{onClick:o[7]||(o[7]=v(()=>{},["stop"]))},[l(ae,{modelValue:I.value,"onUpdate:modelValue":o[5]||(o[5]=t=>I.value=t),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),z.value.length?(n(),i(Ne,{key:0,height:"300"},{default:a(()=>[l(Se,{modelValue:R.value,"onUpdate:modelValue":o[6]||(o[6]=t=>R.value=t),style:{display:"flex","flex-direction":"column"}},{default:a(()=>[(n(!0),k(G,null,K(z.value,t=>(n(),i(Re,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(n(),i(De,{key:1,description:e.$t("common.noData")},null,8,["description"]))])])]),p("div",bt,[l(w,{size:"small",onClick:o[8]||(o[8]=t=>le("clear"))},{default:a(()=>[b(m(e.$t("common.clear")),1)]),_:1}),l(w,{type:"primary",onClick:le,size:"small"},{default:a(()=>[b(m(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):_("",!0),l($,{prop:"nick_name",label:e.$t("common.creator"),"show-overflow-tooltip":""},null,8,["label"]),l($,{label:e.$t("views.document.table.updateTime"),width:"180"},{default:a(({row:t})=>[b(m(V(ne)(t.update_time)),1)]),_:1},8,["label"]),l($,{label:e.$t("common.createTime"),width:"180"},{default:a(({row:t})=>[b(m(V(ne)(t.create_time)),1)]),_:1},8,["label"]),l($,{label:e.$t("common.operation"),align:"left",width:"160",fixed:"right"},{default:a(({row:t})=>[p("span",{onClick:o[9]||(o[9]=v(()=>{},["stop"]))},[d.value.switch()?(n(),i(Ae,{key:0,modelValue:t.is_active,"onUpdate:modelValue":M=>t.is_active=M,"before-change":()=>ke(t),size:"small",class:"mr-4"},null,8,["modelValue","onUpdate:modelValue","before-change"])):_("",!0)]),l(Be,{direction:"vertical"}),t.template_id&&d.value.edit()?(n(),i(O,{key:0,effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:a(()=>[p("span",gt,[l(w,{type:"primary",text:"",onClick:v(M=>be(t,!0),["stop"]),title:e.$t("common.edit")},{default:a(()=>[l(h,{iconName:"app-edit"})]),_:1},8,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),!t.template_id&&t.tool_type==="CUSTOM"&&d.value.edit()?(n(),i(O,{key:1,effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:a(()=>[p("span",kt,[l(w,{type:"primary",text:"",onClick:v(M=>ye(t),["stop"]),title:e.$t("common.edit")},{default:a(()=>[l(h,{iconName:"app-edit"})]),_:1},8,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),!t.template_id&&t.tool_type==="MCP"&&d.value.edit()?(n(),i(O,{key:2,effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:a(()=>[p("span",Ct,[l(w,{type:"primary",text:"",onClick:v(M=>he(t),["stop"]),title:e.$t("common.edit")},{default:a(()=>[l(h,{iconName:"app-edit"})]),_:1},8,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),!t.template_id&&d.value.copy()?(n(),i(O,{key:3,effect:"dark",content:e.$t("common.copy"),placement:"top"},{default:a(()=>[p("span",Tt,[l(w,{type:"primary",text:"",onClick:v(M=>ve(t),["stop"]),title:e.$t("common.copy")},{default:a(()=>[l(h,{iconName:"app-copy"})]),_:1},8,["onClick","title"])])]),_:2},1032,["content"])):_("",!0),ue(t)?(n(),i(Ee,{key:4,trigger:"click"},{dropdown:a(()=>[l(xe,null,{default:a(()=>{var M;return[((M=t.init_field_list)==null?void 0:M.length)>0&&d.value.edit()?(n(),i(x,{key:0,onClick:v(F=>fe(t),["stop"])},{default:a(()=>[l(h,{iconName:"app-operation",class:"color-secondary"}),b(" "+m(e.$t("common.param.initParam")),1)]),_:1},8,["onClick"])):_("",!0),d.value.auth()?(n(),i(x,{key:1,onClick:v(F=>pe(t),["stop"])},{default:a(()=>[l(h,{iconName:"app-resource-authorization",class:"color-secondary"}),b(" "+m(e.$t("views.system.resourceAuthorization.title")),1)]),_:1},8,["onClick"])):_("",!0),!t.template_id&&t.tool_type==="CUSTOM"&&d.value.export()?(n(),i(x,{key:2,onClick:v(F=>me(t),["stop"])},{default:a(()=>[l(h,{iconName:"app-export",class:"color-secondary"}),b(" "+m(e.$t("common.export")),1)]),_:1},8,["onClick"])):_("",!0),t.tool_type==="MCP"&&d.value.edit()?(n(),i(x,{key:3,onClick:v(F=>de(t),["stop"])},{default:a(()=>[l(h,{iconName:"app-operate-log",class:"color-secondary"}),b(" "+m(e.$t("views.tool.mcpConfig")),1)]),_:1},8,["onClick"])):_("",!0),d.value.delete()?(n(),i(x,{key:4,divided:"",onClick:v(F=>_e(t),["stop"])},{default:a(()=>[l(h,{iconName:"app-delete",class:"color-secondary"}),b(" "+m(e.$t("common.delete")),1)]),_:1},8,["onClick"])):_("",!0)]}),_:2},1024)]),default:a(()=>[l(w,{text:"",onClick:o[10]||(o[10]=v(()=>{},["stop"])),type:"primary"},{default:a(()=>[l(h,{iconName:"app-more"})]),_:1})]),_:2},1024)):_("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])]),_:1}),l(Ye,{ref_key:"InitParamDrawerRef",ref:W,onRefresh:A},null,512),l(Ze,{ref_key:"ToolFormDrawerRef",ref:U,onRefresh:A,title:J.value},null,8,["title"]),l(et,{ref_key:"McpToolFormDrawerRef",ref:j,onRefresh:A,title:te.value},null,8,["title"]),l(tt,{ref_key:"AddInternalToolDialogRef",ref:oe,onRefresh:ge},null,512),l(ot,{ref_key:"McpToolConfigDialogRef",ref:ee,onRefresh:A},null,512),l(Ke,{type:V(Ge).TOOL,ref_key:"ResourceAuthorizationDrawerRef",ref:Z},null,8,["type"])])}}});export{St as default};
