import{ay as ae,b8 as oe,aA as te,aB as n,bd as le,aC as y,be as se,aD as m,bf as ne,aF as P,bg as ie,aH as l,bb as q,aG as s,aI as t,aE as re,bm as de,aJ as i,aK as v,bn as ue,bc as k,bo as C,bi as pe}from"./chat-CUfIjAsy.js";import{_ as me}from"./AIModeParamSettingDialog.vue_vue_type_script_setup_true_lang-cRJioUrS.js";const ce={class:"content-height"},ve={class:"update-info flex border-r-6 mb-16 p-8-12"},fe={class:"mt-4"},ge={class:"ml-12 lighter"},_e={class:"flex-between"},be={class:"flex-between"},ye={class:"dialog-footer"},ke=ae({__name:"index",props:{apiType:{}},emits:["refresh"],setup(D,{expose:G,emit:U}){var F;const _=D,z=oe(),{params:{id:f,documentId:E}}=z,{model:H,prompt:M,user:I}=te(),R=U,c=n(!1),r=n(!1),B=n(null),V=n([]),b=n(""),h=n("error"),L={all:["0","1","2","3","4","5","n"],error:["0","1","3","4","5","n"]},$=n(),S=n(null),Q=(F=I.userInfo)==null?void 0:F.id,o=n(M.get(Q)),K=le({model_id:[{required:!0,message:y("views.application.form.aiModel.placeholder"),trigger:"blur"}],prompt:[{required:!0,message:y("common.prompt.placeholder"),trigger:"blur"}]});se(r,e=>{var a;e||(o.value=M.get(Q),(a=$.value)==null||a.clearValidate())});const T=n(),j=()=>{var e;o.value.model_id&&((e=T.value)==null||e.open(o.value.model_id,f,o.value.model_params_setting))};function J(){var e;o.value.model_id?(e=T.value)==null||e.reset_default(o.value.model_id,f):A({})}function A(e){o.value.model_params_setting=e}const O=(e,a,d)=>{S.value=d,X(),V.value=e,b.value=a,r.value=!0},W=async e=>{e&&await e.validate((a,d)=>{var g,w;if(a){if(M.save((g=I.userInfo)==null?void 0:g.id,o.value),b.value==="paragraph"){const u={...o.value,paragraph_id_list:V.value};k({type:"paragraph",systemType:_.apiType}).putBatchGenerateRelated(f,E,u,c).then(()=>{C(y("views.document.generateQuestion.successMessage")),R("refresh"),r.value=!1})}else if(b.value==="document"){const u={...o.value,document_id_list:V.value,state_list:L[h.value]};k({type:"document",systemType:_.apiType}).putBatchGenerateRelated(f,u,c).then(()=>{C(y("views.document.generateQuestion.successMessage")),R("refresh"),r.value=!1})}else if(b.value==="knowledge"){const u={...o.value,state_list:L[h.value]};k({type:"knowledge",systemType:_.apiType}).putGenerateRelated(f||((w=S.value)==null?void 0:w.id),u,c).then(()=>{C(y("views.document.generateQuestion.successMessage")),r.value=!1})}}})};function X(){var a;c.value=!0;const e=_.apiType==="systemManage"?{model_type:"LLM",workspace_id:(a=S.value)==null?void 0:a.workspace_id}:{model_type:"LLM"};k({type:"model",systemType:_.apiType}).getSelectModelList(e).then(d=>{B.value=pe.groupBy(d==null?void 0:d.data,"provider"),c.value=!1}).catch(()=>{c.value=!1})}return G({open:O,dialogVisible:r}),(e,a)=>{const d=m("AppIcon"),g=m("el-button"),w=m("ModelSelect"),u=m("el-form-item"),Y=m("el-input"),N=m("el-radio"),Z=m("el-radio-group"),x=m("el-form"),ee=m("el-dialog");return P(),ne(ie,null,[l(ee,{title:e.$t("views.document.generateQuestion.title"),modelValue:r.value,"onUpdate:modelValue":a[5]||(a[5]=p=>r.value=p),width:"650","close-on-click-modal":!1,"close-on-press-escape":!1,onClick:a[6]||(a[6]=q(()=>{},["stop"]))},{footer:s(()=>[t("span",ye,[l(g,{onClick:a[3]||(a[3]=q(p=>r.value=!1,["prevent"]))},{default:s(()=>[v(i(e.$t("common.cancel")),1)]),_:1}),l(g,{type:"primary",onClick:a[4]||(a[4]=p=>W($.value)),disabled:!ue(H)||c.value},{default:s(()=>[v(i(e.$t("common.confirm")),1)]),_:1},8,["disabled"])])]),default:s(()=>[t("div",ce,[l(x,{ref_key:"FormRef",ref:$,model:o.value,rules:K,"label-position":"top","hide-required-asterisk":""},{default:s(()=>[t("div",ve,[t("div",fe,[l(d,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),t("div",ge,[t("p",null,i(e.$t("views.document.generateQuestion.tip1",{data:"{data}"})),1),t("p",null,i(e.$t("views.document.generateQuestion.tip2")+"<question></question>"+e.$t("views.document.generateQuestion.tip3")),1),t("p",null,i(e.$t("views.document.generateQuestion.tip4")),1)])]),l(u,{prop:"model_id"},{label:s(()=>[t("div",_e,[t("div",null,[t("span",null,[v(i(e.$t("views.application.form.aiModel.label"))+" ",1),a[7]||(a[7]=t("span",{class:"color-danger"},"*",-1))])]),l(g,{type:"primary",link:"",onClick:j,disabled:!o.value.model_id},{default:s(()=>[l(d,{iconName:"app-setting",class:"mr-4"}),v(" "+i(e.$t("common.paramSetting")),1)]),_:1},8,["disabled"])])]),default:s(()=>[l(w,{modelValue:o.value.model_id,"onUpdate:modelValue":a[0]||(a[0]=p=>o.value.model_id=p),placeholder:e.$t("views.application.form.aiModel.placeholder"),options:B.value,showFooter:"","model-type":"LLM",onChange:J},null,8,["modelValue","placeholder","options"])]),_:1}),l(u,{prop:"prompt"},{label:s(()=>[t("div",be,[t("div",null,[t("span",null,[v(i(e.$t("common.prompt.label"))+" ",1),a[8]||(a[8]=t("span",{class:"color-danger"},"*",-1))])])])]),default:s(()=>[l(Y,{modelValue:o.value.prompt,"onUpdate:modelValue":a[1]||(a[1]=p=>o.value.prompt=p),placeholder:e.$t("common.prompt.placeholder"),rows:7,type:"textarea"},null,8,["modelValue","placeholder"])]),_:1}),["document","knowledge"].includes(b.value)?(P(),re(u,{key:0,label:e.$t("components.selectParagraph.title"),prop:"state"},{default:s(()=>[l(Z,{modelValue:h.value,"onUpdate:modelValue":a[2]||(a[2]=p=>h.value=p),class:"radio-block"},{default:s(()=>[l(N,{value:"error",size:"large"},{default:s(()=>[v(i(e.$t("components.selectParagraph.error")),1)]),_:1}),l(N,{value:"all",size:"large"},{default:s(()=>[v(i(e.$t("components.selectParagraph.all")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])):de("",!0)]),_:1},8,["model","rules"])])]),_:1},8,["title","modelValue"]),l(me,{ref_key:"AIModeParamSettingDialogRef",ref:T,onRefresh:A},null,512)],64)}}});export{ke as _};
