import{ay as de,b8 as ue,aA as pe,b7 as G,aB as p,br as _e,aD as n,bs as me,bf as v,aF as c,aI as o,bt as N,aH as t,aK as d,aJ as i,aG as a,aE as f,by as J,cz as ve,bn as S,bg as fe,bh as he,cf as T,bm as y,cw as ge,cA as ye,cg as O,cB as be,bi as Q,aC as we,bS as ke,bc as $e,cC as Ce,ce as xe}from"./chat-CUfIjAsy.js";import{_ as Se}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-BaZJjs1f.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-Cy_JfFls.js";const Te=""+new URL("hit-test-empty-D0jNCBAC.png",import.meta.url).href,Ve={class:"hit-test p-16-24"},De={class:"avatar"},Re={class:"content ml-12"},ze=["title"],Be={class:"primary"},Ne={class:"footer-content flex-between"},Ie={key:0},Ke={key:0},Ae={key:1,class:"ml-4"},qe={class:"hit-test__operate"},Pe={class:"mb-16"},Ee={class:"title mb-8"},He={class:"mb-4"},Me={class:"mb-4"},Ue={class:"mb-4"},Fe={class:"mb-16"},je={class:"title mb-8"},Le={class:"mb-16"},Ge={class:"title mb-8"},Je={class:"text-right"},Oe={key:0,class:"operate-textarea flex"},Qe={class:"operate"},We={src:ye,alt:""},Xe={src:be,alt:""},Ye=de({__name:"index",setup(Ze){const h=ue(),{params:{id:W}}=h,{user:X}=pe(),I=G(()=>h.path.includes("shared")?"systemShare":h.path.includes("resource-management")?"systemManage":"workspace"),K=p(),A=p(),m=p(!1),g=p([]),q=p(""),_=p(""),V=p({similarity:.6,top_number:5,search_mode:"embedding"}),P=p(!0),r=p({}),b=p(!1),w=p(""),k=G(()=>!_.value);function Y(e){e==="keywords"?r.value.similarity=0:r.value.similarity=.6}function E(e){e==="open"?(b.value=!0,r.value=Q.cloneDeep(V.value)):e==="close"&&(b.value=!1,V.value=Q.cloneDeep(r.value))}function Z(e){q.value=we("views.paragraph.paragraphDetail"),A.value.open(e)}function H(e){!(e!=null&&e.ctrlKey)&&!(e!=null&&e.shiftKey)&&!(e!=null&&e.altKey)&&!(e!=null&&e.metaKey)?(e.preventDefault(),!k.value&&!m.value&&M()):ee(e)}const ee=e=>{const l=K.value.$el.querySelector(".el-textarea__inner"),u=l.selectionStart,$=l.selectionEnd;e.preventDefault(),_.value=_.value.slice(0,u)+`
`+_.value.slice($),ke(()=>{l.setSelectionRange(u+1,u+1)})};function M(){const e={query_text:_.value,...V.value};$e({type:"knowledge",systemType:I.value}).putKnowledgeHitTest(W,e,m).then(l=>{g.value=l.data&&Ce(l.data,"comprehensive_score",!0),w.value=_.value,_.value="",P.value=!1})}function te(e){if(e){const l=g.value.filter(u=>u.id===e.id)[0];l.content=e.content,l.title=e.title}else g.value=[],M()}return _e(()=>{}),(e,l)=>{const u=n("el-text"),$=n("el-avatar"),U=n("el-empty"),ae=n("Document"),le=n("el-icon"),D=n("AppIcon"),se=n("CardBox"),R=n("el-col"),F=n("el-row"),oe=n("el-scrollbar"),C=n("el-card"),x=n("el-button"),z=n("el-radio"),ie=n("el-radio-group"),j=n("el-input-number"),ne=n("el-popover"),re=n("el-input"),ce=me("loading");return c(),v("div",Ve,[o("h4",null,[d(i(e.$t("views.application.hitTest.title"))+" ",1),t(u,{type:"info",class:"ml-4"},{default:a(()=>[d(i(e.$t("views.application.hitTest.text")),1)]),_:1})]),N((c(),f(C,{style:{"--el-card-padding":"0"},class:"hit-test__main p-16 mt-16 mb-16"},{default:a(()=>[o("div",{class:"question-title",style:J({visibility:w.value?"visible":"hidden"})},[o("div",De,[t($,null,{default:a(()=>[...l[8]||(l[8]=[o("img",{src:ve,style:{width:"54%"},alt:""},null,-1)])]),_:1})]),o("div",Re,[o("h4",{class:"text break-all ellipsis-1",style:{width:"66%"},title:w.value},i(w.value),9,ze)])],4),t(oe,null,{default:a(()=>[o("div",{style:J({height:S(X).isExpire()?"calc(100vh - 340px)":"calc(100vh - 300px)"})},[P.value?(c(),f(U,{key:0,image:S(Te),description:e.$t("views.application.hitTest.emptyMessage1"),style:{"padding-top":"160px"},"image-size":125},null,8,["image","description"])):g.value.length==0?(c(),f(U,{key:1,description:e.$t("views.application.hitTest.emptyMessage2"),style:{"padding-top":"160px"},"image-size":125},null,8,["description"])):(c(),f(F,{key:2},{default:a(()=>[(c(!0),v(fe,null,he(g.value,(s,L)=>(c(),f(R,{xs:24,sm:12,md:12,lg:8,xl:6,key:L,class:"p-8"},{default:a(()=>[t(se,{shadow:"hover",title:s.title||"-",description:s.content,class:T(["document-card layout-bg layout-bg cursor",s.is_active?"":"disabled"]),onClick:B=>Z(s)},{icon:a(()=>[t($,{class:"avatar-light",size:22},{default:a(()=>[d(i(L+1+""),1)]),_:2},1024)]),tag:a(()=>{var B;return[o("div",Be,i((B=s.similarity)==null?void 0:B.toFixed(3)),1)]}),footer:a(()=>[o("div",Ne,[t(u,null,{default:a(()=>[t(le,null,{default:a(()=>[t(ae)]),_:1}),d(" "+i(s==null?void 0:s.document_name),1)]),_:2},1024),s.trample_num||s.star_num?(c(),v("div",Ie,[s.star_num?(c(),v("span",Ke,[t(D,{iconName:"app-like-color"}),d(" "+i(s.star_num),1)])):y("",!0),s.trample_num?(c(),v("span",Ae,[t(D,{iconName:"app-oppose-color"}),d(" "+i(s.trample_num),1)])):y("",!0)])):y("",!0)])]),_:2},1032,["title","description","class","onClick"])]),_:2},1024))),128))]),_:1}))],4)]),_:1})]),_:1})),[[ce,m.value]]),t(Se,{ref_key:"ParagraphDialogRef",ref:A,title:q.value,onRefresh:te,apiType:I.value},null,8,["title","apiType"]),o("div",qe,[t(ne,{visible:b.value,placement:"right-end",width:500,trigger:"click"},{reference:a(()=>[S(h).path.includes("share/")?y("",!0):(c(),f(x,{key:0,class:"mb-8",onClick:l[0]||(l[0]=s=>E("open"))},{default:a(()=>[t(D,{iconName:"app-setting"}),d(" "+i(e.$t("common.paramSetting")),1)]),_:1}))]),default:a(()=>[o("div",Pe,[o("div",Ee,i(e.$t("views.application.dialog.selectSearchMode")),1),t(ie,{modelValue:r.value.search_mode,"onUpdate:modelValue":l[1]||(l[1]=s=>r.value.search_mode=s),class:"card__radio",onChange:Y},{default:a(()=>[t(C,{shadow:"never",class:T(["mb-16",r.value.search_mode==="embedding"?"active":""])},{default:a(()=>[t(z,{value:"embedding",size:"large"},{default:a(()=>[o("p",He,i(e.$t("views.application.dialog.vectorSearch")),1),t(u,{type:"info"},{default:a(()=>[d(i(e.$t("views.application.dialog.vectorSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"]),t(C,{shadow:"never",class:T(["mb-16",r.value.search_mode==="keywords"?"active":""])},{default:a(()=>[t(z,{value:"keywords",size:"large"},{default:a(()=>[o("p",Me,i(e.$t("views.application.dialog.fullTextSearch")),1),t(u,{type:"info"},{default:a(()=>[d(i(e.$t("views.application.dialog.fullTextSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"]),t(C,{shadow:"never",class:T(["mb-16",r.value.search_mode==="blend"?"active":""])},{default:a(()=>[t(z,{value:"blend",size:"large"},{default:a(()=>[o("p",Ue,i(e.$t("views.application.dialog.hybridSearch")),1),t(u,{type:"info"},{default:a(()=>[d(i(e.$t("views.application.dialog.hybridSearchTooltip")),1)]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"])]),t(F,{gutter:20},{default:a(()=>[t(R,{span:12},{default:a(()=>[o("div",Fe,[o("div",je,i(e.$t("views.application.dialog.similarityThreshold")),1),t(j,{modelValue:r.value.similarity,"onUpdate:modelValue":l[2]||(l[2]=s=>r.value.similarity=s),min:0,max:r.value.search_mode==="blend"?2:1,precision:3,step:.1,"value-on-clear":0,"controls-position":"right",class:"w-full"},null,8,["modelValue","max"])])]),_:1}),t(R,{span:12},{default:a(()=>[o("div",Le,[o("div",Ge,i(e.$t("views.application.dialog.topReferences")),1),t(j,{modelValue:r.value.top_number,"onUpdate:modelValue":l[3]||(l[3]=s=>r.value.top_number=s),min:1,max:1e4,"controls-position":"right",class:"w-full"},null,8,["modelValue"])])]),_:1})]),_:1}),o("div",Je,[t(x,{onClick:l[4]||(l[4]=s=>b.value=!1)},{default:a(()=>[d(i(e.$t("common.cancel")),1)]),_:1}),t(x,{type:"primary",onClick:l[5]||(l[5]=s=>E("close"))},{default:a(()=>[d(i(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"]),S(h).path.includes("share/")?y("",!0):(c(),v("div",Oe,[t(re,{ref_key:"quickInputRef",ref:K,modelValue:_.value,"onUpdate:modelValue":l[6]||(l[6]=s=>_.value=s),type:"textarea",placeholder:e.$t("common.inputPlaceholder"),autosize:{minRows:1,maxRows:1},onKeydown:l[7]||(l[7]=ge(s=>H(s),["enter"]))},null,8,["modelValue","placeholder"]),o("div",Qe,[t(x,{text:"",class:"sent-button",disabled:k.value||m.value,onClick:H},{default:a(()=>[N(o("img",We,null,512),[[O,k.value||m.value]]),N(o("img",Xe,null,512),[[O,!k.value&&!m.value]])]),_:1},8,["disabled"])])]))])])}}}),lt=xe(Ye,[["__scopeId","data-v-9d1d15ea"]]);export{lt as default};
