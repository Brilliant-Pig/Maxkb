import{ay as Y,aB as $,aV as ce,aD as s,aE as L,aF as f,aG as o,aW as A,aH as n,aI as e,aJ as l,b1 as q,aX as j,aY as G,aK as w,aS as N,aZ as de,bD as he,dX as _e,aO as X,c0 as $e,aC as P,b2 as H,dY as re,cf as J,aA as pe,aP as oe,aU as be,b6 as ye,b7 as me,ce as ge,b8 as ve,aT as O,dZ as Ve,az as ke,cF as Le,d_ as Ce,b4 as Te,c1 as le,d$ as Se,b3 as ie}from"./admin-Ca7cl6NN.js";import{_ as we}from"./ParagraphForm.vue_vue_type_script_setup_true_lang-DMqxNyYm.js";const Re={class:"bold title p-24",style:{"padding-bottom":"0"}},Fe={class:"flex align-center"},De={class:"p-24",style:{"padding-top":"16px"}},Me={key:1,class:"p-24"},Ie={class:"dialog-footer"},ze=Y({__name:"EditParagraphDialog",props:{isConnect:Boolean,knowledgeId:String},emits:["updateContent"],setup(M,{expose:z,emit:F}){const S=F,C=$(!1),b=$({}),D=$(),T=$(),r=$(!1),i=$("");ce(C,p=>{p||(b.value={})});const d=p=>{b.value=de.cloneDeep(p),C.value=!0};function y(p,_){b.value.problem_list.splice(_,1)}function R(){var p,_,V;i.value.trim()&&((p=b.value)!=null&&p.problem_list.some(v=>v.content===i.value.trim())||(V=(_=b.value)==null?void 0:_.problem_list)==null||V.push({content:i.value.trim()}),i.value="",r.value=!1)}function k(){r.value=!0,he(()=>{var p;(p=T.value)==null||p.focus()})}const I=async()=>{var p,_;await((p=D.value)==null?void 0:p.validate())&&(S("updateContent",{problem_list:b.value.problem_list,...(_=D.value)==null?void 0:_.form}),C.value=!1)};return z({open:d}),(p,_)=>{const V=s("el-col"),v=s("el-divider"),m=s("AppIcon"),c=s("el-button"),g=s("el-input"),u=s("auto-tooltip"),t=s("TagEllipsis"),a=s("el-scrollbar"),E=s("el-row"),K=s("el-dialog");return f(),L(K,{title:p.$t("views.paragraph.editParagraph"),modelValue:C.value,"onUpdate:modelValue":_[3]||(_[3]=U=>C.value=U),width:"80%","destroy-on-close":"",class:"paragraph-dialog","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[e("span",Ie,[n(c,{onClick:_[2]||(_[2]=N(U=>C.value=!1,["prevent"]))},{default:o(()=>[w(l(p.$t("common.cancel")),1)]),_:1}),n(c,{type:"primary",onClick:I},{default:o(()=>[w(l(p.$t("common.save")),1)]),_:1})])]),default:o(()=>[M.isConnect?(f(),L(E,{key:0},{default:o(()=>[n(V,{span:18,class:"p-24"},{default:o(()=>[n(we,{ref_key:"paragraphFormRef",ref:D,data:b.value,isEdit:!0,"knowledge-id":M.knowledgeId},null,8,["data","knowledge-id"])]),_:1}),n(V,{span:6,class:"border-l",style:{width:"300px"}},{default:o(()=>[e("p",Re,[e("span",Fe,[e("span",null,l(p.$t("views.paragraph.relatedProblem.title")),1),n(v,{direction:"vertical",class:"mr-4"}),n(c,{text:"",onClick:k},{default:o(()=>[n(m,{iconName:"app-add-outlined"})]),_:1})])]),n(a,{height:"500px"},{default:o(()=>[e("div",De,[r.value?(f(),L(g,{key:0,modelValue:i.value,"onUpdate:modelValue":_[0]||(_[0]=U=>i.value=U),placeholder:p.$t("views.paragraph.relatedProblem.placeholder"),onChange:R,onBlur:_[1]||(_[1]=U=>r.value=!1),ref_key:"inputRef",ref:T,class:"mb-8"},null,8,["modelValue","placeholder"])):q("",!0),(f(!0),A(j,null,G(b.value.problem_list,(U,B)=>(f(),L(t,{key:B,onClose:Q=>y(U,B),class:"question-tag",type:"info",effect:"plain",closable:""},{default:o(()=>[n(u,{content:U.content},{default:o(()=>[w(l(U.content),1)]),_:2},1032,["content"])]),_:2},1032,["onClose"]))),128))])]),_:1})]),_:1})]),_:1})):(f(),A("div",Me,[n(we,{ref_key:"paragraphFormRef",ref:D,data:b.value,isEdit:!0,"knowledge-id":M.knowledgeId},null,8,["data","knowledge-id"])]))]),_:1},8,["title","modelValue"])}}}),Ue={class:"flex-between"},Pe={class:"lighter mt-12"},xe={class:"lighter mt-12"},Ae=Y({__name:"ParagraphList",props:{modelValue:{type:Array,default:()=>[]},isConnect:Boolean,knowledgeId:String},emits:["update:modelValue"],setup(M,{emit:z}){const F=$(30),S=$(1),C=$(0),b=$(),D=z,T=$(!1),r=$([]),i=M;_e(()=>{if(i.modelValue&&i.modelValue.length>0){const p=F.value*S.value;r.value=i.modelValue.slice(0,Math.min(p,i.modelValue.length))}}),_e(()=>{const _=F.value*S.value;r.value=i.modelValue.slice(0,Math.min(_,i.modelValue.length))});const d=X(()=>r.value),y=()=>{T.value||(T.value=!0,setTimeout(()=>{T.value=!1},100))},R=(p,_)=>{C.value=_,b.value.open(p)},k=p=>{const _=[...i.modelValue];i.isConnect&&p.title&&!(p!=null&&p.problem_list.some(v=>v.content===p.title.trim()))&&p.problem_list.push({content:p.title.trim()}),_[C.value]=de.cloneDeep(p),D("update:modelValue",_);const V=C.value-F.value*(S.value-1);V>=0&&V<r.value.length&&(r.value[V]=de.cloneDeep(p))},I=(p,_)=>{$e(`${P("views.paragraph.delete.confirmTitle")}${p.title||"-"} ?`,P("views.paragraph.delete.confirmMessage"),{confirmButtonText:P("common.confirm"),confirmButtonClass:"danger"}).then(()=>{const V=[...i.modelValue];if(V.splice(_,1),D("update:modelValue",V),r.value.splice(_,1),i.modelValue.length>r.value.length*S.value){const v=i.modelValue[r.value.length*S.value];v&&r.value.push(v)}}).catch(()=>{})};return(p,_)=>{const V=s("AppIcon"),v=s("el-button"),m=s("el-text"),c=s("el-card"),g=s("InfiniteScroll");return f(),A("div",null,[n(g,{size:d.value.length,total:M.modelValue.length,page_size:F.value,current_page:S.value,"onUpdate:current_page":_[0]||(_[0]=u=>S.value=u),onLoad:_[1]||(_[1]=u=>y()),loading:T.value},{default:o(()=>[(f(!0),A(j,null,G(d.value,(u,t)=>(f(),L(c,{key:t,shadow:"never",class:"card-never mb-16"},{default:o(()=>[e("div",Ue,[e("span",null,l(u.title||"-"),1),e("div",null,[n(v,{link:"",onClick:a=>R(u,t)},{default:o(()=>[n(V,{iconName:"app-edit"})]),_:1},8,["onClick"]),n(v,{link:"",onClick:a=>I(u,t)},{default:o(()=>[n(V,{iconName:"app-delete"})]),_:1},8,["onClick"])])]),e("div",Pe,l(u.content),1),e("div",xe,[n(m,{type:"info"},{default:o(()=>[w(l(u.content.length)+" "+l(p.$t("views.paragraph.character_count")),1)]),_:2},1024)])]),_:2},1024))),128))]),_:1},8,["size","total","page_size","current_page","loading"]),n(ze,{ref_key:"EditParagraphDialogRef",ref:b,onUpdateContent:k,isConnect:M.isConnect,"knowledge-id":M.knowledgeId},null,8,["isConnect","knowledge-id"])])}}}),Ee={class:"flex-center"},Be=["src"],He={class:"ml-4"},Ne={class:"mb-16"},Xe={key:0,class:"paragraph-list"},qe=Y({__name:"ParagraphPreview",props:{data:{type:Array,default:()=>[]},isConnect:Boolean,knowledgeId:String},setup(M){const z=$(0);return(F,S)=>{const C=s("el-text"),b=s("el-scrollbar"),D=s("el-tab-pane"),T=s("el-tabs");return f(),L(T,{modelValue:z.value,"onUpdate:modelValue":S[0]||(S[0]=r=>z.value=r),class:"paragraph-tabs"},{default:o(()=>[(f(!0),A(j,null,G(M.data,(r,i)=>(f(),L(D,{key:i,label:r.name,name:i},{label:o(()=>[e("div",Ee,[e("img",{src:H(re)(r&&(r==null?void 0:r.name)),alt:"",height:"16"},null,8,Be),e("span",He,l(r==null?void 0:r.name),1)])]),default:o(()=>[e("div",Ne,[n(C,{type:"info"},{default:o(()=>[w(l(r.content.length)+" "+l(F.$t("views.paragraph.title")),1)]),_:2},1024)]),z.value==i?(f(),A("div",Xe,[n(b,null,{default:o(()=>[n(Ae,{modelValue:r.content,"onUpdate:modelValue":d=>r.content=d,isConnect:M.isConnect,"knowledge-id":M.knowledgeId},null,8,["modelValue","onUpdate:modelValue","isConnect","knowledge-id"])]),_:2},1024)])):q("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}}),Qe=J(qe,[["__scopeId","data-v-c20b8d02"]]),Ze={class:"set-rules"},Oe={class:"title-decoration-1 mb-16"},Ke={class:"set-rules__right"},je={class:"mb-4"},Ye={class:"mb-4"},Ge={class:"set-rules__form"},Je={class:"form-item mb-16"},We={class:"title flex align-center mb-8"},et={style:{"margin-right":"4px"}},tt={class:"form-item mb-16"},lt={class:"title mb-8"},ot={class:"form-item mb-16"},nt={class:"title mb-8"},st={style:{"margin-top":"4px"}},at={class:"text-right mt-8"},it={class:"title-decoration-1 mb-8"},ut=Y({__name:"SetRules",setup(M,{expose:z}){const{knowledge:F}=pe(),S=X(()=>F.documentsFiles),C=$([]),b=oe(),{query:{id:D}}=b,T=X(()=>b.path.includes("shared")?"systemShare":b.path.includes("resource-management")?"systemManage":"workspace"),r=$("1"),i=$(!1),d=$([]),y=$(!1),R=$(!1),k=$(!0),I=be({patterns:[],limit:500,with_filter:!0});function p(v){v&&k.value&&(d.value=d.value.map(m=>({...m,content:m.content.map(c=>({...c,problem_list:c.title.trim()?[{content:c.title.trim()}]:[]}))})),k.value=!1)}function _(){i.value=!0;const v=new FormData;S.value.forEach(m=>{m!=null&&m.raw&&v.append("file",m==null?void 0:m.raw)}),r.value==="2"&&Object.keys(I).forEach(m=>{m=="patterns"?I.patterns.forEach(c=>v.append("patterns",c)):v.append(m,I[m])}),O({type:"document",systemType:T.value}).postSplitDocument(D,v).then(m=>{const c=m.data;c.map(g=>{g.name.length>128&&(g.name=Ve(g.name,128)),R.value&&g.content.map(u=>{u.problem_list=u.title.trim()?[{content:u.title.trim()}]:[]})}),d.value=c,i.value=!1}).catch(()=>{i.value=!1})}const V=()=>{O({type:"document",systemType:T.value}).listSplitPattern(D,y).then(v=>{C.value=v.data})};return ce(r,()=>{r.value==="2"&&V()}),ye(()=>{_()}),z({paragraphList:d,checkedConnect:R,loading:i}),(v,m)=>{const c=s("el-text"),g=s("el-radio"),u=s("el-card"),t=s("AppIcon"),a=s("el-tooltip"),E=s("el-option"),K=s("el-select"),U=s("el-slider"),B=s("el-switch"),Q=s("el-radio-group"),Z=s("el-scrollbar"),W=s("el-checkbox"),ne=s("el-button"),ee=s("el-col"),se=s("el-row"),ae=me("loading");return f(),A("div",Ze,[n(se,null,{default:o(()=>[n(ee,{span:10,class:"p-24"},{default:o(()=>[e("h4",Oe,l(v.$t("views.document.setRules.title.setting")),1),e("div",Ke,[n(Z,null,{default:o(()=>[e("div",{class:"left-height",onClick:m[5]||(m[5]=N(()=>{},["stop"]))},[n(Q,{modelValue:r.value,"onUpdate:modelValue":m[4]||(m[4]=x=>r.value=x),class:"card__radio"},{default:o(()=>[n(u,{shadow:"never",class:ge(["mb-16",r.value==="1"?"active":""])},{default:o(()=>[n(g,{value:"1",size:"large"},{default:o(()=>[e("p",je,l(v.$t("views.document.setRules.intelligent.label")),1),n(c,{type:"info"},{default:o(()=>[w(l(v.$t("views.document.setRules.intelligent.text")),1)]),_:1})]),_:1})]),_:1},8,["class"]),n(u,{shadow:"never",class:ge(["mb-16",r.value==="2"?"active":""])},{default:o(()=>[n(g,{value:"2",size:"large"},{default:o(()=>[e("p",Ye,l(v.$t("views.document.setRules.advanced.label")),1),n(c,{type:"info"},{default:o(()=>[w(l(v.$t("views.document.setRules.advanced.text")),1)]),_:1})]),_:1}),r.value==="2"?(f(),L(u,{key:0,shadow:"never",class:"card-never mt-16",style:{"margin-left":"30px"}},{default:o(()=>[e("div",Ge,[e("div",Je,[e("div",We,[e("span",et,l(v.$t("views.document.setRules.patterns.label")),1),n(a,{effect:"dark",content:v.$t("views.document.setRules.patterns.tooltip"),placement:"right"},{default:o(()=>[n(t,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"])]),e("div",{onClick:m[1]||(m[1]=N(()=>{},["stop"]))},[n(K,{modelValue:I.patterns,"onUpdate:modelValue":m[0]||(m[0]=x=>I.patterns=x),multiple:"","reserve-keyword":!1,"allow-create":"","default-first-option":"",filterable:"",placeholder:v.$t("views.document.setRules.patterns.placeholder")},{default:o(()=>[(f(!0),A(j,null,G(C.value,(x,te)=>(f(),L(E,{key:te,label:x.key,value:x.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])])]),e("div",tt,[e("div",lt,l(v.$t("views.document.setRules.limit.label")),1),n(U,{modelValue:I.limit,"onUpdate:modelValue":m[2]||(m[2]=x=>I.limit=x),"show-input":"","show-input-controls":!1,min:50,max:1e5},null,8,["modelValue"])]),e("div",ot,[e("div",nt,l(v.$t("views.document.setRules.with_filter.label")),1),n(B,{size:"small",modelValue:I.with_filter,"onUpdate:modelValue":m[3]||(m[3]=x=>I.with_filter=x)},null,8,["modelValue"]),e("div",st,[n(c,{type:"info"},{default:o(()=>[w(l(v.$t("views.document.setRules.with_filter.text")),1)]),_:1})])])])]),_:1})):q("",!0)]),_:1},8,["class"])]),_:1},8,["modelValue"])])]),_:1}),e("div",null,[n(W,{modelValue:R.value,"onUpdate:modelValue":m[6]||(m[6]=x=>R.value=x),onChange:p,style:{"white-space":"normal"}},{default:o(()=>[w(l(v.$t("views.document.setRules.checkedConnect.label")),1)]),_:1},8,["modelValue"])]),e("div",at,[n(ne,{onClick:_},{default:o(()=>[w(l(v.$t("views.document.buttons.preview")),1)]),_:1})])])]),_:1}),n(ee,{span:14,class:"p-24 border-l"},{default:o(()=>[ve((f(),A("div",null,[e("h4",it,l(v.$t("views.document.setRules.title.preview")),1),n(Qe,{data:d.value,"onUpdate:data":m[7]||(m[7]=x=>d.value=x),isConnect:R.value,"knowledge-id":H(D)},null,8,["data","isConnect","knowledge-id"])])),[[ae,i.value]])]),_:1})]),_:1})])}}}),dt=J(ut,[["__scopeId","data-v-c7e3e026"]]),ct={class:"mt-8"},rt={class:"bold"},pt={class:"bold"},mt={class:"bold"},vt={class:"result-success"},ft={class:"bolder"},_t={class:"flex-between"},gt={class:"flex"},wt=["src"],ht={class:"ml-8"},$t=Y({__name:"ResultSuccess",props:{data:{type:Object,default:()=>{}}},setup(M){const z=M,F=ke(),S=oe(),{params:{id:C,folderId:b}}=S,D=X(()=>S.path.includes("shared")?"systemShare":S.path.includes("resource-management")?"systemManage":"workspace"),T=X(()=>{var i;return(i=z.data)==null?void 0:i.document_list.reduce((d,y)=>d+=y.paragraph_count,0)}),r=X(()=>{var i;return((i=z.data)==null?void 0:i.document_list.reduce((d,y)=>d+=y.char_length,0))||0});return(i,d)=>{const y=s("el-text"),R=s("el-divider"),k=s("el-button"),I=s("el-result"),p=s("SuccessFilled"),_=s("el-icon"),V=s("CircleCloseFilled"),v=s("Loading"),m=s("el-card"),c=s("el-scrollbar");return f(),L(c,null,{default:o(()=>{var g;return[n(I,{icon:"color-success",title:`沁 ${i.$t("views.knowledge.ResultSuccess.title")} 沁荏},{"sub-title":o(()=>{var u;return[e("div",ct,[e("span",rt,l(((u=M.data)==null?void 0:u.document_list.length)||0),1),n(y,{type:"info",class:"ml-4"},{default:o(()=>[w(l(i.$t("common.fileUpload.document")),1)]),_:1}),n(R,{direction:"vertical"}),e("span",pt,l(T.value||0),1),n(y,{type:"info",class:"ml-4"},{default:o(()=>[w(l(i.$t("views.knowledge.ResultSuccess.paragraph")),1)]),_:1}),n(R,{direction:"vertical"}),e("span",mt,l(H(Le)(r.value)||0),1),n(y,{type:"info",class:"ml-4"},{default:o(()=>[w(l(i.$t("common.character")),1)]),_:1})])]}),extra:o(()=>[D.value==="workspace"?(f(),L(k,{key:0,onClick:d[0]||(d[0]=u=>H(F).push({path:"/knowledge"}))},{default:o(()=>[w(l(i.$t("views.knowledge.ResultSuccess.buttons.toknowledge")),1)]),_:1})):(f(),L(k,{key:1,onClick:d[1]||(d[1]=u=>H(F).push({path:`/system/${H(b)}/knowledge`}))},{default:o(()=>[w(l(i.$t("views.knowledge.ResultSuccess.buttons.toknowledge")),1)]),_:1})),n(k,{type:"primary",onClick:d[2]||(d[2]=u=>{var t;return H(F).push({path:`/knowledge/${(t=M.data)==null?void 0:t.id}/${H(b)}/document`})})},{default:o(()=>[w(l(i.$t("views.knowledge.ResultSuccess.buttons.toDocument")),1)]),_:1})]),_:1},8,["title"]),e("div",vt,[e("p",ft,l(i.$t("views.knowledge.ResultSuccess.documentList")),1),(f(!0),A(j,null,G((g=M.data)==null?void 0:g.document_list,(u,t)=>(f(),L(m,{shadow:"never",class:"file-List-card mt-8",key:t},{default:o(()=>[e("div",_t,[e("div",gt,[e("img",{src:H(re)(u&&(u==null?void 0:u.name)),alt:"",width:"40"},null,8,wt),e("div",ht,[e("p",null,l(u&&(u==null?void 0:u.name)),1),n(y,{type:"info",size:"small"},{default:o(()=>[w(l(H(Ce)(u&&(u==null?void 0:u.char_length))),1)]),_:2},1024)])]),e("div",null,[n(y,{type:"info",class:"mr-16"},{default:o(()=>[w(l(u&&(u==null?void 0:u.paragraph_count))+" "+l(i.$t("views.knowledge.ResultSuccess.paragraph_count")),1)]),_:2},1024),u.status==="1"?(f(),L(y,{key:0},{default:o(()=>[n(_,{class:"color-success"},{default:o(()=>[n(p)]),_:1})]),_:1})):u.status==="2"?(f(),L(y,{key:1},{default:o(()=>[n(_,{class:"color-danger"},{default:o(()=>[n(V)]),_:1})]),_:1})):u.status==="0"?(f(),L(y,{key:2},{default:o(()=>[n(_,{class:"is-loading primary"},{default:o(()=>[n(v)]),_:1}),w(" "+l(i.$t("views.knowledge.ResultSuccess.loading"))+"... ",1)]),_:1})):q("",!0)])])]),_:2},1024))),128))])]}),_:1})}}}),bt=J($t,[["__scopeId","data-v-7c0700b3"]]),ue="data:image/svg+xml,%3csvg%20width='40'%20height='40'%20viewBox='0%200%2040%2040'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M33.0404%2011.3738C33.2279%2011.5614%2033.3333%2011.8157%2033.3333%2012.0809V34.8149C33.3333%2035.8376%2032.5374%2036.6667%2031.5555%2036.6667H8.4444C7.46256%2036.6667%206.66663%2035.8376%206.66663%2034.8149V5.18523C6.66663%204.16248%207.46256%203.33337%208.4444%203.33337H24.5857C24.851%203.33337%2025.1053%203.43873%2025.2929%203.62627L33.0404%2011.3738Z'%20fill='%233370FF'/%3e%3cpath%20d='M20.6509%2015.8135C20.3173%2015.3965%2019.683%2015.3965%2019.3494%2015.8135L14.4166%2021.9795C13.9801%2022.5251%2014.3686%2023.3334%2015.0673%2023.3334H18.3335V26.6667H21.6668V23.3334H24.9329C25.6317%2023.3334%2026.0202%2022.5251%2025.5837%2021.9795L20.6509%2015.8135Z'%20fill='white'/%3e%3cpath%20d='M18.3335%2030.0001V28.3334H21.6668V30.0001H18.3335Z'%20fill='white'/%3e%3cpath%20d='M25%203.33337L33.3333%2011.6667H26.6667C25.7462%2011.6667%2025%2010.9205%2025%2010V3.33337Z'%20fill='%232B5FD9'/%3e%3c/svg%3e",yt={class:"title-decoration-1 mb-8"},kt={class:"mt-16 mb-16"},Ct={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},Tt={class:"mt-4"},Vt={class:"ml-16 lighter"},Lt={class:"el-upload__text"},St={class:"upload__decoration"},Rt={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},Ft={class:"mt-4"},Dt={class:"ml-16 lighter"},Mt={class:"el-upload__text"},It={class:"upload__decoration"},zt={class:"update-info flex p-8-12 border-r-6 mb-16 w-full"},Ut={class:"mt-4"},Pt={class:"ml-16 lighter"},xt={class:"el-upload__text"},At={class:"upload__decoration"},Et={class:"flex-between"},Bt={class:"flex"},Ht=["src"],Nt={class:"ml-8"},Xt=Y({__name:"UploadComponent",setup(M,{expose:z}){const F=oe(),{query:{id:S}}=F,C=X(()=>F.path.includes("shared")?"systemShare":F.path.includes("resource-management")?"systemManage":"workspace"),{knowledge:b}=pe(),D=X(()=>b.documentsFiles),T=X(()=>b.documentsType),r=$(),i=$(!1),d=$({fileType:"txt",fileList:[]}),y=be({fileList:[{required:!0,message:P("views.document.upload.requiredMessage"),trigger:"change"}]}),R=$(50),k=$(100);ce(d.value,t=>{b.saveDocumentsType(t.fileType),b.saveDocumentsFile(t.fileList)});function I(t){O({type:"document",systemType:C.value}).exportQATemplate(`${t}${P("views.document.upload.template")}.${t=="csv"?t:"xlsx"}`,t)}function p(t){O({type:"document",systemType:C.value}).exportTableTemplate(`${t}${P("views.document.upload.template")}.${t=="csv"?t:"xlsx"}`,t)}function _(){d.value.fileList=[]}function V(t){d.value.fileList.splice(t,1)}const v=(t,a)=>{if(!((t==null?void 0:t.size)/1024/1024<k.value))return le(P("views.document.tip.fileLimitSizeTip1")+k.value+"MB"),a.splice(-1,1),!1;if(!Se(t==null?void 0:t.name,d.value.fileType))return(t==null?void 0:t.name)!==".DS_Store"&&le(P("views.document.upload.errorMessage2")),a.splice(-1,1),!1;if((t==null?void 0:t.size)===0)return le(P("views.document.upload.errorMessage3")),a.splice(-1,1),!1},m=()=>{le(P("views.document.tip.fileLimitCountTip1")+R.value+P("views.document.tip.fileLimitCountTip2"))},c=t=>{let a=null;he(()=>{document.querySelector(".el-upload__input")!=null&&(a=document.querySelector(".el-upload__input"),a.webkitdirectory=t)})};function g(){if(r.value)return r.value.validate(t=>t)}function u(){O({type:"knowledge",systemType:C.value}).getKnowledgeDetail(S,i).then(t=>{R.value=t.data.file_count_limit,k.value=t.data.file_size_limit})}return ye(()=>{T.value&&(d.value.fileType=T.value),D.value&&(d.value.fileList=D.value),u()}),Te(()=>{d.value={fileType:"txt",fileList:[]}}),z({validate:g,form:d}),(t,a)=>{var te;const E=s("el-radio-button"),K=s("el-radio-group"),U=s("AppIcon"),B=s("el-button"),Q=s("el-upload"),Z=s("el-form-item"),W=s("el-form"),ne=s("el-text"),ee=s("el-card"),se=s("el-col"),ae=s("el-row"),x=me("loading");return f(),A(j,null,[e("h4",yt,l(t.$t("views.document.uploadDocument")),1),ve((f(),L(W,{ref_key:"FormRef",ref:r,model:d.value,rules:y,"label-position":"top","require-asterisk-position":"right"},{default:o(()=>[e("div",kt,[n(K,{modelValue:d.value.fileType,"onUpdate:modelValue":a[0]||(a[0]=h=>d.value.fileType=h),onChange:_,class:"app-radio-button-group"},{default:o(()=>[n(E,{value:"txt"},{default:o(()=>[w(l(t.$t("views.document.fileType.txt.label")),1)]),_:1}),n(E,{value:"table"},{default:o(()=>[w(l(t.$t("views.document.fileType.table.label")),1)]),_:1}),n(E,{value:"QA"},{default:o(()=>[w(l(t.$t("views.document.fileType.QA.label")),1)]),_:1})]),_:1},8,["modelValue"])]),d.value.fileType==="QA"?(f(),L(Z,{key:0,prop:"fileList"},{default:o(()=>[e("div",Ct,[e("div",Tt,[n(U,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",Vt,[e("p",null,[w(l(t.$t("views.document.fileType.QA.tip1"))+" ",1),n(B,{type:"primary",link:"",onClick:a[1]||(a[1]=h=>I("excel"))},{default:o(()=>[w(l(t.$t("views.document.upload.download"))+" Excel "+l(t.$t("views.document.upload.template")),1)]),_:1}),n(B,{type:"primary",link:"",onClick:a[2]||(a[2]=h=>I("csv"))},{default:o(()=>[w(l(t.$t("views.document.upload.download"))+" CSV "+l(t.$t("views.document.upload.template")),1)]),_:1})]),e("p",null,l(t.$t("views.document.fileType.QA.tip2")),1),e("p",null," 3. "+l(t.$t("views.document.tip.fileLimitCountTip1"))+" "+l(R.value)+" "+l(t.$t("views.document.tip.fileLimitCountTip2"))+", "+l(t.$t("views.document.tip.fileLimitSizeTip1"))+" "+l(k.value)+" MB ",1)])]),n(Q,{webkitdirectory:!1,class:"w-full mb-4",drag:"",multiple:"","file-list":d.value.fileList,"onUpdate:fileList":a[5]||(a[5]=h=>d.value.fileList=h),action:"#","auto-upload":!1,"show-file-list":!1,accept:".xlsx, .xls, .csv,.zip",limit:R.value,"on-exceed":m,"on-change":v,onClick:a[6]||(a[6]=N(h=>c(!1),["prevent"]))},{default:o(()=>[a[17]||(a[17]=e("img",{src:ue,alt:""},null,-1)),e("div",Lt,[e("p",null,[w(l(t.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:a[3]||(a[3]=N(h=>c(!1),["prevent"]))},l(t.$t("views.document.upload.selectFile")),1),e("em",{class:"hove ml-4",onClick:a[4]||(a[4]=N(h=>c(!0),["prevent"]))},l(t.$t("views.document.upload.selectFiles")),1)]),e("div",St,[e("p",null,l(t.$t("views.document.upload.formats"))+"XLS縲々LSX縲，SV縲〇IP",1)])])]),_:1},8,["file-list","limit"])]),_:1})):d.value.fileType==="table"?(f(),L(Z,{key:1,prop:"fileList"},{default:o(()=>[e("div",Rt,[e("div",Ft,[n(U,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",Dt,[e("p",null,[w(l(t.$t("views.document.fileType.table.tip1"))+" ",1),n(B,{type:"primary",link:"",onClick:a[7]||(a[7]=h=>p("excel"))},{default:o(()=>[w(l(t.$t("views.document.upload.download"))+" Excel "+l(t.$t("views.document.upload.template")),1)]),_:1}),n(B,{type:"primary",link:"",onClick:a[8]||(a[8]=h=>p("csv"))},{default:o(()=>[w(l(t.$t("views.document.upload.download"))+" CSV "+l(t.$t("views.document.upload.template")),1)]),_:1})]),e("p",null,l(t.$t("views.document.fileType.table.tip2")),1),e("p",null,l(t.$t("views.document.fileType.table.tip3")),1),e("p",null," 4. "+l(t.$t("views.document.tip.fileLimitCountTip1"))+" "+l(R.value)+" "+l(t.$t("views.document.tip.fileLimitCountTip2"))+", "+l(t.$t("views.document.tip.fileLimitSizeTip1"))+" "+l(k.value)+" MB ",1)])]),n(Q,{webkitdirectory:!1,class:"w-full mb-4",drag:"",multiple:"","file-list":d.value.fileList,"onUpdate:fileList":a[11]||(a[11]=h=>d.value.fileList=h),action:"#","auto-upload":!1,"show-file-list":!1,accept:".xlsx, .xls, .csv",limit:R.value,"on-exceed":m,"on-change":v,onClick:a[12]||(a[12]=N(h=>c(!1),["prevent"]))},{default:o(()=>[a[18]||(a[18]=e("img",{src:ue,alt:""},null,-1)),e("div",Mt,[e("p",null,[w(l(t.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:a[9]||(a[9]=N(h=>c(!1),["prevent"]))},l(t.$t("views.document.upload.selectFile")),1),e("em",{class:"hover ml-4",onClick:a[10]||(a[10]=N(h=>c(!0),["prevent"]))},l(t.$t("views.document.upload.selectFiles")),1)]),e("div",It,[e("p",null,l(t.$t("views.document.upload.formats"))+"XLS縲々LSX縲，SV",1)])])]),_:1},8,["file-list","limit"])]),_:1})):(f(),L(Z,{key:2,prop:"fileList"},{default:o(()=>[e("div",zt,[e("div",Ut,[n(U,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),e("div",Pt,[e("p",null,l(t.$t("views.document.fileType.txt.tip1")),1),e("p",null," 2. "+l(t.$t("views.document.tip.fileLimitCountTip1"))+" "+l(R.value)+" "+l(t.$t("views.document.tip.fileLimitCountTip2"))+", "+l(t.$t("views.document.tip.fileLimitSizeTip1"))+" "+l(k.value)+" MB ",1)])]),n(Q,{webkitdirectory:!1,class:"w-full",drag:"",multiple:"","file-list":d.value.fileList,"onUpdate:fileList":a[15]||(a[15]=h=>d.value.fileList=h),action:"#","auto-upload":!1,"show-file-list":!1,accept:".txt, .md, .log, .docx, .pdf, .html,.zip,.xlsx,.xls,.csv",limit:R.value,"on-exceed":m,"on-change":v,onClick:a[16]||(a[16]=N(h=>c(!1),["prevent"]))},{default:o(()=>[a[19]||(a[19]=e("img",{src:ue,alt:""},null,-1)),e("div",xt,[e("p",null,[w(l(t.$t("views.document.upload.uploadMessage"))+" ",1),e("em",{class:"hover",onClick:a[13]||(a[13]=N(h=>c(!1),["prevent"]))},l(t.$t("views.document.upload.selectFile")),1),e("em",{class:"hover ml-4",onClick:a[14]||(a[14]=N(h=>c(!0),["prevent"]))},l(t.$t("views.document.upload.selectFiles")),1)]),e("div",At,[e("p",null,l(t.$t("views.document.upload.formats"))+"TXT縲｀arkdown縲￣DF縲．OCX縲？TML縲々LS縲々LSX縲，SV縲〇IP ",1)])])]),_:1},8,["file-list","limit"])]),_:1}))]),_:1},8,["model","rules"])),[[x,i.value]]),(te=d.value.fileList)!=null&&te.length?(f(),L(ae,{key:0,gutter:8},{default:o(()=>[(f(!0),A(j,null,G(d.value.fileList,(h,fe)=>(f(),L(se,{key:fe,span:12,class:"mb-8"},{default:o(()=>[n(ee,{shadow:"never",class:"file-List-card"},{default:o(()=>[e("div",Et,[e("div",Bt,[e("img",{src:H(re)(h&&(h==null?void 0:h.name)),alt:"",width:"40"},null,8,Ht),e("div",Nt,[e("p",null,l(h&&(h==null?void 0:h.name)),1),n(ne,{type:"info",size:"small"},{default:o(()=>[w(l(H(Ce)(h&&(h==null?void 0:h.size))||"0K"),1)]),_:2},1024)])]),n(B,{text:"",onClick:Wt=>V(fe)},{default:o(()=>[n(U,{iconName:"app-delete"})]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):q("",!0)],64)}}}),qt=J(Xt,[["__scopeId","data-v-c79a74ad"]]),Qt={class:"upload-document p-12-24"},Zt={class:"flex align-center mb-16"},Ot={style:{display:"inline-block"}},Kt={class:"upload-document__main flex"},jt={class:"upload-document__component main-calc-height"},Yt={key:0,class:"upload-component p-24"},Gt={key:0,class:"upload-document__footer text-right border-t"},Jt=Y({__name:"UploadDocument",setup(M){const{knowledge:z}=pe(),F=X(()=>z.documentsFiles),S=X(()=>z.documentsType),C=ke(),b=oe(),{params:{folderId:D},query:{id:T}}=b,r=X(()=>b.path.includes("shared")?"systemShare":b.path.includes("resource-management")?"systemManage":"workspace"),i=$(),d=$(),y=$(!1),R=$(!1),k=$(0),I=$(null);async function p(){if(R.value=!0,await d.value.validate())if(S.value==="QA"){const c=new FormData;F.value.forEach(g=>{g!=null&&g.raw&&c.append("file",g==null?void 0:g.raw)}),T&&O({type:"document",systemType:r.value}).postQADocument(T,c,y).then(()=>{ie(P("common.submitSuccess")),V(),C.push({path:`/knowledge/${T}/${D}/document`})})}else if(S.value==="table"){const c=new FormData;F.value.forEach(g=>{g!=null&&g.raw&&c.append("file",g==null?void 0:g.raw)}),T&&O({type:"document",systemType:r.value}).postTableDocument(T,c,y).then(()=>{ie(P("common.submitSuccess")),V(),C.push({path:`/knowledge/${T}/${D}/document`})})}else k.value++>2&&(k.value=0);else R.value=!1}const _=()=>{k.value=0};function V(){z.saveDocumentsFile([]),z.saveDocumentsType("")}function v(){var g;y.value=!0;const c=[];(g=i.value)==null||g.paragraphList.map(u=>{var t;(t=i.value)!=null&&t.checkedConnect||u.content.map(a=>{delete a.problem_list}),c.push({name:u.name,paragraphs:u.content,source_file_id:u.source_file_id})}),T&&O({type:"document",systemType:r.value}).putMulDocument(T,c).then(()=>{ie(P("common.submitSuccess")),V(),C.push({path:`/knowledge/${T}/${D}/document`})}).catch(()=>{y.value=!1})}function m(){var c;((c=F.value)==null?void 0:c.length)>0?$e(P("common.tip"),P("views.document.tip.saveMessage"),{confirmButtonText:P("common.confirm")}).then(()=>{C.go(-1),V()}).catch(()=>{}):C.go(-1)}return Te(()=>{V()}),(c,g)=>{var U,B,Q,Z;const u=s("back-button"),t=s("el-scrollbar"),a=s("el-card"),E=s("el-button"),K=me("loading");return f(),A("div",Qt,[e("div",Zt,[n(u,{onClick:m,style:{"margin-left":"-4px"}}),e("h3",Ot,l(c.$t("views.document.uploadDocument")),1)]),n(a,{style:{"--el-card-padding":"0"}},{default:o(()=>[ve((f(),A("div",Kt,[e("div",jt,[n(t,null,{default:o(()=>[k.value===0?(f(),A("div",Yt,[n(qt,{ref_key:"UploadComponentRef",ref:d},null,512)])):k.value===1?(f(),L(dt,{key:1,ref_key:"SetRulesRef",ref:i},null,512)):k.value===2?(f(),L(bt,{key:2,data:I.value},null,8,["data"])):q("",!0)]),_:1})])])),[[K,y.value]])]),_:1}),k.value!==2?(f(),A("div",Gt,[n(E,{onClick:g[0]||(g[0]=W=>H(C).go(-1)),disabled:((U=i.value)==null?void 0:U.loading)||y.value},{default:o(()=>[w(l(c.$t("common.cancel")),1)]),_:1},8,["disabled"]),k.value===1?(f(),L(E,{key:0,onClick:_,disabled:((B=i.value)==null?void 0:B.loading)||y.value},{default:o(()=>[w(l(c.$t("views.document.buttons.prev")),1)]),_:1},8,["disabled"])):q("",!0),k.value===0?(f(),L(E,{key:1,onClick:p,type:"primary",disabled:((Q=i.value)==null?void 0:Q.loading)||y.value},{default:o(()=>[w(l(S.value==="txt"?c.$t("views.document.buttons.next"):c.$t("views.document.buttons.import")),1)]),_:1},8,["disabled"])):q("",!0),k.value===1?(f(),L(E,{key:2,onClick:v,type:"primary",disabled:((Z=i.value)==null?void 0:Z.loading)||y.value},{default:o(()=>[w(l(c.$t("views.document.buttons.import")),1)]),_:1},8,["disabled"])):q("",!0)])):q("",!0)])}}}),ll=J(Jt,[["__scopeId","data-v-0c1cd587"]]);export{ll as default};
