import{ay as he,az as $e,aA as Ce,aO as Ve,aQ as Ke,aB as u,aC as d,aU as Se,aV as Ne,b6 as xe,aL as Re,aD as s,aW as b,aF as n,aH as t,aG as o,aK as p,aJ as r,b2 as h,aI as m,aE as c,b1 as v,aX as U,aY as I,aS as f,bZ as X,bW as Te,b_ as ze,c2 as T,b3 as L,c0 as Ae}from"./admin-Ca7cl6NN.js";import{S as De}from"./SyncWebDialog-BRhvaG-V.js";import{_ as Ee}from"./index.vue_vue_type_script_setup_true_lang-Dj2shVcI.js";import{l as Le}from"./permission-api-BDoWsP34.js";import"./AIModeParamSettingDialog.vue_vue_type_script_setup_true_lang-CewLxAyU.js";import"./workspace-CiflQXiK.js";const Me={class:"p-16-24"},We={class:"ml-4 color-text-primary"},Be={class:"flex-between mb-16"},Ue={class:"complex-search"},Ie={class:"flex align-center"},Pe={class:"ml-8"},Fe={key:0},Ge={key:1},Oe={key:2},Ze={class:"filter"},He={class:"form-item mb-16 ml-4"},Je={class:"text-right"},Qe={key:0,class:"mr-8"},qe={class:"mr-8"},al=he({__name:"KnowledgeResourceIndex",setup(Xe){const P=$e(),{user:F}=Ce(),i=Ve(()=>Ke.knowledge.systemManage),Y=()=>i.value.doc_read()||i.value.problem_read()||i.value.edit()||i.value.knowledge_chat_user_read()||i.value.hit_test(),j=()=>i.value.sync()||i.value.generate()||i.value.edit()||i.value.export()||i.value.delete()||i.value.auth(),y=u("name"),g=u({name:"",create_user:"",type:""}),G=u([]),ee=u([{label:d("views.knowledge.knowledgeType.generalKnowledge"),value:"0"},{label:d("views.knowledge.knowledgeType.webKnowledge"),value:"1"},{label:d("views.knowledge.knowledgeType.larkKnowledge"),value:"2"}]),N=u(!1),O=u([]),M=Se({current_page:1,page_size:20,total:0}),Z=u();function le(e){Z.value.open(e.id)}const te=e=>{T.exportKnowledge(e.name,e.id,N).then(()=>{L(d("common.exportSuccess"))})},oe=e=>{T.exportZipKnowledge(e.name,e.id,N).then(()=>{L(d("common.exportSuccess"))})};function ae(e){Ae(`${d("views.knowledge.delete.confirmTitle")}${e.name} ?`,`${d("views.knowledge.delete.confirmMessage1")} ${e.application_mapping_count} ${d("views.knowledge.delete.confirmMessage2")}`,{confirmButtonText:d("common.confirm"),confirmButtonClass:"danger"}).then(()=>{T.delKnowledge(e.id,N).then(()=>{w(),L(d("common.deleteSuccess"))})}).catch(()=>{})}const W=u();function ne(e){W.value&&W.value.open([],"knowledge",e)}const H=u();function se(e){H.value.open(e.id)}function ie(e){T.putReEmbeddingKnowledge(e.id).then(()=>{L(d("common.submitSuccess"))})}const z=u([]),A=u(!1),$=u([]),K=u(""),D=u([]);Ne([()=>z.value,()=>K.value],()=>{K.value.length||(D.value=z.value),D.value=z.value.filter(e=>e.label.toLowerCase().includes(K.value.toLowerCase()))},{immediate:!0});function J(e){e==="clear"&&($.value=[]),K.value="",w(),A.value=!1}async function re(){if(F.isEE()){const e=await Le("workspace").getSystemWorkspaceList(N);z.value=e.data.map(a=>({label:a.name,value:a.id}))}}const ce=()=>{g.value={name:"",create_user:""}};function w(){const e={};g.value[y.value]&&(e[y.value]=g.value[y.value]),$.value.length>0&&(e.workspace_ids=JSON.stringify($.value)),T.getKnowledgeListPage(M,e,N).then(a=>{var x,E;M.total=(x=a.data)==null?void 0:x.total,O.value=(E=a.data)==null?void 0:E.records})}return xe(()=>{re(),w(),Re.getAllMemberList("").then(e=>{G.value=e.data})}),(e,a)=>{const x=s("el-breadcrumb-item"),E=s("el-breadcrumb"),R=s("el-option"),B=s("el-select"),Q=s("el-input"),ue=s("KnowledgeIcon"),C=s("el-table-column"),de=s("Filter"),pe=s("el-icon"),S=s("el-button"),me=s("el-checkbox"),ve=s("el-checkbox-group"),_e=s("el-scrollbar"),ge=s("el-empty"),fe=s("el-popover"),_=s("AppIcon"),q=s("el-tooltip"),V=s("el-dropdown-item"),ye=s("el-dropdown-menu"),we=s("el-dropdown"),ke=s("app-table"),be=s("el-card");return n(),b("div",Me,[t(E,{"separator-icon":"ArrowRight"},{default:o(()=>[t(x,null,{default:o(()=>[p(r(h(d)("views.system.resource_management.label")),1)]),_:1}),t(x,null,{default:o(()=>[m("h5",We,r(h(d)("views.knowledge.title")),1)]),_:1})]),_:1}),t(be,{class:"mt-16",style:{height:"calc(var(--app-main-height) + 20px)"}},{default:o(()=>[m("div",Be,[m("div",Ue,[t(B,{class:"complex-search__left",modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=l=>y.value=l),style:{width:"120px"},onChange:ce},{default:o(()=>[t(R,{label:e.$t("common.creator"),value:"create_user"},null,8,["label"]),t(R,{label:e.$t("common.name"),value:"name"},null,8,["label"]),t(R,{label:e.$t("views.system.resource_management.type"),value:"type"},null,8,["label"])]),_:1},8,["modelValue"]),y.value==="name"?(n(),c(Q,{key:0,modelValue:g.value.name,"onUpdate:modelValue":a[1]||(a[1]=l=>g.value.name=l),onChange:w,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):y.value==="create_user"?(n(),c(B,{key:1,modelValue:g.value.create_user,"onUpdate:modelValue":a[2]||(a[2]=l=>g.value.create_user=l),onChange:w,filterable:"",clearable:"",style:{width:"220px"}},{default:o(()=>[(n(!0),b(U,null,I(G.value,l=>(n(),c(R,{key:l.id,value:l.id,label:l.nick_name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):y.value==="type"?(n(),c(B,{key:2,modelValue:g.value.type,"onUpdate:modelValue":a[3]||(a[3]=l=>g.value.type=l),onChange:w,clearable:"",filterable:"",style:{width:"220px"}},{default:o(()=>[(n(!0),b(U,null,I(ee.value,l=>(n(),c(R,{key:l.id,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):v("",!0)])]),t(ke,{data:O.value,"pagination-config":M,onSizeChange:w,onChangePage:w,maxTableHeight:260},{default:o(()=>[t(C,{width:"220",label:e.$t("common.name"),"show-overflow-tooltip":""},{default:o(({row:l})=>[m("div",Ie,[t(ue,{type:l.type,size:24},null,8,["type"]),m("span",Pe,r(l.name),1)])]),_:1},8,["label"]),t(C,{prop:"tool_type",label:e.$t("views.system.resource_management.type"),width:"110"},{default:o(({row:l})=>[l.type===1?(n(),b("span",Fe,r(e.$t("views.knowledge.knowledgeType.webKnowledge")),1)):l.type===2?(n(),b("span",Ge,r(e.$t("views.knowledge.knowledgeType.larkKnowledge")),1)):(n(),b("span",Oe,r(e.$t("views.knowledge.knowledgeType.generalKnowledge")),1))]),_:1},8,["label"]),h(F).isEE()?(n(),c(C,{key:0,width:"150",prop:"workspace_name",label:e.$t("views.workspace.title"),"show-overflow-tooltip":""},{header:o(()=>[m("div",null,[m("span",null,r(e.$t("views.workspace.title")),1),t(fe,{width:200,trigger:"click",visible:A.value},{reference:o(()=>[t(S,{style:{"margin-top":"-2px"},type:$.value&&$.value.length>0?"primary":"",link:"",onClick:a[4]||(a[4]=l=>A.value=!A.value)},{default:o(()=>[t(pe,null,{default:o(()=>[t(de)]),_:1})]),_:1},8,["type"])]),default:o(()=>[m("div",Ze,[m("div",He,[m("div",{onClick:a[7]||(a[7]=f(()=>{},["stop"]))},[t(Q,{modelValue:K.value,"onUpdate:modelValue":a[5]||(a[5]=l=>K.value=l),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),D.value.length?(n(),c(_e,{key:0,height:"300"},{default:o(()=>[t(ve,{modelValue:$.value,"onUpdate:modelValue":a[6]||(a[6]=l=>$.value=l),style:{display:"flex","flex-direction":"column"}},{default:o(()=>[(n(!0),b(U,null,I(D.value,l=>(n(),c(me,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(n(),c(ge,{key:1,description:e.$t("common.noData")},null,8,["description"]))])])]),m("div",Je,[t(S,{size:"small",onClick:a[8]||(a[8]=l=>J("clear"))},{default:o(()=>[p(r(e.$t("common.clear")),1)]),_:1}),t(S,{type:"primary",onClick:J,size:"small"},{default:o(()=>[p(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):v("",!0),t(C,{prop:"nick_name",label:e.$t("common.creator"),"show-overflow-tooltip":""},null,8,["label"]),t(C,{label:e.$t("views.document.table.updateTime"),width:"180"},{default:o(({row:l})=>[p(r(h(X)(l.update_time)),1)]),_:1},8,["label"]),t(C,{label:e.$t("common.createTime"),width:"180"},{default:o(({row:l})=>[p(r(h(X)(l.create_time)),1)]),_:1},8,["label"]),t(C,{label:e.$t("common.operation"),align:"left",width:"120",fixed:"right"},{default:o(({row:l})=>[t(q,{effect:"dark",content:e.$t("views.system.resource_management.management"),placement:"top"},{default:o(()=>[Y()?(n(),b("span",Qe,[t(S,{type:"primary",text:"",title:e.$t("views.system.resource_management.management"),onClick:k=>h(P).push({path:`/knowledge/${l.id}/resource-management/document`})},{default:o(()=>[t(_,{iconName:"app-admin-operation"})]),_:1},8,["title","onClick"])])):v("",!0)]),_:2},1032,["content"]),t(q,{effect:"dark",content:e.$t("views.knowledge.setting.vectorization"),placement:"top"},{default:o(()=>[m("span",qe,[i.value.vector()?(n(),c(S,{key:0,type:"primary",text:"",title:e.$t("views.knowledge.setting.vectorization"),onClick:f(k=>ie(l),["stop"])},{default:o(()=>[t(_,{iconName:"app-vectorization"})]),_:1},8,["title","onClick"])):v("",!0)])]),_:2},1032,["content"]),j()?(n(),c(we,{key:0,trigger:"click"},{dropdown:o(()=>[t(ye,null,{default:o(()=>[l.type===1&&i.value.sync()?(n(),c(V,{key:0,onClick:f(k=>se(l),["stop"])},{default:o(()=>[t(_,{iconName:"app-sync",class:"color-secondary"}),p(" "+r(e.$t("views.knowledge.setting.sync")),1)]),_:1},8,["onClick"])):v("",!0),i.value.generate()?(n(),c(V,{key:1,onClick:f(k=>ne(l),["stop"])},{default:o(()=>[t(_,{iconName:"app-generate-question",class:"color-secondary"}),p(" "+r(e.$t("views.document.generateQuestion.title")),1)]),_:1},8,["onClick"])):v("",!0),i.value.edit()?(n(),c(V,{key:2,onClick:k=>h(P).push({path:`/knowledge/${l.id}/resource-management/setting`})},{default:o(()=>[t(_,{iconName:"app-setting",class:"color-secondary"}),p(" "+r(e.$t("common.setting")),1)]),_:1},8,["onClick"])):v("",!0),i.value.auth()?(n(),c(V,{key:3,onClick:f(k=>le(l),["stop"])},{default:o(()=>[t(_,{iconName:"app-resource-authorization",class:"color-secondary"}),p(" "+r(e.$t("views.system.resourceAuthorization.title")),1)]),_:1},8,["onClick"])):v("",!0),i.value.export()?(n(),c(V,{key:4,onClick:f(k=>te(l),["stop"])},{default:o(()=>[t(_,{iconName:"app-export",class:"color-secondary"}),p(r(e.$t("views.document.setting.export"))+" Excel ",1)]),_:1},8,["onClick"])):v("",!0),i.value.export()?(n(),c(V,{key:5,onClick:f(k=>oe(l),["stop"])},{default:o(()=>[t(_,{iconName:"app-export",class:"color-secondary"}),p(r(e.$t("views.document.setting.export"))+" ZIP",1)]),_:1},8,["onClick"])):v("",!0),i.value.delete()?(n(),c(V,{key:6,type:"danger",onClick:f(k=>ae(l),["stop"])},{default:o(()=>[t(_,{iconName:"app-delete",class:"color-secondary"}),p(" "+r(e.$t("common.delete")),1)]),_:1},8,["onClick"])):v("",!0)]),_:2},1024)]),default:o(()=>[t(S,{text:"",onClick:a[9]||(a[9]=f(()=>{},["stop"])),type:"primary"},{default:o(()=>[t(_,{iconName:"app-more"})]),_:1})]),_:2},1024)):v("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])]),_:1}),t(De,{ref_key:"SyncWebDialogRef",ref:H},null,512),t(Ee,{ref_key:"GenerateRelatedDialogRef",ref:W,apiType:"systemManage"},null,512),t(ze,{type:h(Te).KNOWLEDGE,ref_key:"ResourceAuthorizationDrawerRef",ref:Z},null,8,["type"])])}}});export{al as default};
