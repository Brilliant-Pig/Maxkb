import{ay as ne,aB as u,bd as se,aC as _,aD as t,aE as h,aF as v,aG as a,aH as l,bb as T,aI as m,aK as O,aJ as b,bo as x,bV as Me,bf as te,bg as Ae,bh as Oe,br as Se,be as ve,bs as _e,bn as r,bt as I,bZ as J,bY as E,b_ as k,cG as fe,bm as X,cg as Pe,bW as ge,c6 as be,ce as Ge}from"./chat-CUfIjAsy.js";import{l as K}from"./permission-api-DyNdOx42.js";import"./workspace-Cv2gXV-V.js";const Ve={class:"dialog-footer"},De=ne({__name:"CreateOrUpdateGroupDialog",emits:["refresh"],setup(re,{expose:S,emit:P}){const M=P,g=u(!1),i={name:""},p=u({...i});function D(c){c?p.value={id:c.id,name:c.name}:p.value={...i},g.value=!0}const A=u(),G=se({name:[{required:!0,message:`${_("common.inputPlaceholder")}${_("views.chatUser.group.name")}`,trigger:"blur"}]}),W=u(!1),F=async c=>{c&&await c.validate(f=>{f&&K("userGroup").postUserGroup(p.value,W).then(V=>{x(p.value.id?_("common.renameSuccess"):_("common.createSuccess")),M("refresh",V.data),g.value=!1})})};return S({open:D}),(c,f)=>{const V=t("el-input"),q=t("el-form-item"),$=t("el-form"),U=t("el-button"),n=t("el-dialog");return v(),h(n,{title:`${p.value.id?c.$t("common.rename"):c.$t("common.create")}${c.$t("views.chatUser.group.title")}`,modelValue:g.value,"onUpdate:modelValue":f[4]||(f[4]=d=>g.value=d),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:a(()=>[m("span",Ve,[l(U,{onClick:f[2]||(f[2]=T(d=>g.value=!1,["prevent"]))},{default:a(()=>[O(b(c.$t("common.cancel")),1)]),_:1}),l(U,{type:"primary",onClick:f[3]||(f[3]=d=>F(A.value)),loading:W.value},{default:a(()=>[O(b(p.value.id?c.$t("common.save"):c.$t("common.create")),1)]),_:1},8,["loading"])])]),default:a(()=>[l($,{"label-position":"top",ref_key:"formRef",ref:A,rules:G,model:p.value,"require-asterisk-position":"right",onSubmit:f[1]||(f[1]=T(()=>{},["prevent"]))},{default:a(()=>[l(q,{label:c.$t("views.chatUser.group.name"),prop:"name"},{default:a(()=>[l(V,{modelValue:p.value.name,"onUpdate:modelValue":f[0]||(f[0]=d=>p.value.name=d),maxlength:"128","show-word-limit":"",placeholder:`${c.$t("common.inputPlaceholder")}${c.$t("views.chatUser.group.name")}`},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Le={class:"dialog-footer"},Ne=ne({__name:"CreateGroupUserDialog",emits:["refresh"],setup(re,{expose:S,emit:P}){const M=P,g=u(!1),i={user:[]},p=u({...i}),D=u(!1),A=u([]),G=u([]);async function W(){try{const n=await K("chatUser").getChatUserList(D);G.value=n.data,A.value=[...n.data]}catch(n){console.error(n)}}const F=n=>{if(!n){A.value=G.value;return}const d=n.toLowerCase();A.value=G.value.filter(w=>{var z,L;return((z=w.nick_name)==null?void 0:z.toLowerCase().includes(d))||((L=w.username)==null?void 0:L.toLowerCase().includes(d))})};Me(()=>{W()});const c=u("");function f(n){p.value={...i},c.value=n,g.value=!0}const V=u(),q=se({user:[{required:!0,message:_("common.selectPlaceholder"),trigger:"blur"}]}),$=u(!1),U=async n=>{n&&await n.validate(d=>{d&&K("userGroup").postAddMember(c.value,{user_ids:p.value.user},$).then(()=>{x(_("common.addSuccess")),M("refresh"),g.value=!1})})};return S({open:f}),(n,d)=>{const w=t("el-option"),z=t("el-select"),L=t("el-form-item"),ee=t("el-form"),N=t("el-button"),le=t("el-dialog");return v(),h(le,{title:n.$t("views.role.member.add"),modelValue:g.value,"onUpdate:modelValue":d[3]||(d[3]=C=>g.value=C),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:a(()=>[m("span",Le,[l(N,{onClick:d[1]||(d[1]=T(C=>g.value=!1,["prevent"]))},{default:a(()=>[O(b(n.$t("common.cancel")),1)]),_:1}),l(N,{type:"primary",onClick:d[2]||(d[2]=C=>U(V.value)),loading:$.value},{default:a(()=>[O(b(n.$t("common.add")),1)]),_:1},8,["loading"])])]),default:a(()=>[l(ee,{"label-position":"top",ref_key:"formRef",ref:V,rules:q,model:p.value,"require-asterisk-position":"right"},{default:a(()=>[l(L,{label:n.$t("views.chatUser.group.usernameOrName"),prop:"user"},{default:a(()=>[l(z,{modelValue:p.value.user,"onUpdate:modelValue":d[0]||(d[0]=C=>p.value.user=C),multiple:"",filterable:"","reserve-keyword":!1,placeholder:n.$t("common.selectPlaceholder"),loading:D.value,"filter-method":F},{default:a(()=>[(v(!0),te(Ae,null,Oe(A.value,C=>(v(),h(w,{key:C.id,label:C.nick_name,value:C.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Be={class:"group p-24"},Ie={class:"ml-4 color-text-primary"},Te={class:"flex"},Ke={class:"user-left border-r"},We={class:"p-24 pb-0"},Fe={class:"flex-between mb-12"},qe={class:"medium"},ze={class:"list-height-left"},He={class:"p-8-16"},Je={class:"flex-between"},Ye=["title"],Ze={class:"user-right"},je={class:"flex align-center"},Qe=["title"],Xe={class:"color-input-placeholder ml-4"},xe={class:"flex-between mb-16",style:{"margin-top":"20px"}},el={class:"flex-between complex-search"},ll=ne({__name:"index",setup(re){const S=u(""),P=u(!1),M=u([]),g=u([]),i=u();async function p(){try{const e=await K("userGroup").getUserGroup(P);M.value=e.data,g.value=G(M.value,S.value)}catch(e){console.error(e)}}const D=()=>ge(new J([E.ADMIN,E.WORKSPACE_MANAGE],[k.WORKSPACE_USER_GROUP_EDIT,k.USER_GROUP_EDIT],[],"OR"),"OR"),A=()=>ge(new J([E.ADMIN,E.WORKSPACE_MANAGE],[k.WORKSPACE_USER_GROUP_DELETE,k.USER_GROUP_DELETE],[],"OR"),"OR");Se(async()=>{await p(),i.value=M.value[0]});function G(e,o){return o.length?e.filter(R=>R.name.toLowerCase().includes(o.toLowerCase())):e}ve(S,e=>{g.value=G(M.value,e)});function W(e){i.value=e}const F=u();function c(e){var o;(o=F.value)==null||o.open(e)}function f(e){be(`${_("views.chatUser.group.delete.confirmTitle")}${e.name} ?`,_("views.chatUser.group.delete.confirmMessage"),{confirmButtonText:_("common.confirm"),confirmButtonClass:"danger"}).then(()=>{K("userGroup").delUserGroup(e.id,P).then(async()=>{var o;x(_("common.deleteSuccess")),await p(),i.value=e.id===((o=i.value)==null?void 0:o.id)?M.value[0]:i.value})}).catch(()=>{})}async function V(e){await p(),e?i.value=e:i.value=M.value.find(o=>{var R;return o.id===((R=i.value)==null?void 0:R.id)})}const q=u(!1),$=u("username"),U=u({username:"",nick_name:"",source:""}),n=se({current_page:1,page_size:20,total:0}),d=u([]);async function w(){var e,o;if((e=i.value)!=null&&e.id)try{const R={[$.value]:U.value[$.value]},j=await K("userGroup").getUserListByGroup((o=i.value)==null?void 0:o.id,n,R,q);d.value=j.data.records,n.total=j.data.total}catch(R){console.error(R)}}function z(){n.current_page=1,w()}ve(()=>{var e;return(e=i.value)==null?void 0:e.id},()=>{w()});const L=u();function ee(){var e,o;(o=L.value)==null||o.open((e=i.value)==null?void 0:e.id)}const N=u([]);function le(e){N.value=e}function C(e){be(e?`${_("views.workspace.member.delete.confirmTitle")}${e.nick_name} ?`:_("views.chatUser.group.batchDeleteMember",{count:N.value.length}),"",{confirmButtonText:_("common.confirm"),confirmButtonClass:"danger"}).then(()=>{var o;K("userGroup").postRemoveMember((o=i.value)==null?void 0:o.id,{group_relation_ids:e?[e.user_group_relation_id]:N.value.map(R=>R.user_group_relation_id)},P).then(async()=>{x(_("common.removeSuccess")),await w()})}).catch(()=>{})}const oe=u("");function he(e){oe.value=e.id}return(e,o)=>{const R=t("el-breadcrumb-item"),j=t("el-breadcrumb"),H=t("AppIcon"),Y=t("el-button"),ue=t("el-tooltip"),ae=t("el-input"),ie=t("el-dropdown-item"),we=t("el-dropdown-menu"),Re=t("el-dropdown"),$e=t("common-list"),Ue=t("el-scrollbar"),Ce=t("el-divider"),y=t("el-option"),ce=t("el-select"),Z=t("el-table-column"),Ee=t("app-table"),ke=t("el-card"),Q=_e("hasPermission"),de=_e("loading");return v(),te("div",Be,[l(j,{"separator-icon":"ArrowRight",class:"mb-16"},{default:a(()=>[l(R,null,{default:a(()=>[O(b(r(_)("views.chatUser.title")),1)]),_:1}),l(R,null,{default:a(()=>[m("h5",Ie,b(r(_)("views.chatUser.group.title")),1)]),_:1})]),_:1}),l(ke,{style:{"--el-card-padding":"0"}},{default:a(()=>{var me,pe;return[m("div",Te,[m("div",Ke,[m("div",We,[m("div",Fe,[m("h4",qe,b(e.$t("views.chatUser.group.title")),1),l(ue,{effect:"dark",content:`${e.$t("common.create")}${e.$t("views.chatUser.group.title")}`,placement:"top"},{default:a(()=>[I((v(),h(Y,{type:"primary",text:"",onClick:o[0]||(o[0]=s=>c())},{default:a(()=>[l(H,{iconName:"app-add-outlined"})]),_:1})),[[Q,new(r(J))([r(E).ADMIN,r(E).WORKSPACE_MANAGE],[r(k).WORKSPACE_USER_GROUP_CREATE,r(k).USER_GROUP_CREATE],[],"OR")]])]),_:1},8,["content"])]),l(ae,{modelValue:S.value,"onUpdate:modelValue":o[1]||(o[1]=s=>S.value=s),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:"",filterable:""},null,8,["modelValue","placeholder"])]),m("div",ze,[I((v(),h(Ue,null,{default:a(()=>{var s;return[m("div",He,[l($e,{data:g.value,onClick:W,"default-active":(s=i.value)==null?void 0:s.id,onMouseenter:he,onMouseleave:o[3]||(o[3]=B=>oe.value="")},{default:a(({row:B})=>[m("div",Je,[m("span",{class:"ellipsis",title:B.name},b(r(fe)(B.name)),9,Ye),I(m("div",{onClick:o[2]||(o[2]=T(()=>{},["stop"]))},[D()||A()?(v(),h(Re,{key:0,teleported:!1,trigger:"click"},{dropdown:a(()=>[l(we,{style:{"min-width":"80px"}},{default:a(()=>[D()?(v(),h(ie,{key:0,onClick:T(ye=>c(B),["stop"]),class:"p-8"},{default:a(()=>[l(H,{iconName:"app-edit",class:"color-secondary"}),O(" "+b(e.$t("common.rename")),1)]),_:1},8,["onClick"])):X("",!0),A()?(v(),h(ie,{key:1,onClick:T(ye=>f(B),["stop"]),class:"border-t p-8"},{default:a(()=>[l(H,{iconName:"app-delete",class:"color-secondary"}),O(" "+b(e.$t("common.delete")),1)]),_:1},8,["onClick"])):X("",!0)]),_:2},1024)]),default:a(()=>[l(Y,{text:""},{default:a(()=>[l(H,{iconName:"app-more"})]),_:1})]),_:2},1024)):X("",!0)],512),[[Pe,oe.value===B.id]])])]),empty:a(()=>[...o[10]||(o[10]=[m("span",null,null,-1)])]),_:1},8,["data","default-active"])])]}),_:1})),[[de,P.value]])])]),I((v(),te("div",Ze,[m("div",je,[m("h4",{class:"medium ellipsis",title:(me=i.value)==null?void 0:me.name},b(r(fe)((pe=i.value)==null?void 0:pe.name)),9,Qe),l(Ce,{direction:"vertical",class:"mr-8 ml-8"}),l(H,{iconName:"app-workspace",style:{"font-size":"16px"},class:"color-input-placeholder"}),m("span",Xe,b(n.total),1)]),m("div",xe,[m("div",null,[I((v(),h(Y,{type:"primary",onClick:o[4]||(o[4]=s=>ee())},{default:a(()=>[O(b(r(_)("views.role.member.add")),1)]),_:1})),[[Q,new(r(J))([r(E).ADMIN,r(E).WORKSPACE_MANAGE],[r(k).WORKSPACE_USER_GROUP_ADD_MEMBER,r(k).USER_GROUP_ADD_MEMBER],[],"OR")]]),I((v(),h(Y,{disabled:N.value.length===0,onClick:o[5]||(o[5]=s=>C())},{default:a(()=>[O(b(e.$t("common.remove")),1)]),_:1},8,["disabled"])),[[Q,new(r(J))([r(E).ADMIN,r(E).WORKSPACE_MANAGE],[r(k).WORKSPACE_USER_GROUP_REMOVE_MEMBER,r(k).USER_GROUP_REMOVE_MEMBER],[],"OR")]])]),m("div",el,[l(ce,{class:"complex-search__left",modelValue:$.value,"onUpdate:modelValue":o[6]||(o[6]=s=>$.value=s),style:{width:"120px"}},{default:a(()=>[l(y,{label:e.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),l(y,{label:e.$t("views.userManage.userForm.nick_name.label"),value:"nick_name"},null,8,["label"]),l(y,{label:e.$t("views.userManage.source.label"),value:"source"},null,8,["label"])]),_:1},8,["modelValue"]),$.value==="username"?(v(),h(ae,{key:0,modelValue:U.value.username,"onUpdate:modelValue":o[7]||(o[7]=s=>U.value.username=s),onChange:w,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):$.value==="nick_name"?(v(),h(ae,{key:1,modelValue:U.value.nick_name,"onUpdate:modelValue":o[8]||(o[8]=s=>U.value.nick_name=s),onChange:w,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):$.value==="source"?(v(),h(ce,{key:2,modelValue:U.value.source,"onUpdate:modelValue":o[9]||(o[9]=s=>U.value.source=s),onChange:w,style:{width:"220px"},clearable:"",placeholder:e.$t("common.inputPlaceholder")},{default:a(()=>[l(y,{label:e.$t("views.userManage.source.local"),value:"LOCAL"},null,8,["label"]),l(y,{label:"CAS",value:"CAS"}),l(y,{label:"LDAP",value:"LDAP"}),l(y,{label:"OIDC",value:"OIDC"}),l(y,{label:"OAuth2",value:"OAuth2"}),l(y,{label:e.$t("views.userManage.source.wecom"),value:"wecom"},null,8,["label"]),l(y,{label:e.$t("views.userManage.source.lark"),value:"lark"},null,8,["label"]),l(y,{label:e.$t("views.userManage.source.dingtalk"),value:"dingtalk"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])):X("",!0)])]),l(Ee,{data:d.value,"pagination-config":n,onSizeChange:z,onChangePage:w,onSelectionChange:le,maxTableHeight:330},{default:a(()=>[l(Z,{type:"selection",width:"55"}),l(Z,{prop:"nick_name",label:e.$t("views.userManage.userForm.nick_name.label"),"show-overflow-tooltip":""},null,8,["label"]),l(Z,{prop:"username",label:e.$t("views.login.loginForm.username.label")},null,8,["label"]),l(Z,{prop:"source",label:e.$t("views.userManage.source.label")},{default:a(({row:s})=>[O(b(s.source==="LOCAL"?e.$t("views.userManage.source.local"):s.source==="wecom"?e.$t("views.userManage.source.wecom"):s.source==="lark"?e.$t("views.userManage.source.lark"):s.source==="dingtalk"?e.$t("views.userManage.source.dingtalk"):s.source==="OAUTH2"||s.source==="OAuth2"?"OAuth2":s.source),1)]),_:1},8,["label"]),l(Z,{label:e.$t("common.operation"),width:"100",fixed:"right"},{default:a(({row:s})=>[l(ue,{effect:"dark",content:`${e.$t("common.remove")}`,placement:"top"},{default:a(()=>[I((v(),h(Y,{type:"primary",text:"",onClick:T(B=>C(s),["stop"])},{default:a(()=>[l(H,{iconName:"app-delete-users"})]),_:1},8,["onClick"])),[[Q,new(r(J))([r(E).ADMIN,r(E).WORKSPACE_MANAGE],[r(k).WORKSPACE_USER_GROUP_REMOVE_MEMBER,r(k).USER_GROUP_REMOVE_MEMBER],[],"OR")]])]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])])),[[de,q.value]])])]}),_:1}),l(De,{ref_key:"createOrUpdateGroupDialogRef",ref:F,onRefresh:V},null,512),l(Ne,{ref_key:"createGroupUserDialogRef",ref:L,onRefresh:w},null,512)])}}}),nl=Ge(ll,[["__scopeId","data-v-dd7fce16"]]);export{nl as default};
