import{ay as X,b8 as Y,b7 as Z,b9 as ee,aB as l,be as ae,br as te,bp as ne,aD as i,bs as oe,bf as H,aF as c,bg as J,aI as V,bt as le,aH as u,aE as T,bm as j,aJ as D,bn as $,aG as t,bh as Q,aK as B,bx as se,bc as x,bS as pe,bi as K,b$ as re,bb as W}from"./chat-CUfIjAsy.js";import{_ as ie}from"./ParagraphForm.vue_vue_type_script_setup_true_lang-Cy_JfFls.js";const de={class:"bold title p-24",style:{"padding-bottom":"0"}},ue={class:"flex align-center"},ce={class:"p-24",style:{"padding-top":"16px"}},me=X({__name:"ProblemComponent",props:{paragraphId:{},docId:{},knowledgeId:{},apiType:{}},setup(L,{expose:q}){const a=L,N=Y(),{params:{id:k,documentId:b}}=N,R=Z(()=>ee.knowledge[a.apiType]),z=l(),g=l(!1),h=l(!1),m=l(""),n=l([]),v=l([]),f=l(!1);ae(()=>a.paragraphId,e=>{e&&s()},{immediate:!0});function w(e,p){if(e.id){const I={paragraph_id:a.paragraphId||"",problem_id:e.id};x({type:"paragraph",systemType:a.apiType}).putDisassociationProblem(a.knowledgeId||k,b||a.docId,I,g).then(_=>{s()})}else n.value.splice(p,1)}function s(){g.value=!0,x({type:"paragraph",systemType:a.apiType}).getParagraphProblem(a.knowledgeId||k,b||a.docId,a.paragraphId||"").then(e=>{n.value=e.data,g.value=!1}).catch(()=>{g.value=!1})}function E(){h.value=!0,pe(()=>{var e;(e=z.value)==null||e.focus()})}function S(e){if(a.paragraphId){const p={paragraph_id:a.paragraphId,problem_id:e};(v.value.some(_=>_.id===e)?x({type:"paragraph",systemType:a.apiType}).putAssociationProblem(a.knowledgeId||k,b||a.docId,p,g):x({type:"paragraph",systemType:a.apiType}).postParagraphProblem(a.knowledgeId||k,b||a.docId,a.paragraphId,{content:e},g)).then(()=>{s(),m.value="",h.value=!1})}else{const p=v.value.find(_=>_.id===e),I=p?p.content:e;n.value.some(_=>_.content===I)||n.value.push({content:I}),m.value="",h.value=!1}}const F=e=>{P(e)};function P(e){return x({type:"problem",systemType:a.apiType}).getProblemsPage(a.knowledgeId||k,{current_page:1,page_size:100},e&&{content:e},f).then(p=>{v.value=p.data.records})}return te(()=>{P()}),ne(()=>{n.value=[],m.value="",h.value=!1}),q({problemList:n}),(e,p)=>{const I=i("el-divider"),_=i("AppIcon"),o=i("el-button"),r=i("el-option"),A=i("el-select"),y=i("auto-tooltip"),C=i("TagEllipsis"),M=i("el-scrollbar"),G=oe("loading");return c(),H(J,null,[V("p",de,[V("span",ue,[V("span",null,D(e.$t("views.paragraph.relatedProblem.title")),1),u(I,{direction:"vertical",class:"mr-4"}),R.value.problem_relate($(k))?(c(),T(o,{key:0,text:"",onClick:E},{default:t(()=>[u(_,{iconName:"app-add-outlined"})]),_:1})):j("",!0)])]),le((c(),H("div",null,[u(M,{height:"500px"},{default:t(()=>[V("div",ce,[h.value?(c(),T(A,{key:0,modelValue:m.value,"onUpdate:modelValue":p[0]||(p[0]=d=>m.value=d),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:e.$t("views.paragraph.relatedProblem.placeholder"),remote:"","remote-method":F,loading:f.value,onChange:S,onBlur:p[1]||(p[1]=d=>h.value=!1),class:"mb-16","popper-class":"select-popper","popper-append-to-body":!1},{default:t(()=>[(c(!0),H(J,null,Q(v.value,d=>(c(),T(r,{key:d.id,label:d.content,value:d.id},{default:t(()=>[B(D(d.content),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])):j("",!0),(c(!0),H(J,null,Q(n.value,(d,U)=>(c(),T(C,se({key:U,onClose:O=>w(d,U),class:"question-tag",type:"info",effect:"plain"},{ref_for:!0},R.value.problem_relate($(k))?{closable:!0}:{}),{default:t(()=>[u(y,{content:d.content},{default:t(()=>[B(D(d.content),1)]),_:2},1032,["content"])]),_:2},1040,["onClose"]))),128))])]),_:1})])),[[G,g.value]])],64)}}}),ve={class:"p-24",style:{"padding-bottom":"8px"}},fe={style:{position:"absolute",right:"20px",top:"20px"}},_e={key:0,class:"text-right p-24 pt-0"},be={class:"dialog-footer"},ye=X({__name:"ParagraphDialog",props:{title:{},apiType:{}},emits:["refresh"],setup(L,{expose:q,emit:a}){const N=L,k=Y(),{params:{id:b,documentId:R}}=k,z=Z(()=>ee.knowledge[N.apiType]),g=a,h=l(),m=l(),n=l(!1),v=l(!1),f=l(""),w=l({}),s=l(!1),E=l(""),S=l(""),F=l(null),P=l(null);ae(n,o=>{o||(f.value="",w.value={},s.value=!1,E.value="",S.value="",F.value=null)});const e=()=>{s.value=!1,w.value=K.cloneDeep(F.value)},p=(o,r)=>{o&&r==="add"?(s.value=!0,P.value=o.position):o?(w.value.title=o.title,w.value.content=o.content,F.value=K.cloneDeep(w.value),f.value=o.id,E.value=o.document_id,S.value=o.dataset_id||b,r==="edit"?s.value=!0:s.value=!1):s.value=!0,n.value=!0},I=async()=>{var o,r,A,y;if(await((o=m.value)==null?void 0:o.validate()))if(v.value=!0,f.value)x({type:"paragraph",systemType:N.apiType}).putParagraph(S.value,R||E.value,f.value,(r=m.value)==null?void 0:r.form,v).then(C=>{s.value=!1,g("refresh",C.data)});else{const C=h.value.problemList.length>0?{position:String(P.value)?P.value:null,problem_list:h.value.problemList,...(A=m.value)==null?void 0:A.form}:{position:String(P.value)?P.value:null,...(y=m.value)==null?void 0:y.form};x({type:"paragraph",systemType:N.apiType}).postParagraph(b,R,C,v).then(()=>{n.value=!1,g("refresh")})}},_=K.debounce(()=>{I()},200);return q({open:p,dialogVisible:n}),(o,r)=>{const A=i("AppIcon"),y=i("el-button"),C=i("el-scrollbar"),M=i("el-col"),G=i("el-row"),d=i("el-dialog"),U=oe("loading");return c(),T(d,{title:L.title,modelValue:n.value,"onUpdate:modelValue":r[2]||(r[2]=O=>n.value=O),width:"80%",class:"paragraph-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":""},re({default:t(()=>[le((c(),T(G,null,{default:t(()=>[u(M,{span:18},{default:t(()=>[u(C,{height:"500","wrap-class":"paragraph-scrollbar"},{default:t(()=>[V("div",ve,[V("div",fe,[f.value&&!s.value?(c(),T(y,{key:0,text:"",onClick:r[0]||(r[0]=O=>s.value=!0)},{default:t(()=>[u(A,{iconName:"app-edit"})]),_:1})):j("",!0)]),u(ie,{ref_key:"paragraphFormRef",ref:m,data:w.value,isEdit:s.value,"knowledge-id":$(b)},null,8,["data","isEdit","knowledge-id"])])]),_:1}),f.value&&s.value?(c(),H("div",_e,[u(y,{onClick:W(e,["prevent"])},{default:t(()=>[B(D(o.$t("common.cancel")),1)]),_:1}),u(y,{type:"primary",disabled:v.value,onClick:$(_)},{default:t(()=>[B(D(o.$t("common.save")),1)]),_:1},8,["disabled","onClick"])])):j("",!0)]),_:1}),u(M,{span:6,class:"border-l",style:{width:"300px"}},{default:t(()=>[z.value.problem_read($(b))?(c(),T(me,{key:0,paragraphId:f.value,docId:E.value,knowledgeId:$(b),apiType:L.apiType,ref_key:"ProblemRef",ref:h},null,8,["paragraphId","docId","knowledgeId","apiType"])):j("",!0)]),_:1})]),_:1})),[[U,v.value]])]),_:2},[f.value?void 0:{name:"footer",fn:t(()=>[V("span",be,[u(y,{onClick:r[1]||(r[1]=W(O=>n.value=!1,["prevent"]))},{default:t(()=>[B(D(o.$t("common.cancel")),1)]),_:1}),u(y,{disabled:v.value,type:"primary",onClick:$(_)},{default:t(()=>[B(D(o.$t("common.submit")),1)]),_:1},8,["disabled","onClick"])])]),key:"0"}]),1032,["title","modelValue"])}}});export{ye as _};
