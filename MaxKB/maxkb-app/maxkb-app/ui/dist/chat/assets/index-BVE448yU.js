import{ay as G,aB as i,bV as fe,aD as s,bs as q,aE as W,aF as w,aG as n,aI as _,aH as a,aK as N,aJ as y,bt as S,aL as ve,aC as r,cN as be,bo as H,bd as ae,br as ne,be as le,bf as j,bg as ke,bn as $,bZ as ee,bY as I,b_ as U,bm as z,bb as T,c6 as J,ce as se,cG as oe,cg as we,bW as te}from"./chat-CUfIjAsy.js";import{_ as ge}from"./MemberFormContent.vue_vue_type_script_setup_true_lang-Yqdo20at.js";import{l as O}from"./permission-api-DyNdOx42.js";import"./workspace-Cv2gXV-V.js";const he={style:{flex:"auto"}},$e=G({__name:"AddMemberDrawer",props:{currentWorkspace:{}},emits:["refresh"],setup(K,{expose:g,emit:C}){const v=K,b=C,m=i(!1),d=i(!1),f=i([]),R=i(!1),V=i([]),M=i([]),D=i([]);async function u(){var e;try{const l=await ve.getUserList(R);M.value=[{path:"user_ids",label:r("views.role.member.title"),rules:[{required:!0,message:`${r("common.selectPlaceholder")}${r("views.role.member.title")}`}],selectProps:{options:((e=l.data)==null?void 0:e.map(p=>({label:p.nick_name,value:p.id})))||[],placeholder:`${r("common.selectPlaceholder")}${r("views.role.member.title")}`}}]}catch(l){console.error(l)}}async function t(){var e;try{const l=await O("workspace").getWorkspaceRoleList(R);D.value=[{path:"role_ids",label:r("views.role.member.role"),rules:[{required:!0,message:`${r("common.selectPlaceholder")}${r("views.role.member.role")}`}],selectProps:{options:((e=l.data.filter(p=>p.type!==be.ADMIN))==null?void 0:e.map(p=>({label:p.name,value:p.id})))||[],placeholder:`${r("common.selectPlaceholder")}${r("views.role.member.role")}`}}]}catch(l){console.error(l)}}function c(){V.value=[...M.value,...D.value],f.value=[{user_ids:[],role_ids:[]}]}fe(async()=>{await u(),await t(),c()});function h(){c(),d.value=!0}function k(){d.value=!1}const P=i();function o(){var e;(e=P.value)==null||e.validate().then(async l=>{var p;l&&(await O("workspace").CreateWorkspaceMember((p=v.currentWorkspace)==null?void 0:p.id,f.value,m),H(r("common.addSuccess")),k(),b("refresh"))})}return g({open:h}),(e,l)=>{const p=s("el-button"),L=s("el-drawer"),F=q("loading");return w(),W(L,{modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=A=>d.value=A),size:"600","destroy-on-close":!0,"before-close":k},{header:n(()=>[_("h4",null,y(e.$t("views.role.member.add")),1)]),default:n(()=>[S(a(ge,{ref_key:"memberFormContentRef",ref:P,models:V.value,form:f.value,"onUpdate:form":l[0]||(l[0]=A=>f.value=A),keepOneLine:""},null,8,["models","form"]),[[F,R.value]])]),footer:n(()=>[_("div",he,[a(p,{onClick:k},{default:n(()=>[N(y(e.$t("common.cancel")),1)]),_:1}),a(p,{type:"primary",onClick:l[1]||(l[1]=A=>o()),loading:m.value},{default:n(()=>[N(y(e.$t("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["modelValue"])}}}),Ce={class:"flex-between mb-16"},ye={class:"flex complex-search"},We=G({__name:"Member",props:{currentWorkspace:{}},setup(K){const g=K,C=i(!1),v=i("username"),b=i({username:"",nick_name:""}),m=ae({current_page:1,page_size:20,total:0}),d=i([]);async function f(){var t,c;if((t=g.currentWorkspace)!=null&&t.id)try{const h={[v.value]:b.value[v.value]},k=await O("workspace").getWorkspaceMemberList((c=g.currentWorkspace)==null?void 0:c.id,m,h,C);d.value=k.data.records,m.total=k.data.total}catch(h){console.error(h)}}function R(){m.current_page=1,f()}ne(()=>{f()}),le(()=>{var t;return(t=g.currentWorkspace)==null?void 0:t.id},()=>{f()});const V=({row:t,column:c,rowIndex:h,columnIndex:k})=>{if(c.property==="nick_name"||c.property==="username"){const P=d.value.filter(o=>o.user_id===t.user_id);return h===d.value.findIndex(o=>o.user_id===t.user_id)?{rowspan:P.length,colspan:1}:{rowspan:0,colspan:0}}},M=i();function D(){var t;(t=M.value)==null||t.open()}function u(t){J(`${r("views.workspace.member.delete.confirmTitle")}${t.nick_name} ?`,"",{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{var c;C.value=!0,O("workspace").deleteWorkspaceMember((c=g.currentWorkspace)==null?void 0:c.id,t.user_relation_id,C).then(()=>{H(r("common.deleteSuccess")),f()})}).catch(()=>{})}return(t,c)=>{const h=s("el-button"),k=s("el-option"),P=s("el-select"),o=s("el-input"),e=s("el-table-column"),l=s("AppIcon"),p=s("el-tooltip"),L=s("app-table"),F=q("hasPermission"),A=q("loading");return w(),j(ke,null,[_("div",Ce,[S((w(),W(h,{type:"primary",onClick:D},{default:n(()=>[N(y(t.$t("views.role.member.add")),1)]),_:1})),[[F,new($(ee))([$(I).ADMIN,$(I).WORKSPACE_MANAGE.getWorkspaceRole],[$(U).WORKSPACE_ADD_MEMBER,$(U).WORKSPACE_WORKSPACE_ADD_MEMBER.getWorkspacePermissionWorkspaceManageRole],[],"OR")]]),_("div",ye,[a(P,{class:"complex-search__left",modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=E=>v.value=E),style:{width:"120px"}},{default:n(()=>[a(k,{label:t.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),a(k,{label:t.$t("views.userManage.userForm.nick_name.label"),value:"nick_name"},null,8,["label"])]),_:1},8,["modelValue"]),v.value==="username"?(w(),W(o,{key:0,modelValue:b.value.username,"onUpdate:modelValue":c[1]||(c[1]=E=>b.value.username=E),onChange:f,placeholder:t.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):v.value==="nick_name"?(w(),W(o,{key:1,modelValue:b.value.nick_name,"onUpdate:modelValue":c[2]||(c[2]=E=>b.value.nick_name=E),onChange:f,placeholder:t.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):z("",!0)])]),S((w(),W(L,{data:d.value,"pagination-config":m,onSizeChange:R,onChangePage:f,class:"member-table","span-method":V,maxTableHeight:320},{default:n(()=>[a(e,{prop:"nick_name",label:t.$t("views.userManage.userForm.nick_name.label")},null,8,["label"]),a(e,{prop:"username",label:t.$t("views.login.loginForm.username.label")},null,8,["label"]),a(e,{prop:"role_name",label:t.$t("views.role.member.role")},null,8,["label"]),a(e,{label:t.$t("common.operation"),width:"100",fixed:"right"},{default:n(({row:E})=>[a(p,{effect:"dark",content:`${t.$t("views.role.member.delete.button")}`,placement:"top"},{default:n(()=>[S((w(),W(h,{type:"primary",text:"",onClick:T(Y=>u(E),["stop"])},{default:n(()=>[a(l,{iconName:"app-delete-users"})]),_:1},8,["onClick"])),[[F,new($(ee))([$(I).ADMIN,$(I).WORKSPACE_MANAGE.getWorkspaceRole],[$(U).WORKSPACE_REMOVE_MEMBER,$(U).WORKSPACE_WORKSPACE_REMOVE_MEMBER.getWorkspacePermissionWorkspaceManageRole],[],"OR")]])]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[A,C.value]]),a($e,{ref_key:"addMemberDrawerRef",ref:M,currentWorkspace:g.currentWorkspace,onRefresh:f},null,8,["currentWorkspace"])],64)}}}),Re=se(We,[["__scopeId","data-v-b3a66da8"]]),Me={class:"dialog-footer"},Pe=G({__name:"CreateOrUpdateWorkspaceDialog",emits:["refresh"],setup(K,{expose:g,emit:C}){const v=C,b=i(!1),m={name:""},d=i({...m});function f(u){u?d.value={id:u.id,name:u.name}:d.value={...m},b.value=!0}const R=i(),V=ae({name:[{required:!0,message:`${r("common.inputPlaceholder")}${r("views.workspace.name")}`,trigger:"blur"}]}),M=i(!1),D=async u=>{u&&await u.validate(t=>{t&&O("workspace").CreateOrUpdateWorkspace(d.value,M).then(c=>{H(d.value.id?r("common.renameSuccess"):r("common.createSuccess")),v("refresh",c.data),b.value=!1})})};return g({open:f}),(u,t)=>{const c=s("el-input"),h=s("el-form-item"),k=s("el-form"),P=s("el-button"),o=s("el-dialog");return w(),W(o,{title:`${d.value.id?u.$t("common.rename"):u.$t("common.create")}${u.$t("views.workspace.title")}`,modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=e=>b.value=e),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:n(()=>[_("span",Me,[a(P,{onClick:t[2]||(t[2]=T(e=>b.value=!1,["prevent"]))},{default:n(()=>[N(y(u.$t("common.cancel")),1)]),_:1}),a(P,{type:"primary",onClick:t[3]||(t[3]=e=>D(R.value)),loading:M.value},{default:n(()=>[N(y(d.value.id?u.$t("common.save"):u.$t("common.create")),1)]),_:1},8,["loading"])])]),default:n(()=>[a(k,{"label-position":"top",ref_key:"formRef",ref:R,rules:V,model:d.value,"require-asterisk-position":"right",onSubmit:t[1]||(t[1]=T(()=>{},["prevent"]))},{default:n(()=>[a(h,{label:u.$t("views.workspace.name"),prop:"name"},{default:n(()=>[a(c,{modelValue:d.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value.name=e),maxlength:"64","show-word-limit":"",placeholder:`${u.$t("common.inputPlaceholder")}${u.$t("views.workspace.name")}`},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Ae={class:"workspace-manage p-16-24"},Ee={class:"mb-16"},Ve={class:"flex main-calc-height"},De={class:"workspace-left border-r"},Se={class:"p-24 pb-0"},Oe={class:"flex-between mb-12"},Ie={class:"medium"},Ue={class:"list-height-left"},Ne={class:"p-8-16"},Fe={class:"flex-between"},Be=["title"],Te={class:"workspace-right p-24"},Ke={class:"flex align-center mb-16"},Le={class:"medium"},xe={class:"color-input-placeholder ml-4"},qe=G({__name:"index",setup(K){const g=i(""),C=i(!1),v=i([]),b=i([]),m=i();async function d(){try{const o=await O("workspace").getSystemWorkspaceList(C);v.value=o.data,b.value=M(v.value,g.value)}catch(o){console.error(o)}}ne(async()=>{await d(),m.value=v.value[0]});const f=()=>te([I.ADMIN,U.WORKSPACE_EDIT],"OR"),R=()=>te([I.ADMIN,U.WORKSPACE_DELETE],"OR");async function V(o){await d(),o?m.value=o:m.value=v.value.find(e=>{var l;return e.id===((l=m.value)==null?void 0:l.id)})}function M(o,e){return e.length?o.filter(l=>l.name.toLowerCase().includes(e.toLowerCase())):o}le(g,o=>{b.value=M(v.value,o)});function D(o){m.value=o}const u=i();function t(o){var e;(e=u.value)==null||e.open(o)}async function c(o){try{return await O("workspace").deleteWorkspaceCheck(o)}catch(e){console.log(e)}}async function h(o){const e=await c(o.id);(e?e.data.can_delete:!0)?J(`${r("views.workspace.delete.confirmTitle")}${o.name} ?`,r("views.workspace.delete.confirmContent"),{confirmButtonText:r("common.confirm"),confirmButtonClass:"danger"}).then(()=>{O("workspace").deleteWorkspace(o.id,C).then(async()=>{var p;H(r("common.deleteSuccess")),await d(),m.value=o.id===((p=m.value)==null?void 0:p.id)?v.value[0]:m.value})}):J(`${r("views.workspace.delete.confirmTitle")}${o.name} ?`,e?e.data.message:r("views.workspace.delete.confirmContent"),{showConfirmButton:!1,cancelButtonText:r("common.close")})}const k=i("");function P(o){k.value=o.id}return(o,e)=>{const l=s("AppIcon"),p=s("el-button"),L=s("el-tooltip"),F=s("el-input"),A=s("el-dropdown-item"),E=s("el-dropdown-menu"),Y=s("el-dropdown"),re=s("common-list"),ce=s("el-scrollbar"),ie=s("el-divider"),me=s("UserFilled"),de=s("el-icon"),ue=s("el-card"),pe=q("hasPermission"),Z=q("loading");return w(),j("div",Ae,[_("h2",Ee,y(o.$t("views.workspace.title")),1),a(ue,{style:{"--el-card-padding":"0"}},{default:n(()=>{var Q,X;return[_("div",Ve,[_("div",De,[_("div",Se,[_("div",Oe,[_("h4",Ie,y(o.$t("views.workspace.list")),1),a(L,{effect:"dark",content:`${o.$t("common.create")}${o.$t("views.workspace.title")}`,placement:"top"},{default:n(()=>[S((w(),W(p,{type:"primary",text:"",onClick:e[0]||(e[0]=x=>t())},{default:n(()=>[a(l,{iconName:"app-add-outlined"})]),_:1})),[[pe,[$(I).ADMIN,$(U).WORKSPACE_CREATE]]])]),_:1},8,["content"])]),a(F,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=x=>g.value=x),placeholder:o.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),_("div",Ue,[S((w(),W(ce,null,{default:n(()=>{var x;return[_("div",Ne,[a(re,{data:b.value,onClick:D,"default-active":(x=m.value)==null?void 0:x.id,onMouseenter:P,onMouseleave:e[3]||(e[3]=B=>k.value="")},{default:n(({row:B})=>[_("div",Fe,[_("span",{class:"ellipsis",title:B.name},y($(oe)(B.name)),9,Be),S(_("div",{onClick:e[2]||(e[2]=T(()=>{},["stop"]))},[f()||R()?(w(),W(Y,{key:0,teleported:!1,trigger:"click"},{dropdown:n(()=>[a(E,{style:{"min-width":"80px"}},{default:n(()=>[f()?(w(),W(A,{key:0,onClick:T(_e=>t(B),["stop"]),class:"p-8"},{default:n(()=>[a(l,{iconName:"app-edit",class:"color-secondary"}),N(" "+y(o.$t("common.rename")),1)]),_:1},8,["onClick"])):z("",!0),R()?(w(),W(A,{key:1,onClick:T(_e=>h(B),["stop"]),class:"border-t p-8"},{default:n(()=>[a(l,{iconName:"app-delete",class:"color-secondary"}),N(" "+y(o.$t("common.delete")),1)]),_:1},8,["onClick"])):z("",!0)]),_:2},1024)]),default:n(()=>[a(p,{text:""},{default:n(()=>[a(l,{iconName:"app-more"})]),_:1})]),_:2},1024)):z("",!0)],512),[[we,k.value===B.id]])])]),empty:n(()=>[...e[4]||(e[4]=[_("span",null,null,-1)])]),_:1},8,["data","default-active"])])]}),_:1})),[[Z,C.value]])])]),S((w(),j("div",Te,[_("div",Ke,[_("h4",Le,y($(oe)((Q=m.value)==null?void 0:Q.name)),1),a(ie,{direction:"vertical",class:"mr-8 ml-8"}),a(de,{class:"color-input-placeholder"},{default:n(()=>[a(me)]),_:1}),_("span",xe,y((X=m.value)==null?void 0:X.user_count),1)]),a(Re,{currentWorkspace:m.value},null,8,["currentWorkspace"])])),[[Z,C.value]])])]}),_:1}),a(Pe,{ref_key:"createOrUpdateWorkspaceDialogRef",ref:u,onRefresh:V},null,512)])}}}),Je=se(qe,[["__scopeId","data-v-8d855397"]]);export{Je as default};
