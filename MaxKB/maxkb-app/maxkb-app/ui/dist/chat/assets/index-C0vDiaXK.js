import{ay as ye,aA as we,az as Ce,aC as f,aB as m,bd as ke,be as Ve,aD as i,aE as v,aF as u,bn as D,c2 as Q,aG as t,aH as o,bm as W,aI as p,cf as Se,aK as y,aJ as d,bb as x,cl as z,bo as Ae,ce as Qe,bi as eo,b7 as Oe,b9 as oo,br as to,cM as ao,bs as lo,bt as no,bf as te,bg as Te,bh as De,du as io,cG as so,c1 as We,cI as ro,c0 as ae,c4 as po,bW as le,bZ as M,bY as q,b_ as P,bX as N,c6 as Fe,c7 as co}from"./chat-CUfIjAsy.js";import{_ as uo}from"./icon_import-D9IDqZyN.js";import{b as Me}from"./data-DGRPWeYS.js";import{M as _o}from"./MoveToDialog-C_KK_pzs.js";const mo="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.833313%207.4004C0.833313%207.04021%201.20266%206.79818%201.53291%206.94197L8.77364%2010.0945C8.95607%2010.1739%209.07404%2010.354%209.07404%2010.553V18.339C9.07404%2018.7152%208.67435%2018.9566%208.34141%2018.7816L1.14372%2014.9983C1.05096%2014.9474%200.973499%2014.8738%200.919056%2014.7847C0.864612%2014.6957%200.835079%2014.5943%200.833395%2014.4907L0.833313%2014.4814V7.4004ZM18.4644%206.93223C18.795%206.78607%2019.1666%207.0281%2019.1666%207.38952V14.4814C19.1666%2014.5866%2019.1379%2014.6899%2019.0833%2014.7807C19.0288%2014.8715%2018.9504%2014.9466%2018.8562%2014.9983L11.6585%2018.7816C11.3256%2018.9566%2010.9259%2018.7152%2010.9259%2018.339L10.9259%2010.5912C10.9259%2010.3933%2011.0427%2010.214%2011.2237%2010.1339L18.4644%206.93223ZM9.69988%201.7434C9.79147%201.69315%209.89483%201.66675%209.99998%201.66675C10.1051%201.66675%2010.2085%201.69315%2010.3001%201.7434L17.198%204.80727C17.5962%204.98413%2017.5934%205.55024%2017.1935%205.72316L10.1984%208.74757C10.0718%208.80232%209.92817%208.80232%209.80155%208.74757L2.80644%205.72316C2.40651%205.55025%202.40371%204.98413%202.80191%204.80727L9.69988%201.7434Z'%20fill='white'/%3e%3c/svg%3e",fo="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3.18428%204.04678C3.99599%203.49862%204.93827%203.33337%205.56826%203.33337H12.5001C12.0398%203.33337%2011.6667%203.70647%2011.6667%204.16671C11.6667%204.62694%2012.0398%205.00004%2012.5001%205.00004H5.56826C5.17552%205.00004%204.58372%205.11283%204.11702%205.428C3.69634%205.71209%203.33341%206.18316%203.33341%207.06392C3.33341%207.94608%203.69793%208.42805%204.12319%208.72081C4.59235%209.04379%205.18357%209.16132%205.56826%209.16132H14.4978C15.1332%209.16132%2016.0634%209.3331%2016.8602%209.89052C17.7012%2010.4789%2018.3334%2011.4598%2018.3334%2012.9079C18.3334%2014.3555%2017.7017%2015.3385%2016.8624%2015.9298C16.0666%2016.4905%2015.1362%2016.6667%2014.4978%2016.6667H7.50008C7.96032%2016.6667%208.33342%2016.2936%208.33342%2015.8334C8.33342%2015.3731%207.96032%2015%207.50008%2015H14.4978C14.882%2015%2015.4529%2014.8841%2015.9025%2014.5673C16.3087%2014.2812%2016.6667%2013.8014%2016.6667%2012.9079C16.6667%2012.0149%2016.3092%2011.5391%2015.9047%2011.2562C15.4561%2010.9423%2014.8851%2010.828%2014.4978%2010.828H5.56826C4.93022%2010.828%203.98736%2010.6507%203.17811%2010.0936C2.32496%209.50629%201.66675%208.52289%201.66675%207.06392C1.66675%205.60354%202.32656%204.62601%203.18428%204.04678Z'%20fill='white'/%3e%3cpath%20d='M7.50008%2015C7.03984%2015%206.66675%2015.3731%206.66675%2015.8334C6.66675%2016.2936%207.03984%2016.6667%207.50008%2016.6667H2.50008C2.03984%2016.6667%201.66675%2016.2936%201.66675%2015.8334C1.66675%2015.3731%202.03984%2015%202.50008%2015H7.50008Z'%20fill='white'/%3e%3cpath%20d='M12.5001%205.00004C12.9603%205.00004%2013.3334%204.62694%2013.3334%204.16671C13.3334%203.70647%2012.9603%203.33337%2012.5001%203.33337H17.4546C17.9148%203.33337%2018.2879%203.70647%2018.2879%204.16671C18.2879%204.62694%2017.9148%205.00004%2017.4546%205.00004H12.5001Z'%20fill='white'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M12.5%203.33329C12.0398%203.33329%2011.6667%203.70639%2011.6667%204.16663C11.6667%204.62686%2012.0398%204.99996%2012.5%204.99996C12.9602%204.99996%2013.3333%204.62686%2013.3333%204.16663C13.3333%203.70639%2012.9602%203.33329%2012.5%203.33329ZM10%204.16663C10%202.78591%2011.1193%201.66663%2012.5%201.66663C13.8807%201.66663%2015%202.78591%2015%204.16663C15%205.54734%2013.8807%206.66663%2012.5%206.66663C11.1193%206.66663%2010%205.54734%2010%204.16663Z'%20fill='white'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M7.5%2015C7.03976%2015%206.66667%2015.3731%206.66667%2015.8334C6.66667%2016.2936%207.03976%2016.6667%207.5%2016.6667C7.96024%2016.6667%208.33333%2016.2936%208.33333%2015.8334C8.33333%2015.3731%207.96024%2015%207.5%2015ZM5%2015.8334C5%2014.4527%206.11929%2013.3334%207.5%2013.3334C8.88071%2013.3334%2010%2014.4527%2010%2015.8334C10%2017.2141%208.88071%2018.3334%207.5%2018.3334C6.11929%2018.3334%205%2017.2141%205%2015.8334Z'%20fill='white'/%3e%3c/svg%3e",go={blank:{edges:[],nodes:Me},assistant:{nodes:[{id:"base-node",type:"base-node",x:120,y:260.30849999999987,properties:{config:{},height:734.766,showNode:!0,stepName:"基本信息",node_data:{desc:"模板",name:"知识库问答助手",prologue:`您好，我是 XXX 小助手，您可以向我提出 XXX 使用问题。
- XXX 主要功能有什么？
- XXX 如何收费？
- 需要转人工服务`,tts_type:"BROWSER"},input_field_list:[],user_input_config:{title:"用户输入"},api_input_field_list:[],user_input_field_list:[]}},{id:"start-node",type:"start-node",x:120,y:929.6914999999999,properties:{config:{fields:[{label:"用户问题",value:"question"}],globalFields:[{label:"当前时间",value:"time"},{label:"历史聊天记录",value:"history_context"},{label:"对话 ID",value:"chat_id"}]},fields:[{label:"用户问题",value:"question"}],height:364,showNode:!0,stepName:"开始",globalFields:[{label:"当前时间",value:"time"}]}},{id:"fd0324fc-f5e4-4fa6-a2d9-cb251b467605",type:"search-knowledge-node",x:710,y:929.6914999999999,properties:{config:{fields:[{label:"检索结果的分段列表",value:"paragraph_list"},{label:"满足直接回答的分段列表",value:"is_hit_handling_method_list"},{label:"检索结果",value:"data"},{label:"满足直接回答的分段内容",value:"directly_return"}]},height:794,showNode:!0,stepName:"知识库检索",condition:"AND",node_data:{knowledge_id_list:[],knowledge_setting:{top_n:3,similarity:.6,search_mode:"embedding",max_paragraph_char_number:5e3},question_reference_address:["start-node","question"],all_knowledge_id_list:[],knowledge_list:[]}}},{id:"420a6e4f-44ff-4847-bb81-0923630846b5",type:"condition-node",x:1300,y:929.6914999999999,properties:{width:600,config:{fields:[{label:"分支名称",value:"branch_name"}]},height:544.148,showNode:!0,stepName:"判断器",condition:"AND",node_data:{branch:[{id:"7887",type:"IF",condition:"and",conditions:[{field:["fd0324fc-f5e4-4fa6-a2d9-cb251b467605","is_hit_handling_method_list"],value:1,compare:"is_not_null"}]},{id:"6847",type:"ELSE IF 1",condition:"and",conditions:[{field:["fd0324fc-f5e4-4fa6-a2d9-cb251b467605","paragraph_list"],value:1,compare:"is_not_null"}]},{id:"2794",type:"ELSE",condition:"and",conditions:[]}]},branch_condition_list:[{index:0,height:121.383,id:"7887"},{index:1,height:121.383,id:"6847"},{index:2,height:44,id:"2794"}]}},{id:"36a440a9-5b00-4d82-b13a-8e7819112918",type:"reply-node",x:1890,y:120,properties:{config:{fields:[{label:"内容",value:"answer"}]},height:386,showNode:!0,stepName:"指定回复",condition:"AND",node_data:{fields:["fd0324fc-f5e4-4fa6-a2d9-cb251b467605","directly_return"],content:"",is_result:!0,reply_type:"referencing"}}},{id:"f7c3b4a2-cb80-4e47-b050-7fef0315daaf",type:"ai-chat-node",x:1890,y:929.6914999999999,properties:{config:{fields:[{label:"AI 回答内容",value:"answer"},{label:"思考过程",value:"reasoning_content"}]},height:993.383,showNode:!0,stepName:"AI 对话",condition:"AND",node_data:{prompt:`已知信息：
{{知识库检索.data}}
问题：
{{开始.question}}`,system:"",model_id:"",is_result:!0,max_tokens:null,temperature:null,dialogue_type:"WORKFLOW",model_setting:{reasoning_content_end:"</think>",reasoning_content_start:"<think>",reasoning_content_enable:!1},dialogue_number:1}}},{id:"04dd6c1e-95f9-4757-bb3e-134d503fce54",type:"reply-node",x:1890,y:1798.383,properties:{config:{fields:[{label:"内容",value:"answer"}]},height:504,showNode:!0,stepName:"指定回复1",condition:"AND",node_data:{fields:[],content:"抱歉，没有在知识库查询到相关内容，请提供更详细的信息。",is_result:!0,reply_type:"content"}}}],edges:[{id:"73f8992c-65ef-409a-a151-378d0927f2aa",type:"app-edge",sourceNodeId:"start-node",targetNodeId:"fd0324fc-f5e4-4fa6-a2d9-cb251b467605",startPoint:{x:280,y:929.6914999999999},endPoint:{x:550,y:929.6914999999999},properties:{},pointsList:[{x:280,y:929.6914999999999},{x:390,y:929.6914999999999},{x:440,y:929.6914999999999},{x:550,y:929.6914999999999}],sourceAnchorId:"start-node_right",targetAnchorId:"fd0324fc-f5e4-4fa6-a2d9-cb251b467605_left"},{id:"6a8d23d9-5179-424e-80c2-f08d37cdb8d4",type:"app-edge",sourceNodeId:"fd0324fc-f5e4-4fa6-a2d9-cb251b467605",targetNodeId:"420a6e4f-44ff-4847-bb81-0923630846b5",startPoint:{x:870,y:929.6914999999999},endPoint:{x:1010,y:929.6914999999999},properties:{},pointsList:[{x:870,y:929.6914999999999},{x:980,y:929.6914999999999},{x:900,y:929.6914999999999},{x:1010,y:929.6914999999999}],sourceAnchorId:"fd0324fc-f5e4-4fa6-a2d9-cb251b467605_right",targetAnchorId:"420a6e4f-44ff-4847-bb81-0923630846b5_left"},{id:"56006748-d9fe-491b-a14b-04fd568cac08",type:"app-edge",sourceNodeId:"420a6e4f-44ff-4847-bb81-0923630846b5",targetNodeId:"36a440a9-5b00-4d82-b13a-8e7819112918",startPoint:{x:1590,y:793.3089999999999},endPoint:{x:1730,y:120},properties:{},pointsList:[{x:1590,y:793.3089999999999},{x:1700,y:793.3089999999999},{x:1620,y:120},{x:1730,y:120}],sourceAnchorId:"420a6e4f-44ff-4847-bb81-0923630846b5_7887_right",targetAnchorId:"36a440a9-5b00-4d82-b13a-8e7819112918_left"},{id:"9bc8721b-07aa-4730-9347-910ed64e26b9",type:"app-edge",sourceNodeId:"420a6e4f-44ff-4847-bb81-0923630846b5",targetNodeId:"f7c3b4a2-cb80-4e47-b050-7fef0315daaf",startPoint:{x:1590,y:922.6919999999999},endPoint:{x:1730,y:929.6914999999999},properties:{},pointsList:[{x:1590,y:922.6919999999999},{x:1700,y:922.6919999999999},{x:1620,y:929.6914999999999},{x:1730,y:929.6914999999999}],sourceAnchorId:"420a6e4f-44ff-4847-bb81-0923630846b5_6847_right",targetAnchorId:"f7c3b4a2-cb80-4e47-b050-7fef0315daaf_left"},{id:"c276a5b6-ec29-4ab9-b911-a0a929ff193f",type:"app-edge",sourceNodeId:"420a6e4f-44ff-4847-bb81-0923630846b5",targetNodeId:"04dd6c1e-95f9-4757-bb3e-134d503fce54",startPoint:{x:1590,y:1013.3834999999998},endPoint:{x:1730,y:1798.383},properties:{},pointsList:[{x:1590,y:1013.3834999999998},{x:1700,y:1013.3834999999998},{x:1620,y:1798.383},{x:1730,y:1798.383}],sourceAnchorId:"420a6e4f-44ff-4847-bb81-0923630846b5_2794_right",targetAnchorId:"04dd6c1e-95f9-4757-bb3e-134d503fce54_left"}]}},vo={class:"w-full"},bo={class:"flex-center p-24"},ho={class:"dialog-footer"},yo=ye({__name:"CreateApplicationDialog",emits:["refresh"],setup(Ie,{expose:H,emit:U}){const{user:E}=we(),w=Ce(),X=U,F=f("views.application.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),b=f("views.application.dialog.defaultPrompt1",{question:"{question}"})+"<data></data>"+f("views.application.dialog.defaultPrompt2"),g=m({edges:[],nodes:Me}),k=m("blank"),V=m(),C=m(!1),R=m(!1),l=m({name:"",desc:"",model_id:void 0,dialogue_number:1,prologue:f("views.application.form.defaultPrologue"),knowledge_id_list:[],knowledge_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:F,system:"",no_references_prompt:"{question}"},model_params_setting:{},problem_optimization:!1,problem_optimization_prompt:b,stt_model_id:void 0,tts_model_id:void 0,stt_model_enable:!1,tts_model_enable:!1,tts_type:"BROWSER",type:"SIMPLE"}),_=ke({name:[{required:!0,message:f("views.application.form.appName.placeholder"),trigger:"blur"}],model_id:[{required:!1,message:f("views.application.form.aiModel.placeholder"),trigger:"change"}]}),h=m("");Ve(R,c=>{var s;c||(l.value={name:"",desc:"",model_id:void 0,dialogue_number:1,prologue:f("views.application.form.defaultPrologue"),knowledge_id_list:[],knowledge_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:F,system:"",no_references_prompt:"{question}"},model_params_setting:{},problem_optimization:!1,problem_optimization_prompt:b,stt_model_id:void 0,tts_model_id:void 0,stt_model_enable:!1,tts_model_enable:!1,tts_type:"BROWSER",type:"SIMPLE"},(s=V.value)==null||s.clearValidate())});const G=(c,s)=>{h.value=c,l.value.type=s||"SIMPLE",R.value=!0},j=async c=>{c&&await c.validate(s=>{s&&(Q(l.value.type)&&(g.value.nodes[0].properties.node_data.desc=l.value.desc,g.value.nodes[0].properties.node_data.name=l.value.name,l.value.work_flow=g.value),C.value=!0,z.postApplication({...l.value,folder_id:h.value}).then(O=>E.profile().then(()=>O)).then(O=>{Ae(f("common.createSuccess")),X("refresh"),Q(l.value.type)?w.push({path:`/application/workspace/${O.data.id}/workflow`}):w.push({path:`/application/workspace/${O.data.id}/${O.data.type}/setting`}),R.value=!1}).finally(()=>{C.value=!1}))})};function K(c){k.value=c,g.value=go[c]}return H({open:G}),(c,s)=>{const O=i("el-input"),J=i("el-form-item"),ne=i("AppIcon"),ue=i("el-card"),ie=i("el-col"),se=i("LogoIcon"),_e=i("el-text"),me=i("CardBox"),fe=i("el-row"),ge=i("el-form"),ee=i("el-button"),ve=i("el-dialog");return u(),v(ve,{title:D(Q)(l.value.type)?c.$t("views.application.createWorkFlowApplication"):c.$t("views.application.createApplication"),modelValue:R.value,"onUpdate:modelValue":s[8]||(s[8]=$=>R.value=$),width:"650","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[p("span",ho,[o(ee,{onClick:s[6]||(s[6]=x($=>R.value=!1,["prevent"])),loading:C.value},{default:t(()=>[y(d(c.$t("common.cancel")),1)]),_:1},8,["loading"]),o(ee,{type:"primary",onClick:s[7]||(s[7]=$=>j(V.value)),loading:C.value},{default:t(()=>[y(d(c.$t("common.create")),1)]),_:1},8,["loading"])])]),default:t(()=>[o(ge,{ref_key:"applicationFormRef",ref:V,model:l.value,rules:_,"label-position":"top","require-asterisk-position":"right",onSubmit:s[5]||(s[5]=x(()=>{},["prevent"]))},{default:t(()=>[o(J,{label:c.$t("views.application.form.appName.label"),prop:"name"},{default:t(()=>[o(O,{modelValue:l.value.name,"onUpdate:modelValue":s[0]||(s[0]=$=>l.value.name=$),maxlength:"64",placeholder:c.$t("views.application.form.appName.placeholder"),"show-word-limit":"",onBlur:s[1]||(s[1]=$=>{var re;return l.value.name=(re=l.value.name)==null?void 0:re.trim()})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(J,{label:c.$t("common.desc")},{default:t(()=>[o(O,{modelValue:l.value.desc,"onUpdate:modelValue":s[2]||(s[2]=$=>l.value.desc=$),type:"textarea",placeholder:c.$t("views.application.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l.value.type==="WORK_FLOW"?(u(),v(J,{key:0,label:c.$t("views.document.upload.template")},{default:t(()=>[p("div",vo,[o(fe,{gutter:16},{default:t(()=>[o(ie,{span:12},{default:t(()=>[o(ue,{class:Se(["template-radio-card cursor text-center flex-center",k.value==="blank"?"active":""]),shadow:"never",onClick:s[3]||(s[3]=$=>K("blank"))},{default:t(()=>[p("div",bo,[o(ne,{iconName:"app-add-outlined",class:"mr-12"}),y(" "+d(c.$t("views.application.form.appTemplate.blankApp.title")),1)])]),_:1},8,["class"])]),_:1}),o(ie,{span:12},{default:t(()=>[o(me,{title:c.$t("views.application.form.appTemplate.assistantApp.title"),description:c.$t("views.application.form.appTemplate.assistantApp.description"),shadow:"never",class:Se(["template-radio-card cursor",k.value==="assistant"?"active":""]),onClick:s[4]||(s[4]=$=>K("assistant"))},{icon:t(()=>[o(se,{height:"32px"})]),subTitle:t(()=>[o(_e,{class:"color-secondary",size:"small"},{default:t(()=>[y(d(c.$t("views.application.workflow")),1)]),_:1})]),_:1},8,["title","description","class"])]),_:1})]),_:1})])]),_:1},8,["label"])):W("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),wo=Qe(yo,[["__scopeId","data-v-0185f945"]]),Co={class:"dialog-footer"},ko=ye({__name:"CopyApplicationDialog",setup(Ie,{expose:H}){const U=Ce(),{user:E}=we(),w=f("views.application.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),X=m(),F=m(!1),b=m(!1),g=m({name:"",desc:"",model_id:"",dialogue_number:0,prologue:f("views.application.form.defaultPrologue"),knowledge_id_list:[],knowledge_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:w},problem_optimization:!1,type:"SIMPLE"}),k=ke({name:[{required:!0,message:f("views.application.form.appName.placeholder"),trigger:"blur"}]}),V=m("");Ve(b,l=>{var _;l||(g.value={name:"",desc:"",model_id:"",dialogue_number:0,prologue:f("views.application.form.defaultPrologue"),knowledge_id_list:[],knowledge_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:w},problem_optimization:!1,type:"SIMPLE"},(_=X.value)==null||_.clearValidate())});const C=(l,_)=>{V.value=_;const h=eo.cloneDeep(l);delete h.id,h.name=h.name+` ${f("common.copyTitle")}`,g.value=h,b.value=!0},R=async l=>{l&&await l.validate(_=>{_&&z.postApplication({...g.value,folder_id:V.value},F).then(h=>E.profile().then(()=>h)).then(h=>{Ae(f("common.createSuccess")),Q(g.value.type)?U.push({path:`/application/workspace/${h.data.id}/workflow`}):U.push({path:`/application/workspace/${h.data.id}/${h.data.type}/setting`}),b.value=!1})})};return H({open:C}),(l,_)=>{const h=i("el-input"),G=i("el-form-item"),j=i("el-form"),K=i("el-button"),c=i("el-dialog");return u(),v(c,{title:l.$t("views.application.copyApplication"),modelValue:b.value,"onUpdate:modelValue":_[5]||(_[5]=s=>b.value=s),width:"650","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[p("span",Co,[o(K,{onClick:_[3]||(_[3]=x(s=>b.value=!1,["prevent"])),loading:F.value},{default:t(()=>[y(d(l.$t("common.cancel")),1)]),_:1},8,["loading"]),o(K,{type:"primary",onClick:_[4]||(_[4]=s=>R(X.value)),loading:F.value},{default:t(()=>[y(d(l.$t("common.copy")),1)]),_:1},8,["loading"])])]),default:t(()=>[o(j,{ref_key:"applicationFormRef",ref:X,model:g.value,rules:k,"label-position":"top","require-asterisk-position":"right",onSubmit:_[2]||(_[2]=x(()=>{},["prevent"]))},{default:t(()=>[o(G,{label:l.$t("views.application.form.appName.label"),prop:"name"},{default:t(()=>[o(h,{modelValue:g.value.name,"onUpdate:modelValue":_[0]||(_[0]=s=>g.value.name=s),maxlength:"64",placeholder:l.$t("views.application.form.appName.placeholder"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(G,{label:l.$t("common.desc")},{default:t(()=>[o(h,{modelValue:g.value.desc,"onUpdate:modelValue":_[1]||(_[1]=s=>g.value.desc=s),type:"textarea",placeholder:l.$t("views.application.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),Ao={class:"p-12-16 pb-0 mt-12"},Io={class:"p-8"},Po={class:"flex"},$o={class:"flex-between complex-search"},Ro={class:"flex"},No={class:"pre-wrap ml-8"},xo={class:"lighter"},Eo={class:"flex"},Lo={class:"pre-wrap ml-8"},So={class:"lighter"},Oo={class:"flex align-center w-full"},To={class:"pre-wrap ml-8"},Do={class:"lighter"},Wo={class:"flex align-center"},Fo={class:"pre-wrap ml-4"},Vo={class:"lighter"},Mo={style:{"max-height":"calc(100vh - 120px)"}},qo=["src"],zo={key:0,class:"flex align-center"},Uo={class:"color-secondary"},Bo={class:"color-secondary"},Ho={key:1,class:"flex align-center"},Xo={class:"color-secondary"},Jo=ye({__name:"index",setup(Ie){const H=Ce(),U=Oe(()=>"workspace"),E=Oe(()=>oo.application[U.value]),{folder:w,application:X,user:F}=we(),b=m(!1),g=m("name"),k=m({name:"",create_user:"",publish_status:void 0}),V=m([]),C=ke({current_page:1,page_size:30,total:0}),R=m([]),l=m([]),_=m(),h=m();function G(e){h.value.open(e.id)}const j=m();function K(e){var r;const a={id:e.id,folder_id:e.folder};(r=j.value)==null||r.open(a)}function c(e){const a=l.value.findIndex(r=>r.id===e.id);l.value.splice(a,1)}const s=e=>{H.push({path:O(e)})},O=e=>le([new M([q.USER],[P.APPLICATION.getApplicationWorkspaceResourcePermission(e.id)],[],"AND"),q.WORKSPACE_MANAGE.getWorkspaceRole,P.APPLICATION_OVERVIEW_READ.getWorkspacePermissionWorkspaceManageRole,P.APPLICATION_OVERVIEW_READ.getApplicationWorkspaceResourcePermission(e.id)],"OR")?`/application/workspace/${e.id}/${e.type}/overview`:le([new M([q.USER],[P.APPLICATION.getApplicationWorkspaceResourcePermission(e.id)],[],"AND"),q.WORKSPACE_MANAGE.getWorkspaceRole,P.APPLICATION_EDIT.getWorkspacePermissionWorkspaceManageRole,P.APPLICATION_EDIT.getApplicationWorkspaceResourcePermission(e.id)],"OR")?e.type=="WORK_FLOW"?`/application/workspace/${e.id}/workflow`:`/application/workspace/${e.id}/${e.type}/setting`:le([new M([q.USER],[P.APPLICATION.getApplicationWorkspaceResourcePermission(e.id)],[N.IS_EE,N.IS_PE],"AND"),new M([q.WORKSPACE_MANAGE.getWorkspaceRole],[P.APPLICATION_ACCESS_READ.getWorkspacePermissionWorkspaceManageRole],[N.IS_EE,N.IS_PE],"OR"),new M([],[P.APPLICATION_ACCESS_READ.getApplicationWorkspaceResourcePermission(e.id)],[N.IS_EE,N.IS_PE],"OR")],"OR")?`/application/workspace/${e.id}/${e.type}/access`:le([new M([q.USER],[P.APPLICATION.getApplicationWorkspaceResourcePermission(e.id)],[N.IS_EE,N.IS_PE],"AND"),new M([q.WORKSPACE_MANAGE.getWorkspaceRole],[P.APPLICATION_CHAT_USER_READ.getWorkspacePermissionWorkspaceManageRole],[N.IS_EE,N.IS_PE],"OR"),new M([],[P.APPLICATION_CHAT_USER_READ.getApplicationWorkspaceResourcePermission(e.id)],[N.IS_EE,N.IS_PE],"OR")],"OR")?`/application/workspace/${e.id}/${e.type}/chat-user`:le([new M([q.USER],[P.APPLICATION.getApplicationWorkspaceResourcePermission(e.id)],[],"AND"),P.APPLICATION_CHAT_LOG_READ.getWorkspacePermissionWorkspaceManageRole,P.APPLICATION_CHAT_LOG_READ.getApplicationWorkspaceResourcePermission(e.id)],"OR")?`/application//workspace${e.id}/${e.type}/chat-log`:"/application/",J=m();function ne(e){var a;J.value.open(((a=w.currentFolder)==null?void 0:a.id)||"default",e)}const ue=()=>{k.value={name:"",create_user:""}};function ie(e){(e.type=="WORK_FLOW"?r=>z.getApplicationDetail(r):r=>Promise.resolve({data:e}))(e.id).then(r=>{var Y,pe,de;let T=(de=(pe=(Y=r.data)==null?void 0:Y.work_flow)==null?void 0:pe.nodes)==null?void 0:de.filter(A=>A.id==="base-node").map(A=>A.properties.api_input_field_list?A.properties.api_input_field_list.map(I=>({name:I.variable,value:I.default_value})):A.properties.input_field_list?A.properties.input_field_list.filter(I=>I.assignment_method==="api_input").map(I=>({name:I.variable,value:I.default_value})):[]).reduce((A,I)=>[...A,...I]);T=T||[];const B=se(T)?"?"+se(T):"";z.getAccessToken(e.id,b).then(A=>{var I;window.open(X.location+((I=A==null?void 0:A.data)==null?void 0:I.access_token)+B)})})}function se(e){const a=new URLSearchParams;return e.forEach(r=>{a.append(encodeURIComponent(r.name),encodeURIComponent(r.value))}),a.toString()}function _e(e){z.getApplicationDetail(e.id,b).then(a=>{var r;a!=null&&a.data&&_.value.open({...a.data,model_id:a.data.model},((r=w.currentFolder)==null?void 0:r.id)||"default")})}function me(e){Q(e.type)?H.push({path:`/application/workspace/${e.id}/workflow`}):H.push({path:`/application/workspace/${e.id}/${e.type}/setting`})}function fe(e){Fe(`${f("views.application.delete.confirmTitle")}${e.name} ?`,f("views.application.delete.confirmMessage"),{confirmButtonText:f("common.confirm"),cancelButtonText:f("common.cancel"),confirmButtonClass:"danger"}).then(()=>{z.delApplication(e.id,b).then(()=>{const a=l.value.findIndex(r=>r.id===e.id);l.value.splice(a,1),Ae(f("common.deleteSuccess"))})}).catch(()=>{})}const ge=e=>{z.exportApplication(e.id,e.name,b).catch(a=>{a.response.status!==403&&a.response.data.text().then(r=>{co(`${f("views.application.tip.ExportError")}:${JSON.parse(r).message}`)})})},ee=m(),ve=e=>{const a=new FormData;a.append("file",e.raw,e.name),ee.value.clearFiles(),z.importApplication(w.currentFolder.id,a,b).then(async r=>{r!=null&&r.data&&(l.value=[],F.profile())}).then(()=>{oe()}).catch(r=>{r.code===400&&Fe(f("common.tip"),f("views.application.tip.professionalMessage"),{cancelButtonText:f("common.confirm"),confirmButtonText:f("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")})})},$=m();function re(){$.value.open(ae.APPLICATION,w.currentFolder.id)}function Pe(e){const a={};w.asyncGetFolder(ae.APPLICATION,a,b).then(r=>{var T;R.value=r.data,e&&w.setCurrentFolder(((T=r.data)==null?void 0:T[0])||{}),oe()})}function $e(e){var a;e.id!==((a=w.currentFolder)==null?void 0:a.id)&&(w.setCurrentFolder(e),C.current_page=1,l.value=[],oe())}function Re(){C.current_page=1,l.value=[],Pe()}function be(){C.current_page=1,l.value=[],oe()}function oe(){var a;const e={folder_id:((a=w.currentFolder)==null?void 0:a.id)||"default"};k.value[g.value]&&(e[g.value]=k.value[g.value]),z.getApplication(C,e,b).then(r=>{C.total=r.data.total,l.value=[...l.value,...r.data.records]})}return to(()=>{var e;Pe(!((e=w.currentFolder)!=null&&e.id)),ao.getAllMemberList(F.getWorkspaceId(),b).then(a=>{V.value=a.data})}),(e,a)=>{const r=i("folder-tree"),T=i("FolderBreadcrumb"),B=i("el-option"),Y=i("el-select"),pe=i("el-input"),de=i("arrow-down"),A=i("el-icon"),I=i("el-button"),ce=i("el-avatar"),he=i("el-text"),L=i("el-dropdown-item"),qe=i("el-upload"),S=i("AppIcon"),Ne=i("el-dropdown-menu"),xe=i("el-dropdown"),ze=i("auto-tooltip"),Ee=i("el-tag"),Ue=i("SuccessFilled"),Be=i("el-divider"),He=i("CardBox"),Xe=i("el-col"),Ke=i("el-row"),Ze=i("el-empty"),Ge=i("InfiniteScroll"),je=i("ContentContainer"),Je=i("LayoutContainer"),Ye=lo("loading");return u(),v(Je,{showCollapse:"",class:"application-manage"},{left:t(()=>{var n;return[p("h4",Ao,d(e.$t("views.application.title")),1),p("div",Io,[o(r,{source:D(ae).APPLICATION,data:R.value,currentNodeKey:(n=D(w).currentFolder)==null?void 0:n.id,onHandleNodeClick:$e,onRefreshTree:Re},null,8,["source","data","currentNodeKey"])])]}),default:t(()=>[o(je,null,{header:t(()=>[o(T,{folderList:R.value,onClick:$e},null,8,["folderList"])]),search:t(()=>[p("div",Po,[p("div",$o,[o(Y,{class:"complex-search__left",modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=n=>g.value=n),style:{width:"120px"},onChange:ue},{default:t(()=>[o(B,{label:e.$t("common.creator"),value:"create_user"},null,8,["label"]),o(B,{label:e.$t("common.name"),value:"name"},null,8,["label"]),o(B,{label:e.$t("common.publishStatus"),value:"publish_status"},null,8,["label"])]),_:1},8,["modelValue"]),g.value==="name"?(u(),v(pe,{key:0,modelValue:k.value.name,"onUpdate:modelValue":a[1]||(a[1]=n=>k.value.name=n),onChange:be,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):g.value==="create_user"?(u(),v(Y,{key:1,modelValue:k.value.create_user,"onUpdate:modelValue":a[2]||(a[2]=n=>k.value.create_user=n),onChange:be,filterable:"",clearable:"",style:{width:"220px"}},{default:t(()=>[(u(!0),te(Te,null,De(V.value,n=>(u(),v(B,{key:n.id,value:n.id,label:n.nick_name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):g.value==="publish_status"?(u(),v(Y,{key:2,modelValue:k.value.publish_status,"onUpdate:modelValue":a[3]||(a[3]=n=>k.value.publish_status=n),onChange:be,filterable:"",clearable:"",style:{width:"220px"}},{default:t(()=>[o(B,{label:e.$t("common.published"),value:"published"},null,8,["label"]),o(B,{label:e.$t("common.unpublished"),value:"unpublished"},null,8,["label"])]),_:1},8,["modelValue"])):W("",!0)]),E.value.create()?(u(),v(xe,{key:0,trigger:"click"},{dropdown:t(()=>[o(Ne,{class:"create-dropdown"},{default:t(()=>[o(L,{onClick:a[4]||(a[4]=n=>ne("SIMPLE"))},{default:t(()=>[p("div",Ro,[o(ce,{shape:"square",class:"avatar-blue mt-4",size:32},{default:t(()=>[...a[9]||(a[9]=[p("img",{src:mo,style:{width:"65%"},alt:""},null,-1)])]),_:1}),p("div",No,[p("div",xo,d(e.$t("views.application.simple")),1),o(he,{type:"info",size:"small"},{default:t(()=>[y(d(e.$t("views.application.simplePlaceholder")),1)]),_:1})])])]),_:1}),o(L,{onClick:a[5]||(a[5]=n=>ne("WORK_FLOW"))},{default:t(()=>[p("div",Eo,[o(ce,{shape:"square",class:"avatar-purple mt-4",size:32},{default:t(()=>[...a[10]||(a[10]=[p("img",{src:fo,style:{width:"65%"},alt:""},null,-1)])]),_:1}),p("div",Lo,[p("div",So,d(e.$t("views.application.workflow")),1),o(he,{type:"info",size:"small"},{default:t(()=>[y(d(e.$t("views.application.workflowPlaceholder")),1)]),_:1})])])]),_:1}),o(qe,{class:"import-button",ref_key:"elUploadRef",ref:ee,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(n,Le)=>ve(n)},{default:t(()=>[o(L,null,{default:t(()=>[p("div",Oo,[o(ce,{shape:"square",class:"mt-4",size:32,style:{background:"none"}},{default:t(()=>[...a[11]||(a[11]=[p("img",{src:uo,alt:""},null,-1)])]),_:1}),p("div",To,[p("div",Do,d(e.$t("common.importCreate")),1)])])]),_:1})]),_:1},8,["on-change"]),o(L,{onClick:re,divided:""},{default:t(()=>[p("div",Wo,[o(S,{iconName:"app-folder",style:{"font-size":"32px"}}),p("div",Fo,[p("div",Vo,d(e.$t("components.folder.addFolder")),1)])])]),_:1})]),_:1})]),default:t(()=>[o(I,{type:"primary",class:"ml-8"},{default:t(()=>[y(d(e.$t("common.create"))+" ",1),o(A,{class:"el-icon--right"},{default:t(()=>[o(de)]),_:1})]),_:1})]),_:1})):W("",!0)])]),default:t(()=>[no((u(),te("div",Mo,[o(Ge,{size:l.value.length,total:C.total,page_size:C.page_size,current_page:C.current_page,"onUpdate:current_page":a[8]||(a[8]=n=>C.current_page=n),onLoad:oe,loading:b.value},{default:t(()=>[l.value.length>0?(u(),v(Ke,{key:0,gutter:15,class:"w-full"},{default:t(()=>[(u(!0),te(Te,null,De(l.value,(n,Le)=>(u(),v(Xe,{key:Le,xs:24,sm:12,md:12,lg:8,xl:6,class:"mb-16"},{default:t(()=>[o(He,{title:n.name,description:n.desc,class:"cursor",onClick:Z=>s(n)},{icon:t(()=>[o(ce,{shape:"square",size:32,style:{background:"none"}},{default:t(()=>[p("img",{src:D(We)(n==null?void 0:n.icon,D(We)("./favicon.ico")),alt:""},null,8,qo)]),_:2},1024)]),subTitle:t(()=>[o(he,{class:"color-secondary lighter",size:"small"},{default:t(()=>[o(ze,{content:n.username},{default:t(()=>[y(d(e.$t("common.creator"))+": "+d(D(so)(n.nick_name)),1)]),_:2},1032,["content"])]),_:2},1024)]),tag:t(()=>[D(Q)(n.type)?(u(),v(Ee,{key:0,class:"warning-tag"},{default:t(()=>[y(d(e.$t("views.application.workflow")),1)]),_:1})):(u(),v(Ee,{key:1,class:"blue-tag"},{default:t(()=>[y(d(e.$t("views.application.simple")),1)]),_:1}))]),footer:t(()=>[n.is_publish?(u(),te("div",zo,[o(A,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:t(()=>[o(Ue)]),_:1}),p("span",Uo,d(e.$t("views.application.status.published")),1),o(Be,{direction:"vertical"}),o(S,{iconName:"app-clock",class:"color-secondary mr-8"}),p("span",Bo,d(D(io)(n.update_time)),1)])):(u(),te("div",Ho,[o(S,{iconName:"app-disabled",class:"color-secondary mr-8"}),p("span",Xo,d(e.$t("views.application.status.unpublished")),1)]))]),mouseEnter:t(()=>[p("div",{onClick:a[7]||(a[7]=x(()=>{},["stop"]))},[o(xe,{trigger:"click"},{dropdown:t(()=>[o(Ne,null,{default:t(()=>[o(L,{onClick:x(Z=>ie(n),["stop"])},{default:t(()=>[o(S,{iconName:"app-create-chat",class:"color-secondary"}),y(" "+d(e.$t("views.application.operation.toChat")),1)]),_:1},8,["onClick"]),E.value.edit(n.id)?(u(),v(L,{key:0,onClick:x(Z=>me(n),["stop"])},{default:t(()=>[o(S,{iconName:"app-setting",class:"color-secondary"}),y(" "+d(e.$t("common.setting")),1)]),_:1},8,["onClick"])):W("",!0),E.value.auth(n.id)?(u(),v(L,{key:1,onClick:x(Z=>G(n),["stop"])},{default:t(()=>[o(S,{iconName:"app-resource-authorization",class:"color-secondary"}),y(" "+d(e.$t("views.system.resourceAuthorization.title")),1)]),_:1},8,["onClick"])):W("",!0),E.value.edit(n.id)&&U.value==="workspace"?(u(),v(L,{key:2,onClick:x(Z=>K(n),["stop"])},{default:t(()=>[o(S,{iconName:"app-migrate",class:"color-secondary"}),y(" "+d(e.$t("common.moveTo")),1)]),_:1},8,["onClick"])):W("",!0),E.value.create()?(u(),v(L,{key:3,onClick:Z=>_e(n)},{default:t(()=>[o(S,{iconName:"app-copy",class:"color-secondary"}),y(" "+d(e.$t("common.copy")),1)]),_:1},8,["onClick"])):W("",!0),E.value.export(n.id)?(u(),v(L,{key:4,divided:"",onClick:x(Z=>ge(n),["stop"])},{default:t(()=>[o(S,{iconName:"app-export",class:"color-secondary"}),y(" "+d(e.$t("common.export")),1)]),_:1},8,["onClick"])):W("",!0),E.value.delete(n.id)?(u(),v(L,{key:5,divided:"",onClick:x(Z=>fe(n),["stop"])},{default:t(()=>[o(S,{iconName:"app-delete",class:"color-secondary"}),y(" "+d(e.$t("common.delete")),1)]),_:1},8,["onClick"])):W("",!0)]),_:2},1024)]),default:t(()=>[o(I,{text:"",onClick:a[6]||(a[6]=x(()=>{},["stop"]))},{default:t(()=>[o(S,{iconName:"app-more"})]),_:1})]),_:2},1024)])]),_:2},1032,["title","description","onClick"])]),_:2},1024))),128))]),_:1})):(u(),v(Ze,{key:1,description:e.$t("common.noData")},null,8,["description"]))]),_:1},8,["size","total","page_size","current_page","loading"])])),[[Ye,C.current_page===1&&b.value,void 0,{fullscreen:!0,lock:!0}]])]),_:1}),o(wo,{ref_key:"CreateApplicationDialogRef",ref:J},null,512),o(ko,{ref_key:"CopyApplicationDialogRef",ref:_},null,512),o(ro,{ref_key:"CreateFolderDialogRef",ref:$,onRefresh:Re},null,512),U.value==="workspace"?(u(),v(_o,{key:0,ref_key:"MoveToDialogRef",ref:j,source:D(ae).APPLICATION,onRefresh:c},null,8,["source"])):W("",!0),o(po,{type:D(ae).APPLICATION,ref_key:"ResourceAuthorizationDrawerRef",ref:h},null,8,["type"])]),_:1})}}});export{Jo as default};
