import{l as je,_ as Fe}from"./vue-draggable-plus-LBFQtMpC.js";import{ay as he,b8 as _e,b7 as O,aB as u,be as ye,aD as d,aE as m,aF as r,bb as z,aG as l,aH as t,cS as He,aI as b,aK as k,aJ as p,bc as j,b9 as Pe,bs as Se,bt as me,cf as Te,bm as _,bf as U,bn as R,cg as Qe,c6 as Ve,aC as T,bo as fe,ce as Me,bd as Je,br as Oe,bg as ge,bh as Ce,bi as We}from"./chat-CUfIjAsy.js";import{_ as Re}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-BaZJjs1f.js";import{_ as Ie}from"./index.vue_vue_type_script_setup_true_lang-CvygeC7o.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-Cy_JfFls.js";import"./AIModeParamSettingDialog.vue_vue_type_script_setup_true_lang-cRJioUrS.js";const Xe={class:"dialog-footer"},xe=he({__name:"SelectDocumentDialog",props:{apiType:{}},emits:["refresh"],setup(f,{expose:ne,emit:D}){const A=f,w=_e(),{params:{id:K,documentId:V},query:{from:L,isShared:x}}=w,$=O(()=>x==="true"),F=D,v=u(),H=u({}),C=u(!1),N=u(!1),n=u([]);ye(C,g=>{var h;g||(n.value=[],(h=v.value)==null||h.clearValidate())});const Y=g=>{W(),n.value=g,C.value=!0},G=async()=>{var g;if(await((g=v.value)==null?void 0:g.validate())){const h={id_list:n.value};j({type:"paragraph",systemType:A.apiType}).putMigrateMulParagraph(K,V,v.value.form.knowledge_id,v.value.form.document_id,h,N).then(()=>{F("refresh"),C.value=!1})}};function W(){j({type:"knowledge",systemType:A.apiType,isShared:$.value}).getKnowledgeDetail(K,N).then(g=>{H.value=g.data})}function Q(g){localStorage.setItem(K+"chat_dataset_id",g)}function X(g){localStorage.setItem(K+"chat_document_id",g)}return ne({open:Y,dialogVisible:C}),(g,h)=>{const P=d("el-button"),c=d("el-dialog");return r(),m(c,{title:`${g.$t("views.chatLog.selectKnowledge")}/${g.$t("common.fileUpload.document")}`,modelValue:C.value,"onUpdate:modelValue":h[1]||(h[1]=Z=>C.value=Z),width:"500","close-on-click-modal":!1,"close-on-press-escape":!1,onClick:h[2]||(h[2]=z(()=>{},["stop"]))},{footer:l(()=>[b("span",Xe,[t(P,{onClick:h[0]||(h[0]=z(Z=>C.value=!1,["prevent"]))},{default:l(()=>[k(p(g.$t("common.cancel")),1)]),_:1}),t(P,{type:"primary",onClick:G,loading:N.value},{default:l(()=>[k(p(g.$t("views.document.setting.migration")),1)]),_:1},8,["loading"])])]),default:l(()=>[t(He,{ref_key:"SelectKnowledgeDocumentRef",ref:v,apiType:f.apiType,onChangeKnowledge:Q,onChangeDocument:X,isApplication:!0,"workspace-id":H.value.workspace_id},null,8,["apiType","workspace-id"])]),_:1},8,["title","modelValue"])}}}),Ye={key:0,class:"mk-sticky"},Ze={class:"mr-8"},ea={class:"mr-8"},aa={class:"w-full flex-between",style:{"line-height":"22px"}},ta={class:"flex align-center"},la={class:"mb-16"},oa=he({__name:"ParagraphCard",props:{data:{},disabled:{type:Boolean},showMoveUp:{type:Boolean},showMoveDown:{type:Boolean}},emits:["dialogVisibleChange","clickCard","changeState","deleteParagraph","refresh","refreshMigrateParagraph","move"],setup(f,{emit:ne}){const D=f,A=_e(),{params:{id:w,documentId:K},query:{from:V,isShared:L}}=A;O(()=>L==="true");const x=O(()=>V),$=O(()=>Pe.knowledge[x.value]),F=o=>$.value.doc_generate(o)||$.value.doc_edit(o),v=ne,H=u(!1),C=u(!1),N=u(!1),n=u(!1);function Y(){N.value=!0,n.value=!1}function G(){N.value=n.value}async function W(o){const i={is_active:!o.is_active};await j({type:"paragraph",systemType:x.value}).putParagraph(w,K,o.id,i,C).then(()=>(v("changeState",o.id),!0)).catch(()=>!1)}const Q=u();function X(o){Q.value&&Q.value.open([o.id],"paragraph",o.id)}function g(o){Ve(`${T("views.paragraph.delete.confirmTitle")} ${o.title||"-"} ?`,T("views.paragraph.delete.confirmMessage"),{confirmButtonText:T("common.confirm"),confirmButtonClass:"danger"}).then(()=>{j({type:"paragraph",systemType:x.value}).delParagraph(w,K,o.id,H).then(()=>{v("deleteParagraph",o.id),fe(T("common.deleteSuccess"))})}).catch(()=>{})}const h=u(),P=u("");function c(o){D.disabled||(P.value=T("views.paragraph.editParagraph"),h.value.open(o,"edit"))}const Z=$.value.doc_edit(w);function M(o){!Z||ie.value||(D.disabled?v("clickCard"):(P.value=T("views.paragraph.paragraphDetail"),h.value.open(o)))}function pe(o){P.value=T("views.paragraph.addParagraph"),h.value.open(o,"add")}const se=u();function de(o){se.value.open([o.id])}function ue(o){v("refresh",o)}function ve(){v("refreshMigrateParagraph",D.data)}const ie=O(()=>{var o,i,ee;return((o=h.value)==null?void 0:o.dialogVisible)||((i=se.value)==null?void 0:i.dialogVisible)||((ee=Q.value)==null?void 0:ee.dialogVisible)});return ye(ie,o=>{v("dialogVisibleChange",o)}),(o,i)=>{const ee=d("el-switch"),ae=d("el-divider"),B=d("AppIcon"),te=d("el-button"),ce=d("el-tooltip"),q=d("el-dropdown-item"),e=d("ArrowRight"),a=d("el-icon"),y=d("el-dropdown-menu"),E=d("el-dropdown"),le=d("el-card"),I=d("MdPreview"),oe=Se("loading");return me((r(),m(le,{shadow:"hover",class:Te(["paragraph-box cursor",f.data.is_active?"":"disabled"]),onMouseenter:i[10]||(i[10]=S=>Y()),onMouseleave:i[11]||(i[11]=S=>G()),onClick:i[12]||(i[12]=z(S=>M(f.data),["stop"]))},{default:l(()=>[f.disabled?_("",!0):me((r(),U("div",Ye,[F(R(w))?(r(),m(le,{key:0,class:"paragraph-box-operation mt-8 mr-8",shadow:"always",style:{"--el-card-padding":"8px 12px","--el-card-border-radius":"8px"},onClick:i[8]||(i[8]=z(()=>{},["stop"]))},{default:l(()=>[$.value.doc_edit(R(w))?(r(),m(ee,{key:0,loading:C.value,modelValue:f.data.is_active,"onUpdate:modelValue":i[0]||(i[0]=S=>f.data.is_active=S),"before-change":()=>W(f.data),size:"small"},null,8,["loading","modelValue","before-change"])):_("",!0),t(ae,{direction:"vertical"}),b("span",Ze,[$.value.doc_edit(R(w))?(r(),m(ce,{key:0,effect:"dark",content:o.$t("views.paragraph.editParagraph"),placement:"top"},{default:l(()=>[t(te,{text:"",onClick:i[1]||(i[1]=z(S=>c(f.data),["stop"]))},{default:l(()=>[t(B,{iconName:"app-edit",size:16,class:"color-secondary"})]),_:1})]),_:1},8,["content"])):_("",!0)]),b("span",ea,[$.value.doc_edit(R(w))?(r(),m(ce,{key:0,effect:"dark",content:o.$t("views.paragraph.prevAddParagraph"),placement:"top"},{default:l(()=>[$.value.doc_edit(R(w))?(r(),m(te,{key:0,text:"",onClick:i[2]||(i[2]=z(S=>pe(f.data),["stop"]))},{default:l(()=>[t(B,{iconName:"app-add-circle-outlined",class:"color-secondary",size:16})]),_:1})):_("",!0)]),_:1},8,["content"])):_("",!0)]),F(R(w))?(r(),m(E,{key:1,trigger:"click",teleported:!1},{dropdown:l(()=>[t(y,{style:{"min-width":"140px"}},{default:l(()=>[$.value.doc_generate(R(w))?(r(),m(q,{key:0,onClick:i[3]||(i[3]=z(S=>X(f.data),["stop"]))},{default:l(()=>[t(B,{iconName:"app-generate-question",class:"color-secondary"}),k(" "+p(o.$t("views.document.generateQuestion.title")),1)]),_:1})):_("",!0),$.value.doc_edit(R(w))?(r(),m(q,{key:1,onClick:i[4]||(i[4]=z(S=>de(f.data),["stop"]))},{default:l(()=>[t(B,{iconName:"app-migrate",class:"color-secondary"}),k(" "+p(o.$t("views.document.setting.migration")),1)]),_:1})):_("",!0),$.value.doc_edit(R(w))?(r(),m(q,{key:2},{default:l(()=>[t(E,{class:"w-full",trigger:"hover","show-arrow":!1,placement:"right-start","popper-class":"move-position-popper"},{dropdown:l(()=>[t(y,null,{default:l(()=>[t(q,{disabled:!D.showMoveUp,onClick:i[5]||(i[5]=z(S=>v("move","up"),["stop"]))},{default:l(()=>[k(p(o.$t("views.document.movePosition.moveUp")),1)]),_:1},8,["disabled"]),t(q,{disabled:!D.showMoveDown,onClick:i[6]||(i[6]=z(S=>v("move","down"),["stop"]))},{default:l(()=>[k(p(o.$t("views.document.movePosition.moveDown")),1)]),_:1},8,["disabled"])]),_:1})]),default:l(()=>[b("div",aa,[b("div",ta,[t(B,{iconName:"app-drag-outlined",class:"color-secondary"}),k(" "+p(o.$t("views.document.movePosition.title")),1)]),t(a,{class:"color-input-placeholder",size:16,style:{"margin-right":"0"}},{default:l(()=>[t(e)]),_:1})])]),_:1})]),_:1})):_("",!0),$.value.doc_edit(R(w))?(r(),m(q,{key:3,onClick:i[7]||(i[7]=z(S=>g(f.data),["stop"]))},{default:l(()=>[t(B,{iconName:"app-delete",class:"color-secondary"}),k(" "+p(o.$t("common.delete")),1)]),_:1})):_("",!0)]),_:1})]),default:l(()=>[t(te,{text:""},{default:l(()=>[t(B,{iconName:"app-more",class:"color-secondary"})]),_:1})]),_:1})):_("",!0)]),_:1})):_("",!0)],512)),[[Qe,N.value]]),b("h2",la,p(f.data.title||"-"),1),t(I,{ref:"editorRef",editorId:"preview-only",modelValue:f.data.content,class:"maxkb-md",style:{background:"none"},onClickPreview:i[9]||(i[9]=S=>M(f.data))},null,8,["modelValue"]),t(Re,{ref_key:"ParagraphDialogRef",ref:h,title:P.value,onRefresh:ue,apiType:x.value},null,8,["title","apiType"]),t(xe,{ref_key:"SelectDocumentDialogRef",ref:se,onRefresh:ve,apiType:x.value},null,8,["apiType"]),t(Ie,{ref_key:"GenerateRelatedDialogRef",ref:Q,onRefresh:ue,apiType:x.value},null,8,["apiType"])]),_:1},8,["class"])),[[oe,H.value]])}}}),De=Me(oa,[["__scopeId","data-v-82261161"]]),na={class:"paragraph p-12-24"},sa={class:"flex align-center",style:{width:"78%"}},ia={style:{display:"inline-block"}},ra={class:"break-all"},da={key:0,class:"header-button"},ua={class:"flex-between p-12-16 border-b"},ca={class:"paragraph-sidebar p-16"},pa=["title"],va={class:"w-full"},ga={key:1},ma={class:"paragraph-detail"},fa=["id"],ha={key:0,class:"paragraph-card flex w-full"},_a=["id"],ya={key:0,class:"mul-operation border-t w-full flex align-center"},wa={class:"color-secondary ml-24 mr-16"},ba=he({__name:"index",setup(f){const ne=_e(),{params:{id:D,documentId:A},query:{from:w,isShared:K}}=ne,V=O(()=>w),L=O(()=>K==="true"),x=O(()=>Pe.knowledge[V.value]),$=u(),F=u(),v=u(!1),H=u(!1),C=u({}),N=u({}),n=u([]),Y=u(""),G=u(""),W=u("title"),Q=()=>{G.value=""},X=u(!1);ye(()=>{var e;return(e=F.value)==null?void 0:e.dialogVisible},e=>{X.value=e});function g(e){X.value=e}const h=(e,a)=>{var y;e.preventDefault(),(y=document.querySelector(`${a}`))==null||y.scrollIntoView({behavior:"smooth",block:"start"})},P=u(!1),c=u([]);function Z(e){const a=c.value.indexOf(e);a===-1?c.value.push(e):c.value.splice(a,1)}const M=Je({current_page:1,page_size:30,total:0});function pe(e){const a=n.value.findIndex(y=>y.id===e);n.value.splice(a,1)}function se(e){const a=n.value.findIndex(y=>y.id===e);n.value[a].is_active=!n.value[a].is_active}function de(e){e&&(c.value=[e.id]),n.value=n.value.filter(a=>!c.value.includes(a.id)),c.value=[],fe(T("views.document.tip.migrationSuccess"))}function ue(e){$.value.open(c.value)}function ve(){Ve(`${T("views.document.delete.confirmTitle1")} ${c.value.length} ${T("views.document.delete.confirmTitle2")}`,T("views.paragraph.delete.confirmMessage"),{confirmButtonText:T("common.confirm"),confirmButtonClass:"danger"}).then(()=>{j({type:"paragraph",systemType:V.value}).putMulParagraph(D,A,c.value,H).then(()=>{n.value=n.value.filter(e=>!c.value.includes(e.id)),c.value=[],fe(T("views.document.delete.successMessage"))})}).catch(()=>{})}function ie(e){P.value=e,c.value=[]}function o(){M.current_page=1,n.value=[],ae()}function i(){Y.value=T("views.paragraph.addParagraph"),F.value.open()}function ee(){j({type:"document",isShared:L.value,systemType:V.value}).getDocumentDetail(D,A,v).then(e=>{C.value=e.data}),j({type:"knowledge",isShared:L.value,systemType:V.value}).getKnowledgeDetail(D,v).then(e=>{N.value=e.data})}function ae(){j({type:"paragraph",isShared:L.value,systemType:V.value}).getParagraphPage(D,A,M,G.value&&{[W.value]:G.value},v).then(e=>{n.value=[...n.value,...e.data.records],M.total=e.data.total})}function B(e){if(e){const a=n.value.findIndex(y=>y.id===e.id);n.value.splice(a,1,e)}else M.current_page=1,n.value=[],ae()}const te=u();function ce(e){const a=[];c.value.map(y=>{y&&a.push(y)}),te.value.open(a,"paragraph")}function q(e,a,y){var I;const E=We.cloneDeep(a);E&&(E.new_position=E.new_position+1);const le=E??{paragraph_id:n.value[e.newIndex].id,new_position:((I=n.value[e.newIndex+1])==null?void 0:I.position)||n.value.length};if(j({type:"paragraph",systemType:V.value}).putAdjustPosition(D,A,le,v),a){const oe=n.value.splice(y,1)[0];n.value.splice(a.new_position,0,oe)}}return Oe(()=>{ee(),ae()}),(e,a)=>{var be,ke;const y=d("back-button"),E=d("el-link"),le=d("el-text"),I=d("el-button"),oe=d("el-option"),S=d("el-select"),Be=d("el-input"),Ue=d("el-anchor-link"),ze=d("el-anchor"),we=d("el-scrollbar"),Ne=d("el-empty"),Ae=d("el-checkbox"),Ke=d("InfiniteScroll"),Le=d("el-checkbox-group"),Ge=d("LayoutContainer"),qe=d("el-card"),Ee=Se("loading");return r(),U("div",na,[b("div",sa,[t(y,{to:"-1",style:{"margin-left":"-4px"}}),b("h3",ia,p((be=C.value)==null?void 0:be.name),1),((ke=C.value)==null?void 0:ke.type)==="1"?(r(),m(le,{key:0,type:"info"},{default:l(()=>{var s,J;return[k("（"+p(e.$t("views.document.form.source_url.label"))+"：",1),t(E,{href:(J=(s=C.value)==null?void 0:s.meta)==null?void 0:J.source_url,target:"_blank"},{default:l(()=>{var re,$e;return[b("span",ra,p(($e=(re=C.value)==null?void 0:re.meta)==null?void 0:$e.source_url),1)]}),_:1},8,["href"]),a[10]||(a[10]=k("） ",-1))]}),_:1})):_("",!0)]),!L.value&&x.value.doc_edit(R(D))?(r(),U("div",da,[P.value===!1?(r(),m(I,{key:0,onClick:a[0]||(a[0]=s=>ie(!0))},{default:l(()=>[k(p(e.$t("views.paragraph.setting.batchSelected")),1)]),_:1})):_("",!0),P.value===!0?(r(),m(I,{key:1,onClick:a[1]||(a[1]=s=>ie(!1))},{default:l(()=>[k(p(e.$t("views.paragraph.setting.cancelSelected")),1)]),_:1})):_("",!0),P.value===!1?(r(),m(I,{key:2,onClick:i,type:"primary",disabled:v.value},{default:l(()=>[k(p(e.$t("views.paragraph.addParagraph")),1)]),_:1},8,["disabled"])):_("",!0)])):_("",!0),me((r(),m(qe,{style:{"--el-card-padding":"0"},class:"paragraph__main mt-16"},{default:l(()=>[b("div",ua,[b("span",null,p(M.total)+" "+p(e.$t("views.paragraph.paragraph_count")),1),t(Be,{modelValue:G.value,"onUpdate:modelValue":a[3]||(a[3]=s=>G.value=s),placeholder:e.$t("common.search"),class:"input-with-select",style:{width:"260px"},onChange:o,clearable:""},{prepend:l(()=>[t(S,{modelValue:W.value,"onUpdate:modelValue":a[2]||(a[2]=s=>W.value=s),placeholder:"Select",style:{width:"80px"},onChange:Q},{default:l(()=>[t(oe,{label:e.$t("common.title"),value:"title"},null,8,["label"]),t(oe,{label:e.$t("common.content"),value:"content"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),t(Ge,{showCollapse:""},{left:l(()=>[b("div",ca,[t(we,{class:"paragraph-scrollbar"},{default:l(()=>[t(ze,{direction:"vertical",type:"default",offset:130,container:".paragraph-scrollbar",onClick:h},{default:l(()=>[(r(!0),U(ge,null,Ce(n.value,s=>(r(),U(ge,{key:s.id},[s.title?(r(),m(Ue,{key:0,href:`#m${s.id}`,title:s.title},{default:l(()=>[b("span",{title:s.title},p(s.title),9,pa)]),_:2},1032,["href","title"])):_("",!0)],64))),128))]),_:1})]),_:1})])]),default:l(()=>[b("div",va,[n.value.length==0?(r(),m(Ne,{key:0,description:e.$t("common.noData")},null,8,["description"])):(r(),U("div",ga,[t(we,{class:"paragraph-scrollbar"},{default:l(()=>[b("div",ma,[t(Le,{modelValue:c.value,"onUpdate:modelValue":a[6]||(a[6]=s=>c.value=s)},{default:l(()=>[t(Ke,{size:n.value.length,total:M.total,page_size:M.page_size,current_page:M.current_page,"onUpdate:current_page":a[5]||(a[5]=s=>M.current_page=s),onLoad:ae,loading:v.value},{default:l(()=>[t(R(je),{ref:"el",modelValue:n.value,"onUpdate:modelValue":a[4]||(a[4]=s=>n.value=s),disabled:P.value===!0||L.value||X.value||!x.value.doc_edit(R(D)),handle:".handle",animation:150,ghostClass:"ghost",onEnd:q},{default:l(()=>[(r(!0),U(ge,null,Ce(n.value,(s,J)=>(r(),U("div",{key:s.id,id:`m${s.id}`,class:"flex mb-16"},[P.value===!0?(r(),U("div",ha,[t(Ae,{value:s.id},null,8,["value"]),t(De,{data:s,class:Te(["mb-8 w-full",{"is-selected":c.value.includes(s.id)}]),disabled:!0,onClickCard:re=>Z(s.id)},null,8,["data","class","onClickCard"])])):(r(),U("div",{key:1,class:"handle paragraph-card flex w-full",id:s.id},[a[11]||(a[11]=b("img",{src:Fe,alt:"",height:"15",class:"handle-img mr-8 mt-24 cursor"},null,-1)),t(De,{data:s,showMoveUp:J!==0,showMoveDown:J<n.value.length-1,class:"mb-8 w-full",onChangeState:se,onDeleteParagraph:pe,onMove:re=>q(null,{paragraph_id:s.id,new_position:re==="up"?J-1:J+1},J),onRefresh:B,onRefreshMigrateParagraph:de,disabled:L.value,onDialogVisibleChange:g},null,8,["data","showMoveUp","showMoveDown","onMove","disabled"])],8,_a))],8,fa))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["size","total","page_size","current_page","loading"])]),_:1},8,["modelValue"])])]),_:1})]))])]),_:1}),P.value===!0?(r(),U("div",ya,[t(I,{disabled:c.value.length===0,onClick:a[7]||(a[7]=s=>ce())},{default:l(()=>[k(p(e.$t("views.document.generateQuestion.title")),1)]),_:1},8,["disabled"]),t(I,{disabled:c.value.length===0,onClick:a[8]||(a[8]=s=>ue())},{default:l(()=>[k(p(e.$t("views.document.setting.migration")),1)]),_:1},8,["disabled"]),t(I,{disabled:c.value.length===0,onClick:ve},{default:l(()=>[k(p(e.$t("common.delete")),1)]),_:1},8,["disabled"]),b("span",wa,p(e.$t("common.selected"))+" "+p(c.value.length)+" "+p(e.$t("views.document.items")),1),c.value.length>0?(r(),m(I,{key:0,link:"",type:"primary",onClick:a[9]||(a[9]=s=>c.value=[])},{default:l(()=>[k(p(e.$t("common.clear")),1)]),_:1})):_("",!0)])):_("",!0)]),_:1})),[[Ee,M.current_page===1&&v.value||H.value]]),t(Re,{ref_key:"ParagraphDialogRef",ref:F,title:Y.value,apiType:V.value,onRefresh:B},null,8,["title","apiType"]),t(xe,{ref_key:"SelectDocumentDialogRef",ref:$,onRefresh:de,apiType:V.value,workspaceId:N.value.workspace_id},null,8,["apiType","workspaceId"]),t(Ie,{ref_key:"GenerateRelatedDialogRef",ref:te,onRefresh:B,apiType:V.value},null,8,["apiType"])])}}}),Ta=Me(ba,[["__scopeId","data-v-991164e3"]]);export{Ta as default};
