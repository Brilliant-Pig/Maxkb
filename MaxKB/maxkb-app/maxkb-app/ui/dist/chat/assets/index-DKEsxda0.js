const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dingtalkQrCode-BZOpUj4v.js","./logo_dingtalk-CyDPr22R.js","./chat-CUfIjAsy.js","./chat-D6EHGZHg.css","./dingtalkQrCode-CulsC8mV.css","./larkQrCode-CysP777h.js","./logo_lark-DULIW3z6.js","./wecomQrCode-DPyoqmWv.js","./wecom.prod-BQnzBeVx.js","./wecomQrCode-De2SNR1F.css"])))=>i.map(i=>d[i]);
import{ay as ee,aB as d,aA as j,az as ue,b8 as Y,aD as w,aE as v,aF as n,bb as ge,aG as m,aH as y,aK as de,aJ as E,aC as L,br as pe,bS as he,db as ye,ce as me,bf as k,aI as i,cH as we,bh as _e,bm as D,cs as be,ct as ke,bg as Z,cu as G,cv as Ce,b7 as Le,bV as W,bs as xe,bt as Ae,bn as C,d0 as ce,cw as De,by as Oe,dc as ie,c6 as $e,cy as qe,c7 as Ie}from"./chat-CUfIjAsy.js";import{_ as Ve,a as Re,f as X,d as Pe}from"./index-Cs-4hlXP.js";const Se=ee({__name:"password",setup(V){const g=d(),{chatUser:R}=j(),t=d(!1),T=ue(),M=Y(),P=()=>R.passwordAuthentication(f.value.password).then($=>{T.push({name:"chat",params:{accessToken:R.accessToken},query:M.query})}),O=($,x,a)=>{x===""?a(new Error(L("chat.passwordValidator.errorMessage1"))):P().catch(()=>{a(new Error(L("chat.passwordValidator.errorMessage2")))})},S=()=>{g.value.validate()},p={password:[{required:!0,validator:O,trigger:"manual"}]},f=d({password:""});return($,x)=>{const a=w("el-input"),K=w("el-form-item"),H=w("el-button"),B=w("el-form");return n(),v(B,{ref_key:"FormRef",ref:g,model:f.value,onSubmit:ge(S,["prevent"])},{default:m(()=>[y(K,{prop:"value",rules:p.password},{default:m(()=>[y(a,{"show-password":"",modelValue:f.value.password,"onUpdate:modelValue":x[0]||(x[0]=Q=>f.value.password=Q)},null,8,["modelValue"])]),_:1},8,["rules"]),y(H,{class:"w-full mt-8",type:"primary",onClick:S,loading:t.value},{default:m(()=>[de(E($.$t("common.confirm")),1)]),_:1},8,["loading"])]),_:1},8,["model"])}}}),Ee=768,Te=()=>{const{common:V}=j(),g=()=>{var t;return((t=document.body)==null?void 0:t.getBoundingClientRect()).width-1<Ee};pe(()=>{he(()=>{g()&&V.toggleDevice(ye.Mobile)})})},Me={},Ue={class:"login-warp flex-center"},Qe={class:"login-container w-full h-full"},Fe={class:"flex-center w-full h-full"};function Be(V,g){return n(),k("div",Ue,[i("div",Qe,[i("div",Fe,[we(V.$slots,"default",{},void 0,!0)])])])}const ze=me(Me,[["render",Be],["__scopeId","data-v-e5a94abc"]]),je={key:0,class:"text-center"},Ke=ee({__name:"QrCodeTab",props:{tabs:{}},setup(V){const{chatUser:g}=j(),R=V,t=d(""),T=d([]),M=d({app_key:"",app_secret:""});async function P(){try{return await g.getQrSource()}catch{return[]}}pe(async()=>{R.tabs.length>0&&(t.value=R.tabs[0].key),T.value=await P(),O(t.value)});const O=p=>{const f=T.value.find($=>$.auth_type===p);f&&f.config&&(M.value=f.config)},S=p=>{t.value=p,O(p)};return(p,f)=>{const $=w("el-tab-pane"),x=w("el-tabs");return n(),v(x,{modelValue:t.value,"onUpdate:modelValue":f[0]||(f[0]=a=>t.value=a),onTabChange:S},{default:m(()=>[(n(!0),k(Z,null,_e(V.tabs,a=>(n(),v($,{key:a.key,label:a.value,name:a.key},{default:m(()=>[a.key===t.value?(n(),k("div",je,[(n(),v(be(ke(()=>Ve(Object.assign({"./dingtalkQrCode.vue":()=>G(()=>import("./dingtalkQrCode-BZOpUj4v.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),"./larkQrCode.vue":()=>G(()=>import("./larkQrCode-CysP777h.js"),__vite__mapDeps([5,6,2,3]),import.meta.url),"./wecomQrCode.vue":()=>G(()=>import("./wecomQrCode-DPyoqmWv.js"),__vite__mapDeps([7,2,3,8,9]),import.meta.url)}),`./${a.key}QrCode.vue`,2))),{config:M.value},null,8,["config"]))])):D("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])}}}),He={class:"user-login-container p-24"},Ne={key:0,class:"flex-center",style:{"margin-bottom":"32px"}},Je=["src"],Ge={key:1,class:"user-login__header"},We={class:"flex-between"},Xe={class:"flex align-center"},Ye={class:"mr-12 ml-16 flex"},Ze=["src"],et=["title"],tt={class:"mb-24"},ot={key:0,class:"mb-24"},at={key:1},st={class:"mb-24"},lt={class:"mb-24"},nt={key:0,class:"mb-24"},rt={class:"flex-between w-full"},ct=["src"],it={key:2},ut={key:3,class:"login-gradient-divider lighter mt-24"},dt={class:"text-center mt-16"},pt=ee({__name:"index",setup(V){Te();const g=ue(),{theme:R,chatUser:t,common:T}=j(),{locale:M}=Ce({useScope:"global"}),P=d(!1),O=Y(),S=d(""),{params:{accessToken:p},query:{mode:f}}=O,$=Le(()=>{console.log(T.isMobile());let e="";return!f||f==="pc"?e=T.isMobile()?"mobile":"pc":e=f,console.log(e),e==="pc"}),x=d(),a=d({username:"",password:"",captcha:""}),K=d(1),H=d({username:[{required:!0,message:L("views.login.loginForm.username.requiredMessage"),trigger:"blur"}],password:[{required:!0,message:L("views.login.loginForm.password.requiredMessage"),trigger:"blur"}],captcha:[{required:!1,message:L("views.login.loginForm.captcha.requiredMessage"),trigger:"blur"}]}),B=()=>{var e;(e=x.value)==null||e.validate().then(()=>{var o;if(_.value==="LDAP")t.ldapLogin(a.value).then(s=>{g.push({name:"chat",params:{accessToken:t.accessToken},query:O.query})});else{const s=X.pki.publicKeyFromPem((o=t==null?void 0:t.chat_profile)==null?void 0:o.rasKey),u=JSON.stringify(a.value),q=X.util.encodeUtf8(u),h=s.encrypt(q,"RSAES-PKCS1-V1_5"),r=X.util.encode64(h);t.login({encryptedData:r,username:a.value.username}).then(A=>{g.push({name:"chat",params:{accessToken:t.accessToken},query:O.query})}).catch(()=>{Q(a.value.username)})}})};function Q(e){ie.getCaptcha(e,p).then(o=>{S.value=o.data.captcha})}W(()=>{M.value=t.getLanguage()});const c=d([]),N=d([""]),_=d(""),U=d(!1),te=d([]);function fe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const o=Math.random()*16|0;return(e==="x"?o:o&3|8).toString(16)})}function oe(e,o=!1){e==="LDAP"||e===""||e==="password"||ie.getAuthSetting(e,P).then(s=>{if(!s.data||!s.data.config)return;const u=s.data.config,q=new URLSearchParams(O.query).toString();let h=`${u.redirectUrl}/${p}`;q&&(h+=`?${q}`);let r;if(e==="CAS")r=u.ldpUri,r+=r.indexOf("?")!==-1?`&service=${encodeURIComponent(h)}`:`?service=${encodeURIComponent(h)}`;else if(e==="OIDC"){const A=u.scope||"openid+profile+email";r=`${u.authEndpoint}?client_id=${u.clientId}&redirect_uri=${h}&response_type=code&scope=${A}`,u.state&&(r+=`&state=${u.state}`)}else e==="OAuth2"&&(r=`${u.authEndpoint}?client_id=${u.clientId}&response_type=code&redirect_uri=${h}&state=${fe()}`,u.scope&&(r+=`&scope=${u.scope}`));r&&(o?$e(L("views.login.jump_tip"),"",{confirmButtonText:L("views.login.jump"),cancelButtonText:L("common.cancel"),confirmButtonClass:""}).then(()=>{window.location.href=r}).catch(()=>{}):(console.log("url",r),window.location.href=r))})}function J(e){var o;if(_.value=e==="LDAP"?e:"LOCAL",e!=="LOCAL"&&(_.value=e),e==="QR_CODE"){_.value=e,U.value=!0;return}U.value=!1,a.value={username:"",password:"",captcha:""},oe(e),(o=x.value)==null||o.clearValidate()}function ve(e){Q(e)}return W(()=>{var e,o;(e=t.chat_profile)!=null&&e.max_attempts&&(K.value=t.chat_profile.max_attempts),(o=t.chat_profile)!=null&&o.login_value&&(c.value=t.chat_profile.login_value,c.value.includes("LOCAL")?c.value=["LOCAL",...c.value.filter(s=>s!=="LOCAL")]:c.value.includes("LDAP")&&(c.value=["LDAP",...c.value.filter(s=>s!=="LDAP")]),_.value=c.value[0]||"LOCAL",!c.value.includes("LOCAL")&&!c.value.includes("LDAP")&&(_.value=""),c.value.length==1&&["CAS","OIDC","OAuth2"].includes(c.value[0])&&oe(c.value[0]),N.value=c.value.filter(s=>!["CAS","OIDC","OAuth2","LOCAL","LDAP"].includes(s)),c.value=c.value.filter(s=>!["lark","wecom","dingtalk"].includes(s)),N.value.length>0&&(N.value.forEach(s=>{te.value.push({key:s,value:s==="wecom"?L("views.system.authentication.scanTheQRCode.wecom"):s==="dingtalk"?L("views.system.authentication.scanTheQRCode.dingtalk"):L("views.system.authentication.scanTheQRCode.lark")})}),!c.value.includes("LOCAL")&&!c.value.includes("LDAP")&&(U.value=!0),c.value=["QR_CODE",...c.value]))}),W(()=>{const e=Y(),o=d(e.fullPath),s=new URLSearchParams(o.value.split("?")[1]),u=s.get("client"),q=()=>{const r=s.get("corpId");r&&Pe.runtime.permission.requestAuthCode({corpId:r}).then(A=>{console.log("DingTalk client request success:",A),t.dingOauth2Callback(A.code,p).then(()=>{g.push({name:"chat",params:{accessToken:p},query:e.query})})})},h=()=>{const r=s.get("appId"),A=()=>{var b;(b=window.tt)==null||b.requestAuthCode({appId:r,success:I=>{t.larkCallback(I.code,p).then(()=>{g.push({name:"chat",params:{accessToken:p},query:e.query})})},fail:I=>{Ie(I)}})};qe("https://lf-scm-cn.feishucdn.com/lark/op/h5-js-sdk-1.5.44.js",{jsId:"lark-sdk",forceReload:!0}).then(()=>{var b;window.tt?(b=window.tt)==null||b.requestAccess({appID:r,scopeList:[],success:I=>{t.larkCallback(I.code,p).then(()=>{g.push({name:"chat",params:{accessToken:p},query:e.query})})},fail:I=>{const{errno:z}=I;z===103&&A()}}):A()}).catch(b=>{console.error("SDK 加载失败:",b)})};switch(u){case"dingtalk":q();break;case"lark":h();break}}),(e,o)=>{const s=w("el-avatar"),u=w("LogoIcon"),q=w("el-card"),h=w("el-input"),r=w("el-form-item"),A=w("el-form"),b=w("el-button"),I=xe("loading");return P.value?D("",!0):Ae((n(),v(ze,{key:0},{default:m(()=>{var z,ae,se,le,ne,re;return[i("div",He,[$.value?(n(),k("div",Ne,[C(ce)((z=C(t).chat_profile)==null?void 0:z.icon)?(n(),v(s,{key:0,shape:"square",size:32,class:"mr-8",style:{background:"none"}},{default:m(()=>{var l;return[i("img",{src:(l=C(t).chat_profile)==null?void 0:l.icon,alt:""},null,8,Je)]}),_:1})):(n(),v(u,{key:1,height:"32px",class:"mr-8"})),i("h1",null,E((ae=C(t).chat_profile)==null?void 0:ae.application_name),1)])):(n(),k("div",Ge,[i("div",We,[i("div",Xe,[i("div",Ye,[C(ce)((se=C(t).chat_profile)==null?void 0:se.icon)?(n(),v(s,{key:0,shape:"square",size:32,style:{background:"none"}},{default:m(()=>{var l;return[i("img",{src:(l=C(t).chat_profile)==null?void 0:l.icon,alt:""},null,8,Ze)]}),_:1})):(n(),v(u,{key:1,height:"32px"}))]),i("h4",{class:"ellipsis",style:{"max-width":"270px"},title:(le=C(t).chat_profile)==null?void 0:le.application_name},E((ne=C(t).chat_profile)==null?void 0:ne.application_name),9,et)])])])),((re=C(t).chat_profile)==null?void 0:re.authentication_type)=="password"?(n(),v(q,{key:2,class:"login-card"},{default:m(()=>[i("h2",tt,E(e.$t("views.applicationOverview.appInfo.LimitDialog.authenticationValue")),1),y(Se)]),_:1})):(n(),v(q,{key:3,class:"login-card",style:{"--el-card-padding":"0"}},{default:m(()=>[!U.value&&(_.value==="LDAP"||_.value==="LOCAL")?(n(),k("h2",ot,E(_.value=="LOCAL"?e.$t("views.login.title"):_.value),1)):D("",!0),!U.value&&(_.value==="LDAP"||_.value==="LOCAL")?(n(),k("div",at,[y(A,{class:"login-form",rules:H.value,model:a.value,ref_key:"loginFormRef",ref:x,onKeyup:De(B,["enter"])},{default:m(()=>[i("div",st,[y(r,{prop:"username"},{default:m(()=>[y(h,{size:"large",class:"input-item",modelValue:a.value.username,"onUpdate:modelValue":o[0]||(o[0]=l=>a.value.username=l),onBlur:o[1]||(o[1]=l=>ve(a.value.username)),placeholder:e.$t("views.login.loginForm.username.placeholder")},null,8,["modelValue","placeholder"])]),_:1})]),i("div",lt,[y(r,{prop:"password"},{default:m(()=>[y(h,{type:"password",size:"large",class:"input-item",modelValue:a.value.password,"onUpdate:modelValue":o[2]||(o[2]=l=>a.value.password=l),placeholder:e.$t("views.login.loginForm.password.placeholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1})]),_.value!=="LDAP"&&S.value?(n(),k("div",nt,[y(r,{prop:"captcha"},{default:m(()=>[i("div",rt,[y(h,{size:"large",class:"input-item",modelValue:a.value.captcha,"onUpdate:modelValue":o[3]||(o[3]=l=>a.value.captcha=l),placeholder:e.$t("views.login.loginForm.captcha.placeholder")},null,8,["modelValue","placeholder"]),i("img",{src:S.value,alt:"",height:"38",class:"ml-8 cursor border border-r-6",onClick:o[4]||(o[4]=l=>Q(a.value.username))},null,8,ct)])]),_:1})])):D("",!0)]),_:1},8,["rules","model"]),y(b,{size:"large",type:"primary",class:"w-full",onClick:B,loading:P.value},{default:m(()=>[de(E(e.$t("views.login.buttons.login")),1)]),_:1},8,["loading"])])):D("",!0),U.value?(n(),k("div",it,[y(Ke,{tabs:te.value},null,8,["tabs"])])):D("",!0),c.value.length>1?(n(),k("div",ut,[i("span",null,E(e.$t("views.login.moreMethod")),1)])):D("",!0),i("div",dt,[(n(!0),k(Z,null,_e(c.value,l=>(n(),k(Z,null,[l!=="LOCAL"&&_.value!==l&&l!=="QR_CODE"?(n(),v(b,{circle:"",key:l,class:"login-button-circle color-secondary",onClick:F=>J(l)},{default:m(()=>{var F;return[i("span",{style:Oe({"font-size":l==="OAUTH2"?"8px":"10px",color:(F=C(R).themeInfo)==null?void 0:F.theme})},E(l),5)]}),_:2},1032,["onClick"])):D("",!0),l==="QR_CODE"&&_.value!==l?(n(),v(b,{circle:"",key:l,class:"login-button-circle color-secondary",onClick:o[5]||(o[5]=F=>J("QR_CODE"))},{default:m(()=>[...o[7]||(o[7]=[i("img",{src:Re,width:"25px"},null,-1)])]),_:1})):D("",!0),l==="LOCAL"&&_.value!="LOCAL"?(n(),v(b,{circle:"",key:l,class:"login-button-circle color-secondary",style:{"font-size":"24px"},icon:"UserFilled",onClick:o[6]||(o[6]=F=>J("LOCAL"))})):D("",!0)],64))),256))])]),_:1}))])]}),_:1})),[[I,P.value]])}}}),mt=me(pt,[["__scopeId","data-v-8913cbab"]]),vt=Object.freeze(Object.defineProperty({__proto__:null,default:mt},Symbol.toStringTag,{value:"Module"}));export{Se as _,vt as a,Te as u};
