import{ay as Ve,az as Ae,b8 as xe,aA as Se,b7 as ze,b9 as Ne,aB as p,aC as _,bd as Le,be as Re,br as Ue,aL as Ee,aD as n,bf as S,aF as s,aH as a,aG as t,aK as v,aJ as r,bn as y,aI as i,aE as u,bm as z,bg as M,bh as B,c1 as Pe,c2 as Te,bb as N,c3 as oe,c0 as Ie,c4 as Fe,c5 as O,c6 as Me,bo as Be,c7 as Oe}from"./chat-CUfIjAsy.js";import{l as De}from"./permission-api-DyNdOx42.js";import"./workspace-Cv2gXV-V.js";const We={class:"p-16-24"},Je={class:"ml-4 color-text-primary"},He={class:"flex-between mb-16"},Ke={class:"complex-search"},qe={class:"table-name flex align-center"},Ge=["src"],je={class:"filter"},Qe={class:"form-item mb-16"},Xe={class:"text-right"},Ye={key:0,class:"flex align-center"},Ze={class:"color-text-primary"},el={key:1,class:"flex align-center"},ll={class:"color-text-primary"},al={class:"filter"},tl={class:"form-item mb-16 ml-4"},ol={class:"text-right"},nl={class:"mr-8"},sl={class:"mr-8"},pl=Ve({__name:"ApplicationResourceIndex",setup(il){const ne=Ae();xe();const{user:H,application:se}=Se(),f=ze(()=>Ne.application.systemManage),ie=()=>f.value.overview_read()||f.value.access_read()||f.value.edit()||f.value.chat_log_read()||f.value.chat_user_read(),re=()=>f.value.export()||f.value.delete()||f.value.auth(),K=p();function ue(e){K.value.open(e.id)}const D=p([]);function ce(e){var m,V;(V=(m=e==null?void 0:e.work_flow)==null?void 0:m.nodes)==null||V.filter(c=>c.id==="base-node").map(c=>{D.value=c.properties.api_input_field_list?c.properties.api_input_field_list.map(d=>({name:d.variable,value:d.default_value})):c.properties.input_field_list?c.properties.input_field_list.filter(d=>d.assignment_method==="api_input").map(d=>({name:d.variable,value:d.default_value})):[]});const o=q(D.value)?"?"+q(D.value):"";O.getAccessToken(e.id,R).then(c=>{var d;window.open(se.location+((d=c==null?void 0:c.data)==null?void 0:d.access_token)+o)})}function q(e){const o=new URLSearchParams;return e.forEach(m=>{o.append(encodeURIComponent(m.name),encodeURIComponent(m.value))}),o.toString()}function pe(e){Me(`${_("views.application.delete.confirmTitle")}${e.name} ?`,_("views.application.delete.confirmMessage"),{confirmButtonText:_("common.confirm"),cancelButtonText:_("common.cancel"),confirmButtonClass:"danger"}).then(()=>{O.delApplication(e.id,R).then(()=>{const o=U.value.findIndex(m=>m.id===e.id);U.value.splice(o,1),Be(_("common.deleteSuccess"))})}).catch(()=>{})}const me=e=>{O.exportApplication(e.id,e.name,R).catch(o=>{o.response.status!==403&&o.response.data.text().then(m=>{Oe(`${_("views.application.tip.ExportError")}:${JSON.parse(m).message}`)})})},g=p("name"),b=p({name:"",create_user:"",type:""}),G=p([]),de=p([{label:_("views.application.workflow"),value:"WORK_FLOW"},{label:_("views.application.simple"),value:"SIMPLE"}]),R=p(!1),U=p([]),W=Le({current_page:1,page_size:20,total:0}),E=p([]),P=p(!1),$=p([]),T=p(!1),C=p([]),ve=p([{label:_("views.application.status.published"),value:!0},{label:_("views.application.status.unpublished"),value:!1}]),L=p(""),I=p([]);Re([()=>E.value,()=>L.value],()=>{L.value.length||(I.value=E.value),I.value=E.value.filter(e=>e.label.toLowerCase().includes(L.value.toLowerCase()))},{immediate:!0});function j(e){e==="clear"&&($.value=[]),L.value="",w(),P.value=!1}function Q(e){e==="clear"&&(C.value=[]),w(),T.value=!1}async function _e(){if(H.isEE()){const e=await De("workspace").getSystemWorkspaceList(R);E.value=e.data.map(o=>({label:o.name,value:o.id}))}}const fe=()=>{b.value={name:"",create_user:"",type:""}};function w(){const e={};b.value[g.value]&&(e[g.value]=b.value[g.value]),$.value.length>0&&(e.workspace_ids=JSON.stringify($.value)),C.value.length>0&&(e.status=JSON.stringify(C.value)),O.getApplication(W,e,R).then(o=>{var m,V;W.total=(m=o.data)==null?void 0:m.total,U.value=(V=o.data)==null?void 0:V.records})}return Ue(()=>{_e(),w(),Ee.getAllMemberList("").then(e=>{G.value=e.data})}),(e,o)=>{const m=n("el-breadcrumb-item"),V=n("el-breadcrumb"),c=n("el-option"),d=n("el-select"),X=n("el-input"),be=n("el-avatar"),F=n("el-icon"),k=n("el-table-column"),Y=n("el-tag"),Z=n("Filter"),h=n("el-button"),ee=n("el-checkbox"),le=n("el-checkbox-group"),ae=n("el-popover"),he=n("SuccessFilled"),A=n("AppIcon"),ye=n("el-scrollbar"),ge=n("el-empty"),te=n("el-tooltip"),J=n("el-dropdown-item"),we=n("el-dropdown-menu"),ke=n("el-dropdown"),$e=n("app-table"),Ce=n("el-card");return s(),S("div",We,[a(V,{"separator-icon":"ArrowRight"},{default:t(()=>[a(m,null,{default:t(()=>[v(r(y(_)("views.system.resource_management.label")),1)]),_:1}),a(m,null,{default:t(()=>[i("h5",Je,r(y(_)("views.application.title")),1)]),_:1})]),_:1}),a(Ce,{class:"mt-16",style:{height:"calc(var(--app-main-height) + 20px)"}},{default:t(()=>[i("div",He,[i("div",Ke,[a(d,{class:"complex-search__left",modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=l=>g.value=l),style:{width:"120px"},onChange:fe},{default:t(()=>[a(c,{label:e.$t("common.creator"),value:"create_user"},null,8,["label"]),a(c,{label:e.$t("common.name"),value:"name"},null,8,["label"]),a(c,{label:e.$t("views.system.resource_management.type"),value:"type"},null,8,["label"])]),_:1},8,["modelValue"]),g.value==="name"?(s(),u(X,{key:0,modelValue:b.value.name,"onUpdate:modelValue":o[1]||(o[1]=l=>b.value.name=l),onChange:w,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):g.value==="create_user"?(s(),u(d,{key:1,modelValue:b.value.create_user,"onUpdate:modelValue":o[2]||(o[2]=l=>b.value.create_user=l),onChange:w,clearable:"",filterable:"",style:{width:"220px"}},{default:t(()=>[(s(!0),S(M,null,B(G.value,l=>(s(),u(c,{key:l.id,value:l.id,label:l.nick_name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):g.value==="type"?(s(),u(d,{key:2,modelValue:b.value.type,"onUpdate:modelValue":o[3]||(o[3]=l=>b.value.type=l),onChange:w,clearable:"",filterable:"",style:{width:"220px"}},{default:t(()=>[(s(!0),S(M,null,B(de.value,l=>(s(),u(c,{key:l.id,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):z("",!0)])]),a($e,{data:U.value,"pagination-config":W,onSizeChange:w,onChangePage:w,maxTableHeight:260},{default:t(()=>[a(k,{width:"220",label:e.$t("common.name"),"show-overflow-tooltip":""},{default:t(l=>[i("div",qe,[a(F,{size:"24",class:"mr-8"},{default:t(()=>[a(be,{shape:"square",size:24,style:{background:"none"},class:"mr-8"},{default:t(()=>{var x;return[i("img",{src:y(Pe)((x=l.row)==null?void 0:x.icon),alt:""},null,8,Ge)]}),_:2},1024)]),_:2},1024),v(" "+r(l.row.name),1)])]),_:1},8,["label"]),a(k,{prop:"tool_type",label:e.$t("views.system.resource_management.type"),width:"160"},{default:t(l=>[y(Te)(l.row.type)?(s(),u(Y,{key:0,class:"warning-tag"},{default:t(()=>[v(r(e.$t("views.application.workflow")),1)]),_:1})):(s(),u(Y,{key:1,class:"blue-tag"},{default:t(()=>[v(r(e.$t("views.application.simple")),1)]),_:1}))]),_:1},8,["label"]),a(k,{width:"150",prop:"is_publish",label:e.$t("common.status.label"),"show-overflow-tooltip":""},{header:t(()=>[i("div",null,[i("span",null,r(e.$t("common.status.label")),1),a(ae,{width:100,trigger:"click",visible:T.value},{reference:t(()=>[a(h,{style:{"margin-top":"-2px"},type:C.value&&C.value.length>0?"primary":"",link:"",onClick:o[4]||(o[4]=l=>T.value=!T.value)},{default:t(()=>[a(F,null,{default:t(()=>[a(Z)]),_:1})]),_:1},8,["type"])]),default:t(()=>[i("div",je,[i("div",Qe,[i("div",{onClick:o[6]||(o[6]=N(()=>{},["stop"]))},[a(le,{modelValue:C.value,"onUpdate:modelValue":o[5]||(o[5]=l=>C.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(s(!0),S(M,null,B(ve.value,l=>(s(),u(ee,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),i("div",Xe,[a(h,{size:"small",onClick:o[7]||(o[7]=l=>Q("clear"))},{default:t(()=>[v(r(e.$t("common.clear")),1)]),_:1}),a(h,{type:"primary",onClick:Q,size:"small"},{default:t(()=>[v(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),default:t(l=>[l.row.is_publish?(s(),S("div",Ye,[a(F,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:t(()=>[a(he)]),_:1}),i("span",Ze,r(e.$t("views.application.status.published")),1)])):(s(),S("div",el,[a(A,{iconName:"app-disabled",class:"color-secondary mr-8"}),i("span",ll,r(e.$t("views.application.status.unpublished")),1)]))]),_:1},8,["label"]),y(H).isEE()?(s(),u(k,{key:0,width:"150",prop:"workspace_name",label:e.$t("views.workspace.title"),"show-overflow-tooltip":""},{header:t(()=>[i("div",null,[i("span",null,r(e.$t("views.workspace.title")),1),a(ae,{width:200,trigger:"click",visible:P.value},{reference:t(()=>[a(h,{style:{"margin-top":"-2px"},type:$.value&&$.value.length>0?"primary":"",link:"",onClick:o[8]||(o[8]=l=>P.value=!P.value)},{default:t(()=>[a(F,null,{default:t(()=>[a(Z)]),_:1})]),_:1},8,["type"])]),default:t(()=>[i("div",al,[i("div",tl,[i("div",{onClick:o[11]||(o[11]=N(()=>{},["stop"]))},[a(X,{modelValue:L.value,"onUpdate:modelValue":o[9]||(o[9]=l=>L.value=l),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),I.value.length?(s(),u(ye,{key:0,height:"300"},{default:t(()=>[a(le,{modelValue:$.value,"onUpdate:modelValue":o[10]||(o[10]=l=>$.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(s(!0),S(M,null,B(I.value,l=>(s(),u(ee,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(s(),u(ge,{key:1,description:e.$t("common.noData")},null,8,["description"]))])])]),i("div",ol,[a(h,{size:"small",onClick:o[12]||(o[12]=l=>j("clear"))},{default:t(()=>[v(r(e.$t("common.clear")),1)]),_:1}),a(h,{type:"primary",onClick:j,size:"small"},{default:t(()=>[v(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):z("",!0),a(k,{prop:"nick_name",label:e.$t("common.creator"),"show-overflow-tooltip":""},null,8,["label"]),a(k,{label:e.$t("views.application.publishTime"),width:"180"},{default:t(({row:l})=>[v(r(y(oe)(l.update_time)),1)]),_:1},8,["label"]),a(k,{label:e.$t("common.createTime"),width:"180"},{default:t(({row:l})=>[v(r(y(oe)(l.create_time)),1)]),_:1},8,["label"]),a(k,{label:e.$t("common.operation"),align:"left",width:"120",fixed:"right"},{default:t(({row:l})=>[a(te,{effect:"dark",content:e.$t("views.application.operation.toChat"),placement:"top"},{default:t(()=>[i("span",nl,[a(h,{type:"primary",text:"",title:e.$t("views.application.operation.toChat"),onClick:N(x=>ce(l),["stop"])},{default:t(()=>[a(A,{iconName:"app-create-chat"})]),_:1},8,["title","onClick"])])]),_:2},1032,["content"]),ie()?(s(),u(te,{key:0,effect:"dark",content:e.$t("views.system.resource_management.management"),placement:"top"},{default:t(()=>[i("span",sl,[a(h,{type:"primary",text:"",title:e.$t("views.system.resource_management.management"),onClick:x=>y(ne).push({path:`/application/resource-management/${l.id}/${l.type}/overview`})},{default:t(()=>[a(A,{iconName:"app-admin-operation"})]),_:1},8,["title","onClick"])])]),_:2},1032,["content"])):z("",!0),re()?(s(),u(ke,{key:1,trigger:"click"},{dropdown:t(()=>[a(we,null,{default:t(()=>[f.value.auth()?(s(),u(J,{key:0,onClick:N(x=>ue(l),["stop"])},{default:t(()=>[a(A,{iconName:"app-resource-authorization",class:"color-secondary"}),v(" "+r(e.$t("views.system.resourceAuthorization.title")),1)]),_:1},8,["onClick"])):z("",!0),f.value.export()?(s(),u(J,{key:1,onClick:N(x=>me(l),["stop"])},{default:t(()=>[a(A,{iconName:"app-export",class:"color-secondary"}),v(" "+r(e.$t("common.export")),1)]),_:1},8,["onClick"])):z("",!0),f.value.delete()?(s(),u(J,{key:2,onClick:N(x=>pe(l),["stop"])},{default:t(()=>[a(A,{iconName:"app-delete",class:"color-secondary"}),v(" "+r(e.$t("common.delete")),1)]),_:1},8,["onClick"])):z("",!0)]),_:2},1024)]),default:t(()=>[a(h,{text:"",onClick:o[13]||(o[13]=N(()=>{},["stop"])),type:"primary"},{default:t(()=>[a(A,{iconName:"app-more"})]),_:1})]),_:2},1024)):z("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])]),_:1}),a(Fe,{type:y(Ie).APPLICATION,ref_key:"ResourceAuthorizationDrawerRef",ref:K},null,8,["type"])])}}});export{pl as default};
