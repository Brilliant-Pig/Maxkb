import{ay as Ee,b8 as we,aB as v,bW as M,b9 as oe,b7 as A,bd as G,br as ke,be as ne,bf as K,aI as o,aH as s,aJ as h,bn as I,c0 as Ae,aG as u,aD as i,bc as R,bZ as Oe,bY as W,b_ as H,bt as re,bs as Ue,aE as O,bm as F,aK as z,aC as ie,aF as b,bo as Le,ce as Te}from"./chat-CUfIjAsy.js";const De={class:"group p-16-24"},Se={class:"mb-16"},Ie={class:"color-secondary"},Re={class:"flex"},Pe={class:"user-left border-r"},Ve={class:"p-24 pb-0"},$e={class:"medium mb-12"},Ne={class:"list-height-left"},Me={class:"p-16"},Ge=["title"],Ke={class:"user-right"},We={class:"flex-between"},He={class:"flex align-center"},Fe=["title"],ze={class:"color-input-placeholder ml-4"},Be={key:0,class:"flex align-center"},je={class:"color-secondary mr-8"},xe={class:"flex-between mb-16",style:{"margin-top":"18px"}},Je={class:"flex complex-search"},Ye=Ee({__name:"index",setup(Ze){const r=we(),{params:{id:B,folderId:ue}}=r,j=v({APPLICATION:oe.application.workspace.application_chat_user_edit(B),KNOWLEDGE:oe.knowledge.workspace.chat_user_edit(B),RESOURCE_APPLICATION:M([W.ADMIN,H.RESOURCE_APPLICATION_CHAT_USER_EDIT],"OR"),RESOURCE_KNOWLEDGE:M([W.ADMIN,H.RESOURCE_KNOWLEDGE_CHAT_USER_EDIT],"OR"),SHAREDKNOWLEDGE:M(new Oe([W.ADMIN],[H.SHARED_KNOWLEDGE_CHAT_USER_EDIT],[],"OR"),"OR")}),x=A(()=>{var e,a,n;if(r.path.includes("resource-management")){if(((e=r.meta)==null?void 0:e.resourceType)==="KNOWLEDGE")return"RESOURCE_KNOWLEDGE";if(((a=r.meta)==null?void 0:a.resourceType)==="APPLICATION")return"RESOURCE_APPLICATION"}else{if(r.path.includes("shared"))return"SHAREDKNOWLEDGE";if(r.path.includes("knowledge/"))return"KNOWLEDGE";if(r.path.includes("application/"))return"APPLICATION"}return(n=r.meta)==null?void 0:n.resourceType}),w=G({resource_id:r.params.id,resource_type:r.meta.resourceType}),U=v(""),L=v(!1),T=v([]),P=v([]),t=v(),D=A(()=>r.path.includes("shared")?"systemShare":r.path.includes("resource-management")?"systemManage":"workspace");async function J(){try{const e=await R({type:"chatUser",isShared:Z.value,systemType:D.value}).getUserGroupList(w,L);T.value=e.data,P.value=Y(T.value,U.value)}catch(e){console.error(e)}}ke(async()=>{await J(),t.value=T.value[0]});function Y(e,a){return a.length?e.filter(n=>n.name.toLowerCase().includes(a.toLowerCase())):e}ne(U,e=>{P.value=Y(T.value,e)});const d=G({});function ce(e){for(const a in d)delete d[a];t.value=e}async function de(){var a,n,_,p,m;const e=[{user_group_id:(a=t.value)==null?void 0:a.id,is_auth:!((n=t.value)!=null&&n.is_auth)}];try{await R({type:"chatUser",systemType:D.value}).editUserGroupList(w,e,L),await J(),t.value={name:(_=t.value)==null?void 0:_.name,id:(p=t.value)==null?void 0:p.id,is_auth:!((m=t.value)!=null&&m.is_auth)},y()}catch($){console.error($)}}const V=v(!1),g=v("username"),f=v({username:"",nick_name:"",source:""}),C=G({current_page:1,page_size:20,total:0}),E=v([]),Z=A(()=>ue==="share");async function y(){var n,_;if(!((n=t.value)!=null&&n.id))return;const e={},a=f.value[g.value];a!=null&&a!==""&&(e[g.value]=a);try{const p=await R({type:"chatUser",isShared:Z.value,systemType:D.value}).getUserGroupUserList(w,(_=t.value)==null?void 0:_.id,C,e,V);p.data.records.forEach(m=>{d[m.id]===void 0&&(d[m.id]=m.is_auth),m.is_auth=d[m.id]}),E.value=p.data.records,C.total=p.data.total}catch(p){console.error(p)}}function pe(){C.current_page=1,y()}ne(()=>{var e;return(e=t.value)==null?void 0:e.id},()=>{C.current_page=1,y()});const q=A(()=>E.value.length>0&&E.value.every(e=>d[e.id])),me=A(()=>!q.value&&E.value.some(e=>d[e.id])),ve=e=>{E.value.forEach(a=>{a.is_auth=e,d[a.id]=e})},he=(e,a)=>{a.is_auth=e,d[a.id]=e};async function _e(){var e;try{const a=Object.entries(d).map(([n,_])=>({chat_user_id:n,is_auth:_}));await R({type:"chatUser",systemType:D.value}).putUserGroupUser(w,(e=t.value)==null?void 0:e.id,a,V),Le(ie("common.saveSuccess"))}catch(a){console.error(a)}}return(e,a)=>{const n=i("el-input"),_=i("common-list"),p=i("el-scrollbar"),m=i("el-divider"),$=i("UserFilled"),be=i("el-icon"),ge=i("el-switch"),c=i("el-option"),Q=i("el-select"),fe=i("el-button"),S=i("el-table-column"),X=i("el-checkbox"),ye=i("app-table"),Ce=i("el-card"),ee=Ue("loading");return b(),K("div",De,[o("div",Se,[o("h2",null,h(e.$t("views.chatUser.title")),1),o("div",Ie,h(w.resource_type===I(Ae).APPLICATION?e.$t("views.chatUser.applicationTitleTip"):e.$t("views.chatUser.knowledgeTitleTip")),1)]),s(Ce,{style:{"--el-card-padding":"0"}},{default:u(()=>{var ae,le,se,te;return[o("div",Re,[o("div",Pe,[o("div",Ve,[o("h4",$e,h(e.$t("views.chatUser.group.title")),1),s(n,{modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=l=>U.value=l),placeholder:e.$t("common.search"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"])]),o("div",Ne,[re((b(),O(p,null,{default:u(()=>{var l;return[o("div",Me,[s(_,{data:P.value,onClick:ce,"default-active":(l=t.value)==null?void 0:l.id},{default:u(({row:k})=>[o("span",{class:"ellipsis-1",title:k.name},h(k.name),9,Ge)]),empty:u(()=>[...a[5]||(a[5]=[o("span",null,null,-1)])]),_:1},8,["data","default-active"])])]}),_:1})),[[ee,L.value]])])]),re((b(),K("div",Ke,[o("div",We,[o("div",He,[o("h4",{class:"medium ellipsis",title:(ae=t.value)==null?void 0:ae.name},h(((le=t.value)==null?void 0:le.name)||"-"),9,Fe),s(m,{direction:"vertical",class:"mr-8 ml-8"}),s(be,{class:"color-input-placeholder"},{default:u(()=>[s($)]),_:1}),o("span",ze,h(C.total),1)]),!I(r).path.includes("share/")&&j.value[x.value]?(b(),K("div",Be,[o("div",je,h(e.$t("views.chatUser.autoAuthorization")),1),s(ge,{size:"small","model-value":(se=t.value)==null?void 0:se.is_auth,onClick:de,loading:L.value},null,8,["model-value","loading"])])):F("",!0)]),o("div",xe,[o("div",Je,[s(Q,{class:"complex-search__left",modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=l=>g.value=l),style:{width:"120px"}},{default:u(()=>[s(c,{label:e.$t("views.login.loginForm.username.label"),value:"username"},null,8,["label"]),s(c,{label:e.$t("views.userManage.userForm.nick_name.label"),value:"nick_name"},null,8,["label"]),s(c,{label:e.$t("views.userManage.source.label"),value:"source"},null,8,["label"])]),_:1},8,["modelValue"]),g.value==="username"?(b(),O(n,{key:0,modelValue:f.value.username,"onUpdate:modelValue":a[2]||(a[2]=l=>f.value.username=l),onChange:y,placeholder:e.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):g.value==="nick_name"?(b(),O(n,{key:1,modelValue:f.value.nick_name,"onUpdate:modelValue":a[3]||(a[3]=l=>f.value.nick_name=l),onChange:y,placeholder:e.$t("common.inputPlaceholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):g.value==="source"?(b(),O(Q,{key:2,modelValue:f.value.source,"onUpdate:modelValue":a[4]||(a[4]=l=>f.value.source=l),onChange:y,placeholder:e.$t("common.selectPlaceholder"),style:{width:"220px"},clearable:""},{default:u(()=>[s(c,{label:e.$t("views.userManage.source.local"),value:"LOCAL"},null,8,["label"]),s(c,{label:"CAS",value:"CAS"}),s(c,{label:"LDAP",value:"LDAP"}),s(c,{label:"OIDC",value:"OIDC"}),s(c,{label:"OAuth2",value:"OAuth2"}),s(c,{label:e.$t("views.userManage.source.wecom"),value:"wecom"},null,8,["label"]),s(c,{label:e.$t("views.userManage.source.lark"),value:"lark"},null,8,["label"]),s(c,{label:e.$t("views.userManage.source.dingtalk"),value:"dingtalk"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])):F("",!0)]),!I(r).path.includes("share/")&&j.value[x.value]?(b(),O(fe,{key:0,type:"primary",disabled:(te=t.value)==null?void 0:te.is_auth,onClick:_e},{default:u(()=>[z(h(I(ie)("common.save")),1)]),_:1},8,["disabled"])):F("",!0)]),s(ye,{data:E.value,"pagination-config":C,onSizeChange:pe,onChangePage:y,maxTableHeight:350},{default:u(()=>[s(S,{prop:"nick_name",label:e.$t("views.userManage.userForm.nick_name.label")},null,8,["label"]),s(S,{prop:"username",label:e.$t("views.login.loginForm.username.label")},null,8,["label"]),s(S,{prop:"source",label:e.$t("views.userManage.source.label")},{default:u(({row:l})=>[z(h(l.source==="LOCAL"?e.$t("views.userManage.source.local"):l.source==="wecom"?e.$t("views.userManage.source.wecom"):l.source==="lark"?e.$t("views.userManage.source.lark"):l.source==="dingtalk"?e.$t("views.userManage.source.dingtalk"):l.source==="OAUTH2"||l.source==="OAuth2"?"OAuth2":l.source),1)]),_:1},8,["label"]),s(S,{width:140,align:"center"},{header:u(()=>{var l;return[s(X,{"model-value":q.value,indeterminate:me.value,disabled:(l=t.value)==null?void 0:l.is_auth,onChange:ve},{default:u(()=>[z(h(e.$t("views.chatUser.authorization")),1)]),_:1},8,["model-value","indeterminate","disabled"])]}),default:u(({row:l})=>{var k;return[s(X,{modelValue:l.is_auth,"onUpdate:modelValue":N=>l.is_auth=N,indeterminate:l.indeterminate,disabled:(k=t.value)==null?void 0:k.is_auth,onChange:N=>he(N,l)},null,8,["modelValue","onUpdate:modelValue","indeterminate","disabled","onChange"])]}),_:1})]),_:1},8,["data","pagination-config"])])),[[ee,V.value]])])]}),_:1})])}}}),Qe=Te(Ye,[["__scopeId","data-v-c9cc8ff0"]]);export{Qe as default};
