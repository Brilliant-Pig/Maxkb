import{bj as J,bl as Me,cU as Ne,ay as be,aB as i,aD as s,aE as f,aF as u,aG as a,aI as n,aH as t,aJ as r,bb as z,aK as g,aA as Ae,bd as Re,aC as m,br as Ue,bs as de,bf as $,bt as W,bm as ce,bg as T,bh as M,bn as d,bZ as ve,bY as me,b_ as _e,bX as Y,c3 as Ye,cQ as ze,bo as je,ce as Fe}from"./chat-CUfIjAsy.js";import{W as Be}from"./workspace-Cv2gXV-V.js";const A="/operate_log",He=(h,_,c)=>J(`${A}/${h.current_page}/${h.page_size}`,_,c),We=()=>J(`${A}/menu_operation_option/`,void 0,void 0),Je=(h,_)=>{Ne("log.xlsx",`${A}/export/`,h,void 0,_)},Ge=(h,_)=>Me(`${A}/save`,h,void 0,_),Xe=()=>J(`${A}/get_clean_time`,void 0,void 0),N={getOperateLog:He,getMenuList:We,exportOperateLog:Je,saveCleanTime:Ge,getCleanTime:Xe},qe={class:"border border-r-6 mb-16",style:{"white-space":"pre-wrap",height:"400px"}},Ke={class:"p-16"},Qe={class:"dialog-footer mt-16"},Ze=be({__name:"DetailDialog",setup(h,{expose:_}){const c=i(!1),b=i();return _({open:p=>{b.value=JSON.stringify(p.details,null,4),c.value=!0}}),(p,C)=>{const V=s("el-scrollbar"),D=s("el-button"),L=s("el-dialog");return u(),f(L,{title:p.$t("views.operateLog.table.opt.label"),modelValue:c.value,"onUpdate:modelValue":C[1]||(C[1]=P=>c.value=P),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[n("span",Qe,[t(D,{onClick:C[0]||(C[0]=z(P=>c.value=!1,["prevent"]))},{default:a(()=>[g(r(p.$t("views.operateLog.close")),1)]),_:1})])]),default:a(()=>[n("div",qe,[t(V,null,{default:a(()=>[n("div",Ke,r(b.value),1)]),_:1})])]),_:1},8,["title","modelValue"])}}}),el={class:"operate-log p-16-24"},ll={class:"mb-16"},tl={class:"p-24"},al={class:"flex-between"},ol={style:{display:"flex"}},nl={class:"flex-between complex-search"},sl={class:"filter"},il={class:"form-item mb-16"},rl={class:"text-right"},ul={class:"text-ellipsis"},pl={class:"filter"},dl={class:"form-item mb-16"},cl={class:"text-right"},vl={key:0},ml={key:1,style:{color:"red"}},_l={class:"mr-4"},bl={class:"dialog-footer",style:{"margin-top":"16px"}},fl=be({__name:"index",setup(h){const{user:_}=Ae(),c=i(!1),b=i([]),S=i(!1),p=i([]),C=i(),V=i(!1),D=Re({current_page:1,page_size:20,total:0}),L=i(""),P=i([]),R=i(7),O=i("user"),j=i(""),x=i({start_time:"",end_time:""}),G=i(""),E=i(!1),U=i(180),fe=[{value:7,label:m("views.applicationOverview.monitor.pastDayOptions.past7Days")},{value:30,label:m("views.applicationOverview.monitor.pastDayOptions.past30Days")},{value:90,label:m("views.applicationOverview.monitor.pastDayOptions.past90Days")},{value:183,label:m("views.applicationOverview.monitor.pastDayOptions.past183Days")},{value:"other",label:m("common.custom")}],ge=[{value:"user",label:m("views.operateLog.table.user.label")},{value:"status",label:m("views.operateLog.table.status.label")},{value:"ip_address",label:m("views.operateLog.table.ip_address.label")}],ye=[{value:"200",label:m("views.operateLog.table.status.success")},{value:"500",label:m("views.operateLog.table.status.fail")}],X=i([]),q=i([]);function K(e){e==="clear"&&(b.value=[]),y(),c.value=!1}function Q(e){e==="clear"&&(p.value=[]),y(),S.value=!1}function he(e){y()}function we(e){O.value=e,L.value&&y()}function Z(e){e!=="other"&&(x.value.start_time=ze(e),x.value.end_time="",y())}function ke(e){x.value.start_time=e[0],x.value.end_time=e[1],y()}function $e(e){C.value.open(e)}function Ce(){D.current_page=1,y()}function ee(){const e={start_time:x.value.start_time,end_time:x.value.end_time};return L.value&&O.value!=="status"&&(e[O.value]=L.value),O.value==="status"&&(e.status=j.value),b.value.length>0&&(e.menu=JSON.stringify(b.value)),p.value.length>0&&(e.workspace_ids=JSON.stringify(p.value)),e}function y(){return N.getOperateLog(D,ee(),V).then(e=>{P.value=e.data.records,D.total=e.data.total})}function Ve(){return N.getMenuList().then(e=>{e.data.filter((w,I,F)=>I===F.findIndex(B=>B.menu===w.menu)).forEach(w=>{X.value.push({label:w.menu_label,value:w.menu})})})}const Le=()=>{N.exportOperateLog(ee(),V)};async function Oe(){if(_.isEE()){const e=await Be.getSystemWorkspaceList(V);q.value=e.data.map(o=>({label:o.name,value:o.id}))}}function De(){const e={clean_time:U.value};N.saveCleanTime(e,V).then(()=>{je(m("common.saveSuccess")),E.value=!1,le()}).catch(()=>{E.value=!1})}function le(){N.getCleanTime().then(e=>{U.value=e.data})}return Ue(()=>{Ve(),le(),Oe(),Z(R.value)}),(e,o)=>{const w=s("el-option"),I=s("el-select"),F=s("el-date-picker"),B=s("el-input"),v=s("el-button"),te=s("Filter"),ae=s("el-icon"),oe=s("el-checkbox"),ne=s("el-checkbox-group"),se=s("el-scrollbar"),ie=s("el-popover"),k=s("el-table-column"),re=s("el-tooltip"),xe=s("AppIcon"),Ee=s("app-table"),Se=s("el-card"),Pe=s("el-input-number"),Ie=s("el-dialog"),ue=de("hasPermission"),Te=de("loading");return u(),$("div",el,[n("h2",ll,r(e.$t("views.operateLog.title")),1),t(Se,{style:{"--el-card-padding":"0"},class:"main-calc-height"},{default:a(()=>[n("div",tl,[n("div",al,[n("div",null,[t(I,{modelValue:R.value,"onUpdate:modelValue":o[0]||(o[0]=l=>R.value=l),class:"mr-12",onChange:Z,style:{width:"180px"}},{default:a(()=>[(u(),$(T,null,M(fe,l=>t(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),R.value==="other"?(u(),f(F,{key:0,modelValue:G.value,"onUpdate:modelValue":o[1]||(o[1]=l=>G.value=l),type:"daterange","start-placeholder":e.$t("views.applicationOverview.monitor.startDatePlaceholder"),"end-placeholder":e.$t("views.applicationOverview.monitor.endDatePlaceholder"),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ke},null,8,["modelValue","start-placeholder","end-placeholder"])):ce("",!0)]),n("div",ol,[n("div",nl,[t(I,{modelValue:O.value,"onUpdate:modelValue":o[2]||(o[2]=l=>O.value=l),class:"complex-search__left",onChange:we,style:{width:"120px"}},{default:a(()=>[(u(),$(T,null,M(ge,l=>t(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),O.value==="status"?(u(),f(I,{key:0,modelValue:j.value,"onUpdate:modelValue":o[3]||(o[3]=l=>j.value=l),onChange:he,style:{width:"220px"},clearable:""},{default:a(()=>[(u(),$(T,null,M(ye,l=>t(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])):(u(),f(B,{key:1,modelValue:L.value,"onUpdate:modelValue":o[4]||(o[4]=l=>L.value=l),onChange:y,placeholder:e.$t("common.search"),"prefix-icon":"Search",style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"]))]),W((u(),f(v,{onClick:Le,style:{"margin-left":"10px"}},{default:a(()=>[g(r(e.$t("common.export")),1)]),_:1})),[[ue,new(d(ve))([d(me).ADMIN],[d(_e).OPERATION_LOG_EXPORT],[d(Y).IS_EE,d(Y).IS_PE],"OR")]]),W((u(),f(v,{onClick:o[5]||(o[5]=l=>E.value=!0)},{default:a(()=>[g(r(e.$t("views.chatLog.buttons.clearStrategy")),1)]),_:1})),[[ue,new(d(ve))([d(me).ADMIN],[d(_e).OPERATION_LOG_CLEAR_POLICY],[d(Y).IS_EE,d(Y).IS_PE],"OR")]])])]),W((u(),f(Ee,{class:"mt-16",data:P.value,"pagination-config":D,onSizeChange:Ce,onChangePage:y},{default:a(()=>[t(k,{prop:"menu",label:e.$t("views.operateLog.table.menu.label"),width:"160"},{header:a(()=>[n("div",null,[n("span",null,r(e.$t("views.operateLog.table.menu.label")),1),t(ie,{width:200,trigger:"click",visible:c.value},{reference:a(()=>[t(v,{style:{"margin-top":"-2px"},type:b.value&&b.value.length>0?"primary":"",link:"",onClick:o[6]||(o[6]=l=>c.value=!c.value)},{default:a(()=>[t(ae,null,{default:a(()=>[t(te)]),_:1})]),_:1},8,["type"])]),default:a(()=>[n("div",sl,[n("div",il,[n("div",{onClick:o[8]||(o[8]=z(()=>{},["stop"]))},[t(se,{height:"300",style:{margin:"0 0 0 10px"}},{default:a(()=>[t(ne,{modelValue:b.value,"onUpdate:modelValue":o[7]||(o[7]=l=>b.value=l),style:{display:"flex","flex-direction":"column"}},{default:a(()=>[(u(!0),$(T,null,M(X.value,l=>(u(),f(oe,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",rl,[t(v,{size:"small",onClick:o[9]||(o[9]=l=>K("clear"))},{default:a(()=>[g(r(e.$t("common.clear")),1)]),_:1}),t(v,{type:"primary",onClick:K,size:"small"},{default:a(()=>[g(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"]),t(k,{prop:"operate",label:e.$t("views.operateLog.table.operate.detail")},{default:a(({row:l})=>{var H;return[t(re,{content:l.operate+((H=l.operation_object)!=null&&H.name?`【${l.operation_object.name}】`:""),effect:"dark",placement:"top"},{default:a(()=>{var pe;return[n("span",ul,r(l.operate+((pe=l.operation_object)!=null&&pe.name?`【${l.operation_object.name}】`:"")),1)]}),_:2},1032,["content"])]}),_:1},8,["label"]),t(k,{width:"120",prop:"user.username",label:e.$t("views.operateLog.table.user.label")},null,8,["label"]),d(_).isEE()?(u(),f(k,{key:0,width:"200",prop:"workspace_name",label:e.$t("views.workspace.title")},{header:a(()=>[n("div",null,[n("span",null,r(e.$t("views.workspace.title")),1),t(ie,{width:200,trigger:"click",visible:S.value},{reference:a(()=>[t(v,{style:{"margin-top":"-2px"},type:p.value&&p.value.length>0?"primary":"",link:"",onClick:o[10]||(o[10]=l=>S.value=!S.value)},{default:a(()=>[t(ae,null,{default:a(()=>[t(te)]),_:1})]),_:1},8,["type"])]),default:a(()=>[n("div",pl,[n("div",dl,[n("div",{onClick:o[12]||(o[12]=z(()=>{},["stop"]))},[t(se,{height:"300",style:{margin:"0 0 0 10px"}},{default:a(()=>[t(ne,{modelValue:p.value,"onUpdate:modelValue":o[11]||(o[11]=l=>p.value=l),style:{display:"flex","flex-direction":"column"}},{default:a(()=>[(u(!0),$(T,null,M(q.value,l=>(u(),f(oe,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",cl,[t(v,{size:"small",onClick:o[13]||(o[13]=l=>Q("clear"))},{default:a(()=>[g(r(e.$t("common.clear")),1)]),_:1}),t(v,{type:"primary",onClick:Q,size:"small"},{default:a(()=>[g(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):ce("",!0),t(k,{prop:"status",label:e.$t("views.operateLog.table.status.label"),width:"100"},{default:a(({row:l})=>[l.status===200?(u(),$("span",vl,r(e.$t("views.operateLog.table.status.success")),1)):(u(),$("span",ml,r(e.$t("views.operateLog.table.status.fail")),1))]),_:1},8,["label"]),t(k,{prop:"ip_address",label:e.$t("views.operateLog.table.ip_address.label"),width:"160"},null,8,["label"]),t(k,{label:e.$t("views.operateLog.table.operateTime.label"),width:"180"},{default:a(({row:l})=>[g(r(d(Ye)(l.create_time)),1)]),_:1},8,["label"]),t(k,{label:e.$t("common.operation"),width:"60",align:"left",fixed:"right"},{default:a(({row:l})=>[n("span",_l,[t(re,{effect:"dark",content:e.$t("views.operateLog.table.opt.label"),placement:"top"},{default:a(()=>[t(v,{type:"primary",text:"",onClick:z(H=>$e(l),["stop"]),class:"text-button"},{default:a(()=>[t(xe,{iconName:"app-operate-log"})]),_:1},8,["onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[Te,V.value]])]),t(Ze,{ref_key:"DetailDialogRef",ref:C},null,512)]),_:1}),t(Ie,{title:e.$t("views.chatLog.buttons.clearStrategy"),modelValue:E.value,"onUpdate:modelValue":o[16]||(o[16]=l=>E.value=l),width:"25%","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[n("div",bl,[t(v,{onClick:o[15]||(o[15]=l=>E.value=!1)},{default:a(()=>[g(r(e.$t("common.cancel")),1)]),_:1}),t(v,{type:"primary",onClick:De},{default:a(()=>[g(r(e.$t("common.save")),1)]),_:1})])]),default:a(()=>[n("span",null,r(e.$t("common.delete")),1),t(Pe,{modelValue:U.value,"onUpdate:modelValue":o[14]||(o[14]=l=>U.value=l),"controls-position":"right",min:1,max:1e5,"value-on-clear":0,"step-strictly":"",style:{width:"110px","margin-left":"8px","margin-right":"8px"}},null,8,["modelValue"]),n("span",null,r(e.$t("views.chatLog.daysText")),1)]),_:1},8,["title","modelValue"])])}}}),hl=Fe(fl,[["__scopeId","data-v-4b723511"]]);export{hl as default};
