import{ay as x,aP as re,aO as X,aB as r,aV as oe,aD as i,aE as k,aF as f,aG as e,aI as m,aW as Q,b1 as A,aH as t,aR as Se,aK as $,aJ as d,aT as Z,b3 as te,aC as D,aZ as ae,aU as $e,aS as N,b7 as he,b8 as pe,aX as Ne,aY as ze,ce as Be,dv as Le,dw as Ye,d0 as me,c1 as be,aA as qe,aQ as Re,b2 as ke,dx as De,c0 as Ie,dy as Te,ci as je,cg as Oe,cf as He}from"./admin-Ca7cl6NN.js";import{_ as Je}from"./FieldFormDialog.vue_vue_type_script_setup_true_lang-CSIjR58s.js";const We={key:0},Ul=x({__name:"InitParamDrawer",emits:["refresh"],setup(j,{expose:E,emit:M}){const R=M,S=re(),I=X(()=>S.path.includes("shared")?"systemShare":S.path.includes("resource-management")?"systemManage":"workspace"),V=r(),c=r(!1),h=r(!1),g=r({init_params:{}});oe(h,p=>{p||(g.value={init_params:{},is_active:!1})});const F=async()=>{V.value.validate().then(()=>{var p;Z({type:"tool",systemType:I.value}).putTool((p=g.value)==null?void 0:p.id,g.value,c).then(_=>{te(D("common.editSuccess")),R("refresh"),h.value=!1})})};return E({open:(p,_)=>{p&&(g.value=ae.cloneDeep(p),g.value.is_active=_);const b=g.value.init_field_list.map(n=>n.show_default_value===!1?{[n.field]:void 0}:{[n.field]:n.default_value}).reduce((n,o)=>({...n,...o}),{});g.value.init_params={...b,...g.value.init_params},h.value=!0}}),(p,_)=>{const b=i("el-button"),n=i("el-drawer");return f(),k(n,{modelValue:h.value,"onUpdate:modelValue":_[2]||(_[2]=o=>h.value=o),size:"60%","append-to-body":!0},{header:e(()=>[m("h4",null,d(p.$t("common.param.initParam")),1)]),footer:e(()=>[m("div",null,[t(b,{type:"primary",onClick:_[1]||(_[1]=o=>F()),loading:c.value},{default:e(()=>[$(d(p.$t("common.save")),1)]),_:1},8,["loading"])])]),default:e(()=>{var o;return[m("div",null,[((o=g.value.init_field_list)==null?void 0:o.length)>0?(f(),Q("div",We,[t(Se,{modelValue:g.value.init_params,"onUpdate:modelValue":_[0]||(_[0]=s=>g.value.init_params=s),model:g.value.init_params,"label-position":"top","require-asterisk-position":"right",render_data:g.value.init_field_list,ref_key:"dynamicsFormRef",ref:V},null,8,["modelValue","model","render_data"])])):A("",!0)])]}),_:1},8,["modelValue"])}}}),Ge={class:"dialog-footer"},Pl=x({__name:"AddInternalToolDialog",emits:["refresh"],setup(j,{expose:E,emit:M}){const R=M,S=r(),I=r(!1),V=r(!1),c=r({name:""}),h=$e({name:[{required:!0,message:D("views.tool.form.toolName.placeholder"),trigger:"blur"}]}),g=r(!1);oe(g,p=>{p||(c.value={name:""})});const F=(p,_)=>{p&&(c.value=ae.cloneDeep(p)),V.value=_||!1,g.value=!0},w=async p=>{p&&await p.validate(_=>{_&&(R("refresh",c.value,V.value),g.value=!1)})};return E({open:F}),(p,_)=>{const b=i("el-input"),n=i("el-form-item"),o=i("el-form"),s=i("el-button"),T=i("el-dialog");return f(),k(T,{title:p.$t("views.tool.form.toolName.name"),modelValue:g.value,"onUpdate:modelValue":_[3]||(_[3]=U=>g.value=U),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0,"append-to-body":"",width:"450"},{footer:e(()=>[m("span",Ge,[t(s,{onClick:_[1]||(_[1]=N(U=>g.value=!1,["prevent"]))},{default:e(()=>[$(d(p.$t("common.cancel")),1)]),_:1}),t(s,{type:"primary",onClick:_[2]||(_[2]=U=>w(S.value)),loading:I.value},{default:e(()=>[$(d(V.value?p.$t("common.save"):p.$t("common.add")),1)]),_:1},8,["loading"])])]),default:e(()=>[t(o,{"label-position":"top",ref_key:"fieldFormRef",ref:S,rules:h,model:c.value,"require-asterisk-position":"right"},{default:e(()=>[t(n,{prop:"name",label:p.$t("common.name")},{default:e(()=>[t(b,{modelValue:c.value.name,"onUpdate:modelValue":_[0]||(_[0]=U=>c.value.name=U),maxlength:"64","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Ke={class:"flex align-center",style:{"margin-left":"-8px"}},Qe={key:0,class:"mb-16"},Xe={class:"title-decoration-1 mb-16"},Ze={key:1,class:"mb-16"},xe={class:"title-decoration-1 mb-16"},el={class:"flex"},ll={key:0,class:"color-danger"},tl={key:2,class:"mt-8"},ol={class:"title-decoration-1 mb-16 mt-16"},al={class:"mb-16"},nl={class:"lighter mb-8"},sl=x({__name:"ToolDebugDrawer",setup(j,{expose:E}){const M=re(),R=X(()=>M.path.includes("shared")?"systemShare":M.path.includes("resource-management")?"systemManage":"workspace"),S=r(),I=r(),V=r(!1),c=r(!1),h=r(!1),g=r(!1),F=r(""),w=r({debug_field_list:[],code:"",input_field_list:[],init_field_list:[],init_params:{}});oe(c,b=>{b||(h.value=!1,g.value=!1,F.value="",w.value={debug_field_list:[],code:"",input_field_list:[],init_field_list:[],init_params:{}})});const p=async b=>{var o;const n=b?b.validate():Promise.resolve();Promise.all([(o=I.value)==null?void 0:o.validate(),n]).then(()=>{Z({type:"tool",systemType:R.value}).postToolDebug(w.value,V).then(s=>{s.code===500?(h.value=!0,g.value=!1,F.value=s.message):(h.value=!0,g.value=!0,F.value=s.data)})})};return E({open:b=>{b.input_field_list.length>0&&b.input_field_list.forEach(n=>{w.value.debug_field_list.push({value:"",...n})}),w.value.code=b.code,w.value.input_field_list=b.input_field_list,w.value.init_field_list=b.init_field_list,c.value=!0}}),(b,n)=>{const o=i("Back"),s=i("el-icon"),T=i("el-button"),U=i("el-card"),q=i("el-tag"),J=i("el-input"),y=i("el-form-item"),ee=i("el-form"),B=i("el-alert"),ue=i("el-drawer"),C=he("loading");return f(),k(ue,{modelValue:c.value,"onUpdate:modelValue":n[4]||(n[4]=u=>c.value=u),size:"60%","append-to-body":!0,modal:!1,"show-close":!1},{header:e(()=>[m("div",Ke,[t(T,{class:"cursor mr-4",link:"",onClick:n[0]||(n[0]=N(u=>c.value=!1,["prevent"]))},{default:e(()=>[t(s,{size:20},{default:e(()=>[t(o)]),_:1})]),_:1}),m("h4",null,d(b.$t("common.debug")),1)])]),default:e(()=>[m("div",null,[w.value.init_field_list.length>0?(f(),Q("div",Qe,[m("h4",Xe,d(b.$t("common.param.initParam")),1),t(U,{shadow:"never",class:"card-never",style:{"--el-card-padding":"12px"}},{default:e(()=>[t(Se,{modelValue:w.value.init_params,"onUpdate:modelValue":n[1]||(n[1]=u=>w.value.init_params=u),model:w.value.init_params,"label-position":"top","require-asterisk-position":"right",render_data:w.value.init_field_list,ref_key:"dynamicsFormRef",ref:I},null,8,["modelValue","model","render_data"])]),_:1})])):A("",!0),w.value.debug_field_list.length>0?(f(),Q("div",Ze,[m("h4",xe,d(b.$t("common.param.inputParam")),1),t(U,{shadow:"never",class:"card-never",style:{"--el-card-padding":"12px"}},{default:e(()=>[pe((f(),k(ee,{ref_key:"FormRef",ref:S,model:w.value,"label-position":"top","require-asterisk-position":"right","hide-required-asterisk":"",onSubmit:n[2]||(n[2]=N(()=>{},["prevent"]))},{default:e(()=>[(f(!0),Q(Ne,null,ze(w.value.debug_field_list,(u,O)=>(f(),k(y,{key:O,label:u.name,prop:"debug_field_list."+O+".value",rules:{required:u.is_required,message:b.$t("views.tool.form.param.inputPlaceholder"),trigger:"blur"}},{label:e(()=>[m("div",el,[m("span",null,[$(d(u.name)+" ",1),u.is_required?(f(),Q("span",ll,"*")):A("",!0)]),t(q,{type:"info",class:"info-tag ml-4"},{default:e(()=>[$(d(u.type),1)]),_:2},1024)])]),default:e(()=>[t(J,{modelValue:u.value,"onUpdate:modelValue":H=>u.value=H,placeholder:b.$t("views.tool.form.param.inputPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop","rules"]))),128))]),_:1},8,["model"])),[[C,V.value]])]),_:1})])):A("",!0),t(T,{type:"primary",onClick:n[3]||(n[3]=u=>p(S.value)),loading:V.value},{default:e(()=>[$(d(b.$t("views.tool.form.debug.run")),1)]),_:1},8,["loading"]),h.value?(f(),Q("div",tl,[m("h4",ol,d(b.$t("views.tool.form.debug.runResult")),1),m("div",al,[g.value?(f(),k(B,{key:0,title:b.$t("views.tool.form.debug.runSuccess"),type:"success","show-icon":"",closable:!1},null,8,["title"])):(f(),k(B,{key:1,title:b.$t("views.tool.form.debug.runFailed"),type:"error","show-icon":"",closable:!1},null,8,["title"]))]),m("p",nl,d(b.$t("views.tool.form.debug.output")),1),t(U,{class:Be([g.value?"":"color-danger","pre-wrap"]),shadow:"never"},{default:e(()=>[$(d(String(F.value)=="0"?0:F.value||"-"),1)]),_:1},8,["class"])])):A("",!0)])]),_:1},8,["modelValue"])}}}),il={class:"dialog-footer"},rl=x({__name:"UserFieldFormDialog",emits:["refresh"],setup(j,{expose:E,emit:M}){const R=M,S=r(),I=r(!1),V=r(!1),c=r(),h=(o,s)=>o.every(T=>Ye.get(s,T,void 0)!==void 0),g=X(()=>{if(c.value){const o=c.value;switch(o.type){case"input":return h(["field","input_type","label","required","attrs"],c.value)?c.value:{attrs:o.attrs||{maxlength:200,minlength:0},field:o.field||o.variable,input_type:"TextInput",label:o.label||o.name,default_value:o.default_value,required:o.required!=null?o.required:o.is_required};case"select":return h(["field","input_type","label","required","option_list"],c.value)?c.value:{attrs:o.attrs||{},field:o.field||o.variable,input_type:"SingleSelect",label:o.label||o.name,default_value:o.default_value,required:o.required!=null?o.required:o.is_required,option_list:o.option_list?o.option_list:o.optionList.map(s=>({key:s,value:s}))};case"date":return h(["field","input_type","label","required","attrs.format","attrs.value-format","attrs.type"],c.value)?c.value:{field:o.field||o.variable,input_type:"DatePicker",label:o.label||o.name,default_value:o.default_value,required:o.required!=null?o.required:o.is_required,attrs:{format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",type:"datetime"}};default:return c.value}}else return{input_type:"TextInput",required:!1,attrs:{maxlength:200,minlength:0},show_default_value:!0}}),F=r(null),w=r([{label:D("dynamicsForm.input_type_list.TextInput"),value:"TextInputConstructor"},{label:D("dynamicsForm.input_type_list.PasswordInput"),value:"PasswordInputConstructor"},{label:D("dynamicsForm.input_type_list.SingleSelect"),value:"SingleSelectConstructor"},{label:D("dynamicsForm.input_type_list.MultiSelect"),value:"MultiSelectConstructor"},{label:D("dynamicsForm.input_type_list.RadioCard"),value:"RadioCardConstructor"},{label:D("dynamicsForm.input_type_list.DatePicker"),value:"DatePickerConstructor"},{label:D("dynamicsForm.input_type_list.SwitchInput"),value:"SwitchInputConstructor"}]),p=r(!1),_=(o,s)=>{p.value=!0,o?(V.value=!0,c.value=ae.cloneDeep(o),F.value=s):c.value=null},b=()=>{p.value=!1,V.value=!1,F.value=null,c.value=null},n=async()=>{const o=S.value;o&&await o.validate().then(()=>{R("refresh",o==null?void 0:o.getData(),F.value),V.value=!1,c.value=null,F.value=null})};return E({open:_,close:b}),(o,s)=>{const T=i("el-button"),U=i("el-dialog");return f(),k(U,{title:V.value?o.$t("common.param.editParam"):o.$t("common.param.addParam"),modelValue:p.value,"onUpdate:modelValue":s[2]||(s[2]=q=>p.value=q),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0,"before-close":b,"append-to-body":""},{footer:e(()=>[m("span",il,[t(T,{onClick:N(b,["prevent"])},{default:e(()=>[$(d(o.$t("common.cancel")),1)]),_:1}),t(T,{type:"primary",onClick:s[1]||(s[1]=q=>n()),loading:I.value},{default:e(()=>[$(d(V.value?o.$t("common.save"):o.$t("common.add")),1)]),_:1},8,["loading"])])]),default:e(()=>[t(Le,{modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=q=>g.value=q),"label-position":"top","require-asterisk-position":"right",input_type_list:w.value,ref_key:"DynamicsFormConstructorRef",ref:S},null,8,["modelValue","input_type_list"])]),_:1},8,["title","modelValue"])}}}),ul={class:"flex mt-8"},dl=["src"],ml={class:"el-upload__tip info mt-8"},pl={class:"dialog-footer"},Ae=x({__name:"EditAvatarDialog",props:{iconType:{}},emits:["refresh"],setup(j,{expose:E,emit:M}){const R=M,S=re(),I=r(null),V=r(null),c=r(!1),h=r(!1),g=r(null),F=r("default"),w=X(()=>S.path.includes("shared")?"systemShare":S.path.includes("resource-management")?"systemManage":"workspace");X(()=>S.path.includes("shared")),oe(c,n=>{n||(I.value=null,V.value=null)});const p=n=>{F.value=me(n.icon)?"custom":"default",V.value=me(n.icon)?n.icon:null,g.value=ae.cloneDeep(n),c.value=!0},_=n=>{if((n==null?void 0:n.size)/1024/1024<10)I.value=n,V.value=URL.createObjectURL(n.raw);else return be(D("common.EditAvatarDialog.fileSizeExceeded")),!1};function b(){if(F.value==="default")R("refresh",""),c.value=!1;else if(F.value==="custom"&&I.value){const n=new FormData;n.append("file",I.value.raw),Z({type:"tool",systemType:w.value}).putToolIcon(g.value.id,n,h).then(o=>{R("refresh",o.data),c.value=!1})}else be(D("common.EditAvatarDialog.uploadImagePrompt"))}return E({open:p}),(n,o)=>{const s=i("ToolIcon"),T=i("el-radio"),U=i("el-avatar"),q=i("el-button"),J=i("el-upload"),y=i("el-radio-group"),ee=i("el-dialog");return f(),k(ee,{title:`Logo ${n.$t("common.setting")}`,modelValue:c.value,"onUpdate:modelValue":o[2]||(o[2]=B=>c.value=B),"close-on-click-modal":!1,"close-on-press-escape":!1,width:"550"},{footer:e(()=>[m("span",pl,[t(q,{onClick:o[1]||(o[1]=N(B=>c.value=!1,["prevent"]))},{default:e(()=>[$(d(n.$t("common.cancel")),1)]),_:1}),t(q,{type:"primary",onClick:b,loading:h.value},{default:e(()=>[$(d(n.$t("common.save")),1)]),_:1},8,["loading"])])]),default:e(()=>[t(y,{modelValue:F.value,"onUpdate:modelValue":o[0]||(o[0]=B=>F.value=B),class:"radio-block mb-16"},{default:e(()=>[t(T,{value:"default"},{default:e(()=>[m("p",null,d(n.$t("common.EditAvatarDialog.default")),1),t(s,{size:32,type:j.iconType},null,8,["type"])]),_:1}),t(T,{value:"custom"},{default:e(()=>[m("p",null,d(n.$t("common.EditAvatarDialog.customizeUpload")),1),m("div",ul,[V.value?(f(),k(U,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-16"},{default:e(()=>[m("img",{src:V.value,alt:""},null,8,dl)]),_:1})):A("",!0),t(J,{ref:"uploadRef",action:"#","auto-upload":!1,"show-file-list":!1,accept:"image/jpeg, image/png, image/gif","on-change":_},{default:e(()=>[t(q,{icon:"Upload",disabled:F.value!=="custom"},{default:e(()=>[$(d(n.$t("common.EditAvatarDialog.upload")),1)]),_:1},8,["disabled"])]),_:1},512)]),m("div",ml,d(n.$t("common.EditAvatarDialog.sizeTip")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["title","modelValue"])}}}),cl={class:"title-decoration-1 mb-16"},fl={class:"flex w-full"},vl=["src"],_l={class:"flex-between"},yl={class:"title-decoration-1 mb-16"},gl=["title"],bl={class:"mr-4"},$l={class:"flex-between"},hl={class:"title-decoration-1 mb-16"},kl={class:"mr-4"},wl={class:"title-decoration-1 mb-16"},Vl={key:0,class:"mb-8"},Cl={class:"title-decoration-1 mb-16 mt-16"},Fl={class:"flex-between border-r-6 p-8-12 mb-8 layout-bg lighter"},El=x({__name:"ToolFormDrawer",props:{title:String},emits:["refresh"],setup(j,{expose:E,emit:M}){const R=re(),{folder:S,user:I}=qe(),V=X(()=>R.path.includes("shared")?"systemShare":R.path.includes("resource-management")?"systemManage":"workspace"),c=X(()=>Re.tool[V.value]),h=M,g=r(),F=r(),w=r(),p=r(),_=r(),b=r(),n=r(),o=r(!1),s=r(!1),T=r(!1),U=r(!1),q=r(null),J=r(!1),y=r({name:"",desc:"",code:"",icon:"",input_field_list:[],init_field_list:[]});oe(T,l=>{var a;l||(o.value=!1,U.value=!1,q.value=null,y.value={name:"",desc:"",code:"",icon:"",input_field_list:[],init_field_list:[]},(a=n.value)==null||a.clearValidate())});const ee=$e({name:[{required:!0,message:D("views.tool.form.toolName.requiredMessage"),trigger:"blur"}]});function B(l){y.value.code=l}function ue(){C(y.value)?Ie(D("common.tip"),D("views.tool.tip.saveMessage"),{confirmButtonText:D("common.confirm")}).then(()=>{T.value=!1}).catch(()=>{}):T.value=!1}function C(l){return Object.values(l).some(a=>Array.isArray(a)?a.length!==0:a!=null&&a!=="")}function u(){F.value.open(y.value)}function O(l){var a;(a=y.value.input_field_list)==null||a.splice(l,1)}function H(l,a){typeof a<"u"&&(q.value=a),g.value.open(l)}function z(l){var a,L;q.value!==null?(a=y.value.input_field_list)==null||a.splice(q.value,1,l):(L=y.value.input_field_list)==null||L.push(l),q.value=null}function le(l,a){typeof a<"u"&&(q.value=a),w.value.open(l)}function ne(l){var a,L;q.value!==null?(a=y.value.init_field_list)==null||a.splice(q.value,1,l):(L=y.value.init_field_list)==null||L.push(l),q.value=null,w.value.close()}function ce(l){y.value.icon=l}function fe(l){var a;(a=y.value.init_field_list)==null||a.splice(l,1)}function se(){p.value.open(y.value)}const ve=async l=>{l&&await l.validate(a=>{var L,ie;if(a)if(s.value=!0,o.value)Z({type:"tool",systemType:V.value}).putTool((L=y.value)==null?void 0:L.id,y.value).then(Y=>(te(D("common.editSuccess")),h("refresh",Y.data),I.profile())).then(()=>{T.value=!1}).finally(()=>{s.value=!1});else{const Y={folder_id:(ie=S.currentFolder)==null?void 0:ie.id,...y.value};Z({type:"tool",systemType:V.value}).postTool(Y).then(_e=>(te(D("common.createSuccess")),h("refresh"),I.profile())).then(()=>{T.value=!1}).finally(()=>{s.value=!1})}})};return E({open:l=>{l&&(o.value=!!(l!=null&&l.id),y.value=ae.cloneDeep(l)),T.value=!0,setTimeout(()=>{U.value=!0},100)}}),(l,a)=>{const L=i("el-Avatar"),ie=i("el-avatar"),Y=i("AppIcon"),_e=i("el-input"),Ve=i("el-form-item"),Me=i("el-form"),W=i("el-button"),G=i("el-table-column"),K=i("el-tag"),Ce=i("el-switch"),de=i("el-tooltip"),Fe=i("el-table"),ye=i("el-text"),Ue=i("CodemirrorEditor"),Pe=i("el-drawer"),Ee=he("loading");return f(),k(Pe,{modelValue:T.value,"onUpdate:modelValue":a[14]||(a[14]=v=>T.value=v),size:"60%","before-close":ue},{header:e(()=>[m("h4",null,d(j.title),1)]),footer:e(()=>{var v;return[m("div",null,[t(W,{loading:s.value,onClick:a[12]||(a[12]=P=>T.value=!1)},{default:e(()=>[$(d(l.$t("common.cancel")),1)]),_:1},8,["loading"]),c.value.debug()?(f(),k(W,{key:0,loading:s.value,onClick:u},{default:e(()=>[$(d(l.$t("common.debug")),1)]),_:1},8,["loading"])):A("",!0),(o.value?c.value.edit((v=y.value)==null?void 0:v.id):c.value.create())?(f(),k(W,{key:1,type:"primary",onClick:a[13]||(a[13]=P=>ve(n.value)),loading:s.value},{default:e(()=>[$(d(o.value?l.$t("common.save"):l.$t("common.create")),1)]),_:1},8,["loading"])):A("",!0)])]}),default:e(()=>[m("div",null,[m("h4",cl,d(l.$t("views.model.modelForm.title.baseInfo")),1),pe((f(),k(Me,{ref_key:"FormRef",ref:n,model:y.value,rules:ee,"label-position":"top","require-asterisk-position":"right",onSubmit:a[6]||(a[6]=N(()=>{},["prevent"]))},{default:e(()=>[t(Ve,{label:l.$t("views.tool.form.toolName.label"),prop:"name"},{default:e(()=>[m("div",fl,[y.value.id?(f(),Q("div",{key:0,class:"edit-avatar mr-12",onMouseenter:a[0]||(a[0]=v=>J.value=!0),onMouseleave:a[1]||(a[1]=v=>J.value=!1)},[ke(me)(y.value.icon)?(f(),k(L,{key:0,id:y.value.id,shape:"square",size:32,style:{background:"none"}},{default:e(()=>[m("img",{src:String(y.value.icon),alt:""},null,8,vl)]),_:1},8,["id"])):(f(),k(ie,{key:1,class:"avatar-green",shape:"square",size:32},{default:e(()=>[...a[15]||(a[15]=[m("img",{src:De,style:{width:"58%"},alt:""},null,-1)])]),_:1})),J.value?(f(),k(L,{key:2,id:y.value.id,shape:"square",class:"edit-mask",size:32,onClick:se},{default:e(()=>[t(Y,{iconName:"app-edit"})]),_:1},8,["id"])):A("",!0)],32)):(f(),k(ie,{key:1,class:"avatar-green mr-12",shape:"square",size:32},{default:e(()=>[...a[16]||(a[16]=[m("img",{src:De,style:{width:"58%"},alt:""},null,-1)])]),_:1})),t(_e,{modelValue:y.value.name,"onUpdate:modelValue":a[2]||(a[2]=v=>y.value.name=v),placeholder:l.$t("views.tool.form.toolName.placeholder"),maxlength:"64","show-word-limit":"",onBlur:a[3]||(a[3]=v=>{var P;return y.value.name=(P=y.value.name)==null?void 0:P.trim()})},null,8,["modelValue","placeholder"])])]),_:1},8,["label"]),t(Ve,{label:l.$t("common.desc")},{default:e(()=>[t(_e,{modelValue:y.value.desc,"onUpdate:modelValue":a[4]||(a[4]=v=>y.value.desc=v),type:"textarea",placeholder:l.$t("views.tool.form.toolDescription.placeholder"),maxlength:"128","show-word-limit":"",autosize:{minRows:3},onBlur:a[5]||(a[5]=v=>{var P;return y.value.desc=(P=y.value.desc)==null?void 0:P.trim()})},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[Ee,s.value]]),m("div",_l,[m("h4",yl,d(l.$t("common.param.initParam")),1),t(W,{link:"",type:"primary",onClick:a[7]||(a[7]=v=>le())},{default:e(()=>[t(Y,{iconName:"app-add-outlined",class:"mr-4"}),$(" "+d(l.$t("common.add")),1)]),_:1})]),t(Fe,{ref_key:"initFieldTableRef",ref:_,data:y.value.init_field_list,class:"mb-16"},{default:e(()=>[t(G,{prop:"field",label:l.$t("dynamicsForm.paramForm.field.label")},{default:e(({row:v})=>[m("span",{title:v.field,class:"ellipsis-1"},d(v.field),9,gl)]),_:1},8,["label"]),t(G,{label:l.$t("dynamicsForm.paramForm.input_type.label")},{default:e(({row:v})=>[v.input_type==="TextInput"?(f(),k(K,{key:0,type:"info",class:"info-tag"},{default:e(()=>[$(d(l.$t("dynamicsForm.input_type_list.TextInput")),1)]),_:1})):A("",!0),v.input_type==="PasswordInput"?(f(),k(K,{key:1,type:"info",class:"info-tag"},{default:e(()=>[$(d(l.$t("dynamicsForm.input_type_list.PasswordInput")),1)]),_:1})):A("",!0),v.input_type==="Slider"?(f(),k(K,{key:2,type:"info",class:"info-tag"},{default:e(()=>[$(d(l.$t("dynamicsForm.input_type_list.Slider")),1)]),_:1})):A("",!0),v.input_type==="SwitchInput"?(f(),k(K,{key:3,type:"info",class:"info-tag"},{default:e(()=>[$(d(l.$t("dynamicsForm.input_type_list.SwitchInput")),1)]),_:1})):A("",!0),v.input_type==="SingleSelect"?(f(),k(K,{key:4,type:"info",class:"info-tag"},{default:e(()=>[$(d(l.$t("dynamicsForm.input_type_list.SingleSelect")),1)]),_:1})):A("",!0),v.input_type==="MultiSelect"?(f(),k(K,{key:5,type:"info",class:"info-tag"},{default:e(()=>[$(d(l.$t("dynamicsForm.input_type_list.MultiSelect")),1)]),_:1})):A("",!0),v.input_type==="RadioCard"?(f(),k(K,{key:6,type:"info",class:"info-tag"},{default:e(()=>[$(d(l.$t("dynamicsForm.input_type_list.RadioCard")),1)]),_:1})):A("",!0),v.input_type==="DatePicker"?(f(),k(K,{key:7,type:"info",class:"info-tag"},{default:e(()=>[$(d(l.$t("dynamicsForm.input_type_list.DatePicker")),1)]),_:1})):A("",!0)]),_:1},8,["label"]),t(G,{label:l.$t("common.required")},{default:e(({row:v})=>[m("div",{onClick:a[8]||(a[8]=N(()=>{},["stop"]))},[t(Ce,{disabled:"",size:"small",modelValue:v.required,"onUpdate:modelValue":P=>v.required=P},null,8,["modelValue","onUpdate:modelValue"])])]),_:1},8,["label"]),t(G,{label:l.$t("common.operation"),align:"left",width:"90"},{default:e(({row:v,$index:P})=>[m("span",bl,[t(de,{effect:"dark",content:l.$t("common.modify"),placement:"top"},{default:e(()=>[t(W,{type:"primary",text:"",onClick:N(ge=>le(v,P),["stop"])},{default:e(()=>[t(Y,{iconName:"app-edit"})]),_:1},8,["onClick"])]),_:2},1032,["content"])]),t(de,{effect:"dark",content:l.$t("common.delete"),placement:"top"},{default:e(()=>[t(W,{type:"primary",text:"",onClick:ge=>fe(P)},{default:e(()=>[t(Y,{iconName:"app-delete"})]),_:1},8,["onClick"])]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data"]),m("div",$l,[m("h4",hl,[$(d(l.$t("common.param.inputParam"))+" ",1),t(ye,{type:"info",class:"color-secondary"},{default:e(()=>[$(d(l.$t("views.tool.form.param.paramInfo1")),1)]),_:1})]),t(W,{link:"",type:"primary",onClick:a[9]||(a[9]=v=>H())},{default:e(()=>[t(Y,{iconName:"app-add-outlined",class:"mr-4"}),$(" "+d(l.$t("common.add")),1)]),_:1})]),t(Fe,{ref_key:"inputFieldTableRef",ref:b,data:y.value.input_field_list,class:"mb-16"},{default:e(()=>[t(G,{prop:"name",label:l.$t("views.tool.form.paramName.label")},null,8,["label"]),t(G,{label:l.$t("views.tool.form.dataType.label")},{default:e(({row:v})=>[t(K,{type:"info",class:"info-tag"},{default:e(()=>[$(d(v.type),1)]),_:2},1024)]),_:1},8,["label"]),t(G,{label:l.$t("common.required")},{default:e(({row:v})=>[m("div",{onClick:a[10]||(a[10]=N(()=>{},["stop"]))},[t(Ce,{size:"small",modelValue:v.is_required,"onUpdate:modelValue":P=>v.is_required=P},null,8,["modelValue","onUpdate:modelValue"])])]),_:1},8,["label"]),t(G,{prop:"source",label:l.$t("views.tool.form.source.label")},{default:e(({row:v})=>[$(d(v.source==="custom"?l.$t("common.custom"):l.$t("views.tool.form.source.reference")),1)]),_:1},8,["label"]),t(G,{label:l.$t("common.operation"),align:"left",width:"90"},{default:e(({row:v,$index:P})=>[m("span",kl,[t(de,{effect:"dark",content:l.$t("common.modify"),placement:"top"},{default:e(()=>[t(W,{type:"primary",text:"",onClick:N(ge=>H(v,P),["stop"])},{default:e(()=>[t(Y,{iconName:"app-edit"})]),_:1},8,["onClick"])]),_:2},1032,["content"])]),t(de,{effect:"dark",content:l.$t("common.delete"),placement:"top"},{default:e(()=>[t(W,{type:"primary",text:"",onClick:ge=>O(P)},{default:e(()=>[t(Y,{iconName:"app-delete"})]),_:1},8,["onClick"])]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data"]),m("h4",wl,[$(d(l.$t("views.tool.form.param.code"))+" ",1),a[17]||(a[17]=m("span",{class:"color-danger",style:{"margin-left":"-10px"}},"*",-1)),t(ye,{type:"info",class:"color-secondary"},{default:e(()=>[$(d(l.$t("views.tool.form.param.paramInfo2")),1)]),_:1})]),U.value?(f(),Q("div",Vl,[t(Ue,{title:l.$t("views.tool.form.param.code"),modelValue:y.value.code,"onUpdate:modelValue":a[11]||(a[11]=v=>y.value.code=v),onSubmitDialog:B},null,8,["title","modelValue"])])):A("",!0),m("h4",Cl,[$(d(l.$t("common.param.outputParam"))+" ",1),t(ye,{type:"info",class:"color-secondary"},{default:e(()=>[$(d(l.$t("views.tool.form.param.paramInfo1")),1)]),_:1})]),m("div",Fl,[m("span",null,d(l.$t("common.result"))+" {result}",1)])]),t(sl,{ref_key:"ToolDebugDrawerRef",ref:F},null,512),t(Je,{ref_key:"FieldFormDialogRef",ref:g,onRefresh:z},null,512),t(rl,{ref_key:"UserFieldFormDialogRef",ref:w,onRefresh:ne},null,512),t(Ae,{ref_key:"EditAvatarDialogRef",ref:p,onRefresh:ce},null,512)]),_:1},8,["modelValue"])}}}),Dl={class:"title-decoration-1 mb-16"},Tl={class:"flex w-full"},Sl=["src"],ql={class:"title-decoration-1 mb-16"},Rl=`{
  "math": {
    "url": "your_server",
    "transport": "sse"
  }
}`,Nl=x({__name:"McpToolFormDrawer",props:{title:String},emits:["refresh"],setup(j,{expose:E,emit:M}){const R=re(),{folder:S,user:I}=qe(),V=X(()=>R.path.includes("shared")?"systemShare":R.path.includes("resource-management")?"systemManage":"workspace"),c=X(()=>Re.tool[V.value]),h=M,g=r(),F=r(),w=r(!1),p=r(!1),_=r(!1),b=r(!1),n=r(null),o=r(!1),s=r({name:"",desc:"",code:"",icon:"",input_field_list:[],init_field_list:[],tool_type:"MCP"});oe(_,C=>{var u;C||(w.value=!1,b.value=!1,n.value=null,s.value={name:"",desc:"",code:"",icon:"",input_field_list:[],init_field_list:[],tool_type:"MCP"},(u=F.value)==null||u.clearValidate())});const T=$e({name:[{required:!0,message:D("views.tool.form.mcpName.requiredMessage"),trigger:"blur"}],code:[{required:!0,message:D("views.tool.form.mcp.requiredMessage"),trigger:"blur"}]});function U(){q(s.value)?Ie(D("common.tip"),D("views.tool.tip.saveMessage"),{confirmButtonText:D("common.confirm")}).then(()=>{_.value=!1}).catch(()=>{}):_.value=!1}function q(C){return Object.values(C).some(u=>Array.isArray(u)?u.length!==0:u!=null&&u!=="")}function J(C){s.value.icon=C}function y(){g.value.open(s.value)}const ee=async C=>{C&&await C.validate(u=>{var O,H;if(u){try{const z=JSON.parse(s.value.code);if(typeof z!="object"||z===null||Array.isArray(z))throw new Error("Code must be a valid JSON object")}catch{be(D("views.applicationWorkflow.nodes.mcpNode.mcpServerTip"));return}if(p.value=!0,w.value)Z({type:"tool",systemType:V.value}).putTool((O=s.value)==null?void 0:O.id,s.value).then(z=>(te(D("common.editSuccess")),h("refresh",z.data),I.profile())).then(()=>{_.value=!1}).finally(()=>{p.value=!1});else{const z={folder_id:(H=S.currentFolder)==null?void 0:H.id,...s.value};Z({type:"tool",systemType:V.value}).postTool(z).then(le=>(te(D("common.createSuccess")),h("refresh"),I.profile())).then(()=>{_.value=!1}).finally(()=>{p.value=!1})}}})};function B(){s.value.code&&(p.value=!0,Z({type:"tool",systemType:V.value}).postToolTestConnection({code:s.value.code},p).then(()=>{te(D("views.system.testSuccess"))}).finally(()=>{p.value=!1}))}return E({open:C=>{C&&(w.value=!!(C!=null&&C.id),s.value=ae.cloneDeep(C)),_.value=!0,setTimeout(()=>{b.value=!0},100)}}),(C,u)=>{const O=i("el-Avatar"),H=i("el-avatar"),z=i("AppIcon"),le=i("el-input"),ne=i("el-form-item"),ce=i("el-text"),fe=i("el-form"),se=i("el-button"),ve=i("el-drawer"),we=he("loading");return f(),k(ve,{modelValue:_.value,"onUpdate:modelValue":u[10]||(u[10]=l=>_.value=l),size:"60%","before-close":U},{header:e(()=>[m("h4",null,d(j.title),1)]),footer:e(()=>{var l;return[m("div",null,[t(se,{loading:p.value,onClick:B},{default:e(()=>[$(d(C.$t("views.system.test")),1)]),_:1},8,["loading"]),t(se,{loading:p.value,onClick:u[8]||(u[8]=a=>_.value=!1)},{default:e(()=>[$(d(C.$t("common.cancel")),1)]),_:1},8,["loading"]),(w.value?c.value.edit((l=s.value)==null?void 0:l.id):c.value.create())?(f(),k(se,{key:0,type:"primary",onClick:u[9]||(u[9]=a=>ee(F.value)),loading:p.value},{default:e(()=>[$(d(w.value?C.$t("common.save"):C.$t("common.create")),1)]),_:1},8,["loading"])):A("",!0)])]}),default:e(()=>[m("div",null,[m("h4",Dl,d(C.$t("views.model.modelForm.title.baseInfo")),1),pe((f(),k(fe,{ref_key:"FormRef",ref:F,model:s.value,rules:T,"label-position":"top","require-asterisk-position":"right","hide-required-asterisk":"",onSubmit:u[7]||(u[7]=N(()=>{},["prevent"]))},{default:e(()=>[t(ne,{label:C.$t("views.tool.form.mcpName.label"),prop:"name"},{default:e(()=>[m("div",Tl,[s.value.id?(f(),Q("div",{key:0,class:"edit-avatar mr-12",onMouseenter:u[0]||(u[0]=l=>o.value=!0),onMouseleave:u[1]||(u[1]=l=>o.value=!1)},[ke(me)(s.value.icon)?(f(),k(O,{key:0,id:s.value.id,shape:"square",size:32,style:{background:"none"}},{default:e(()=>[m("img",{src:String(s.value.icon),alt:""},null,8,Sl)]),_:1},8,["id"])):(f(),k(H,{key:1,shape:"square",size:32},{default:e(()=>[...u[11]||(u[11]=[m("img",{src:Te,style:{width:"75%"},alt:""},null,-1)])]),_:1})),o.value?(f(),k(O,{key:2,id:s.value.id,shape:"square",class:"edit-mask",size:32,onClick:y},{default:e(()=>[t(z,{iconName:"app-edit"})]),_:1},8,["id"])):A("",!0)],32)):(f(),k(H,{key:1,shape:"square",size:32,class:"mr-12"},{default:e(()=>[...u[12]||(u[12]=[m("img",{src:Te,style:{width:"75%"},alt:""},null,-1)])]),_:1})),t(le,{modelValue:s.value.name,"onUpdate:modelValue":u[2]||(u[2]=l=>s.value.name=l),placeholder:C.$t("views.tool.form.mcpName.placeholder"),maxlength:"64","show-word-limit":"",onBlur:u[3]||(u[3]=l=>{var a;return s.value.name=(a=s.value.name)==null?void 0:a.trim()})},null,8,["modelValue","placeholder"])])]),_:1},8,["label"]),t(ne,{label:C.$t("common.desc")},{default:e(()=>[t(le,{modelValue:s.value.desc,"onUpdate:modelValue":u[4]||(u[4]=l=>s.value.desc=l),type:"textarea",placeholder:C.$t("views.tool.form.mcpDescription.placeholder"),maxlength:"128","show-word-limit":"",autosize:{minRows:3},onBlur:u[5]||(u[5]=l=>{var a;return s.value.desc=(a=s.value.desc)==null?void 0:a.trim()})},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),m("h4",ql,d(C.$t("views.tool.form.mcp.title")),1),t(ne,{prop:"code"},{label:e(()=>[$(d(C.$t("views.tool.form.mcp.label"))+" ",1),u[13]||(u[13]=m("span",{class:"color-danger"},"*",-1)),t(ce,{type:"info",class:"color-secondary"},{default:e(()=>[$(" （"+d(C.$t("views.tool.form.mcp.tip"))+"） ",1)]),_:1})]),default:e(()=>[t(le,{modelValue:s.value.code,"onUpdate:modelValue":u[6]||(u[6]=l=>s.value.code=l),placeholder:Rl,type:"textarea",autosize:{minRows:5}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[we,p.value]])]),t(Ae,{ref_key:"EditAvatarDialogRef",ref:g,onRefresh:J,iconType:"MCP"},null,512)]),_:1},8,["modelValue"])}}}),Il=x({__name:"McpToolConfigDialog",setup(j,{expose:E}){const M=r(""),R=r(!1),S=r(!1),I=()=>{R.value=!1};return E({open:c=>{M.value=c.code,R.value=!0}}),(c,h)=>{const g=i("el-input"),F=i("AppIcon"),w=i("el-button"),p=i("el-form-item"),_=i("el-form"),b=i("el-dialog");return f(),k(b,{title:c.$t("views.tool.mcpConfig"),width:"600",modelValue:R.value,"onUpdate:modelValue":h[4]||(h[4]=n=>R.value=n),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0,"before-close":I,"append-to-body":"",class:"mcp-config-dialog"},{default:e(()=>[t(_,{"label-width":"auto","label-position":"top"},{default:e(()=>[t(p,{onMouseenter:h[2]||(h[2]=N(n=>S.value=!0,["stop"])),onMouseleave:h[3]||(h[3]=N(n=>S.value=!1,["stop"]))},{default:e(()=>[t(g,{type:"textarea",modelValue:M.value,"onUpdate:modelValue":h[0]||(h[0]=n=>M.value=n),rows:"8",disabled:"",class:"config-textarea"},null,8,["modelValue"]),pe(t(w,{circle:"",class:"copy-icon",onClick:h[1]||(h[1]=N(n=>ke(je)(M.value),["stop"]))},{default:e(()=>[t(F,{iconName:"app-copy",class:"color-secondary"})]),_:1},512),[[Oe,S.value]])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])}}}),zl=He(Il,[["__scopeId","data-v-9ce0e6a0"]]);export{zl as M,Ul as _,El as a,Nl as b,Pl as c};
