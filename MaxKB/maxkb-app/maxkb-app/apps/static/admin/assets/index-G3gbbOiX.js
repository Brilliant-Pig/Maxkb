import{a_ as J,b0 as Me,cU as Ne,ay as fe,aB as i,aD as s,aE as b,aF as u,aG as t,aI as n,aH as a,aJ as r,aS as z,aK as g,aA as Ue,aU as Ae,aC as m,b6 as Re,b7 as de,aW as $,b8 as B,b1 as ce,aX as T,aY as M,b2 as d,bJ as ve,bI as me,bK as _e,bH as Y,bZ as Ye,cQ as ze,b3 as je,cf as Fe}from"./admin-Ca7cl6NN.js";import{W as He}from"./workspace-CiflQXiK.js";const U="/operate_log",We=(h,_,c)=>J(`${U}/${h.current_page}/${h.page_size}`,_,c),Be=()=>J(`${U}/menu_operation_option/`,void 0,void 0),Je=(h,_)=>{Ne("log.xlsx",`${U}/export/`,h,void 0,_)},Ge=(h,_)=>Me(`${U}/save`,h,void 0,_),Ke=()=>J(`${U}/get_clean_time`,void 0,void 0),N={getOperateLog:We,getMenuList:Be,exportOperateLog:Je,saveCleanTime:Ge,getCleanTime:Ke},Xe={class:"border border-r-6 mb-16",style:{"white-space":"pre-wrap",height:"400px"}},qe={class:"p-16"},Qe={class:"dialog-footer mt-16"},Ze=fe({__name:"DetailDialog",setup(h,{expose:_}){const c=i(!1),f=i();return _({open:p=>{f.value=JSON.stringify(p.details,null,4),c.value=!0}}),(p,C)=>{const V=s("el-scrollbar"),D=s("el-button"),L=s("el-dialog");return u(),b(L,{title:p.$t("views.operateLog.table.opt.label"),modelValue:c.value,"onUpdate:modelValue":C[1]||(C[1]=I=>c.value=I),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[n("span",Qe,[a(D,{onClick:C[0]||(C[0]=z(I=>c.value=!1,["prevent"]))},{default:t(()=>[g(r(p.$t("views.operateLog.close")),1)]),_:1})])]),default:t(()=>[n("div",Xe,[a(V,null,{default:t(()=>[n("div",qe,r(f.value),1)]),_:1})])]),_:1},8,["title","modelValue"])}}}),el={class:"operate-log p-16-24"},ll={class:"mb-16"},al={class:"p-24"},tl={class:"flex-between"},ol={style:{display:"flex"}},nl={class:"flex-between complex-search"},sl={class:"filter"},il={class:"form-item mb-16"},rl={class:"text-right"},ul={class:"text-ellipsis"},pl={class:"filter"},dl={class:"form-item mb-16"},cl={class:"text-right"},vl={key:0},ml={key:1,style:{color:"red"}},_l={class:"mr-4"},fl={class:"dialog-footer",style:{"margin-top":"16px"}},bl=fe({__name:"index",setup(h){const{user:_}=Ue(),c=i(!1),f=i([]),S=i(!1),p=i([]),C=i(),V=i(!1),D=Ae({current_page:1,page_size:20,total:0}),L=i(""),I=i([]),A=i(7),O=i("user"),j=i(""),x=i({start_time:"",end_time:""}),G=i(""),E=i(!1),R=i(180),be=[{value:7,label:m("views.applicationOverview.monitor.pastDayOptions.past7Days")},{value:30,label:m("views.applicationOverview.monitor.pastDayOptions.past30Days")},{value:90,label:m("views.applicationOverview.monitor.pastDayOptions.past90Days")},{value:183,label:m("views.applicationOverview.monitor.pastDayOptions.past183Days")},{value:"other",label:m("common.custom")}],ge=[{value:"user",label:m("views.operateLog.table.user.label")},{value:"status",label:m("views.operateLog.table.status.label")},{value:"ip_address",label:m("views.operateLog.table.ip_address.label")}],ye=[{value:"200",label:m("views.operateLog.table.status.success")},{value:"500",label:m("views.operateLog.table.status.fail")}],K=i([]),X=i([]);function q(e){e==="clear"&&(f.value=[]),y(),c.value=!1}function Q(e){e==="clear"&&(p.value=[]),y(),S.value=!1}function he(e){y()}function we(e){O.value=e,L.value&&y()}function Z(e){e!=="other"&&(x.value.start_time=ze(e),x.value.end_time="",y())}function ke(e){x.value.start_time=e[0],x.value.end_time=e[1],y()}function $e(e){C.value.open(e)}function Ce(){D.current_page=1,y()}function ee(){const e={start_time:x.value.start_time,end_time:x.value.end_time};return L.value&&O.value!=="status"&&(e[O.value]=L.value),O.value==="status"&&(e.status=j.value),f.value.length>0&&(e.menu=JSON.stringify(f.value)),p.value.length>0&&(e.workspace_ids=JSON.stringify(p.value)),e}function y(){return N.getOperateLog(D,ee(),V).then(e=>{I.value=e.data.records,D.total=e.data.total})}function Ve(){return N.getMenuList().then(e=>{e.data.filter((w,P,F)=>P===F.findIndex(H=>H.menu===w.menu)).forEach(w=>{K.value.push({label:w.menu_label,value:w.menu})})})}const Le=()=>{N.exportOperateLog(ee(),V)};async function Oe(){if(_.isEE()){const e=await He.getSystemWorkspaceList(V);X.value=e.data.map(o=>({label:o.name,value:o.id}))}}function De(){const e={clean_time:R.value};N.saveCleanTime(e,V).then(()=>{je(m("common.saveSuccess")),E.value=!1,le()}).catch(()=>{E.value=!1})}function le(){N.getCleanTime().then(e=>{R.value=e.data})}return Re(()=>{Ve(),le(),Oe(),Z(A.value)}),(e,o)=>{const w=s("el-option"),P=s("el-select"),F=s("el-date-picker"),H=s("el-input"),v=s("el-button"),ae=s("Filter"),te=s("el-icon"),oe=s("el-checkbox"),ne=s("el-checkbox-group"),se=s("el-scrollbar"),ie=s("el-popover"),k=s("el-table-column"),re=s("el-tooltip"),xe=s("AppIcon"),Ee=s("app-table"),Se=s("el-card"),Ie=s("el-input-number"),Pe=s("el-dialog"),ue=de("hasPermission"),Te=de("loading");return u(),$("div",el,[n("h2",ll,r(e.$t("views.operateLog.title")),1),a(Se,{style:{"--el-card-padding":"0"},class:"main-calc-height"},{default:t(()=>[n("div",al,[n("div",tl,[n("div",null,[a(P,{modelValue:A.value,"onUpdate:modelValue":o[0]||(o[0]=l=>A.value=l),class:"mr-12",onChange:Z,style:{width:"180px"}},{default:t(()=>[(u(),$(T,null,M(be,l=>a(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),A.value==="other"?(u(),b(F,{key:0,modelValue:G.value,"onUpdate:modelValue":o[1]||(o[1]=l=>G.value=l),type:"daterange","start-placeholder":e.$t("views.applicationOverview.monitor.startDatePlaceholder"),"end-placeholder":e.$t("views.applicationOverview.monitor.endDatePlaceholder"),format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:ke},null,8,["modelValue","start-placeholder","end-placeholder"])):ce("",!0)]),n("div",ol,[n("div",nl,[a(P,{modelValue:O.value,"onUpdate:modelValue":o[2]||(o[2]=l=>O.value=l),class:"complex-search__left",onChange:we,style:{width:"120px"}},{default:t(()=>[(u(),$(T,null,M(ge,l=>a(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),O.value==="status"?(u(),b(P,{key:0,modelValue:j.value,"onUpdate:modelValue":o[3]||(o[3]=l=>j.value=l),onChange:he,style:{width:"220px"},clearable:""},{default:t(()=>[(u(),$(T,null,M(ye,l=>a(w,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])):(u(),b(H,{key:1,modelValue:L.value,"onUpdate:modelValue":o[4]||(o[4]=l=>L.value=l),onChange:y,placeholder:e.$t("common.search"),"prefix-icon":"Search",style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"]))]),B((u(),b(v,{onClick:Le,style:{"margin-left":"10px"}},{default:t(()=>[g(r(e.$t("common.export")),1)]),_:1})),[[ue,new(d(ve))([d(me).ADMIN],[d(_e).OPERATION_LOG_EXPORT],[d(Y).IS_EE,d(Y).IS_PE],"OR")]]),B((u(),b(v,{onClick:o[5]||(o[5]=l=>E.value=!0)},{default:t(()=>[g(r(e.$t("views.chatLog.buttons.clearStrategy")),1)]),_:1})),[[ue,new(d(ve))([d(me).ADMIN],[d(_e).OPERATION_LOG_CLEAR_POLICY],[d(Y).IS_EE,d(Y).IS_PE],"OR")]])])]),B((u(),b(Ee,{class:"mt-16",data:I.value,"pagination-config":D,onSizeChange:Ce,onChangePage:y},{default:t(()=>[a(k,{prop:"menu",label:e.$t("views.operateLog.table.menu.label"),width:"160"},{header:t(()=>[n("div",null,[n("span",null,r(e.$t("views.operateLog.table.menu.label")),1),a(ie,{width:200,trigger:"click",visible:c.value},{reference:t(()=>[a(v,{style:{"margin-top":"-2px"},type:f.value&&f.value.length>0?"primary":"",link:"",onClick:o[6]||(o[6]=l=>c.value=!c.value)},{default:t(()=>[a(te,null,{default:t(()=>[a(ae)]),_:1})]),_:1},8,["type"])]),default:t(()=>[n("div",sl,[n("div",il,[n("div",{onClick:o[8]||(o[8]=z(()=>{},["stop"]))},[a(se,{height:"300",style:{margin:"0 0 0 10px"}},{default:t(()=>[a(ne,{modelValue:f.value,"onUpdate:modelValue":o[7]||(o[7]=l=>f.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(u(!0),$(T,null,M(K.value,l=>(u(),b(oe,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",rl,[a(v,{size:"small",onClick:o[9]||(o[9]=l=>q("clear"))},{default:t(()=>[g(r(e.$t("common.clear")),1)]),_:1}),a(v,{type:"primary",onClick:q,size:"small"},{default:t(()=>[g(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"]),a(k,{prop:"operate",label:e.$t("views.operateLog.table.operate.detail")},{default:t(({row:l})=>{var W;return[a(re,{content:l.operate+((W=l.operation_object)!=null&&W.name?`【${l.operation_object.name}】`:""),effect:"dark",placement:"top"},{default:t(()=>{var pe;return[n("span",ul,r(l.operate+((pe=l.operation_object)!=null&&pe.name?`【${l.operation_object.name}】`:"")),1)]}),_:2},1032,["content"])]}),_:1},8,["label"]),a(k,{width:"120",prop:"user.username",label:e.$t("views.operateLog.table.user.label")},null,8,["label"]),d(_).isEE()?(u(),b(k,{key:0,width:"200",prop:"workspace_name",label:e.$t("views.workspace.title")},{header:t(()=>[n("div",null,[n("span",null,r(e.$t("views.workspace.title")),1),a(ie,{width:200,trigger:"click",visible:S.value},{reference:t(()=>[a(v,{style:{"margin-top":"-2px"},type:p.value&&p.value.length>0?"primary":"",link:"",onClick:o[10]||(o[10]=l=>S.value=!S.value)},{default:t(()=>[a(te,null,{default:t(()=>[a(ae)]),_:1})]),_:1},8,["type"])]),default:t(()=>[n("div",pl,[n("div",dl,[n("div",{onClick:o[12]||(o[12]=z(()=>{},["stop"]))},[a(se,{height:"300",style:{margin:"0 0 0 10px"}},{default:t(()=>[a(ne,{modelValue:p.value,"onUpdate:modelValue":o[11]||(o[11]=l=>p.value=l),style:{display:"flex","flex-direction":"column"}},{default:t(()=>[(u(!0),$(T,null,M(X.value,l=>(u(),b(oe,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),n("div",cl,[a(v,{size:"small",onClick:o[13]||(o[13]=l=>Q("clear"))},{default:t(()=>[g(r(e.$t("common.clear")),1)]),_:1}),a(v,{type:"primary",onClick:Q,size:"small"},{default:t(()=>[g(r(e.$t("common.confirm")),1)]),_:1})])]),_:1},8,["visible"])])]),_:1},8,["label"])):ce("",!0),a(k,{prop:"status",label:e.$t("views.operateLog.table.status.label"),width:"100"},{default:t(({row:l})=>[l.status===200?(u(),$("span",vl,r(e.$t("views.operateLog.table.status.success")),1)):(u(),$("span",ml,r(e.$t("views.operateLog.table.status.fail")),1))]),_:1},8,["label"]),a(k,{prop:"ip_address",label:e.$t("views.operateLog.table.ip_address.label"),width:"160"},null,8,["label"]),a(k,{label:e.$t("views.operateLog.table.operateTime.label"),width:"180"},{default:t(({row:l})=>[g(r(d(Ye)(l.create_time)),1)]),_:1},8,["label"]),a(k,{label:e.$t("common.operation"),width:"60",align:"left",fixed:"right"},{default:t(({row:l})=>[n("span",_l,[a(re,{effect:"dark",content:e.$t("views.operateLog.table.opt.label"),placement:"top"},{default:t(()=>[a(v,{type:"primary",text:"",onClick:z(W=>$e(l),["stop"]),class:"text-button"},{default:t(()=>[a(xe,{iconName:"app-operate-log"})]),_:1},8,["onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[Te,V.value]])]),a(Ze,{ref_key:"DetailDialogRef",ref:C},null,512)]),_:1}),a(Pe,{title:e.$t("views.chatLog.buttons.clearStrategy"),modelValue:E.value,"onUpdate:modelValue":o[16]||(o[16]=l=>E.value=l),width:"25%","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[n("div",fl,[a(v,{onClick:o[15]||(o[15]=l=>E.value=!1)},{default:t(()=>[g(r(e.$t("common.cancel")),1)]),_:1}),a(v,{type:"primary",onClick:De},{default:t(()=>[g(r(e.$t("common.save")),1)]),_:1})])]),default:t(()=>[n("span",null,r(e.$t("common.delete")),1),a(Ie,{modelValue:R.value,"onUpdate:modelValue":o[14]||(o[14]=l=>R.value=l),"controls-position":"right",min:1,max:1e5,"value-on-clear":0,"step-strictly":"",style:{width:"110px","margin-left":"8px","margin-right":"8px"}},null,8,["modelValue"]),n("span",null,r(e.$t("views.chatLog.daysText")),1)]),_:1},8,["title","modelValue"])])}}}),hl=Fe(bl,[["__scopeId","data-v-4b723511"]]);export{hl as default};
