import{ay as de,aP as me,aO as F,aB as s,aU as he,aC as W,aV as se,aD as o,aE as w,aF as f,aG as t,aH as l,aI as b,aS as ee,aK as V,aJ as _,aT as q,b3 as Y,b7 as ye,bV as Ve,b8 as ke,b1 as K,aW as pe,aX as we,aY as $e,ce as Se,cf as Te,aQ as Pe,b2 as L,c1 as Re,b6 as Ie,cZ as Me,bZ as Ce}from"./admin-Ca7cl6NN.js";import{_ as xe}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-DwBpdggG.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-DMqxNyYm.js";const ze={class:"dialog-footer"},qe=de({__name:"CreateProblemDialog",emits:["refresh"],setup(Q,{expose:E,emit:$}){const T=me(),{params:{id:h}}=T,y=F(()=>T.path.includes("shared")?"systemShare":T.path.includes("resource-management")?"systemManage":"workspace"),U=$,P=s(),k=s(!1),R=s({data:""}),C=he({data:[{required:!0,message:W("views.problem.tip.requiredMessage"),trigger:"blur"}]}),c=s(!1);se(c,n=>{n||(R.value={data:""})});const d=()=>{c.value=!0},S=async n=>{n&&await n.validate((u,v)=>{if(u){const x=R.value.data.split(`
`).filter(function(B){return B!==""});q({type:"problem",systemType:y.value}).postProblems(h,x,k).then(B=>{Y(W("common.createSuccess")),U("refresh"),c.value=!1})}})};return E({open:d}),(n,u)=>{const v=o("el-input"),x=o("el-form-item"),B=o("el-form"),D=o("el-button"),I=o("el-dialog");return f(),w(I,{title:n.$t("views.problem.createProblem"),modelValue:c.value,"onUpdate:modelValue":u[3]||(u[3]=H=>c.value=H),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:t(()=>[b("span",ze,[l(D,{onClick:u[1]||(u[1]=ee(H=>c.value=!1,["prevent"]))},{default:t(()=>[V(_(n.$t("common.cancel")),1)]),_:1}),l(D,{type:"primary",onClick:u[2]||(u[2]=H=>S(P.value)),loading:k.value},{default:t(()=>[V(_(n.$t("common.confirm")),1)]),_:1},8,["loading"])])]),default:t(()=>[l(B,{"label-position":"top",ref_key:"problemFormRef",ref:P,rules:C,model:R.value,"require-asterisk-position":"right"},{default:t(()=>[l(x,{label:n.$t("views.problem.title"),prop:"data"},{default:t(()=>[l(v,{modelValue:R.value.data,"onUpdate:modelValue":u[0]||(u[0]=H=>R.value.data=H),placeholder:n.$t("views.problem.tip.placeholder"),rows:10,type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Be={class:"bold title align-center p-24 pb-0"},Le={class:"p-8",style:{"padding-bottom":"8px"}},Ue={class:"flex lighter align-center"},Ne={class:"p-24",style:{"padding-bottom":"8px","padding-top":"16px"}},Ae={class:"flex-between mb-16"},Ee={class:"bold title align-center"},He={class:"dialog-footer"},je=de({__name:"RelateProblemDialog",emits:["refresh"],setup(Q,{expose:E,emit:$}){const T=me(),{params:{id:h}}=T,y=F(()=>T.path.includes("shared")?"systemShare":T.path.includes("resource-management")?"systemManage":"workspace"),U=$,P=s(!1),k=s(!1),R=s([]),C=s([]),c=s([]),d=s(""),S=s([]),n=s([]),u=s(""),v=s(""),x=s("title"),B=s(""),D=s(!1),I=he({current_page:1,page_size:50,total:0});function H(){const a={problem_id_list:S.value,paragraph_list:n.value.map(r=>({paragraph_id:r.id,document_id:r.document_id}))};q({type:"problem",systemType:y.value}).putMulAssociationProblem(h,a,k).then(()=>{Y(W("views.problem.tip.relatedSuccess")),P.value=!1})}function p(a){if(D.value)G(a.id)?n.value.splice(n.value.indexOf(a.id),1):n.value.push(a);else{const r={paragraph_id:a.id,problem_id:d.value};G(a.id)?q({type:"paragraph",systemType:y.value}).putDisassociationProblem(h,a.document_id,r,k).then(()=>{j(d.value)}):q({type:"paragraph",systemType:y.value}).putAssociationProblem(h,a.document_id,r,k).then(()=>{j(d.value)})}}function N(){I.current_page=1,c.value=[],u.value&&Z(u.value)}function le(a){I.current_page=1,c.value=[],u.value=a.id,Z(a.id)}function te(){q({type:"document",systemType:y.value}).getDocumentList(h,k).then(a=>{var r;C.value=a.data,R.value=a.data,u.value=((r=C.value)==null?void 0:r.length)>0?C.value[0].id:"",u.value&&Z(u.value)})}function Z(a){q({type:"paragraph",systemType:y.value}).getParagraphPage(h,a||u.value,I,v.value&&{[x.value]:v.value},k).then(r=>{c.value=[...c.value,...r.data.records],I.total=r.data.total})}function j(a){q({type:"problem",systemType:y.value}).getDetailProblems(h,a,k).then(r=>{n.value=r.data})}function X(a){return n.value.filter(r=>r.document_id===a).length}function G(a){return n.value.some(r=>r.id===a)}return se(P,a=>{a||(R.value=[],C.value=[],c.value=[],n.value=[],D.value=!1,u.value="",v.value="",x.value="title",U("refresh"))}),se(B,a=>{var r;c.value=[],R.value=a?C.value.filter(O=>O.name.includes(a)):C.value,u.value=((r=R.value)==null?void 0:r.length)>0?R.value[0].id:""}),E({open:a=>{te(),a.length==1?(d.value=a[0],j(a)):a.length>1&&(S.value=a,D.value=!0),P.value=!0}}),(a,r)=>{const O=o("el-input"),oe=o("auto-tooltip"),ne=o("el-badge"),M=o("common-list"),z=o("el-scrollbar"),ae=o("el-col"),e=o("el-text"),i=o("el-option"),A=o("el-select"),ve=o("el-empty"),J=o("CardBox"),_e=o("InfiniteScroll"),fe=o("el-row"),re=o("el-button"),ue=o("el-dialog"),ge=ye("loading");return f(),w(ue,{title:a.$t("views.problem.relateParagraph.title"),modelValue:P.value,"onUpdate:modelValue":r[5]||(r[5]=g=>P.value=g),width:"80%",class:"paragraph-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1},Ve({default:t(()=>[ke((f(),w(fe,null,{default:t(()=>[l(ae,{span:6},{default:t(()=>[l(z,{height:"500","wrap-class":"paragraph-scrollbar"},{default:t(()=>[b("div",Be,_(a.$t("views.problem.relateParagraph.selectDocument")),1),b("div",Le,[l(O,{modelValue:B.value,"onUpdate:modelValue":r[0]||(r[0]=g=>B.value=g),placeholder:a.$t("views.problem.relateParagraph.placeholder"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),l(M,{data:R.value,class:"mt-8",onClick:le,"default-active":u.value},{default:t(({row:g})=>[b("span",Ue,[l(oe,{content:g.name},{default:t(()=>[V(_(g.name),1)]),_:2},1032,["content"]),X(g.id)?(f(),w(ne,{key:0,value:X(g.id),type:"primary",class:"paragraph-badge ml-4"},null,8,["value"])):K("",!0)])]),_:1},8,["data","default-active"])])]),_:1})]),_:1}),l(ae,{span:18,class:"border-l"},{default:t(()=>[l(z,{height:"500","wrap-class":"paragraph-scrollbar"},{default:t(()=>[b("div",Ne,[b("div",Ae,[b("div",Ee,[V(_(a.$t("components.selectParagraph.title"))+" ",1),l(e,null,{default:t(()=>[V(" （"+_(a.$t("views.problem.relateParagraph.selectedParagraph"))+"："+_(X(u.value))+" "+_(a.$t("views.problem.relateParagraph.count"))+"） ",1)]),_:1})]),l(O,{modelValue:v.value,"onUpdate:modelValue":r[2]||(r[2]=g=>v.value=g),placeholder:a.$t("common.search"),class:"input-with-select",style:{width:"260px"},onChange:N},{prepend:t(()=>[l(A,{modelValue:x.value,"onUpdate:modelValue":r[1]||(r[1]=g=>x.value=g),placeholder:"Select",style:{width:"80px"}},{default:t(()=>[l(i,{label:a.$t("common.title"),value:"title"},null,8,["label"]),l(i,{label:a.$t("common.content"),value:"content"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),c.value.length==0?(f(),w(ve,{key:0,description:a.$t("common.noData")},null,8,["description"])):(f(),w(_e,{key:1,size:c.value.length,total:I.total,page_size:I.page_size,current_page:I.current_page,"onUpdate:current_page":r[3]||(r[3]=g=>I.current_page=g),onLoad:Z,loading:k.value},{default:t(()=>[(f(!0),pe(we,null,$e(c.value,(g,be)=>(f(),w(J,{key:be,shadow:"hover",title:g.title||"-",description:g.content,class:Se(["paragraph-card cursor mb-16",G(g.id)?"selected":""]),showIcon:!1,onClick:m=>p(g)},null,8,["title","description","class","onClick"]))),128))]),_:1},8,["size","total","page_size","current_page","loading"]))])]),_:1})]),_:1})]),_:1})),[[ge,k.value]])]),_:2},[D.value?{name:"footer",fn:t(()=>[b("div",He,[l(re,{onClick:r[4]||(r[4]=g=>P.value=!1)},{default:t(()=>[V(_(a.$t("common.cancel")),1)]),_:1}),l(re,{type:"primary",onClick:H},{default:t(()=>[V(_(a.$t("common.confirm")),1)]),_:1})])]),key:"0"}:void 0]),1032,["title","modelValue"])}}}),De=Te(je,[["__scopeId","data-v-a862ea99"]]),Fe={class:"p-8"},We={class:"footer-content flex-between"},Qe=de({__name:"DetailProblemDrawer",props:{currentId:{},currentContent:{},next:{},pre:{},pre_disable:{type:Boolean},next_disable:{type:Boolean}},emits:["update:currentId","update:currentContent","refresh"],setup(Q,{expose:E,emit:$}){const T=Q,h=$,y=me(),{params:{id:U}}=y,P=F(()=>y.path.includes("shared")?"systemShare":y.path.includes("resource-management")?"systemManage":"workspace"),k=F(()=>Pe.knowledge[P.value]),R=s(),C=s(),c=s(!1),d=s(!1),S=s([]);function n(p){const N={paragraph_id:p.id,problem_id:T.currentId};q({type:"paragraph",systemType:P.value}).putDisassociationProblem(p.knowledge_id,p.document_id,N,c).then(()=>{D()})}function u(){R.value.open([T.currentId])}function v(p){C.value.open(p,"edit")}function x(p){if(p){const N={content:p};q({type:"problem",systemType:P.value}).putProblems(U,T.currentId,N,c).then(()=>{h("update:currentContent",p),Y(W("common.modifySuccess"))})}else Re(W("views.problem.tip.errorMessage"))}function B(){S.value=[]}function D(){T.currentId&&d.value&&q({type:"problem",systemType:P.value}).getDetailProblems(U,T.currentId,c).then(p=>{S.value=p.data})}function I(){D()}return se(()=>T.currentId,()=>{S.value=[],D()}),se(d,p=>{p||(h("update:currentId",""),h("update:currentContent",""),h("refresh"))}),E({open:()=>{D(),d.value=!0}}),(p,N)=>{const le=o("ReadWrite"),te=o("el-form-item"),Z=o("AppIcon"),j=o("el-button"),X=o("el-tooltip"),G=o("el-scrollbar"),ie=o("Document"),a=o("el-icon"),r=o("el-text"),O=o("CardBox"),oe=o("el-form"),ne=o("el-drawer"),M=ye("loading");return f(),w(ne,{modelValue:d.value,"onUpdate:modelValue":N[1]||(N[1]=z=>d.value=z),size:"60%",onClose:B},{header:t(()=>[b("h4",null,_(p.$t("views.problem.detailProblem")),1)]),footer:t(()=>[b("div",null,[k.value.doc_edit(L(U))?(f(),w(j,{key:0,onClick:u},{default:t(()=>[V(_(p.$t("views.problem.relateParagraph.title")),1)]),_:1})):K("",!0),l(j,{onClick:Q.pre,disabled:Q.pre_disable||c.value},{default:t(()=>[V(_(p.$t("views.chatLog.buttons.prev")),1)]),_:1},8,["onClick","disabled"]),l(j,{onClick:Q.next,disabled:Q.next_disable||c.value},{default:t(()=>[V(_(p.$t("views.chatLog.buttons.next")),1)]),_:1},8,["onClick","disabled"])])]),default:t(()=>[b("div",null,[l(G,null,{default:t(()=>[b("div",Fe,[ke((f(),w(oe,{"label-position":"top",onSubmit:N[0]||(N[0]=ee(()=>{},["prevent"]))},{default:t(()=>[l(te,{label:p.$t("views.problem.title")},{default:t(()=>[l(le,{onChange:x,data:Q.currentContent,showEditIcon:k.value.problem_edit(L(U)),maxlength:256},null,8,["data","showEditIcon"])]),_:1},8,["label"]),l(te,{label:p.$t("views.problem.relateParagraph.title")},{default:t(()=>[(f(!0),pe(we,null,$e(S.value,(z,ae)=>(f(),w(O,{key:ae,title:z.title||"-",class:"cursor mb-8 w-full",showIcon:!1,onClick:ee(e=>k.value.doc_edit(L(U))&&v(z),["stop"]),style:{height:"210px"}},{tag:t(()=>[l(X,{effect:"dark",content:p.$t("views.problem.setting.cancelRelated"),placement:"top"},{default:t(()=>[k.value.problem_relate(L(U))?(f(),w(j,{key:0,type:"primary",text:"",onClick:ee(e=>n(z),["stop"])},{default:t(()=>[l(Z,{iconName:"app-quxiaoguanlian"})]),_:1},8,["onClick"])):K("",!0)]),_:2},1032,["content"])]),footer:t(()=>[b("div",We,[l(r,null,{default:t(()=>[l(a,null,{default:t(()=>[l(ie)]),_:1}),V(" "+_(z==null?void 0:z.document_name),1)]),_:2},1024)])]),default:t(()=>[l(G,{height:"110"},{default:t(()=>[V(_(z.content),1)]),_:2},1024)]),_:2},1032,["title","onClick"]))),128))]),_:1},8,["label"])]),_:1})),[[M,c.value]])])]),_:1}),l(xe,{ref_key:"ParagraphDialogRef",ref:C,title:p.$t("views.paragraph.editParagraph"),apiType:P.value,onRefresh:I},null,8,["title","apiType"]),l(De,{ref_key:"RelateProblemDialogRef",ref:R,onRefresh:I},null,512)])]),_:1},8,["modelValue"])}}}),Oe={class:"document p-16-24"},Ze={class:"mb-16"},Ge={class:"main-calc-height"},Je={class:"p-24"},Ke={class:"flex-between"},Xe={key:1},Ye={class:"mr-4"},lt=de({__name:"index",setup(Q){const E=me(),{params:{id:$,folderId:T}}=E,h=F(()=>E.path.includes("shared")?"systemShare":E.path.includes("resource-management")?"systemManage":E.path.includes("share/")?"workspaceShare":"workspace"),y=F(()=>Pe.knowledge[h.value]),U=F(()=>T==="share"),P=s(),k=s(),R=s(),C=s(!1),c=s(""),d=s(""),S=s(""),n=he({current_page:1,page_size:10,total:0,page_sizes:[10,20,50,100,1e3]}),u=s(""),v=s([]),x=F(()=>v.value.map((e,i)=>({[e.id]:i})).reduce((e,i)=>({...e,...i}),{})),B=s(),D=s([]);function I(e){const i=[];e?i.push(e.id):D.value.map(A=>{A&&i.push(A.id)}),P.value.open(i)}function H(){R.value.open()}const p=e=>{D.value=e};function N(e){C.value=!0;const i=[e];q({type:"problem",systemType:h.value}).postProblems($,i).then(()=>{M(),Y(W("common.createSuccess"))}).catch(()=>{C.value=!1})}function le(){const e=[];D.value.map(i=>{i&&e.push(i.id)}),q({type:"problem",systemType:h.value}).putMulProblem($,e,C).then(()=>{var i;Y(W("views.document.delete.successMessage")),(i=B.value)==null||i.clearSelection(),M()})}function te(e){q({type:"problem",systemType:h.value}).delProblems($,e.id,C).then(()=>{Y(W("common.deleteSuccess")),M()})}function Z(e,i){if(e){const A={content:e};q({type:"problem",systemType:h.value}).putProblems($,i,A,C).then(()=>{M(),Y(W("common.modifySuccess"))})}else Re(W("views.problem.tip.errorMessage"))}function j(e){c.value=e.id}function X(){c.value=""}const G=()=>{let e=x.value[d.value]+1;if(e>=v.value.length){if(e+(n.current_page-1)*n.page_size>=n.total-1)return;n.current_page=n.current_page+1,M().then(()=>{e=0,d.value=v.value[e].id,S.value=v.value[e].content})}else d.value=v.value[e].id,S.value=v.value[e].content},ie=F(()=>x.value[d.value]-1<0&&n.current_page<=1),a=F(()=>{const e=x.value[d.value]+1;return e>=v.value.length&&e+(n.current_page-1)*n.page_size>=n.total-1}),r=()=>{let e=x.value[d.value]-1;if(e<0){if(n.current_page<=1)return;n.current_page=n.current_page-1,M().then(()=>{e=n.page_size-1,d.value=v.value[e].id,S.value=v.value[e].content})}else d.value=v.value[e].id,S.value=v.value[e].content};function O(e,i){i&&i.type==="selection"||E.path.includes("share/")||e.paragraph_count&&(d.value=e.id,S.value=e.content,k.value.open())}const oe=({row:e})=>d.value===(e==null?void 0:e.id)?"highlight":"";function ne(){n.current_page=1,M()}function M(){return q({type:"problem",isShared:U.value,systemType:h.value}).getProblemsPage($,n,u.value&&{content:u.value},C).then(e=>{v.value=e.data.records,n.total=e.data.total})}function z(){var e;M(),(e=B.value)==null||e.clearSelection()}function ae(){n.current_page=1,M()}return Ie(()=>{M()}),Me(()=>{}),(e,i)=>{const A=o("el-button"),ve=o("el-input"),J=o("el-table-column"),_e=o("ReadWrite"),fe=o("el-link"),re=o("AppIcon"),ue=o("el-tooltip"),ge=o("app-table"),g=o("el-card"),be=ye("loading");return f(),pe("div",Oe,[b("h2",Ze,_(e.$t("views.problem.title")),1),l(g,{style:{"--el-card-padding":"0"}},{default:t(()=>[b("div",Ge,[b("div",Je,[b("div",Ke,[b("div",null,[y.value.problem_create(L($))?(f(),w(A,{key:0,type:"primary",onClick:H},{default:t(()=>[V(_(e.$t("views.problem.createProblem")),1)]),_:1})):K("",!0),y.value.problem_relate(L($))?(f(),w(A,{key:1,onClick:i[0]||(i[0]=m=>I()),disabled:D.value.length===0},{default:t(()=>[V(_(e.$t("views.problem.relateParagraph.title")),1)]),_:1},8,["disabled"])):K("",!0),y.value.problem_delete(L($))?(f(),w(A,{key:2,onClick:le,disabled:D.value.length===0},{default:t(()=>[V(_(e.$t("views.problem.setting.batchDelete")),1)]),_:1},8,["disabled"])):K("",!0)]),l(ve,{modelValue:u.value,"onUpdate:modelValue":i[1]||(i[1]=m=>u.value=m),placeholder:e.$t("views.problem.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",onChange:M,clearable:""},null,8,["modelValue","placeholder"])]),ke((f(),w(ge,{ref_key:"multipleTableRef",ref:B,class:"mt-16",data:v.value,"pagination-config":n,"quick-create":y.value.problem_create(L($)),quickCreateName:e.$t("views.problem.quickCreateName"),quickCreatePlaceholder:e.$t("views.problem.quickCreateProblem"),quickCreateMaxlength:256,onSizeChange:ne,onChangePage:M,onCellMouseEnter:j,onCellMouseLeave:X,onCreatQuick:N,onRowClick:O,onSelectionChange:p,"row-class-name":oe,"row-key":m=>m.id},{default:t(()=>[l(J,{type:"selection",width:"55","reserve-selection":!0}),l(J,{prop:"content",label:e.$t("views.problem.title"),"min-width":"280"},{default:t(({row:m})=>[l(_e,{onChange:ce=>Z(ce,m.id),data:m.content,showEditIcon:y.value.problem_edit(L($))&&m.id===c.value,maxlength:256},null,8,["onChange","data","showEditIcon"])]),_:1},8,["label"]),l(J,{prop:"paragraph_count",label:e.$t("views.problem.table.paragraph_count"),align:"right","min-width":"100"},{default:t(({row:m})=>[m.paragraph_count?(f(),w(fe,{key:0,type:"primary",onClick:ee(ce=>O(m),["stop"])},{default:t(()=>[V(_(m.paragraph_count),1)]),_:2},1032,["onClick"])):(f(),pe("span",Xe,_(m.paragraph_count),1))]),_:1},8,["label"]),l(J,{prop:"create_time",label:e.$t("common.createTime"),width:"170"},{default:t(({row:m})=>[V(_(L(Ce)(m.create_time)),1)]),_:1},8,["label"]),l(J,{prop:"update_time",label:e.$t("views.problem.table.updateTime"),width:"170"},{default:t(({row:m})=>[V(_(L(Ce)(m.update_time)),1)]),_:1},8,["label"]),l(J,{label:e.$t("common.operation"),align:"left",fixed:"right"},{default:t(({row:m})=>[b("div",null,[b("span",Ye,[l(ue,{effect:"dark",content:e.$t("views.problem.relateParagraph.title"),placement:"top"},{default:t(()=>[y.value.problem_relate(L($))?(f(),w(A,{key:0,type:"primary",text:"",onClick:ee(ce=>I(m),["stop"])},{default:t(()=>[l(re,{iconName:"app-generate-question"})]),_:1},8,["onClick"])):K("",!0)]),_:2},1032,["content"])]),b("span",null,[l(ue,{effect:"dark",content:e.$t("common.delete"),placement:"top"},{default:t(()=>[y.value.problem_delete(L($))?(f(),w(A,{key:0,type:"primary",text:"",onClick:ee(ce=>te(m),["stop"])},{default:t(()=>[l(re,{iconName:"app-delete"})]),_:1},8,["onClick"])):K("",!0)]),_:2},1032,["content"])])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config","quick-create","quickCreateName","quickCreatePlaceholder","row-key"])),[[be,C.value]])])])]),_:1}),l(qe,{ref_key:"CreateProblemDialogRef",ref:R,onRefresh:ae},null,512),l(Qe,{next:G,pre:r,ref_key:"DetailProblemRef",ref:k,currentId:d.value,"onUpdate:currentId":i[2]||(i[2]=m=>d.value=m),currentContent:S.value,"onUpdate:currentContent":i[3]||(i[3]=m=>S.value=m),pre_disable:ie.value,next_disable:a.value,onRefresh:z},null,8,["currentId","currentContent","pre_disable","next_disable"]),l(De,{ref_key:"RelateProblemDialogRef",ref:P,onRefresh:z},null,512)])}}});export{lt as default};
