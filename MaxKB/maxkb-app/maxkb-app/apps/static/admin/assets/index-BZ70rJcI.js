import{cf as q,aW as x,aF as t,aI as o,ay as de,aP as ce,aO as L,aQ as me,aB as h,aC as O,b6 as ue,cZ as ye,aD as r,aE as i,bV as fe,aG as e,b1 as $,aH as a,aS as F,aK as M,aJ as u,b2 as E,c4 as he,b_ as ge,bW as ke,cG as we,c0 as $e,aT as J,b3 as be,aV as Ce,b7 as pe,bG as Me,bH as Se,ce as re,dA as se,b8 as ne,aA as Te,dB as xe,aX as j,aY as Z,c3 as Le,dC as De,dD as Ie}from"./admin-Ca7cl6NN.js";import{E as Ae,_ as Re}from"./ParamSettingDialog.vue_vue_type_script_setup_true_lang-CzFrIreJ.js";import{_ as Ne}from"./AuthorizedWorkspaceDialog.vue_vue_type_script_setup_true_lang-BJP0423Q.js";import"./permission-api-BDoWsP34.js";import"./workspace-CiflQXiK.js";const Ve={},Be={class:"loading-container loader"};function Ee(s,D){return t(),x("div",Be,[...D[0]||(D[0]=[o("div",{class:"download-loading"},[o("div"),o("div"),o("div"),o("div"),o("div"),o("div"),o("div"),o("div")],-1)])])}const ze=q(Ve,[["render",Ee],["__scopeId","data-v-91938551"]]),Fe=["innerHTML"],Oe={class:"flex",style:{height:"22px"}},Pe=["title"],We={key:0},He={key:1},Ge={class:"flex mb-4"},Ue={class:"ellipsis ml-16"},je={class:"flex"},Je={class:"ellipsis-1 ml-16",style:{height:"20px",width:"70%"}},Ke={key:0,class:"progress-mask"},Qe={class:"percentage-label flex-center"},Xe=de({__name:"ModelCard",props:{model:{},provider_list:{},updateModelById:{type:Function},isShared:{type:Boolean},isSystemShare:{type:Boolean},apiType:{}},emits:["change","update:model"],setup(s,{emit:D}){ce();const m=s,I=L(()=>m.apiType==="systemShare"),k=L(()=>me.model[m.apiType]),A=l=>k.value.modify(l)||k.value.delete(l)||k.value.auth(l)||I.value,S=h();function W(l){S.value.open(l.id)}const f=h(),d=L(()=>f.value?f.value:m.model),_=L(()=>d.value.meta&&d.value.meta.message?d.value.meta.message==="pull model manifest: file does not exist"?`${d.value.model_name} ${O("views.model.tip.noModel")}`:d.value.meta.message:""),p=D,g=h();let R;const P=()=>{$e(`${O("views.model.delete.confirmTitle")}${m.model.name} ?`,O("views.model.delete.confirmMessage"),{confirmButtonText:O("common.confirm"),confirmButtonClass:"danger"}).then(()=>{J({type:"model",systemType:m.apiType}).deleteModel(m.model.id).then(()=>{p("change"),be(O("common.deleteSuccess"))})}).catch(()=>{})},N=()=>{J({type:"model",systemType:m.apiType}).pauseDownload(m.model.id).then(()=>{f.value=void 0,p("change")})},V=()=>{var w;const l=m.provider_list.find(c=>c.provider===m.model.provider);l&&((w=g.value)==null||w.open(l,m.model))},T=L(()=>{var l;return(l=m.provider_list.find(w=>w.provider===m.model.provider))==null?void 0:l.icon}),C=()=>{R=setInterval(()=>{d.value.status==="DOWNLOAD"?J({type:"model",systemType:m.apiType}).getModelMetaById(m.model.id).then(l=>{f.value=l.data}):f.value&&(m.updateModelById(m.model.id,f.value),f.value=void 0)},6e3)},K=()=>{R&&clearInterval(R)},H=h(),Q=()=>{var l;(l=H.value)==null||l.open(m.model)},G=h();function U(l){G.value&&G.value.open(l,"Model")}return ue(()=>{C()}),ye(()=>{K()}),(l,w)=>{const c=r("WarningFilled"),n=r("el-icon"),y=r("el-tooltip"),b=r("el-text"),ee=r("el-tag"),X=r("el-button"),B=r("AppIcon"),z=r("el-dropdown-item"),le=r("el-dropdown-menu"),oe=r("el-dropdown"),te=r("card-box");return t(),i(te,{title:s.model.name,shadow:"hover",class:"model-card"},fe({icon:e(()=>[o("span",{style:{height:"32px",width:"32px"},innerHTML:T.value},null,8,Fe)]),title:e(()=>[o("div",Oe,[o("span",{class:"ellipsis-1 mb-4",title:s.model.name,style:{"max-width":"80%"}},u(s.model.name),9,Pe),d.value.status==="ERROR"?(t(),x("span",We,[a(y,{effect:"dark",content:_.value,placement:"top"},{default:e(()=>[a(n,{class:"color-danger ml-4",size:"18"},{default:e(()=>[a(c)]),_:1})]),_:1},8,["content"])])):$("",!0),d.value.status==="PAUSE_DOWNLOAD"?(t(),x("span",He,[a(y,{effect:"dark",content:`${l.$t("views.model.modelForm.base_model.label")}: ${m.model.model_name} ${l.$t("views.model.tip.downloadError")}`,placement:"top"},{default:e(()=>[a(n,{class:"color-danger ml-4",size:"18"},{default:e(()=>[a(c)]),_:1})]),_:1},8,["content"])])):$("",!0)])]),subTitle:e(()=>[a(b,{class:"color-secondary lighter",size:"small"},{default:e(()=>[M(u(l.$t("common.creator"))+": "+u(E(we)(s.model.nick_name)),1)]),_:1})]),tag:e(()=>[s.isShared||I.value?(t(),i(ee,{key:0,type:"info",class:"info-tag"},{default:e(()=>[M(u(E(O)("views.shared.title")),1)]),_:1})):$("",!0)]),default:e(()=>[o("ul",null,[o("li",Ge,[a(b,{type:"info",class:"color-secondary"},{default:e(()=>[M(u(l.$t("views.model.modelForm.model_type.label")),1)]),_:1}),o("span",Ue,u(l.$t(E(he)[s.model.model_type])),1)]),o("li",je,[a(b,{type:"info",class:"color-secondary"},{default:e(()=>[M(u(l.$t("views.model.modelForm.base_model.label")),1)]),_:1}),o("span",Je,u(s.model.model_name),1)])]),d.value.status==="DOWNLOAD"?(t(),x("div",Ke,[a(ze,{class:"percentage"}),o("div",Qe,[M(u(l.$t("views.model.download.downloading"))+" ",1),w[4]||(w[4]=o("span",{class:"dotting"},null,-1)),a(X,{link:"",type:"primary",class:"ml-16",onClick:F(N,["stop"])},{default:e(()=>[M(u(l.$t("views.model.download.cancelDownload")),1)]),_:1})])])):$("",!0),a(Ae,{ref_key:"editModelRef",ref:g,onSubmit:w[3]||(w[3]=Y=>p("change"))},null,512),a(Re,{ref_key:"paramSettingRef",ref:H},null,512),I.value?(t(),i(Ne,{key:1,ref_key:"AuthorizedWorkspaceDialogRef",ref:G},null,512)):$("",!0),s.apiType==="workspace"?(t(),i(ge,{key:2,type:E(ke).MODEL,ref_key:"ResourceAuthorizationDrawerRef",ref:S},null,8,["type"])):$("",!0)]),_:2},[A(s.model.id)?{name:"mouseEnter",fn:e(()=>[s.isShared?$("",!0):(t(),i(oe,{key:0,trigger:"click"},{dropdown:e(()=>[a(le,null,{default:e(()=>[k.value.modify(s.model.id)?(t(),i(z,{key:0,text:"",onClick:F(V,["stop"])},{default:e(()=>[a(B,{iconName:"app-edit",class:"color-secondary"}),M(" "+u(l.$t("common.edit")),1)]),_:1})):$("",!0),I.value?(t(),i(z,{key:1,onClick:w[1]||(w[1]=F(Y=>U(s.model),["stop"]))},{default:e(()=>[a(B,{iconName:"app-lock",class:"color-secondary"}),M(" "+u(l.$t("views.shared.authorized_workspace")),1)]),_:1})):$("",!0),(d.value.model_type==="TTS"||d.value.model_type==="STT"||d.value.model_type==="LLM"||d.value.model_type==="IMAGE"||d.value.model_type==="TTI"||d.value.model_type==="ITV"||d.value.model_type==="EMBEDDING"||d.value.model_type==="TTV")&&k.value.paramSetting(s.model.id)?(t(),i(z,{key:2,onClick:F(Q,["stop"])},{default:e(()=>[a(B,{iconName:"app-setting",class:"color-secondary"}),M(" "+u(l.$t("views.model.modelForm.title.paramSetting")),1)]),_:1})):$("",!0),s.apiType==="workspace"&&k.value.auth(s.model.id)?(t(),i(z,{key:3,onClick:w[2]||(w[2]=F(Y=>W(s.model),["stop"]))},{default:e(()=>[a(B,{iconName:"app-resource-authorization",class:"color-secondary"}),M(" "+u(l.$t("views.system.resourceAuthorization.title")),1)]),_:1})):$("",!0),k.value.delete(s.model.id)?(t(),i(z,{key:4,divided:"",text:"",onClick:F(P,["stop"])},{default:e(()=>[a(B,{iconName:"app-delete",class:"color-secondary"}),M(" "+u(l.$t("common.delete")),1)]),_:1})):$("",!0)]),_:1})]),default:e(()=>[a(X,{text:"",onClick:w[0]||(w[0]=F(()=>{},["stop"]))},{default:e(()=>[a(B,{iconName:"app-more"})]),_:1})]),_:1}))]),key:"0"}:void 0]),1032,["title"])}}}),Ye=q(Xe,[["__scopeId","data-v-3b599ad3"]]),Ze={class:"provider-list"},qe={class:"p-8"},el={key:0,class:"border-b mb-4"},ll={class:"ml-8"},ol={class:"flex align-center"},tl={class:"ml-8"},al={class:"flex align-center"},sl=["innerHTML"],nl=["title"],dl={class:"flex align-center"},il={class:"ml-8"},rl={class:"flex align-center"},cl=["innerHTML"],ml=["title"],ul=de({__name:"Provider",props:{data:{},loading:{type:Boolean},showShared:{type:Boolean},active:{}},emits:["click"],setup(s,{emit:D}){const m=s,I=D,k=h([]),A=h([]);Ce(()=>m.data,f=>{var _;const d=["model_ollama_provider","model_local_provider","model_xinference_provider","model_vllm_provider"];(_=f.filter(p=>p.provider))==null||_.forEach(p=>{d.indexOf(p.provider)>-1?A.value.push(p):k.value.push(p)}),k.value.sort((p,g)=>p.provider.localeCompare(g.provider)),A.value.sort((p,g)=>p.provider.localeCompare(g.provider))},{immediate:!0});const S=f=>{I("click",f)},W=()=>{I("click",{provider:"share",name:O("views.shared.shared_model")})};return(f,d)=>{const _=r("AppIcon"),p=r("common-list"),g=r("el-collapse-item"),R=r("el-collapse"),P=r("el-scrollbar"),N=pe("loading");return t(),x("div",Ze,[a(P,null,{default:e(()=>{var V,T;return[o("div",qe,[s.showShared&&E(Me)(E(Se).IS_EE,"OR")?(t(),x("div",el,[o("div",{onClick:W,class:re(["shared-button flex cursor",((V=s.active)==null?void 0:V.provider)==="share"&&"active"])},[a(_,{iconName:"app-shared-active",style:{"font-size":"18px"},class:"color-primary"}),o("span",ll,u(f.$t("views.shared.shared_model")),1)],2)])):$("",!0),o("div",{class:re(["all-mode flex cursor",(T=s.active)!=null&&T.provider?"":"all-mode-active color-primary-1"]),onClick:d[0]||(d[0]=C=>S(E(se)))},[a(_,{class:"mr-8 color-primary",style:{height:"20px",width:"20px"},iconName:"app-all-menu-active"}),o("span",null,u(f.$t("views.model.modelType.allModel")),1)],2),a(R,{class:"model-collapse","expand-icon-position":"left"},{default:e(()=>[a(g,{title:f.$t("views.model.modelType.publicModel"),name:"1",icon:"CaretRight"},{title:e(()=>[o("div",ol,[a(_,{iconName:"app-folder",style:{"font-size":"20px"}}),o("span",tl,u(f.$t("views.model.modelType.publicModel")),1)])]),default:e(()=>[ne((t(),i(p,{data:k.value,onClick:S,"value-key":"provider","default-active":"",ref:"commonList1"},{default:e(({row:C})=>[o("div",al,[o("span",{innerHTML:C.icon,alt:"",style:{height:"20px",width:"20px"},class:"mr-8"},null,8,sl),o("span",{class:"ellipsis-1",title:C.name},u(C.name),9,nl)])]),_:1},8,["data"])),[[N,s.loading]])]),_:1},8,["title"]),a(g,{title:f.$t("views.model.modelType.privateModel"),name:"2",icon:"CaretRight"},{title:e(()=>[o("div",dl,[a(_,{iconName:"app-folder",style:{"font-size":"20px"}}),o("span",il,u(f.$t("views.model.modelType.privateModel")),1)])]),default:e(()=>[ne((t(),i(p,{data:A.value,onClick:S,"value-key":"provider","default-active":"",ref:"commonList2"},{default:e(({row:C})=>[o("div",rl,[o("span",{innerHTML:C.icon,alt:"",style:{height:"20px",width:"20px"},class:"mr-8"},null,8,cl),o("span",{class:"ellipsis-1",title:C.name},u(C.name),9,ml)])]),_:1},8,["data"])),[[N,s.loading]])]),_:1},8,["title"])]),_:1})])]}),_:1})])}}}),pl=q(ul,[["__scopeId","data-v-5d916b55"]]),vl={class:"p-12-16 pb-0 mt-12"},_l={class:"flex"},yl={class:"complex-search"},fl={class:"model-list-height"},hl=de({__name:"index",setup(s){const D=ce(),{model:m,user:I}=Te(),k=L(()=>D.path.includes("shared")?"systemShare":D.path.includes("resource-management")?"systemManage":"workspace"),A=L(()=>me.model[k.value]),S=L(()=>k.value==="systemShare"),W=h(),f=h(),d=h(!1),_=h(),p=h("name"),g=h({name:"",create_user:"",model_type:""}),R=h([]),P=h(!1),N=h([]),V=h([]),T=L(()=>_.value&&_.value.provider==="share"),C=(c,n)=>{V.value.filter(y=>y.id==c).forEach(y=>{y.status=n.status})},K=L(()=>xe(V.value,2)),H=h(),Q=h(),G=c=>{var n,y;_.value=c,l(),_.value.provider===""&&((n=W.value)==null||n.clearCurrent(),(y=f.value)==null||y.clearCurrent())},U=(c,n)=>{var y,b;c&&c.provider?(y=H.value)==null||y.open(c,n):(b=Q.value)==null||b.open()},l=()=>{var n,y;const c=(n=_.value)!=null&&n.provider&&((y=_.value)==null?void 0:y.provider)!=="share"?{provider:_.value.provider}:{};J({type:"model",isShared:T.value,systemType:k.value}).getModelList({...g.value,...c},P).then(b=>{V.value=b.data}),J({type:"workspace",isShared:T.value,systemType:k.value}).getAllMemberList(I.getWorkspaceId(),d).then(b=>{R.value=b.data})},w=()=>{g.value={name:"",create_user:"",model_type:""}};return ue(()=>{m.asyncGetProvider(d).then(c=>{_.value=se,N.value=[se,...c.data],l()})}),(c,n)=>{const y=r("el-option"),b=r("el-select"),ee=r("el-input"),X=r("el-button"),B=r("el-col"),z=r("el-row"),le=r("el-empty"),oe=r("ContentContainer"),te=r("LayoutContainer"),Y=pe("loading");return t(),i(te,{showCollapse:"",class:"model-manage"},{left:e(()=>[o("h4",vl,u(c.$t("views.model.provider")),1),a(pl,{data:N.value,onClick:G,loading:d.value,showShared:A.value.is_share(),active:_.value},null,8,["data","loading","showShared","active"])]),default:e(()=>{var ie;return[ne((t(),i(oe,{header:(ie=_.value)==null?void 0:ie.name,style:{padding:"0"}},{search:e(()=>[o("div",_l,[o("div",yl,[a(b,{class:"complex-search__left",modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=v=>p.value=v),style:{width:"120px"},onChange:w},{default:e(()=>[a(y,{label:c.$t("common.creator"),value:"create_user"},null,8,["label"]),a(y,{label:c.$t("views.model.modelForm.model_type.label"),value:"model_type"},null,8,["label"]),a(y,{label:c.$t("views.model.modelForm.modeName.label"),value:"name"},null,8,["label"])]),_:1},8,["modelValue"]),p.value==="name"?(t(),i(ee,{key:0,modelValue:g.value.name,"onUpdate:modelValue":n[1]||(n[1]=v=>g.value.name=v),onChange:l,placeholder:c.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):p.value==="create_user"?(t(),i(b,{key:1,modelValue:g.value.create_user,"onUpdate:modelValue":n[2]||(n[2]=v=>g.value.create_user=v),onChange:l,filterable:"",clearable:"",style:{width:"220px"}},{default:e(()=>[(t(!0),x(j,null,Z(R.value,v=>(t(),i(y,{key:v.id,value:v.id,label:v.nick_name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):p.value==="model_type"?(t(),i(b,{key:2,modelValue:g.value.model_type,"onUpdate:modelValue":n[3]||(n[3]=v=>g.value.model_type=v),clearable:"",onChange:l,style:{width:"220px"}},{default:e(()=>[(t(!0),x(j,null,Z(E(Le),v=>(t(),i(y,{key:v.value,label:v.text,value:v.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):$("",!0)]),!T.value&&A.value.create()?(t(),i(X,{key:0,class:"ml-16",type:"primary",onClick:n[4]||(n[4]=v=>U(_.value))},{default:e(()=>[M(u(c.$t("views.model.addModel")),1)]),_:1})):$("",!0)])]),default:e(()=>[o("div",fl,[K.value.length>0?(t(),i(z,{key:0,gutter:15,class:"w-full"},{default:e(()=>[(t(!0),x(j,null,Z(K.value,(v,ae)=>(t(),x(j,{key:ae},[(t(!0),x(j,null,Z(v,(ve,_e)=>(t(),i(B,{xs:24,sm:12,md:S.value?24:12,lg:S.value?12:8,xl:S.value?12:8,class:"mb-16",key:_e},{default:e(()=>[a(Ye,{onChange:l,updateModelById:C,model:ve,provider_list:N.value,isShared:T.value,isSystemShare:S.value,apiType:k.value},null,8,["model","provider_list","isShared","isSystemShare","apiType"])]),_:2},1032,["md","lg","xl"]))),128))],64))),128))]),_:1})):(t(),i(le,{key:1,description:c.$t("common.noData")},null,8,["description"]))])]),_:1},8,["header"])),[[Y,P.value]]),T.value?$("",!0):(t(),i(De,{key:0,ref_key:"createModelRef",ref:H,onSubmit:l,onChange:n[5]||(n[5]=v=>U(v))},null,512)),T.value?$("",!0):(t(),i(Ie,{key:1,ref_key:"selectProviderRef",ref:Q,onChange:n[6]||(n[6]=(v,ae)=>U(v,ae))},null,512))]}),_:1})}}}),Cl=q(hl,[["__scopeId","data-v-13008727"]]);export{Cl as default};
