import{a_ as Qe,b0 as Xe,aA as Ae,ay as ue,aD as s,aE as d,aF as a,aG as o,aW as A,b1 as y,aI as r,aJ as p,b2 as U,cF as Ye,aH as l,aK as k,aS as z,d0 as Be,bX as eo,cf as bo,aB as m,aV as de,aZ as le,aC as g,b7 as oo,aX as X,b8 as to,aY as ie,aT as P,b3 as we,aP as $o,cD as Co,aO as ge,aQ as Do,aU as So,b6 as xo,cG as Je,dx as Lo,dy as Io,cH as Ro,cI as Mo,bW as Ve,b_ as Vo,dz as he,c0 as ke,c1 as zo}from"./admin-Ca7cl6NN.js";import{_ as Ao}from"./icon_import-D9IDqZyN.js";import{c as lo,_ as Bo,a as Fo,b as No,M as Po}from"./McpToolConfigDialog-ClK6hm5s.js";import{_ as Uo}from"./AuthorizedWorkspaceDialog.vue_vue_type_script_setup_true_lang-BJP0423Q.js";import{M as Eo}from"./MoveToDialog-DXfoZkaM.js";const Ho="data:image/svg+xml,%3csvg%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M26.1563%202.66699L26.3594%202.68262C26.8258%202.75455%2027.2257%203.06988%2027.3994%203.51953L29.4004%208.7002C30.2431%2010.8818%2029.5573%2013.1583%2028.0215%2014.5771C28.0235%2014.6068%2028.0264%2014.6369%2028.0264%2014.667V28C28.0264%2028.7364%2027.4288%2029.333%2026.6924%2029.333H5.35941C4.62303%2029.333%204.0264%2028.7364%204.0264%2028V14.667C4.0264%2014.6372%204.02838%2014.6074%204.0303%2014.5781C2.49502%2013.1601%201.80856%2010.8847%202.65042%208.7041L4.65335%203.51953L4.74026%203.33594C4.97526%202.92651%205.41431%202.66712%205.89651%202.66699H26.1563ZM20.3653%2014.1885C19.388%2015.2979%2017.959%2015.9999%2016.3643%2016H15.6846C14.0896%2015.9999%2012.6589%2015.2983%2011.6817%2014.1885C10.7002%2015.2988%209.26596%2016%207.67288%2016C7.33622%2016%207.00883%2015.9688%206.69241%2015.9111V26.667H25.3594V15.9102C25.0425%2015.968%2024.7142%2016%2024.377%2016C22.7837%2015.9999%2021.347%2015.2993%2020.3653%2014.1885Z'%20fill='%23FF8800'/%3e%3c/svg%3e",Fe={_value:"/workspace/"};Object.defineProperty(Fe,"value",{get:function(){const{user:B}=Ae();return this._value+B.getWorkspaceId()+"/tool"}});const Oo=(B,F)=>Qe("/workspace/internal/tool",B,F),qo=(B,F)=>Qe("/workspace/store/tool",B,F),Wo=(B,F,w)=>Xe(`${Fe.value}/${B}/add_internal_tool`,F,void 0,w),jo=(B,F,w)=>Xe(`${Fe.value}/${B}/add_store_tool`,F,void 0,w),ze={getInternalToolList:Oo,getStoreToolList:qo,addInternalTool:Wo,addStoreTool:jo},Zo=["src"],Go={key:0,class:"card-footer-left color-secondary"},Jo=ue({__name:"ToolCard",props:{tool:{},getSubTitle:{type:Function},addLoading:{type:Boolean}},emits:["handleAdd","handleDetail"],setup(B,{emit:F}){const w=B,L=F;return($,i)=>{const D=s("el-avatar"),f=s("el-tag"),v=s("el-text"),I=s("el-button"),_=s("CardBox");return a(),d(_,{title:w.tool.name,description:w.tool.desc,class:"cursor tool-card"},{icon:o(()=>{var N,S,C;return[U(Be)((N=w.tool)==null?void 0:N.icon)?(a(),d(D,{key:0,shape:"square",size:32,style:{background:"none"}},{default:o(()=>{var H;return[r("img",{src:U(eo)((H=w.tool)==null?void 0:H.icon),alt:""},null,8,Zo)]}),_:1})):(S=w.tool)!=null&&S.name?(a(),d(D,{key:1,name:(C=w.tool)==null?void 0:C.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):y("",!0)]}),title:o(()=>{var N,S;return[r("div",null,[k(p((N=w.tool)==null?void 0:N.name)+" ",1),(S=w.tool)!=null&&S.version?(a(),d(f,{key:0,class:"ml-4",type:"info",effect:"plain"},{default:o(()=>{var C;return[k(p((C=w.tool)==null?void 0:C.version),1)]}),_:1})):y("",!0)])]}),subTitle:o(()=>[l(v,{class:"color-secondary",size:"small"},{default:o(()=>[k(p(B.getSubTitle(w.tool)),1)]),_:1})]),footer:o(()=>{var N;return[((N=w.tool)==null?void 0:N.downloads)!=null?(a(),A("span",Go,p(`${$.$t("views.document.upload.download")}: ${U(Ye)(w.tool.downloads||0)} `),1)):y("",!0),r("div",{class:"card-footer-operation mb-8",onClick:i[2]||(i[2]=z(()=>{},["stop"]))},[l(I,{onClick:i[0]||(i[0]=S=>L("handleDetail"))},{default:o(()=>[k(p($.$t("common.detail")),1)]),_:1}),l(I,{type:"primary",loading:w.addLoading,onClick:i[1]||(i[1]=S=>L("handleAdd"))},{default:o(()=>[k(p($.$t("common.add")),1)]),_:1},8,["loading"])])]}),_:1},8,["title","description"])}}}),Ke=bo(Jo,[["__scopeId","data-v-8040cd01"]]),Ko={class:"flex align-center",style:{"margin-left":"-8px"}},Qo={class:"card-header"},Xo={class:"flex-between"},Yo={class:"title flex align-center"},et=["src"],ot={class:"ml-16"},tt={class:"mb-8"},lt=ue({__name:"InternalDescDrawer",emits:["refresh","addTool"],setup(B,{expose:F,emit:w}){const L=w,$=m(!1),i=m(""),D=m({});de($,I=>{I||(i.value="")});const f=(I,_)=>{D.value=_,I&&(i.value=le.cloneDeep(I)),$.value=!0},v=I=>{L("addTool",I),$.value=!1};return F({open:f}),(I,_)=>{const N=s("Back"),S=s("el-icon"),C=s("el-button"),H=s("el-avatar"),W=s("el-text"),M=s("MdPreview"),Q=s("el-drawer");return a(),d(Q,{modelValue:$.value,"onUpdate:modelValue":_[3]||(_[3]=T=>$.value=T),size:"60%","append-to-body":!0},{header:o(()=>[r("div",Ko,[l(C,{class:"cursor mr-4",link:"",onClick:_[0]||(_[0]=z(T=>$.value=!1,["prevent"]))},{default:o(()=>[l(S,{size:20},{default:o(()=>[l(N)]),_:1})]),_:1}),_[4]||(_[4]=r("h4",null,"详情",-1))])]),default:o(()=>{var T,j,x,Z;return[r("div",null,[r("div",Qo,[r("div",Xo,[r("div",Yo,[U(Be)((T=D.value)==null?void 0:T.icon)?(a(),d(H,{key:0,shape:"square",size:64,style:{background:"none"},class:"mr-8"},{default:o(()=>{var J;return[r("img",{src:(J=D.value)==null?void 0:J.icon,alt:""},null,8,et)]}),_:1})):(j=D.value)!=null&&j.name?(a(),d(H,{key:1,name:(x=D.value)==null?void 0:x.name,pinyinColor:"",shape:"square",size:64,class:"mr-8"},null,8,["name"])):y("",!0),r("div",ot,[r("h3",tt,p(D.value.name),1),(Z=D.value)!=null&&Z.desc?(a(),d(W,{key:0,type:"info"},{default:o(()=>[k(p(D.value.desc),1)]),_:1})):y("",!0)])]),r("div",{onClick:_[2]||(_[2]=z(()=>{},["stop"]))},[l(C,{type:"primary",onClick:_[1]||(_[1]=J=>v(D.value))},{default:o(()=>[k(p(I.$t("common.add")),1)]),_:1})])])]),l(M,{ref:"editorRef",editorId:"preview-only",modelValue:i.value,style:{background:"none"},noImgZoomIn:""},null,8,["modelValue"])])]}),_:1},8,["modelValue"])}}}),nt={class:"dialog-header flex-between mb-8"},at=["id"],st={class:"flex align-center",style:{"margin-right":"28px"}},rt=["id"],it={key:1},ct={class:"color-text-primary medium mb-16"},dt={class:"color-primary"},ut=ue({__name:"ToolStoreDialog",props:{apiType:{type:String,default:"workspace"}},emits:["refresh"],setup(B,{expose:F,emit:w}){const{user:L}=Ae(),$=B,i=w,D=m(!1),f=m(!1),v=m(""),I=m(""),_=m("APPSTORE"),N=m([{id:"web_search",title:g("views.tool.toolStore.webSearch"),tools:[]},{id:"database_search",title:g("views.tool.toolStore.databaseQuery"),tools:[]}]),S=m([...N.value]),C=m(null);de(D,c=>{c||(_.value="APPSTORE")});function H(c){var h;return((h=S.value.find(V=>V.id===c.label))==null?void 0:h.title)??""}function W(c){I.value=c,C.value=null,D.value=!0,M()}async function M(){_.value==="INTERNAL"?await Q():await T()}async function Q(){try{S.value=N.value;const c=await ze.getInternalToolList({name:v.value},f);v.value.length?C.value=c.data:(C.value=null,S.value.forEach(h=>{h.tools=c.data.filter(V=>V.label===h.id)}))}catch(c){console.error(c)}}async function T(){try{const c=await ze.getStoreToolList({name:v.value},f),h=c.data.additionalProperties.tags,V=c.data.apps;V.forEach(O=>{O.desc=O.description}),v.value.length?C.value=c.data.apps:(C.value=null,S.value=h.map(O=>({id:O.key,title:O.name,tools:V.filter(ae=>ae.label===O.key)})))}catch(c){console.error(c)}}const j=c=>{c.preventDefault()},x=m();async function Z(c){var h,V;if(_.value==="INTERNAL"){const O=c.icon.replace("icon.png","detail.md"),ce=await(await fetch(O)).text();(h=x.value)==null||h.open(ce,c)}else(V=x.value)==null||V.open(c.readMe,c)}const J=m();function ne(c,h){var V;(V=J.value)==null||V.open(c,h)}const Y=m(!1);async function pe(c){_.value==="INTERNAL"?await _e(c):await Te(c)}async function _e(c){try{await P({type:"tool",systemType:$.apiType}).addInternalTool(c.id,{name:c.name,folder_id:I.value},Y).then(()=>L.profile()),i("refresh"),we(g("common.addSuccess")),D.value=!1}catch(h){console.error(h)}}async function Te(c){try{const h={name:c.name,folder_id:I.value,download_url:c.downloadUrl,download_callback_url:c.downloadCallbackUrl,icon:c.icon,versions:c.versions,label:c.label};await P({type:"tool",systemType:$.apiType}).addStoreTool(c.id,h,Y).then(()=>L.profile()),i("refresh"),we(g("common.addSuccess")),D.value=!1}catch(h){console.error(h)}}function be(){v.value="",M()}return F({open:W}),(c,h)=>{const V=s("el-radio-button"),O=s("el-radio-group"),ae=s("el-input"),ce=s("el-divider"),$e=s("el-anchor-link"),Ce=s("el-anchor"),fe=s("el-col"),me=s("el-row"),ve=s("el-empty"),De=s("el-scrollbar"),ye=s("LayoutContainer"),Se=s("el-dialog"),xe=oo("loading");return a(),A(X,null,[l(Se,{modelValue:D.value,"onUpdate:modelValue":h[2]||(h[2]=R=>D.value=R),width:"1200","append-to-body":"",class:"tool-store-dialog","align-center":"","close-on-click-modal":!1,"close-on-press-escape":!1},{header:o(({titleId:R})=>[r("div",nt,[r("h4",{id:R,class:"medium w-240 mr-8"},p(c.$t("views.tool.toolStore.title")),9,at),l(O,{modelValue:_.value,"onUpdate:modelValue":h[0]||(h[0]=G=>_.value=G),onChange:be,class:"app-radio-button-group"},{default:o(()=>[l(V,{value:"INTERNAL"},{default:o(()=>[k(p(c.$t("views.tool.toolStore.internal")),1)]),_:1}),l(V,{value:"APPSTORE"},{default:o(()=>[k(p(c.$t("views.tool.toolStore.title")),1)]),_:1})]),_:1},8,["modelValue"]),r("div",st,[l(ae,{modelValue:v.value,"onUpdate:modelValue":h[1]||(h[1]=G=>v.value=G),placeholder:c.$t("common.search"),"prefix-icon":"Search",class:"w-240 mr-8",clearable:"",onChange:M},null,8,["modelValue","placeholder"]),l(ce,{direction:"vertical"})])])]),default:o(()=>[to((a(),d(ye,null,{left:o(()=>[l(Ce,{direction:"vertical",offset:130,type:"default",container:".category-scrollbar",onClick:j},{default:o(()=>[(a(!0),A(X,null,ie(S.value,R=>(a(),d($e,{key:R.id,href:`#category-${R.id}`,title:R.title},null,8,["href","title"]))),128))]),_:1})]),default:o(()=>[l(De,{class:"layout-bg","wrap-class":"p-16-24 category-scrollbar"},{default:o(()=>[C.value===null?(a(!0),A(X,{key:0},ie(S.value,R=>(a(),A("div",{key:R.id},[r("h4",{class:"title-decoration-1 mb-16 mt-8 color-text-primary",id:`category-${R.id}`},p(R.title),9,rt),l(me,{gutter:16},{default:o(()=>[(a(!0),A(X,null,ie(R.tools,G=>(a(),d(fe,{key:G.id,span:12,class:"mb-16"},{default:o(()=>[l(Ke,{tool:G,addLoading:Y.value,"get-sub-title":H,onHandleAdd:Le=>ne(G),onHandleDetail:Le=>Z(G)},null,8,["tool","addLoading","onHandleAdd","onHandleDetail"])]),_:2},1024))),128))]),_:2},1024)]))),128)):(a(),A("div",it,[r("h4",ct,[r("span",dt,p(v.value),1),k(" "+p(U(g)("views.tool.toolStore.searchResult",{count:C.value.length})),1)]),C.value.length?(a(),d(me,{key:0,gutter:16},{default:o(()=>[(a(!0),A(X,null,ie(C.value,R=>(a(),d(fe,{key:R.id,span:12,class:"mb-16"},{default:o(()=>[l(Ke,{tool:R,addLoading:Y.value,"get-sub-title":H,onHandleAdd:G=>ne(R),onHandleDetail:G=>Z(R)},null,8,["tool","addLoading","onHandleAdd","onHandleDetail"])]),_:2},1024))),128))]),_:1})):(a(),d(ve,{key:1,description:c.$t("common.noData")},null,8,["description"]))]))]),_:1})]),_:1})),[[xe,f.value]])]),_:1},8,["modelValue"]),l(lt,{ref_key:"internalDescDrawerRef",ref:x,onAddTool:ne},null,512),l(lo,{ref_key:"addInternalToolDialogRef",ref:J,onRefresh:pe},null,512)],64)}}}),pt={class:"flex align-center",style:{"margin-left":"-8px"}},_t={class:"card-header"},ft={class:"flex-between"},mt={class:"title flex align-center"},vt=["src"],yt={class:"ml-16"},gt={class:"mb-8"},ht={key:0,class:"mt-16"},kt=ue({__name:"ToolStoreDescDrawer",emits:["refresh","addTool"],setup(B,{expose:F,emit:w}){const L=m(!1),$=m(""),i=m({});return de(L,f=>{f||($.value="")}),F({open:(f,v)=>{i.value=v,f&&($.value=le.cloneDeep(f)),L.value=!0}}),(f,v)=>{const I=s("Back"),_=s("el-icon"),N=s("el-button"),S=s("el-avatar"),C=s("el-text"),H=s("MdPreview"),W=s("el-drawer");return a(),d(W,{modelValue:L.value,"onUpdate:modelValue":v[1]||(v[1]=M=>L.value=M),size:"60%","append-to-body":!0},{header:o(()=>[r("div",pt,[l(N,{class:"cursor mr-4",link:"",onClick:v[0]||(v[0]=z(M=>L.value=!1,["prevent"]))},{default:o(()=>[l(_,{size:20},{default:o(()=>[l(I)]),_:1})]),_:1}),v[2]||(v[2]=r("h4",null,"详情",-1))])]),default:o(()=>{var M,Q,T,j,x;return[r("div",null,[r("div",_t,[r("div",ft,[r("div",mt,[U(Be)((M=i.value)==null?void 0:M.icon)?(a(),d(S,{key:0,shape:"square",size:64,style:{background:"none"},class:"mr-8"},{default:o(()=>{var Z;return[r("img",{src:(Z=i.value)==null?void 0:Z.icon,alt:""},null,8,vt)]}),_:1})):(Q=i.value)!=null&&Q.name?(a(),d(S,{key:1,name:(T=i.value)==null?void 0:T.name,pinyinColor:"",shape:"square",size:64,class:"mr-8"},null,8,["name"])):y("",!0),r("div",yt,[r("h3",gt,p(i.value.name),1),(j=i.value)!=null&&j.desc?(a(),d(C,{key:0,type:"info"},{default:o(()=>[k(p(i.value.desc),1)]),_:1})):y("",!0)])])]),((x=i.value)==null?void 0:x.downloads)!=null?(a(),A("div",ht,[l(C,{type:"info"},{default:o(()=>{var Z;return[r("div",null,p(f.$t("views.document.upload.download"))+": "+p(U(Ye)(((Z=i.value)==null?void 0:Z.downloads)||0)),1)]}),_:1})])):y("",!0)]),l(H,{ref:"editorRef",editorId:"preview-only",modelValue:$.value,style:{background:"none"},noImgZoomIn:""},null,8,["modelValue"])])]}),_:1},8,["modelValue"])}}}),wt={class:"flex"},Tt={class:"flex-between complex-search"},bt={class:"flex align-center"},$t={class:"pre-wrap ml-8"},Ct={class:"lighter"},Dt={class:"flex align-center"},St={class:"pre-wrap ml-8"},xt={class:"lighter"},Lt={class:"flex align-center w-full"},It={class:"pre-wrap ml-8"},Rt={class:"lighter"},Mt={class:"flex align-center"},Vt={class:"pre-wrap ml-8"},zt={class:"lighter"},At={class:"flex align-center"},Bt={class:"pre-wrap ml-4"},Ft={class:"lighter"},Nt={style:{"max-height":"calc(100vh - 120px)"}},Pt=["src"],Ut={key:1,class:"dot-success"},Et={key:0,class:"flex align-center"},Ht={class:"color-secondary"},Ot={key:1,class:"flex align-center"},qt={class:"color-secondary"},Kt=ue({__name:"ToolListContainer",emits:["refreshFolder"],setup(B,{emit:F}){const w=$o(),{folder:L,user:$,tool:i}=Ae();Co((e,t)=>{i.setToolList([])});const D=F,f=ge(()=>w.path.includes("shared")?"systemShare":w.path.includes("resource-management")?"systemManage":"workspace"),v=ge(()=>L.currentFolder.id==="share"),I=ge(()=>f.value==="systemShare"),_=ge(()=>Do.tool[f.value]),N=e=>_.value.edit(e)||_.value.export(e)||_.value.delete(e)||_.value.auth(e)||I.value,S=m();function C(e){S.value.open(e.id)}const H=m(),W=m("name"),M=m({name:"",create_user:""}),Q=m([]),T=m(!1),j=m(!1),x=So({current_page:1,page_size:30,total:0}),Z=()=>{M.value={name:"",create_user:""}},J=m(),ne=m(),Y=m(""),pe=m(""),_e=m();function Te(e){var u;const t={id:e.id,folder_id:e.folder};(u=_e.value)==null||u.open(t)}function be(e){const t=le.cloneDeep(i.toolList),u=t.findIndex(b=>b.id===e.id);t.splice(u,1),i.setToolList(t)}const c=m();function h(e){c.value&&c.value.open(e,"Tool")}const V=m();function O(e){var t;if((e==null?void 0:e.tool_type)==="MCP"){he.emit("select_node",e.folder_id),ae(e);return}if(e!=null&&e.version){let u="";R.value.filter(b=>b.id===e.template_id).forEach(b=>{u=b.readMe}),he.emit("select_node",e.folder_id),(t=V.value)==null||t.open(u,e);return}e!=null&&e.template_id||v.value||(Y.value=e?g("views.tool.editTool"):g("views.tool.createTool"),e?P({type:"tool",systemType:f.value}).getToolById(e==null?void 0:e.id,T).then(u=>{he.emit("select_node",e.folder_id),J.value.open(u.data)}):J.value.open(e),e&&he.emit("select_node",e.folder_id))}function ae(e){e!=null&&e.template_id||v.value||(pe.value=e?g("views.tool.editMcpTool"):g("views.tool.createMcpTool"),e?P({type:"tool",systemType:f.value}).getToolById(e==null?void 0:e.id,T).then(t=>{ne.value.open(t.data)}):ne.value.open(e))}async function ce(e){if(e.is_active)ke(`${g("views.tool.disabled.confirmTitle")}${e.name} ?`,g("views.tool.disabled.confirmMessage"),{confirmButtonText:g("common.status.disable"),confirmButtonClass:"danger"}).then(()=>{const t={is_active:!e.is_active};P({type:"tool",systemType:f.value}).putTool(e.id,t,j).then(()=>{const u=le.cloneDeep(i.toolList),b=u.findIndex(oe=>oe.id===e.id);return u[b].is_active=!e.is_active,i.setToolList(u),!0}).catch(()=>!1)});else{const t=await P({type:"tool",systemType:f.value}).getToolById(e.id,j);if((!t.data.init_params||Object.keys(t.data.init_params).length===0)&&t.data.init_field_list&&t.data.init_field_list.length>0&&t.data.init_field_list.filter(b=>b.default_value&&b.show_default_value).length!==t.data.init_field_list.length)return H.value.open(t.data,!e.is_active),!1;const u={is_active:!e.is_active};P({type:"tool",systemType:f.value}).putTool(e.id,u,j).then(()=>{const b=le.cloneDeep(i.toolList),oe=b.findIndex(Ie=>Ie.id===e.id);return b[oe].is_active=!e.is_active,i.setToolList(b),!0}).catch(()=>!1)}}async function $e(e){Y.value=g("views.tool.copyTool");const t=await P({type:"tool",systemType:f.value}).getToolById(e.id,j),u=le.cloneDeep(t.data);delete u.id,u.name=u.name+`  ${g("common.copyTitle")}`,J.value.open(u)}function Ce(e){P({type:"tool",systemType:f.value}).exportTool(e.id,e.name,T).catch(t=>{t.response.status!==403&&t.response.data.text().then(u=>{zo(`${g("views.application.tip.ExportError")}:${JSON.parse(u).message}`)})})}function fe(e){ke(`${g("views.tool.delete.confirmTitle")}：${e.name} ?`,g("views.tool.delete.confirmMessage"),{confirmButtonText:g("common.confirm"),cancelButtonText:g("common.cancel"),confirmButtonClass:"danger"}).then(()=>{P({type:"tool",systemType:f.value}).delTool(e.id,T).then(()=>{const t=le.cloneDeep(i.toolList),u=t.findIndex(b=>b.id===e.id);t.splice(u,1),i.setToolList(t),we(g("common.deleteSuccess"))})}).catch(()=>{})}function me(e){P({type:"tool",systemType:f.value}).getToolById(e==null?void 0:e.id,j).then(t=>{H.value.open(t.data)})}const ve=m();function De(){var e;(e=ve.value)==null||e.open(L.currentFolder.id)}const ye=m();function Se(e,t){var u;(u=ye.value)==null||u.open(e,t)}function xe(e,t){t&&P({type:"tool",systemType:f.value}).putTool(e==null?void 0:e.id,{name:e.name},T).then(u=>{we(g("common.saveSuccess")),se()})}const R=m([]);function G(){ze.getStoreToolList({name:""},T).then(e=>{R.value=e.data.apps})}function Le(e){for(const t of R.value)if(t.id===e.template_id&&t.version!==e.version)return e.downloadUrl=t.downloadUrl,e.downloadCallbackUrl=t.downloadCallbackUrl,e.icon=t.icon,e.versions=t.versions,e.label=t.label,!0}function no(e){ke(g("views.tool.toolStore.confirmTip")+e.name,g("views.tool.toolStore.updateStoreToolMessage"),{cancelButtonText:g("common.cancel"),confirmButtonText:g("common.confirm")}).then(()=>{const t={download_url:e.downloadUrl,download_callback_url:e.downloadCallbackUrl,icon:e.icon,versions:e.versions,label:e.label};P({type:"tool",systemType:f.value}).updateStoreTool(e.id,t,T).then(async u=>{if(u!=null&&u.data)return i.setToolList([]),$.profile()}).then(()=>{ee()})}).catch(()=>{})}const Ne=m();function ao(e){const t=new FormData;t.append("file",e.raw,e.name),t.append("folder_id",L.currentFolder.id||$.getWorkspaceId()),Ne.value.clearFiles(),P({type:"tool",systemType:f.value}).postImportTool(t,T).then(async u=>{if(u!=null&&u.data)return i.setToolList([]),$.profile()}).then(()=>{ee()}).catch(u=>{u.code===400&&ke(g("common.tip"),g("views.application.tip.professionalMessage"),{cancelButtonText:g("common.confirm"),confirmButtonText:g("common.professional")}).then(()=>{window.open("https://maxkb.cn/pricing.html","_blank")})})}const Pe=m();function so(e){P({type:"tool",systemType:f.value}).getToolById(e==null?void 0:e.id,T).then(t=>{Pe.value.open(t.data)})}function se(e){if(e){const t=le.cloneDeep(i.toolList),u=t.findIndex(b=>b.id===e.id);t.splice(u,1,e),i.setToolList(t)}else x.total=0,x.current_page=1,i.setToolList([]),ee()}const Ue=m();function ro(){Ue.value.open(Ve.TOOL,L.currentFolder.id)}de(()=>L.currentFolder,e=>{e&&e.id&&(x.current_page=1,i.setToolList([]),ee())},{deep:!0,immediate:!0}),de(()=>i.tool_type,()=>{x.current_page=1,i.setToolList([]),ee()});function ee(){var t;const e={folder_id:((t=L.currentFolder)==null?void 0:t.id)||$.getWorkspaceId(),scope:f.value==="systemShare"?"SHARED":"WORKSPACE",tool_type:i.tool_type||""};M.value[W.value]&&(e[W.value]=M.value[W.value]),P({type:"tool",isShared:v.value,systemType:f.value}).getToolListPage(x,e,T).then(u=>{var b,oe;x.total=(b=u.data)==null?void 0:b.total,i.setToolList([...i.toolList,...(oe=u.data)==null?void 0:oe.records])})}function io(e){L.setCurrentFolder(e)}function co(){D("refreshFolder")}function Ee(){x.current_page=1,i.setToolList([]),ee()}return xo(()=>{f.value!=="workspace"&&ee(),P({type:"workspace",isShared:v.value,systemType:f.value}).getAllMemberList($.getWorkspaceId(),T).then(e=>{Q.value=e.data}),G()}),(e,t)=>{const u=s("el-option"),b=s("el-select"),oe=s("el-input"),Ie=s("arrow-down"),Re=s("el-icon"),Me=s("el-button"),re=s("el-avatar"),E=s("el-dropdown-item"),uo=s("el-upload"),q=s("AppIcon"),He=s("el-dropdown-menu"),Oe=s("el-dropdown"),qe=s("el-text"),We=s("CardBox"),je=s("el-col"),po=s("ToolIcon"),Ze=s("el-tag"),_o=s("Refresh"),fo=s("el-tooltip"),mo=s("SuccessFilled"),vo=s("el-switch"),yo=s("el-divider"),go=s("el-row"),ho=s("el-empty"),ko=s("InfiniteScroll"),wo=s("ContentContainer"),To=oo("loading");return a(),A(X,null,[l(wo,null,{header:o(()=>[Ro(e.$slots,"header")]),search:o(()=>[r("div",wt,[r("div",Tt,[l(b,{class:"complex-search__left",modelValue:W.value,"onUpdate:modelValue":t[0]||(t[0]=n=>W.value=n),style:{width:"120px"},onChange:Z},{default:o(()=>[l(u,{label:e.$t("common.creator"),value:"create_user"},null,8,["label"]),l(u,{label:e.$t("views.tool.form.toolName.label"),value:"name"},null,8,["label"])]),_:1},8,["modelValue"]),W.value==="name"?(a(),d(oe,{key:0,modelValue:M.value.name,"onUpdate:modelValue":t[1]||(t[1]=n=>M.value.name=n),onChange:Ee,placeholder:e.$t("common.searchBar.placeholder"),style:{width:"220px"},clearable:""},null,8,["modelValue","placeholder"])):W.value==="create_user"?(a(),d(b,{key:1,modelValue:M.value.create_user,"onUpdate:modelValue":t[2]||(t[2]=n=>M.value.create_user=n),onChange:Ee,filterable:"",clearable:"",style:{width:"220px"}},{default:o(()=>[(a(!0),A(X,null,ie(Q.value,n=>(a(),d(u,{key:n.id,value:n.id,label:n.nick_name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):y("",!0)]),!v.value&&_.value.create()?(a(),d(Oe,{key:0,trigger:"click"},{dropdown:o(()=>[l(He,{class:"create-dropdown"},{default:o(()=>[l(E,{onClick:t[3]||(t[3]=n=>O())},{default:o(()=>[r("div",bt,[l(re,{class:"avatar-green",shape:"square",size:32},{default:o(()=>[...t[10]||(t[10]=[r("img",{src:Lo,style:{width:"58%"},alt:""},null,-1)])]),_:1}),r("div",$t,[r("div",Ct,p(e.$t("views.tool.createTool")),1)])])]),_:1}),l(E,{onClick:t[4]||(t[4]=n=>ae())},{default:o(()=>[r("div",Dt,[l(re,{shape:"square",size:32},{default:o(()=>[...t[11]||(t[11]=[r("img",{src:Io,style:{width:"75%"},alt:""},null,-1)])]),_:1}),r("div",St,[r("div",xt,p(e.$t("views.tool.createMcpTool")),1)])])]),_:1}),l(uo,{ref_key:"elUploadRef",ref:Ne,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(n,Ge)=>ao(n),class:"import-button"},{default:o(()=>[_.value.import()?(a(),d(E,{key:0},{default:o(()=>[r("div",Lt,[l(re,{shape:"square",size:32,style:{background:"none"}},{default:o(()=>[...t[12]||(t[12]=[r("img",{src:Ao,alt:""},null,-1)])]),_:1}),r("div",It,[r("div",Rt,p(e.$t("common.importCreate")),1)])])]),_:1})):y("",!0)]),_:1},8,["on-change"]),l(E,{onClick:t[5]||(t[5]=n=>De())},{default:o(()=>[r("div",Mt,[l(re,{shape:"square",size:32,style:{background:"none"}},{default:o(()=>[...t[13]||(t[13]=[r("img",{src:Ho,alt:""},null,-1)])]),_:1}),r("div",Vt,[r("div",zt,p(e.$t("views.tool.toolStore.createFromToolStore")),1)])])]),_:1}),f.value==="workspace"?(a(),d(E,{key:0,onClick:ro,divided:""},{default:o(()=>[r("div",At,[l(q,{iconName:"app-folder",style:{"font-size":"32px"}}),r("div",Bt,[r("div",Ft,p(e.$t("components.folder.addFolder")),1)])])]),_:1})):y("",!0)]),_:1})]),default:o(()=>[l(Me,{type:"primary",class:"ml-8"},{default:o(()=>[k(p(e.$t("common.create"))+" ",1),l(Re,{class:"el-icon--right"},{default:o(()=>[l(Ie)]),_:1})]),_:1})]),_:1})):y("",!0)])]),default:o(()=>[to((a(),A("div",Nt,[l(ko,{size:U(i).toolList.length,total:x.total,page_size:x.page_size,current_page:x.current_page,"onUpdate:current_page":t[9]||(t[9]=n=>x.current_page=n),onLoad:ee,loading:T.value},{default:o(()=>[U(i).toolList.length>0?(a(),d(go,{key:0,gutter:15,class:"w-full"},{default:o(()=>[(a(!0),A(X,null,ie(U(i).toolList,(n,Ge)=>(a(),A(X,{key:Ge},[n.resource_type==="folder"?(a(),d(je,{key:0,xs:24,sm:12,md:12,lg:8,xl:6,class:"mb-16"},{default:o(()=>[l(We,{title:n.name,description:n.desc||e.$t("components.noDesc"),class:"cursor",onClick:te=>io(n)},{icon:o(()=>[l(re,{shape:"square",size:32,style:{background:"none"}},{default:o(()=>[l(q,{iconName:"app-folder",style:{"font-size":"32px"}})]),_:1})]),subTitle:o(()=>[l(qe,{class:"color-secondary lighter",size:"small"},{default:o(()=>[k(p(e.$t("common.creator"))+": "+p(U(Je)(n.nick_name)),1)]),_:2},1024)]),_:2},1032,["title","description","onClick"])]),_:2},1024)):(a(),d(je,{key:1,xs:24,sm:12,md:12,lg:8,xl:6,class:"mb-16"},{default:o(()=>[l(We,{title:n.name,description:n.desc,class:"cursor",onClick:z(te=>O(n),["stop"]),disabled:_.value.edit(n.id)},{icon:o(()=>[n!=null&&n.icon?(a(),d(re,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-8"},{default:o(()=>[r("img",{src:U(eo)(n==null?void 0:n.icon),alt:""},null,8,Pt)]),_:2},1024)):(a(),d(po,{key:1,size:32,type:n==null?void 0:n.tool_type},null,8,["type"]))]),title:o(()=>[r("div",null,[k(p(n.name)+" ",1),n.version?(a(),d(Ze,{key:0,class:"ml-4",type:"info",effect:"plain"},{default:o(()=>[k(p(n.version),1)]),_:2},1024)):y("",!0)])]),subTitle:o(()=>[l(qe,{class:"color-secondary lighter",size:"small"},{default:o(()=>[k(p(e.$t("common.creator"))+": "+p(U(Je)(n.nick_name)),1)]),_:2},1024)]),tag:o(({hoverShow:te})=>[v.value?(a(),d(Ze,{key:0,type:"info",class:"info-tag"},{default:o(()=>[k(p(U(g)("views.shared.title")),1)]),_:1})):y("",!0),l(fo,{effect:"dark",content:"更新版本"},{default:o(()=>[Le(n)&&!v.value&&_.value.edit(n.id)?(a(),d(Me,{key:0,text:"",onClick:[t[6]||(t[6]=z(()=>{},["stop"])),K=>no(n)]},{default:o(()=>[te?(a(),d(Re,{key:0},{default:o(()=>[l(_o)]),_:1})):(a(),A("div",Ut))]),_:2},1032,["onClick"])):y("",!0)]),_:2},1024)]),footer:o(()=>[n.is_active?(a(),A("div",Et,[l(Re,{class:"color-success mr-8",style:{"font-size":"16px"}},{default:o(()=>[l(mo)]),_:1}),r("span",Ht,p(e.$t("common.status.enabled")),1)])):(a(),A("div",Ot,[l(q,{iconName:"app-disabled",class:"color-secondary mr-8"}),r("span",qt,p(e.$t("common.status.disabled")),1)]))]),mouseEnter:o(()=>[!v.value&&N(n.id)?(a(),A("div",{key:0,onClick:t[8]||(t[8]=z(()=>{},["stop"]))},[_.value.switch(n.id)?(a(),d(vo,{key:0,modelValue:n.is_active,"onUpdate:modelValue":te=>n.is_active=te,"before-change":()=>ce(n),size:"small",class:"mr-4"},null,8,["modelValue","onUpdate:modelValue","before-change"])):y("",!0),l(yo,{direction:"vertical"}),l(Oe,{trigger:"click"},{dropdown:o(()=>[l(He,null,{default:o(()=>{var te;return[n.tool_type==="MCP"?(a(),d(E,{key:0,onClick:z(K=>so(n),["stop"])},{default:o(()=>[l(q,{iconName:"app-operate-log",class:"color-secondary"}),k(" "+p(e.$t("views.tool.mcpConfig")),1)]),_:1},8,["onClick"])):y("",!0),n.template_id&&_.value.edit(n.id)?(a(),d(E,{key:1,onClick:z(K=>Se(n,!0),["stop"])},{default:o(()=>[l(q,{iconName:"app-edit",class:"color-secondary"}),k(" "+p(e.$t("common.edit")),1)]),_:1},8,["onClick"])):y("",!0),!n.template_id&&_.value.edit(n.id)?(a(),d(E,{key:2,onClick:z(K=>O(n),["stop"])},{default:o(()=>[l(q,{iconName:"app-edit",class:"color-secondary"}),k(" "+p(e.$t("common.edit")),1)]),_:1},8,["onClick"])):y("",!0),!n.template_id&&_.value.copy(n.id)&&n.tool_type!=="MCP"?(a(),d(E,{key:3,onClick:z(K=>$e(n),["stop"])},{default:o(()=>[l(q,{iconName:"app-copy",class:"color-secondary"}),k(" "+p(e.$t("common.copy")),1)]),_:1},8,["onClick"])):y("",!0),((te=n.init_field_list)==null?void 0:te.length)>0&&_.value.edit(n.id)?(a(),d(E,{key:4,onClick:z(K=>me(n),["stop"])},{default:o(()=>[l(q,{iconName:"app-operation",class:"color-secondary"}),k(" "+p(e.$t("common.param.initParam")),1)]),_:1},8,["onClick"])):y("",!0),f.value==="workspace"&&_.value.auth(n.id)?(a(),d(E,{key:5,onClick:z(K=>C(n),["stop"])},{default:o(()=>[l(q,{iconName:"app-resource-authorization",class:"color-secondary"}),k(" "+p(e.$t("views.system.resourceAuthorization.title")),1)]),_:1},8,["onClick"])):y("",!0),_.value.copy(n.id)&&f.value==="workspace"?(a(),d(E,{key:6,onClick:z(K=>Te(n),["stop"])},{default:o(()=>[l(q,{iconName:"app-migrate",class:"color-secondary"}),k(" "+p(e.$t("common.moveTo")),1)]),_:1},8,["onClick"])):y("",!0),I.value?(a(),d(E,{key:7,onClick:z(K=>h(n),["stop"])},{default:o(()=>[l(q,{iconName:"app-lock",class:"color-secondary"}),k(" "+p(e.$t("views.shared.authorized_workspace")),1)]),_:1},8,["onClick"])):y("",!0),!n.template_id&&_.value.export(n.id)&&n.tool_type!=="MCP"?(a(),d(E,{key:8,onClick:z(K=>Ce(n),["stop"])},{default:o(()=>[l(q,{iconName:"app-export",class:"color-secondary"}),k(" "+p(e.$t("common.export")),1)]),_:1},8,["onClick"])):y("",!0),_.value.delete(n.id)?(a(),d(E,{key:9,divided:"",onClick:z(K=>fe(n),["stop"])},{default:o(()=>[l(q,{iconName:"app-delete",class:"color-secondary"}),k(" "+p(e.$t("common.delete")),1)]),_:1},8,["onClick"])):y("",!0)]}),_:2},1024)]),default:o(()=>[l(Me,{text:"",onClick:t[7]||(t[7]=z(()=>{},["stop"]))},{default:o(()=>[l(q,{iconName:"app-more"})]),_:1})]),_:2},1024)])):y("",!0)]),_:2},1032,["title","description","onClick","disabled"])]),_:2},1024))],64))),128))]),_:1})):(a(),d(ho,{key:1,description:e.$t("common.noData")},null,8,["description"]))]),_:1},8,["size","total","page_size","current_page","loading"])])),[[To,x.current_page===1&&T.value,void 0,{fullscreen:!0,lock:!0}]])]),_:3}),l(Bo,{ref_key:"InitParamDrawerRef",ref:H,onRefresh:se},null,512),l(Fo,{ref_key:"ToolFormDrawerRef",ref:J,onRefresh:se,title:Y.value},null,8,["title"]),l(No,{ref_key:"McpToolFormDrawerRef",ref:ne,onRefresh:se,title:pe.value},null,8,["title"]),v.value?y("",!0):(a(),d(Mo,{key:0,ref_key:"CreateFolderDialogRef",ref:Ue,onRefresh:co},null,512)),l(ut,{ref_key:"toolStoreDialogRef",ref:ve,"api-type":f.value,onRefresh:se},null,8,["api-type"]),l(lo,{ref_key:"AddInternalToolDialogRef",ref:ye,onRefresh:xe},null,512),l(Po,{ref_key:"McpToolConfigDialogRef",ref:Pe,onRefresh:se},null,512),I.value?(a(),d(Uo,{key:1,ref_key:"AuthorizedWorkspaceDialogRef",ref:c},null,512)):y("",!0),f.value==="workspace"?(a(),d(Eo,{key:2,ref_key:"MoveToDialogRef",ref:_e,source:U(Ve).TOOL,onRefresh:be},null,8,["source"])):y("",!0),f.value==="workspace"?(a(),d(Vo,{key:3,type:U(Ve).TOOL,ref_key:"ResourceAuthorizationDrawerRef",ref:S},null,8,["type"])):y("",!0),l(kt,{ref_key:"toolStoreDescDrawerRef",ref:V},null,512)],64)}}});export{Kt as _};
